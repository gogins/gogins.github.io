{"version":3,"file":"sounds_BnVsTbRJ.mjs","sources":["../../../src/pages/technical-manual/sounds.mdx","../../../src/pages/learn/sounds.mdx"],"sourcesContent":["---\ntitle: Sounds\nlayout: ../../layouts/MainLayout.astro\n---\n\nimport { MiniRepl } from '../../docs/MiniRepl';\n\n# Sounds\n\nLet's take a closer look about how sounds are implemented in the webaudio output.\n\n## Registering a sound\n\nAll sounds are registered in the sound map, using the the `registerSound` function:\n\n```ts\nfunction registerSound(\n  name: string, // The name of the sound that should be given to `s`, e.g. `mysaw`\n  // The function called by the scheduler to trigger the sound:\n  (\n    time: number, // The audio context time the sound should start\n    value: object, // The value of the `Hap`\n    onended: () => void // A callback that should be fired when the sound has ended\n  ) => {\n    node: AudioNode, // node to connect to rest of the effects chain\n    stop: (time:number) => void // a function that will stop the sound\n  },\n  data: object // meta data, only for ui logic in sounds tab\n);\n```\n\nWhen `registerSound` is called, it registers `{ onTrigger, data }` under the given `name` in a [nanostore map](https://github.com/nanostores/nanostores#maps).\n\n### Example\n\nThis might be a bit abstract, so here is a minimal example:\n\n```js\nregisterSound(\n  'mysaw',\n  (time, value, onended) => {\n    let { freq } = value; // destructure control params\n    const ctx = getAudioContext();\n    // create oscillator\n    const o = new OscillatorNode(ctx, { type: 'sawtooth', frequency: Number(freq) });\n    o.start(time);\n    // add gain node to level down osc\n    const g = new GainNode(ctx, { gain: 0.3 });\n    // connect osc to gain\n    const node = o.connect(g);\n    // this function can be called from outside to stop the sound\n    const stop = (time) => o.stop(time);\n    // ended will be fired when stop has been fired\n    o.addEventListener('ended', () => {\n      o.disconnect();\n      g.disconnect();\n      onended();\n    });\n    return { node, stop };\n  },\n  { type: 'synth' },\n);\n// use the sound\nfreq(220, 440, 330).s('mysaw');\n```\n\nYou can actually use this code in the [REPL](https://strudel.cc/) and it'll work.\nAfter evaluating the code, you should see `mysaw` in listed in the sounds tab.\n\n## Playing sounds\n\nNow here is what happens when a sound is played:\nWhen the webaudio output plays a `Hap`, it will lookup and call the `onTrigger` function for the given `s`.\nThe returned `node` can then be connected to the rest of the standard effects chain\nHaving the stop function separate allows playing sounds via midi too, where you don't know how long the noteon will last\n","---\ntitle: Sounds\nlayout: ../../layouts/MainLayout.astro\n---\n\nimport { MiniRepl } from '../../docs/MiniRepl';\nimport { JsDoc } from '../../docs/JsDoc';\n\n# Sounds\n\nWe can play sounds with `s`, in two different ways:\n\n- `s` can trigger audio samples, where a sound file is loaded in the background and played back:\n  <MiniRepl client:idle tune={`s(\"bd hh sd hh\")`} />\n- `s` can trigger audio synthesisers, which are synthesised in real-time using code also running in the background:\n  <MiniRepl client:idle tune={`s(\"sawtooth square triangle sine\")`} />\n\nYou can learn more about both of these approaches in the pages [Synths](/learn/synths) and [Samples](/learn/samples).\n\n# Combining notes and sounds\n\nIn both of the above cases, we are no longer directly controlling the `note`/`freq` of the sound heard via `s`, as we were in the [Notes](/workshop/first-notes/) page.\n\nSo how can we both control the sound and the pitch? We can _combine_ `note`/`freq` with `s` to change the sound of our pitches:\n\n<MiniRepl client:idle tune={`note(\"a3 c#4 e4 a4\").s(\"sawtooth\")`} />\n\n<MiniRepl client:idle tune={`note(\"57 61 64 69\").s(\"sine\")`} />\n\n<MiniRepl client:idle tune={`freq(\"220 275 330 440\").s(\"triangle\")`} />\n\nThe last example will actually sound the same with or without `s`, because `triangle` is the default value for `s`.\n\nWhat about combining different notes with different sounds at the same time?\n\n<MiniRepl client:idle tune={`freq(\"220 275 330 440 550\").s(\"triangle sawtooth sine\")`} />\n\nHmm, something interesting is going on there, related to there being five notes and three sounds.\n\nLet's now take a step back and think about the Strudel [Code](/learn/code/) we've been hearing so far.\n"],"names":["_jsx","_components","a","tabindex","href","children","span","class","p","_jsxs","h2","id","code","pre","style","ul","li","MiniRepl","tune","h1"],"mappings":"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"}