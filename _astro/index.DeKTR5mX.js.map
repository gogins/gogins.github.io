{"version":3,"file":"index.DeKTR5mX.js","sources":["../../../node_modules/.pnpm/fraction.js@4.3.7/node_modules/fraction.js/fraction.js","../../../packages/core/fraction.mjs","../../../packages/core/timespan.mjs","../../../packages/core/hap.mjs","../../../packages/core/state.mjs","../../../packages/core/logger.mjs","../../../packages/core/util.mjs","../../../packages/core/value.mjs","../../../packages/core/drawLine.mjs","../../../packages/core/pattern.mjs","../../../packages/core/controls.mjs","../../../packages/core/euclid.mjs","../../../packages/core/zyklus.mjs","../../../packages/core/signal.mjs","../../../packages/core/speak.mjs","../../../packages/core/evaluate.mjs","../../../packages/core/neocyclist.mjs","../../../packages/core/cyclist.mjs","../../../packages/core/time.mjs","../../../packages/core/repl.mjs","../../../packages/core/ui.mjs","../../../packages/core/index.mjs","../../../packages/draw/draw.mjs","../../../packages/draw/animate.mjs","../../../packages/draw/pianoroll.mjs","../../../packages/draw/spiral.mjs","../../../node_modules/.pnpm/nanostores@0.9.5/node_modules/nanostores/atom/index.js","../../../node_modules/.pnpm/nanostores@0.9.5/node_modules/nanostores/map/index.js"],"sourcesContent":["/**\n * @license Fraction.js v4.3.7 31/08/2023\n * https://www.xarg.org/2014/03/rational-numbers-in-javascript/\n *\n * Copyright (c) 2023, Robert Eisele (robert@raw.org)\n * Dual licensed under the MIT or GPL Version 2 licenses.\n **/\n\n\n/**\n *\n * This class offers the possibility to calculate fractions.\n * You can pass a fraction in different formats. Either as array, as double, as string or as an integer.\n *\n * Array/Object form\n * [ 0 => <numerator>, 1 => <denominator> ]\n * [ n => <numerator>, d => <denominator> ]\n *\n * Integer form\n * - Single integer value\n *\n * Double form\n * - Single double value\n *\n * String form\n * 123.456 - a simple double\n * 123/456 - a string fraction\n * 123.'456' - a double with repeating decimal places\n * 123.(456) - synonym\n * 123.45'6' - a double with repeating last place\n * 123.45(6) - synonym\n *\n * Example:\n *\n * var f = new Fraction(\"9.4'31'\");\n * f.mul([-4, 3]).div(4.9);\n *\n */\n\n\n// Maximum search depth for cyclic rational numbers. 2000 should be more than enough.\n// Example: 1/7 = 0.(142857) has 6 repeating decimal places.\n// If MAX_CYCLE_LEN gets reduced, long cycles will not be detected and toString() only gets the first 10 digits\nvar MAX_CYCLE_LEN = 2000;\n\n// Parsed data to avoid calling \"new\" all the time\nvar P = {\n  \"s\": 1,\n  \"n\": 0,\n  \"d\": 1\n};\n\nfunction assign(n, s) {\n\n  if (isNaN(n = parseInt(n, 10))) {\n    throw InvalidParameter();\n  }\n  return n * s;\n}\n\n// Creates a new Fraction internally without the need of the bulky constructor\nfunction newFraction(n, d) {\n\n  if (d === 0) {\n    throw DivisionByZero();\n  }\n\n  var f = Object.create(Fraction.prototype);\n  f[\"s\"] = n < 0 ? -1 : 1;\n\n  n = n < 0 ? -n : n;\n\n  var a = gcd(n, d);\n\n  f[\"n\"] = n / a;\n  f[\"d\"] = d / a;\n  return f;\n}\n\nfunction factorize(num) {\n\n  var factors = {};\n\n  var n = num;\n  var i = 2;\n  var s = 4;\n\n  while (s <= n) {\n\n    while (n % i === 0) {\n      n/= i;\n      factors[i] = (factors[i] || 0) + 1;\n    }\n    s+= 1 + 2 * i++;\n  }\n\n  if (n !== num) {\n    if (n > 1)\n      factors[n] = (factors[n] || 0) + 1;\n  } else {\n    factors[num] = (factors[num] || 0) + 1;\n  }\n  return factors;\n}\n\nvar parse = function(p1, p2) {\n\n  var n = 0, d = 1, s = 1;\n  var v = 0, w = 0, x = 0, y = 1, z = 1;\n\n  var A = 0, B = 1;\n  var C = 1, D = 1;\n\n  var N = 10000000;\n  var M;\n\n  if (p1 === undefined || p1 === null) {\n    /* void */\n  } else if (p2 !== undefined) {\n    n = p1;\n    d = p2;\n    s = n * d;\n\n    if (n % 1 !== 0 || d % 1 !== 0) {\n      throw NonIntegerParameter();\n    }\n\n  } else\n    switch (typeof p1) {\n\n      case \"object\":\n        {\n          if (\"d\" in p1 && \"n\" in p1) {\n            n = p1[\"n\"];\n            d = p1[\"d\"];\n            if (\"s\" in p1)\n              n*= p1[\"s\"];\n          } else if (0 in p1) {\n            n = p1[0];\n            if (1 in p1)\n              d = p1[1];\n          } else {\n            throw InvalidParameter();\n          }\n          s = n * d;\n          break;\n        }\n      case \"number\":\n        {\n          if (p1 < 0) {\n            s = p1;\n            p1 = -p1;\n          }\n\n          if (p1 % 1 === 0) {\n            n = p1;\n          } else if (p1 > 0) { // check for != 0, scale would become NaN (log(0)), which converges really slow\n\n            if (p1 >= 1) {\n              z = Math.pow(10, Math.floor(1 + Math.log(p1) / Math.LN10));\n              p1/= z;\n            }\n\n            // Using Farey Sequences\n            // http://www.johndcook.com/blog/2010/10/20/best-rational-approximation/\n\n            while (B <= N && D <= N) {\n              M = (A + C) / (B + D);\n\n              if (p1 === M) {\n                if (B + D <= N) {\n                  n = A + C;\n                  d = B + D;\n                } else if (D > B) {\n                  n = C;\n                  d = D;\n                } else {\n                  n = A;\n                  d = B;\n                }\n                break;\n\n              } else {\n\n                if (p1 > M) {\n                  A+= C;\n                  B+= D;\n                } else {\n                  C+= A;\n                  D+= B;\n                }\n\n                if (B > N) {\n                  n = C;\n                  d = D;\n                } else {\n                  n = A;\n                  d = B;\n                }\n              }\n            }\n            n*= z;\n          } else if (isNaN(p1) || isNaN(p2)) {\n            d = n = NaN;\n          }\n          break;\n        }\n      case \"string\":\n        {\n          B = p1.match(/\\d+|./g);\n\n          if (B === null)\n            throw InvalidParameter();\n\n          if (B[A] === '-') {// Check for minus sign at the beginning\n            s = -1;\n            A++;\n          } else if (B[A] === '+') {// Check for plus sign at the beginning\n            A++;\n          }\n\n          if (B.length === A + 1) { // Check if it's just a simple number \"1234\"\n            w = assign(B[A++], s);\n          } else if (B[A + 1] === '.' || B[A] === '.') { // Check if it's a decimal number\n\n            if (B[A] !== '.') { // Handle 0.5 and .5\n              v = assign(B[A++], s);\n            }\n            A++;\n\n            // Check for decimal places\n            if (A + 1 === B.length || B[A + 1] === '(' && B[A + 3] === ')' || B[A + 1] === \"'\" && B[A + 3] === \"'\") {\n              w = assign(B[A], s);\n              y = Math.pow(10, B[A].length);\n              A++;\n            }\n\n            // Check for repeating places\n            if (B[A] === '(' && B[A + 2] === ')' || B[A] === \"'\" && B[A + 2] === \"'\") {\n              x = assign(B[A + 1], s);\n              z = Math.pow(10, B[A + 1].length) - 1;\n              A+= 3;\n            }\n\n          } else if (B[A + 1] === '/' || B[A + 1] === ':') { // Check for a simple fraction \"123/456\" or \"123:456\"\n            w = assign(B[A], s);\n            y = assign(B[A + 2], 1);\n            A+= 3;\n          } else if (B[A + 3] === '/' && B[A + 1] === ' ') { // Check for a complex fraction \"123 1/2\"\n            v = assign(B[A], s);\n            w = assign(B[A + 2], s);\n            y = assign(B[A + 4], 1);\n            A+= 5;\n          }\n\n          if (B.length <= A) { // Check for more tokens on the stack\n            d = y * z;\n            s = /* void */\n            n = x + d * v + z * w;\n            break;\n          }\n\n          /* Fall through on error */\n        }\n      default:\n        throw InvalidParameter();\n    }\n\n  if (d === 0) {\n    throw DivisionByZero();\n  }\n\n  P[\"s\"] = s < 0 ? -1 : 1;\n  P[\"n\"] = Math.abs(n);\n  P[\"d\"] = Math.abs(d);\n};\n\nfunction modpow(b, e, m) {\n\n  var r = 1;\n  for (; e > 0; b = (b * b) % m, e >>= 1) {\n\n    if (e & 1) {\n      r = (r * b) % m;\n    }\n  }\n  return r;\n}\n\n\nfunction cycleLen(n, d) {\n\n  for (; d % 2 === 0;\n    d/= 2) {\n  }\n\n  for (; d % 5 === 0;\n    d/= 5) {\n  }\n\n  if (d === 1) // Catch non-cyclic numbers\n    return 0;\n\n  // If we would like to compute really large numbers quicker, we could make use of Fermat's little theorem:\n  // 10^(d-1) % d == 1\n  // However, we don't need such large numbers and MAX_CYCLE_LEN should be the capstone,\n  // as we want to translate the numbers to strings.\n\n  var rem = 10 % d;\n  var t = 1;\n\n  for (; rem !== 1; t++) {\n    rem = rem * 10 % d;\n\n    if (t > MAX_CYCLE_LEN)\n      return 0; // Returning 0 here means that we don't print it as a cyclic number. It's likely that the answer is `d-1`\n  }\n  return t;\n}\n\n\nfunction cycleStart(n, d, len) {\n\n  var rem1 = 1;\n  var rem2 = modpow(10, len, d);\n\n  for (var t = 0; t < 300; t++) { // s < ~log10(Number.MAX_VALUE)\n    // Solve 10^s == 10^(s+t) (mod d)\n\n    if (rem1 === rem2)\n      return t;\n\n    rem1 = rem1 * 10 % d;\n    rem2 = rem2 * 10 % d;\n  }\n  return 0;\n}\n\nfunction gcd(a, b) {\n\n  if (!a)\n    return b;\n  if (!b)\n    return a;\n\n  while (1) {\n    a%= b;\n    if (!a)\n      return b;\n    b%= a;\n    if (!b)\n      return a;\n  }\n};\n\n/**\n * Module constructor\n *\n * @constructor\n * @param {number|Fraction=} a\n * @param {number=} b\n */\nexport default function Fraction(a, b) {\n\n  parse(a, b);\n\n  if (this instanceof Fraction) {\n    a = gcd(P[\"d\"], P[\"n\"]); // Abuse variable a\n    this[\"s\"] = P[\"s\"];\n    this[\"n\"] = P[\"n\"] / a;\n    this[\"d\"] = P[\"d\"] / a;\n  } else {\n    return newFraction(P['s'] * P['n'], P['d']);\n  }\n}\n\nvar DivisionByZero = function() { return new Error(\"Division by Zero\"); };\nvar InvalidParameter = function() { return new Error(\"Invalid argument\"); };\nvar NonIntegerParameter = function() { return new Error(\"Parameters must be integer\"); };\n\nFraction.prototype = {\n\n  \"s\": 1,\n  \"n\": 0,\n  \"d\": 1,\n\n  /**\n   * Calculates the absolute value\n   *\n   * Ex: new Fraction(-4).abs() => 4\n   **/\n  \"abs\": function() {\n\n    return newFraction(this[\"n\"], this[\"d\"]);\n  },\n\n  /**\n   * Inverts the sign of the current fraction\n   *\n   * Ex: new Fraction(-4).neg() => 4\n   **/\n  \"neg\": function() {\n\n    return newFraction(-this[\"s\"] * this[\"n\"], this[\"d\"]);\n  },\n\n  /**\n   * Adds two rational numbers\n   *\n   * Ex: new Fraction({n: 2, d: 3}).add(\"14.9\") => 467 / 30\n   **/\n  \"add\": function(a, b) {\n\n    parse(a, b);\n    return newFraction(\n      this[\"s\"] * this[\"n\"] * P[\"d\"] + P[\"s\"] * this[\"d\"] * P[\"n\"],\n      this[\"d\"] * P[\"d\"]\n    );\n  },\n\n  /**\n   * Subtracts two rational numbers\n   *\n   * Ex: new Fraction({n: 2, d: 3}).add(\"14.9\") => -427 / 30\n   **/\n  \"sub\": function(a, b) {\n\n    parse(a, b);\n    return newFraction(\n      this[\"s\"] * this[\"n\"] * P[\"d\"] - P[\"s\"] * this[\"d\"] * P[\"n\"],\n      this[\"d\"] * P[\"d\"]\n    );\n  },\n\n  /**\n   * Multiplies two rational numbers\n   *\n   * Ex: new Fraction(\"-17.(345)\").mul(3) => 5776 / 111\n   **/\n  \"mul\": function(a, b) {\n\n    parse(a, b);\n    return newFraction(\n      this[\"s\"] * P[\"s\"] * this[\"n\"] * P[\"n\"],\n      this[\"d\"] * P[\"d\"]\n    );\n  },\n\n  /**\n   * Divides two rational numbers\n   *\n   * Ex: new Fraction(\"-17.(345)\").inverse().div(3)\n   **/\n  \"div\": function(a, b) {\n\n    parse(a, b);\n    return newFraction(\n      this[\"s\"] * P[\"s\"] * this[\"n\"] * P[\"d\"],\n      this[\"d\"] * P[\"n\"]\n    );\n  },\n\n  /**\n   * Clones the actual object\n   *\n   * Ex: new Fraction(\"-17.(345)\").clone()\n   **/\n  \"clone\": function() {\n    return newFraction(this['s'] * this['n'], this['d']);\n  },\n\n  /**\n   * Calculates the modulo of two rational numbers - a more precise fmod\n   *\n   * Ex: new Fraction('4.(3)').mod([7, 8]) => (13/3) % (7/8) = (5/6)\n   **/\n  \"mod\": function(a, b) {\n\n    if (isNaN(this['n']) || isNaN(this['d'])) {\n      return new Fraction(NaN);\n    }\n\n    if (a === undefined) {\n      return newFraction(this[\"s\"] * this[\"n\"] % this[\"d\"], 1);\n    }\n\n    parse(a, b);\n    if (0 === P[\"n\"] && 0 === this[\"d\"]) {\n      throw DivisionByZero();\n    }\n\n    /*\n     * First silly attempt, kinda slow\n     *\n     return that[\"sub\"]({\n     \"n\": num[\"n\"] * Math.floor((this.n / this.d) / (num.n / num.d)),\n     \"d\": num[\"d\"],\n     \"s\": this[\"s\"]\n     });*/\n\n    /*\n     * New attempt: a1 / b1 = a2 / b2 * q + r\n     * => b2 * a1 = a2 * b1 * q + b1 * b2 * r\n     * => (b2 * a1 % a2 * b1) / (b1 * b2)\n     */\n    return newFraction(\n      this[\"s\"] * (P[\"d\"] * this[\"n\"]) % (P[\"n\"] * this[\"d\"]),\n      P[\"d\"] * this[\"d\"]\n    );\n  },\n\n  /**\n   * Calculates the fractional gcd of two rational numbers\n   *\n   * Ex: new Fraction(5,8).gcd(3,7) => 1/56\n   */\n  \"gcd\": function(a, b) {\n\n    parse(a, b);\n\n    // gcd(a / b, c / d) = gcd(a, c) / lcm(b, d)\n\n    return newFraction(gcd(P[\"n\"], this[\"n\"]) * gcd(P[\"d\"], this[\"d\"]), P[\"d\"] * this[\"d\"]);\n  },\n\n  /**\n   * Calculates the fractional lcm of two rational numbers\n   *\n   * Ex: new Fraction(5,8).lcm(3,7) => 15\n   */\n  \"lcm\": function(a, b) {\n\n    parse(a, b);\n\n    // lcm(a / b, c / d) = lcm(a, c) / gcd(b, d)\n\n    if (P[\"n\"] === 0 && this[\"n\"] === 0) {\n      return newFraction(0, 1);\n    }\n    return newFraction(P[\"n\"] * this[\"n\"], gcd(P[\"n\"], this[\"n\"]) * gcd(P[\"d\"], this[\"d\"]));\n  },\n\n  /**\n   * Calculates the ceil of a rational number\n   *\n   * Ex: new Fraction('4.(3)').ceil() => (5 / 1)\n   **/\n  \"ceil\": function(places) {\n\n    places = Math.pow(10, places || 0);\n\n    if (isNaN(this[\"n\"]) || isNaN(this[\"d\"])) {\n      return new Fraction(NaN);\n    }\n    return newFraction(Math.ceil(places * this[\"s\"] * this[\"n\"] / this[\"d\"]), places);\n  },\n\n  /**\n   * Calculates the floor of a rational number\n   *\n   * Ex: new Fraction('4.(3)').floor() => (4 / 1)\n   **/\n  \"floor\": function(places) {\n\n    places = Math.pow(10, places || 0);\n\n    if (isNaN(this[\"n\"]) || isNaN(this[\"d\"])) {\n      return new Fraction(NaN);\n    }\n    return newFraction(Math.floor(places * this[\"s\"] * this[\"n\"] / this[\"d\"]), places);\n  },\n\n  /**\n   * Rounds a rational number\n   *\n   * Ex: new Fraction('4.(3)').round() => (4 / 1)\n   **/\n  \"round\": function(places) {\n\n    places = Math.pow(10, places || 0);\n\n    if (isNaN(this[\"n\"]) || isNaN(this[\"d\"])) {\n      return new Fraction(NaN);\n    }\n    return newFraction(Math.round(places * this[\"s\"] * this[\"n\"] / this[\"d\"]), places);\n  },\n\n  /**\n   * Rounds a rational number to a multiple of another rational number\n   *\n   * Ex: new Fraction('0.9').roundTo(\"1/8\") => 7 / 8\n   **/\n  \"roundTo\": function(a, b) {\n\n    /*\n    k * x/y ≤ a/b < (k+1) * x/y\n    ⇔ k ≤ a/b / (x/y) < (k+1)\n    ⇔ k = floor(a/b * y/x)\n    */\n\n    parse(a, b);\n\n    return newFraction(this['s'] * Math.round(this['n'] * P['d'] / (this['d'] * P['n'])) * P['n'], P['d']);\n  },\n\n  /**\n   * Gets the inverse of the fraction, means numerator and denominator are exchanged\n   *\n   * Ex: new Fraction([-3, 4]).inverse() => -4 / 3\n   **/\n  \"inverse\": function() {\n\n    return newFraction(this[\"s\"] * this[\"d\"], this[\"n\"]);\n  },\n\n  /**\n   * Calculates the fraction to some rational exponent, if possible\n   *\n   * Ex: new Fraction(-1,2).pow(-3) => -8\n   */\n  \"pow\": function(a, b) {\n\n    parse(a, b);\n\n    // Trivial case when exp is an integer\n\n    if (P['d'] === 1) {\n\n      if (P['s'] < 0) {\n        return newFraction(Math.pow(this['s'] * this[\"d\"], P['n']), Math.pow(this[\"n\"], P['n']));\n      } else {\n        return newFraction(Math.pow(this['s'] * this[\"n\"], P['n']), Math.pow(this[\"d\"], P['n']));\n      }\n    }\n\n    // Negative roots become complex\n    //     (-a/b)^(c/d) = x\n    // <=> (-1)^(c/d) * (a/b)^(c/d) = x\n    // <=> (cos(pi) + i*sin(pi))^(c/d) * (a/b)^(c/d) = x         # rotate 1 by 180°\n    // <=> (cos(c*pi/d) + i*sin(c*pi/d)) * (a/b)^(c/d) = x       # DeMoivre's formula in Q ( https://proofwiki.org/wiki/De_Moivre%27s_Formula/Rational_Index )\n    // From which follows that only for c=0 the root is non-complex. c/d is a reduced fraction, so that sin(c/dpi)=0 occurs for d=1, which is handled by our trivial case.\n    if (this['s'] < 0) return null;\n\n    // Now prime factor n and d\n    var N = factorize(this['n']);\n    var D = factorize(this['d']);\n\n    // Exponentiate and take root for n and d individually\n    var n = 1;\n    var d = 1;\n    for (var k in N) {\n      if (k === '1') continue;\n      if (k === '0') {\n        n = 0;\n        break;\n      }\n      N[k]*= P['n'];\n\n      if (N[k] % P['d'] === 0) {\n        N[k]/= P['d'];\n      } else return null;\n      n*= Math.pow(k, N[k]);\n    }\n\n    for (var k in D) {\n      if (k === '1') continue;\n      D[k]*= P['n'];\n\n      if (D[k] % P['d'] === 0) {\n        D[k]/= P['d'];\n      } else return null;\n      d*= Math.pow(k, D[k]);\n    }\n\n    if (P['s'] < 0) {\n      return newFraction(d, n);\n    }\n    return newFraction(n, d);\n  },\n\n  /**\n   * Check if two rational numbers are the same\n   *\n   * Ex: new Fraction(19.6).equals([98, 5]);\n   **/\n  \"equals\": function(a, b) {\n\n    parse(a, b);\n    return this[\"s\"] * this[\"n\"] * P[\"d\"] === P[\"s\"] * P[\"n\"] * this[\"d\"]; // Same as compare() === 0\n  },\n\n  /**\n   * Check if two rational numbers are the same\n   *\n   * Ex: new Fraction(19.6).equals([98, 5]);\n   **/\n  \"compare\": function(a, b) {\n\n    parse(a, b);\n    var t = (this[\"s\"] * this[\"n\"] * P[\"d\"] - P[\"s\"] * P[\"n\"] * this[\"d\"]);\n    return (0 < t) - (t < 0);\n  },\n\n  \"simplify\": function(eps) {\n\n    if (isNaN(this['n']) || isNaN(this['d'])) {\n      return this;\n    }\n\n    eps = eps || 0.001;\n\n    var thisABS = this['abs']();\n    var cont = thisABS['toContinued']();\n\n    for (var i = 1; i < cont.length; i++) {\n\n      var s = newFraction(cont[i - 1], 1);\n      for (var k = i - 2; k >= 0; k--) {\n        s = s['inverse']()['add'](cont[k]);\n      }\n\n      if (Math.abs(s['sub'](thisABS).valueOf()) < eps) {\n        return s['mul'](this['s']);\n      }\n    }\n    return this;\n  },\n\n  /**\n   * Check if two rational numbers are divisible\n   *\n   * Ex: new Fraction(19.6).divisible(1.5);\n   */\n  \"divisible\": function(a, b) {\n\n    parse(a, b);\n    return !(!(P[\"n\"] * this[\"d\"]) || ((this[\"n\"] * P[\"d\"]) % (P[\"n\"] * this[\"d\"])));\n  },\n\n  /**\n   * Returns a decimal representation of the fraction\n   *\n   * Ex: new Fraction(\"100.'91823'\").valueOf() => 100.91823918239183\n   **/\n  'valueOf': function() {\n\n    return this[\"s\"] * this[\"n\"] / this[\"d\"];\n  },\n\n  /**\n   * Returns a string-fraction representation of a Fraction object\n   *\n   * Ex: new Fraction(\"1.'3'\").toFraction(true) => \"4 1/3\"\n   **/\n  'toFraction': function(excludeWhole) {\n\n    var whole, str = \"\";\n    var n = this[\"n\"];\n    var d = this[\"d\"];\n    if (this[\"s\"] < 0) {\n      str+= '-';\n    }\n\n    if (d === 1) {\n      str+= n;\n    } else {\n\n      if (excludeWhole && (whole = Math.floor(n / d)) > 0) {\n        str+= whole;\n        str+= \" \";\n        n%= d;\n      }\n\n      str+= n;\n      str+= '/';\n      str+= d;\n    }\n    return str;\n  },\n\n  /**\n   * Returns a latex representation of a Fraction object\n   *\n   * Ex: new Fraction(\"1.'3'\").toLatex() => \"\\frac{4}{3}\"\n   **/\n  'toLatex': function(excludeWhole) {\n\n    var whole, str = \"\";\n    var n = this[\"n\"];\n    var d = this[\"d\"];\n    if (this[\"s\"] < 0) {\n      str+= '-';\n    }\n\n    if (d === 1) {\n      str+= n;\n    } else {\n\n      if (excludeWhole && (whole = Math.floor(n / d)) > 0) {\n        str+= whole;\n        n%= d;\n      }\n\n      str+= \"\\\\frac{\";\n      str+= n;\n      str+= '}{';\n      str+= d;\n      str+= '}';\n    }\n    return str;\n  },\n\n  /**\n   * Returns an array of continued fraction elements\n   *\n   * Ex: new Fraction(\"7/8\").toContinued() => [0,1,7]\n   */\n  'toContinued': function() {\n\n    var t;\n    var a = this['n'];\n    var b = this['d'];\n    var res = [];\n\n    if (isNaN(a) || isNaN(b)) {\n      return res;\n    }\n\n    do {\n      res.push(Math.floor(a / b));\n      t = a % b;\n      a = b;\n      b = t;\n    } while (a !== 1);\n\n    return res;\n  },\n\n  /**\n   * Creates a string representation of a fraction with all digits\n   *\n   * Ex: new Fraction(\"100.'91823'\").toString() => \"100.(91823)\"\n   **/\n  'toString': function(dec) {\n\n    var N = this[\"n\"];\n    var D = this[\"d\"];\n\n    if (isNaN(N) || isNaN(D)) {\n      return \"NaN\";\n    }\n\n    dec = dec || 15; // 15 = decimal places when no repetation\n\n    var cycLen = cycleLen(N, D); // Cycle length\n    var cycOff = cycleStart(N, D, cycLen); // Cycle start\n\n    var str = this['s'] < 0 ? \"-\" : \"\";\n\n    str+= N / D | 0;\n\n    N%= D;\n    N*= 10;\n\n    if (N)\n      str+= \".\";\n\n    if (cycLen) {\n\n      for (var i = cycOff; i--;) {\n        str+= N / D | 0;\n        N%= D;\n        N*= 10;\n      }\n      str+= \"(\";\n      for (var i = cycLen; i--;) {\n        str+= N / D | 0;\n        N%= D;\n        N*= 10;\n      }\n      str+= \")\";\n    } else {\n      for (var i = dec; N && i--;) {\n        str+= N / D | 0;\n        N%= D;\n        N*= 10;\n      }\n    }\n    return str;\n  }\n};\n","/*\nfraction.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/fraction.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport Fraction from 'fraction.js';\nimport { TimeSpan } from './timespan.mjs';\n\n// Returns the start of the cycle.\nFraction.prototype.sam = function () {\n  return this.floor();\n};\n\n// Returns the start of the next cycle.\nFraction.prototype.nextSam = function () {\n  return this.sam().add(1);\n};\n\n// Returns a TimeSpan representing the begin and end of the Time value's cycle\nFraction.prototype.wholeCycle = function () {\n  return new TimeSpan(this.sam(), this.nextSam());\n};\n\n// The position of a time value relative to the start of its cycle.\nFraction.prototype.cyclePos = function () {\n  return this.sub(this.sam());\n};\n\nFraction.prototype.lt = function (other) {\n  return this.compare(other) < 0;\n};\n\nFraction.prototype.gt = function (other) {\n  return this.compare(other) > 0;\n};\n\nFraction.prototype.lte = function (other) {\n  return this.compare(other) <= 0;\n};\n\nFraction.prototype.gte = function (other) {\n  return this.compare(other) >= 0;\n};\n\nFraction.prototype.eq = function (other) {\n  return this.compare(other) == 0;\n};\n\nFraction.prototype.max = function (other) {\n  return this.gt(other) ? this : other;\n};\n\nFraction.prototype.maximum = function (...others) {\n  others = others.map((x) => new Fraction(x));\n  return others.reduce((max, other) => other.max(max), this);\n};\n\nFraction.prototype.min = function (other) {\n  return this.lt(other) ? this : other;\n};\n\nFraction.prototype.show = function (/* excludeWhole = false */) {\n  // return this.toFraction(excludeWhole);\n  return this.s * this.n + '/' + this.d;\n};\n\nFraction.prototype.or = function (other) {\n  return this.eq(0) ? other : this;\n};\n\nconst fraction = (n) => {\n  if (typeof n === 'number') {\n    /*\n    https://github.com/infusion/Fraction.js/#doubles\n    „If you pass a double as it is, Fraction.js will perform a number analysis based on Farey Sequences.\"\n    „If you want to keep the number as it is, convert it to a string, as the string parser will not perform any further observations“\n    \n    -> those farey sequences turn out to make pattern querying ~20 times slower! always use strings!\n    -> still, some optimizations could be done: .mul .div .add .sub calls still use numbers\n    */\n    // n = String(n); // this is actually faster but imprecise...\n  }\n  return Fraction(n);\n};\n\nexport const gcd = (...fractions) => {\n  return fractions.reduce((gcd, fraction) => gcd.gcd(fraction), fraction(1));\n};\n\nexport const lcm = (...fractions) => {\n  return fractions.reduce((lcm, fraction) => lcm.lcm(fraction), fraction(1));\n};\n\nfraction._original = Fraction;\n\nexport default fraction;\n\n// \"If you concern performance, cache Fraction.js objects and pass arrays/objects.“\n// -> tested memoized version, but it's slower than unmemoized, even with repeated evaluation\n/* const memo = {};\nconst memoizedFraction = (n) => {\n  if (typeof n === 'number') {\n    n = String(n);\n  }\n  if (memo[n] !== undefined) {\n    return memo[n];\n  }\n  memo[n] = Fraction(n);\n  return memo[n];\n}; */\n","/*\ntimespan.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/timespan.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport Fraction from './fraction.mjs';\n\nexport class TimeSpan {\n  constructor(begin, end) {\n    this.begin = Fraction(begin);\n    this.end = Fraction(end);\n  }\n\n  get spanCycles() {\n    const spans = [];\n    var begin = this.begin;\n    const end = this.end;\n    const end_sam = end.sam();\n\n    // Support zero-width timespans\n    if (begin.equals(end)) {\n      return [new TimeSpan(begin, end)];\n    }\n\n    while (end.gt(begin)) {\n      // If begin and end are in the same cycle, we're done.\n      if (begin.sam().equals(end_sam)) {\n        spans.push(new TimeSpan(begin, this.end));\n        break;\n      }\n      // add a timespan up to the next sam\n      const next_begin = begin.nextSam();\n      spans.push(new TimeSpan(begin, next_begin));\n\n      // continue with the next cycle\n      begin = next_begin;\n    }\n    return spans;\n  }\n\n  get duration() {\n    return this.end.sub(this.begin);\n  }\n\n  cycleArc() {\n    // Shifts a timespan to one of equal duration that starts within cycle zero.\n    // (Note that the output timespan probably does not start *at* Time 0 --\n    // that only happens when the input Arc starts at an integral Time.)\n    const b = this.begin.cyclePos();\n    const e = b.add(this.duration);\n    return new TimeSpan(b, e);\n  }\n\n  withTime(func_time) {\n    // Applies given function to both the begin and end time of the timespan\"\"\"\n    return new TimeSpan(func_time(this.begin), func_time(this.end));\n  }\n\n  withEnd(func_time) {\n    // Applies given function to the end time of the timespan\"\"\"\n    return new TimeSpan(this.begin, func_time(this.end));\n  }\n\n  withCycle(func_time) {\n    // Like withTime, but time is relative to relative to the cycle (i.e. the\n    // sam of the start of the timespan)\n    const sam = this.begin.sam();\n    const b = sam.add(func_time(this.begin.sub(sam)));\n    const e = sam.add(func_time(this.end.sub(sam)));\n    return new TimeSpan(b, e);\n  }\n\n  intersection(other) {\n    // Intersection of two timespans, returns None if they don't intersect.\n    const intersect_begin = this.begin.max(other.begin);\n    const intersect_end = this.end.min(other.end);\n\n    if (intersect_begin.gt(intersect_end)) {\n      return undefined;\n    }\n    if (intersect_begin.equals(intersect_end)) {\n      // Zero-width (point) intersection - doesn't intersect if it's at the end of a\n      // non-zero-width timespan.\n      if (intersect_begin.equals(this.end) && this.begin.lt(this.end)) {\n        return undefined;\n      }\n      if (intersect_begin.equals(other.end) && other.begin.lt(other.end)) {\n        return undefined;\n      }\n    }\n    return new TimeSpan(intersect_begin, intersect_end);\n  }\n\n  intersection_e(other) {\n    // Like 'sect', but raises an exception if the timespans don't intersect.\n    const result = this.intersection(other);\n    if (result == undefined) {\n      throw 'TimeSpans do not intersect';\n    }\n    return result;\n  }\n\n  midpoint() {\n    return this.begin.add(this.duration.div(Fraction(2)));\n  }\n\n  equals(other) {\n    return this.begin.equals(other.begin) && this.end.equals(other.end);\n  }\n\n  show() {\n    return this.begin.show() + ' → ' + this.end.show();\n  }\n}\n\nexport default TimeSpan;\n","/*\nhap.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/hap.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\nimport Fraction from './fraction.mjs';\n\nexport class Hap {\n  /*\n      Event class, representing a value active during the timespan\n      'part'. This might be a fragment of an event, in which case the\n      timespan will be smaller than the 'whole' timespan, otherwise the\n      two timespans will be the same. The 'part' must never extend outside of the\n      'whole'. If the event represents a continuously changing value\n      then the whole will be returned as None, in which case the given\n      value will have been sampled from the point halfway between the\n      start and end of the 'part' timespan.\n      The context is to store a list of source code locations causing the event.\n\n      The word 'Event' is more or less a reserved word in javascript, hence this\n      class is named called 'Hap'.\n      */\n\n  constructor(whole, part, value, context = {}, stateful = false) {\n    this.whole = whole;\n    this.part = part;\n    this.value = value;\n    this.context = context;\n    this.stateful = stateful;\n    if (stateful) {\n      console.assert(typeof this.value === 'function', 'Stateful values must be functions');\n    }\n  }\n\n  get duration() {\n    let duration;\n    if (typeof this.value?.duration === 'number') {\n      duration = Fraction(this.value.duration);\n    } else {\n      duration = this.whole.end.sub(this.whole.begin);\n    }\n    if (typeof this.value?.clip === 'number') {\n      return duration.mul(this.value.clip);\n    }\n    return duration;\n  }\n\n  get endClipped() {\n    return this.whole.begin.add(this.duration);\n  }\n\n  isActive(currentTime) {\n    return this.whole.begin <= currentTime && this.endClipped >= currentTime;\n  }\n\n  isInPast(currentTime) {\n    return currentTime > this.endClipped;\n  }\n  isInNearPast(margin, currentTime) {\n    return currentTime - margin <= this.endClipped;\n  }\n\n  isInFuture(currentTime) {\n    return currentTime < this.whole.begin;\n  }\n  isInNearFuture(margin, currentTime) {\n    return currentTime < this.whole.begin && currentTime > this.whole.begin - margin;\n  }\n  isWithinTime(min, max) {\n    return this.whole.begin <= max && this.endClipped >= min;\n  }\n\n  wholeOrPart() {\n    return this.whole ? this.whole : this.part;\n  }\n\n  withSpan(func) {\n    // Returns a new hap with the function f applies to the hap timespan.\n    const whole = this.whole ? func(this.whole) : undefined;\n    return new Hap(whole, func(this.part), this.value, this.context);\n  }\n\n  withValue(func) {\n    // Returns a new hap with the function f applies to the hap value.\n    return new Hap(this.whole, this.part, func(this.value), this.context);\n  }\n\n  hasOnset() {\n    // Test whether the hap contains the onset, i.e that\n    // the beginning of the part is the same as that of the whole timespan.\"\"\"\n    return this.whole != undefined && this.whole.begin.equals(this.part.begin);\n  }\n\n  hasTag(tag) {\n    return this.context.tags?.includes(tag);\n  }\n\n  resolveState(state) {\n    if (this.stateful && this.hasOnset()) {\n      console.log('stateful');\n      const func = this.value;\n      const [newState, newValue] = func(state);\n      return [newState, new Hap(this.whole, this.part, newValue, this.context, false)];\n    }\n    return [state, this];\n  }\n\n  spanEquals(other) {\n    return (this.whole == undefined && other.whole == undefined) || this.whole.equals(other.whole);\n  }\n\n  equals(other) {\n    return (\n      this.spanEquals(other) &&\n      this.part.equals(other.part) &&\n      // TODO would == be better ??\n      this.value === other.value\n    );\n  }\n\n  show(compact = false) {\n    const value =\n      typeof this.value === 'object'\n        ? compact\n          ? JSON.stringify(this.value).slice(1, -1).replaceAll('\"', '').replaceAll(',', ' ')\n          : JSON.stringify(this.value)\n        : this.value;\n    var spans = '';\n    if (this.whole == undefined) {\n      spans = '~' + this.part.show;\n    } else {\n      var is_whole = this.whole.begin.equals(this.part.begin) && this.whole.end.equals(this.part.end);\n      if (!this.whole.begin.equals(this.part.begin)) {\n        spans = this.whole.begin.show() + ' ⇜ ';\n      }\n      if (!is_whole) {\n        spans += '(';\n      }\n      spans += this.part.show();\n      if (!is_whole) {\n        spans += ')';\n      }\n      if (!this.whole.end.equals(this.part.end)) {\n        spans += ' ⇝ ' + this.whole.end.show();\n      }\n    }\n    return '[ ' + spans + ' | ' + value + ' ]';\n  }\n\n  showWhole(compact = false) {\n    return `${this.whole == undefined ? '~' : this.whole.show()}: ${\n      typeof this.value === 'object'\n        ? compact\n          ? JSON.stringify(this.value).slice(1, -1).replaceAll('\"', '').replaceAll(',', ' ')\n          : JSON.stringify(this.value)\n        : this.value\n    }`;\n  }\n\n  combineContext(b) {\n    const a = this;\n    return { ...a.context, ...b.context, locations: (a.context.locations || []).concat(b.context.locations || []) };\n  }\n\n  setContext(context) {\n    return new Hap(this.whole, this.part, this.value, context);\n  }\n\n  ensureObjectValue() {\n    /* if (isNote(hap.value)) {\n      // supports primitive hap values that look like notes\n      hap.value = { note: hap.value };\n    } */\n    if (typeof this.value !== 'object') {\n      throw new Error(\n        `expected hap.value to be an object, but got \"${this.value}\". Hint: append .note() or .s() to the end`,\n        'error',\n      );\n    }\n  }\n}\n\nexport default Hap;\n","/*\nstate.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/state.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nexport class State {\n  constructor(span, controls = {}) {\n    this.span = span;\n    this.controls = controls;\n  }\n\n  // Returns new State with different span\n  setSpan(span) {\n    return new State(span, this.controls);\n  }\n\n  withSpan(func) {\n    return this.setSpan(func(this.span));\n  }\n\n  // Returns new State with different controls\n  setControls(controls) {\n    return new State(this.span, controls);\n  }\n}\n\nexport default State;\n","export const logKey = 'strudel.log';\n\nlet debounce = 1000,\n  lastMessage,\n  lastTime;\n\nexport function logger(message, type, data = {}) {\n  let t = performance.now();\n  if (lastMessage === message && t - lastTime < debounce) {\n    return;\n  }\n  lastMessage = message;\n  lastTime = t;\n  console.log(`%c${message}`, 'background-color: black;color:white;border-radius:15px');\n  if (typeof document !== 'undefined' && typeof CustomEvent !== 'undefined') {\n    document.dispatchEvent(\n      new CustomEvent(logKey, {\n        detail: {\n          message,\n          type,\n          data,\n        },\n      }),\n    );\n  }\n}\n\nlogger.key = logKey;\n","/*\nutil.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/util.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport { logger } from './logger.mjs';\n\n// returns true if the given string is a note\nexport const isNoteWithOctave = (name) => /^[a-gA-G][#bs]*[0-9]$/.test(name);\nexport const isNote = (name) => /^[a-gA-G][#bsf]*[0-9]?$/.test(name);\nexport const tokenizeNote = (note) => {\n  if (typeof note !== 'string') {\n    return [];\n  }\n  const [pc, acc = '', oct] = note.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1) || [];\n  if (!pc) {\n    return [];\n  }\n  return [pc, acc, oct ? Number(oct) : undefined];\n};\n\nconst chromas = { c: 0, d: 2, e: 4, f: 5, g: 7, a: 9, b: 11 };\nconst accs = { '#': 1, b: -1, s: 1, f: -1 };\n\n// turns the given note into its midi number representation\nexport const noteToMidi = (note, defaultOctave = 3) => {\n  const [pc, acc, oct = defaultOctave] = tokenizeNote(note);\n  if (!pc) {\n    throw new Error('not a note: \"' + note + '\"');\n  }\n  const chroma = chromas[pc.toLowerCase()];\n  const offset = acc?.split('').reduce((o, char) => o + accs[char], 0) || 0;\n  return (Number(oct) + 1) * 12 + chroma + offset;\n};\nexport const midiToFreq = (n) => {\n  return Math.pow(2, (n - 69) / 12) * 440;\n};\n\nexport const freqToMidi = (freq) => {\n  return (12 * Math.log(freq / 440)) / Math.LN2 + 69;\n};\n\nexport const valueToMidi = (value, fallbackValue) => {\n  if (typeof value !== 'object') {\n    throw new Error('valueToMidi: expected object value');\n  }\n  let { freq, note } = value;\n  if (typeof freq === 'number') {\n    return freqToMidi(freq);\n  }\n  if (typeof note === 'string') {\n    return noteToMidi(note);\n  }\n  if (typeof note === 'number') {\n    return note;\n  }\n  if (!fallbackValue) {\n    throw new Error('valueToMidi: expected freq or note to be set');\n  }\n  return fallbackValue;\n};\n\n/**\n * @deprecated does not appear to be referenced or invoked anywhere in the codebase\n * @noAutocomplete\n */\nexport const getFreq = (noteOrMidi) => {\n  if (typeof noteOrMidi === 'number') {\n    return midiToFreq(noteOrMidi);\n  }\n  return midiToFreq(noteToMidi(noteOrMidi));\n};\n\nconst pcs = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];\n/**\n * @deprecated only used in workshop (first-notes)\n * @noAutocomplete\n */\nexport const midi2note = (n) => {\n  const oct = Math.floor(n / 12) - 1;\n  const pc = pcs[n % 12];\n  return pc + oct;\n};\n\n// modulo that works with negative numbers e.g. _mod(-1, 3) = 2. Works on numbers (rather than patterns of numbers, as @mod@ from pattern.mjs does)\nexport const _mod = (n, m) => ((n % m) + m) % m;\n\nexport function nanFallback(value, fallback = 0) {\n  if (isNaN(Number(value))) {\n    logger(`\"${value}\" is not a number, falling back to ${fallback}`, 'warning');\n    return fallback;\n  }\n  return value;\n}\n// round to nearest int, negative numbers will output a subtracted index\nexport const getSoundIndex = (n, numSounds) => {\n  return _mod(Math.round(nanFallback(n ?? 0, 0)), numSounds);\n};\n\nexport const getPlayableNoteValue = (hap) => {\n  let { value, context } = hap;\n  let note = value;\n  if (typeof note === 'object' && !Array.isArray(note)) {\n    note = note.note || note.n || note.value;\n    if (note === undefined) {\n      throw new Error(`cannot find a playable note for ${JSON.stringify(value)}`);\n    }\n  }\n  // if value is number => interpret as midi number as long as its not marked as frequency\n  if (typeof note === 'number' && context.type !== 'frequency') {\n    note = midiToFreq(hap.value);\n  } else if (typeof note === 'number' && context.type === 'frequency') {\n    note = hap.value; // legacy workaround.. will be removed in the future\n  } else if (typeof note !== 'string' || !isNote(note)) {\n    throw new Error('not a note: ' + JSON.stringify(note));\n  }\n  return note;\n};\n\nexport const getFrequency = (hap) => {\n  let { value, context } = hap;\n  // if value is number => interpret as midi number as long as its not marked as frequency\n  if (typeof value === 'object') {\n    if (value.freq) {\n      return value.freq;\n    }\n    return getFreq(value.note || value.n || value.value);\n  }\n  if (typeof value === 'number' && context.type !== 'frequency') {\n    value = midiToFreq(hap.value);\n  } else if (typeof value === 'string' && isNote(value)) {\n    value = midiToFreq(noteToMidi(hap.value));\n  } else if (typeof value !== 'number') {\n    throw new Error('not a note or frequency: ' + value);\n  }\n  return value;\n};\n\n// rotate array by n steps (to the left)\nexport const rotate = (arr, n) => arr.slice(n).concat(arr.slice(0, n));\n\nexport const pipe = (...funcs) => {\n  return funcs.reduce(\n    (f, g) =>\n      (...args) =>\n        f(g(...args)),\n    (x) => x,\n  );\n};\n\nexport const compose = (...funcs) => pipe(...funcs.reverse());\n\n// Removes 'None' values from given list\nexport const removeUndefineds = (xs) => xs.filter((x) => x != undefined);\n\nexport const flatten = (arr) => [].concat(...arr);\n\nexport const id = (a) => a;\nexport const constant = (a, b) => a;\n\nexport const listRange = (min, max) => Array.from({ length: max - min + 1 }, (_, i) => i + min);\n\nexport function curry(func, overload, arity = func.length) {\n  const fn = function curried(...args) {\n    if (args.length >= arity) {\n      return func.apply(this, args);\n    } else {\n      const partial = function (...args2) {\n        return curried.apply(this, args.concat(args2));\n      };\n      if (overload) {\n        overload(partial, args);\n      }\n      return partial;\n    }\n  };\n  if (overload) {\n    // overload function without args... needed for chordBass.transpose(2)\n    overload(fn, []);\n  }\n  return fn;\n}\n\nexport function parseNumeral(numOrString) {\n  const asNumber = Number(numOrString);\n  if (!isNaN(asNumber)) {\n    return asNumber;\n  }\n  if (isNote(numOrString)) {\n    return noteToMidi(numOrString);\n  }\n  throw new Error(`cannot parse as numeral: \"${numOrString}\"`);\n}\n\nexport function mapArgs(fn, mapFn) {\n  return (...args) => fn(...args.map(mapFn));\n}\n\nexport function numeralArgs(fn) {\n  return mapArgs(fn, parseNumeral);\n}\n\nexport function parseFractional(numOrString) {\n  const asNumber = Number(numOrString);\n  if (!isNaN(asNumber)) {\n    return asNumber;\n  }\n  const specialValue = {\n    pi: Math.PI,\n    w: 1,\n    h: 0.5,\n    q: 0.25,\n    e: 0.125,\n    s: 0.0625,\n    t: 1 / 3,\n    f: 0.2,\n    x: 1 / 6,\n  }[numOrString];\n  if (typeof specialValue !== 'undefined') {\n    return specialValue;\n  }\n  throw new Error(`cannot parse as fractional: \"${numOrString}\"`);\n}\n\nexport const fractionalArgs = (fn) => mapArgs(fn, parseFractional);\n\nexport const splitAt = function (index, value) {\n  return [value.slice(0, index), value.slice(index)];\n};\n\nexport const zipWith = (f, xs, ys) => xs.map((n, i) => f(n, ys[i]));\n\nexport const clamp = (num, min, max) => Math.min(Math.max(num, min), max);\n\n/* solmization, not used yet */\nconst solfeggio = ['Do', 'Reb', 'Re', 'Mib', 'Mi', 'Fa', 'Solb', 'Sol', 'Lab', 'La', 'Sib', 'Si']; /*solffegio notes*/\nconst indian = [\n  'Sa',\n  'Re',\n  'Ga',\n  'Ma',\n  'Pa',\n  'Dha',\n  'Ni',\n]; /*indian musical notes,  seems like they do not use flats or sharps*/\nconst german = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Hb', 'H']; /*german & dutch musical notes*/\nconst byzantine = [\n  'Ni',\n  'Pab',\n  'Pa',\n  'Voub',\n  'Vou',\n  'Ga',\n  'Dib',\n  'Di',\n  'Keb',\n  'Ke',\n  'Zob',\n  'Zo',\n]; /*byzantine musical notes*/\nconst japanese = [\n  'I',\n  'Ro',\n  'Ha',\n  'Ni',\n  'Ho',\n  'He',\n  'To',\n]; /*traditional japanese musical notes, seems like they do not use falts or sharps*/\n\nconst english = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];\n\nexport const sol2note = (n, notation = 'letters') => {\n  const pc =\n    notation === 'solfeggio'\n      ? solfeggio /*check if its is any of the following*/\n      : notation === 'indian'\n        ? indian\n        : notation === 'german'\n          ? german\n          : notation === 'byzantine'\n            ? byzantine\n            : notation === 'japanese'\n              ? japanese\n              : english; /*if not use standard version*/\n  const note = pc[n % 12]; /*calculating the midi value to the note*/\n  const oct = Math.floor(n / 12) - 1;\n  return note + oct;\n};\n\n// code hashing helpers\n\nexport function unicodeToBase64(text) {\n  const utf8Bytes = new TextEncoder().encode(text);\n  const base64String = btoa(String.fromCharCode(...utf8Bytes));\n  return base64String;\n}\n\nexport function base64ToUnicode(base64String) {\n  const utf8Bytes = new Uint8Array(\n    atob(base64String)\n      .split('')\n      .map((char) => char.charCodeAt(0)),\n  );\n  const decodedText = new TextDecoder().decode(utf8Bytes);\n  return decodedText;\n}\n\nexport function code2hash(code) {\n  return encodeURIComponent(unicodeToBase64(code));\n  //return '#' + encodeURIComponent(btoa(code));\n}\n\nexport function hash2code(hash) {\n  return base64ToUnicode(decodeURIComponent(hash));\n  //return atob(decodeURIComponent(codeParam || ''));\n}\n\nexport function objectMap(obj, fn) {\n  if (Array.isArray(obj)) {\n    return obj.map(fn);\n  }\n  return Object.fromEntries(Object.entries(obj).map(([k, v], i) => [k, fn(v, k, i)]));\n}\n\n// Floating point versions, see Fraction for rational versions\n// // greatest common divisor\n// export const gcd = function (x, y, ...z) {\n//   if (!y && z.length > 0) {\n//     return gcd(x, ...z);\n//   }\n//   if (!y) {\n//     return x;\n//   }\n//   return gcd(y, x % y, ...z);\n// };\n\n// // lowest common multiple\n// export const lcm = function (x, y, ...z) {\n//   if (z.length == 0) {\n//     return (x * y) / gcd(x, y);\n//   }\n//   return lcm((x * y) / gcd(x, y), ...z);\n// };\n","/*\nvalue.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/value.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport { curry } from './util.mjs';\nimport { logger } from './logger.mjs';\n\nexport function unionWithObj(a, b, func) {\n  if (b?.value !== undefined && Object.keys(b).length === 1) {\n    // https://github.com/tidalcycles/strudel/issues/1026\n    logger(`[warn]: Can't do arithmetic on control pattern.`);\n    return a;\n  }\n  const common = Object.keys(a).filter((k) => Object.keys(b).includes(k));\n  return Object.assign({}, a, b, Object.fromEntries(common.map((k) => [k, func(a[k], b[k])])));\n}\n\nexport const mul = curry((a, b) => a * b);\n\nexport const valued = (value) => {\n  if (value?.constructor?.name === 'Value') {\n    return value;\n  }\n  return Value.of(value);\n};\n\nexport class Value {\n  constructor(value) {\n    this.value = value;\n  }\n  static of(x) {\n    return new Value(x);\n  }\n  get isNothing() {\n    return this.value === null || this.value === undefined;\n  }\n  map(f) {\n    if (this.isNothing) {\n      return this;\n    }\n    return Value.of(f(this.value));\n  }\n  mul(n) {\n    return this.map(mul).ap(n);\n  }\n  ap(other) {\n    return valued(other).map(this.value);\n  }\n  unionWith(other, func) {\n    const type = typeof this.value;\n    other = valued(other);\n    if (type !== typeof other.value) {\n      throw new Error('unionWith: both Values must have same type!');\n    }\n    if (Array.isArray(type) || type !== 'object') {\n      throw new Error('unionWith: expected objects');\n    }\n    return this.map((v) => unionWithObj(v, other.value, func));\n  }\n}\n\nexport const map = curry((f, anyFunctor) => anyFunctor.map(f));\n","/*\ndrawLine.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/drawLine.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport Fraction, { gcd } from './fraction.mjs';\n\n/**\n * Intended for a debugging, drawLine renders the pattern as a string, where each character represents the same time span.\n * Should only be used with single characters as values, otherwise the character slots will be messed up.\n * Character legend:\n *\n * - \"|\" cycle separator\n * - \"-\" hold previous value\n * - \".\" silence\n *\n * @param {Pattern} pattern the pattern to use\n * @param {number} chars max number of characters (approximately)\n * @returns string\n * @example\n * const line = drawLine(\"0 [1 2 3]\", 10); // |0--123|0--123\n * console.log(line);\n * silence;\n */\nfunction drawLine(pat, chars = 60) {\n  let cycle = 0;\n  let pos = Fraction(0);\n  let lines = [''];\n  let emptyLine = ''; // this will be the \"reference\" empty line, which will be copied into extra lines\n  while (lines[0].length < chars) {\n    const haps = pat.queryArc(cycle, cycle + 1);\n    const durations = haps.filter((hap) => hap.hasOnset()).map((hap) => hap.duration);\n    const charFraction = gcd(...durations);\n    const totalSlots = charFraction.inverse(); // number of character slots for the current cycle\n    lines = lines.map((line) => line + '|'); // add pipe character before each cycle\n    emptyLine += '|';\n    for (let i = 0; i < totalSlots; i++) {\n      const [begin, end] = [pos, pos.add(charFraction)];\n      const matches = haps.filter((hap) => hap.whole.begin.lte(begin) && hap.whole.end.gte(end));\n      const missingLines = matches.length - lines.length;\n      if (missingLines > 0) {\n        lines = lines.concat(Array(missingLines).fill(emptyLine));\n      }\n      lines = lines.map((line, i) => {\n        const hap = matches[i];\n        if (hap) {\n          const isOnset = hap.whole.begin.eq(begin);\n          const char = isOnset ? '' + hap.value : '-';\n          return line + char;\n        }\n        return line + '.';\n      });\n      emptyLine += '.';\n      pos = pos.add(charFraction);\n    }\n    cycle++;\n  }\n  return lines.join('\\n');\n}\n\nexport default drawLine;\n","/*\npattern.mjs - Core pattern representation for strudel\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/pattern.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport TimeSpan from './timespan.mjs';\nimport Fraction, { lcm } from './fraction.mjs';\nimport Hap from './hap.mjs';\nimport State from './state.mjs';\nimport { unionWithObj } from './value.mjs';\n\nimport { compose, removeUndefineds, flatten, id, listRange, curry, _mod, numeralArgs, parseNumeral } from './util.mjs';\nimport drawLine from './drawLine.mjs';\nimport { logger } from './logger.mjs';\n\nlet stringParser;\n\n// parser is expected to turn a string into a pattern\n// if set, the reify function will parse all strings with it\n// intended to use with mini to automatically interpret all strings as mini notation\nexport const setStringParser = (parser) => (stringParser = parser);\n\n/** @class Class representing a pattern. */\nexport class Pattern {\n  /**\n   * Create a pattern. As an end user, you will most likely not create a Pattern directly.\n   *\n   * @param {function} query - The function that maps a `State` to an array of `Hap`.\n   * @noAutocomplete\n   */\n  constructor(query, tactus = undefined) {\n    this.query = query;\n    this._Pattern = true; // this property is used to detect if a pattern that fails instanceof Pattern is an instance of another Pattern\n    this.__tactus = tactus; // in terms of number of beats per cycle\n  }\n\n  get tactus() {\n    return this.__tactus ?? Fraction(1);\n  }\n\n  set tactus(tactus) {\n    this.__tactus = Fraction(tactus);\n  }\n\n  setTactus(tactus) {\n    this.tactus = tactus;\n    return this;\n  }\n\n  //////////////////////////////////////////////////////////////////////\n  // Haskell-style functor, applicative and monadic operations\n\n  /**\n   * Returns a new pattern, with the function applied to the value of\n   * each hap. It has the alias `fmap`.\n   * @synonyms fmap\n   * @param {Function} func to to apply to the value\n   * @returns Pattern\n   * @example\n   * \"0 1 2\".withValue(v => v + 10).log()\n   */\n  withValue(func) {\n    const result = new Pattern((state) => this.query(state).map((hap) => hap.withValue(func)));\n    result.tactus = this.tactus;\n    return result;\n  }\n\n  /**\n   * see `withValue`\n   * @noAutocomplete\n   */\n  fmap(func) {\n    return this.withValue(func);\n  }\n\n  /**\n   * Assumes 'this' is a pattern of functions, and given a function to\n   * resolve wholes, applies a given pattern of values to that\n   * pattern of functions.\n   * @param {Function} whole_func\n   * @param {Function} func\n   * @noAutocomplete\n   * @returns Pattern\n   */\n  appWhole(whole_func, pat_val) {\n    const pat_func = this;\n    const query = function (state) {\n      const hap_funcs = pat_func.query(state);\n      const hap_vals = pat_val.query(state);\n      const apply = function (hap_func, hap_val) {\n        const s = hap_func.part.intersection(hap_val.part);\n        if (s == undefined) {\n          return undefined;\n        }\n        return new Hap(\n          whole_func(hap_func.whole, hap_val.whole),\n          s,\n          hap_func.value(hap_val.value),\n          hap_val.combineContext(hap_func),\n        );\n      };\n      return flatten(\n        hap_funcs.map((hap_func) => removeUndefineds(hap_vals.map((hap_val) => apply(hap_func, hap_val)))),\n      );\n    };\n    return new Pattern(query);\n  }\n\n  /**\n   * When this method is called on a pattern of functions, it matches its haps\n   * with those in the given pattern of values.  A new pattern is returned, with\n   * each matching value applied to the corresponding function.\n   *\n   * In this `_appBoth` variant, where timespans of the function and value haps\n   * are not the same but do intersect, the resulting hap has a timespan of the\n   * intersection. This applies to both the part and the whole timespan.\n   * @param {Pattern} pat_val\n   * @noAutocomplete\n   * @returns Pattern\n   */\n  appBoth(pat_val) {\n    const pat_func = this;\n\n    // Tidal's <*>\n    const whole_func = function (span_a, span_b) {\n      if (span_a == undefined || span_b == undefined) {\n        return undefined;\n      }\n      return span_a.intersection_e(span_b);\n    };\n    const result = pat_func.appWhole(whole_func, pat_val);\n    result.tactus = lcm(pat_val.tactus, pat_func.tactus);\n    return result;\n  }\n\n  /**\n   * As with `appBoth`, but the `whole` timespan is not the intersection,\n   * but the timespan from the function of patterns that this method is called\n   * on. In practice, this means that the pattern structure, including onsets,\n   * are preserved from the pattern of functions (often referred to as the left\n   * hand or inner pattern).\n   * @param {Pattern} pat_val\n   * @noAutocomplete\n   * @returns Pattern\n   */\n  appLeft(pat_val) {\n    const pat_func = this;\n\n    const query = function (state) {\n      const haps = [];\n      for (const hap_func of pat_func.query(state)) {\n        const hap_vals = pat_val.query(state.setSpan(hap_func.wholeOrPart()));\n        for (const hap_val of hap_vals) {\n          const new_whole = hap_func.whole;\n          const new_part = hap_func.part.intersection(hap_val.part);\n          if (new_part) {\n            const new_value = hap_func.value(hap_val.value);\n            const new_context = hap_val.combineContext(hap_func);\n            const hap = new Hap(new_whole, new_part, new_value, new_context);\n            haps.push(hap);\n          }\n        }\n      }\n      return haps;\n    };\n    const result = new Pattern(query);\n    result.tactus = this.tactus;\n    return result;\n  }\n\n  /**\n   * As with `appLeft`, but `whole` timespans are instead taken from the\n   * pattern of values, i.e. structure is preserved from the right hand/outer\n   * pattern.\n   * @param {Pattern} pat_val\n   * @noAutocomplete\n   * @returns Pattern\n   */\n  appRight(pat_val) {\n    const pat_func = this;\n\n    const query = function (state) {\n      const haps = [];\n      for (const hap_val of pat_val.query(state)) {\n        const hap_funcs = pat_func.query(state.setSpan(hap_val.wholeOrPart()));\n        for (const hap_func of hap_funcs) {\n          const new_whole = hap_val.whole;\n          const new_part = hap_func.part.intersection(hap_val.part);\n          if (new_part) {\n            const new_value = hap_func.value(hap_val.value);\n            const new_context = hap_val.combineContext(hap_func);\n            const hap = new Hap(new_whole, new_part, new_value, new_context);\n            haps.push(hap);\n          }\n        }\n      }\n      return haps;\n    };\n    const result = new Pattern(query);\n    result.tactus = pat_val.tactus;\n    return result;\n  }\n\n  bindWhole(choose_whole, func) {\n    const pat_val = this;\n    const query = function (state) {\n      const withWhole = function (a, b) {\n        return new Hap(\n          choose_whole(a.whole, b.whole),\n          b.part,\n          b.value,\n          Object.assign({}, a.context, b.context, {\n            locations: (a.context.locations || []).concat(b.context.locations || []),\n          }),\n        );\n      };\n      const match = function (a) {\n        return func(a.value)\n          .query(state.setSpan(a.part))\n          .map((b) => withWhole(a, b));\n      };\n      return flatten(pat_val.query(state).map((a) => match(a)));\n    };\n    return new Pattern(query);\n  }\n\n  bind(func) {\n    const whole_func = function (a, b) {\n      if (a == undefined || b == undefined) {\n        return undefined;\n      }\n      return a.intersection_e(b);\n    };\n    return this.bindWhole(whole_func, func);\n  }\n\n  join() {\n    // Flattens a pattern of patterns into a pattern, where wholes are\n    // the intersection of matched inner and outer haps.\n    return this.bind(id);\n  }\n\n  outerBind(func) {\n    return this.bindWhole((a) => a, func);\n  }\n\n  outerJoin() {\n    // Flattens a pattern of patterns into a pattern, where wholes are\n    // taken from inner haps.\n    return this.outerBind(id);\n  }\n\n  innerBind(func) {\n    return this.bindWhole((_, b) => b, func);\n  }\n\n  innerJoin() {\n    // Flattens a pattern of patterns into a pattern, where wholes are\n    // taken from inner haps.\n    return this.innerBind(id);\n  }\n\n  // Flatterns patterns of patterns, by retriggering/resetting inner patterns at onsets of outer pattern haps\n  resetJoin(restart = false) {\n    const pat_of_pats = this;\n    return new Pattern((state) => {\n      return (\n        pat_of_pats\n          // drop continuous haps from the outer pattern.\n          .discreteOnly()\n          .query(state)\n          .map((outer_hap) => {\n            return (\n              outer_hap.value\n                // reset = align the inner pattern cycle start to outer pattern haps\n                // restart = align the inner pattern cycle zero to outer pattern haps\n                .late(restart ? outer_hap.whole.begin : outer_hap.whole.begin.cyclePos())\n                .query(state)\n                .map((inner_hap) =>\n                  new Hap(\n                    // Supports continuous haps in the inner pattern\n                    inner_hap.whole ? inner_hap.whole.intersection(outer_hap.whole) : undefined,\n                    inner_hap.part.intersection(outer_hap.part),\n                    inner_hap.value,\n                  ).setContext(outer_hap.combineContext(inner_hap)),\n                )\n                // Drop haps that didn't intersect\n                .filter((hap) => hap.part)\n            );\n          })\n          .flat()\n      );\n    });\n  }\n\n  restartJoin() {\n    return this.resetJoin(true);\n  }\n\n  // Like the other joins above, joins a pattern of patterns of values, into a flatter\n  // pattern of values. In this case it takes whole cycles of the inner pattern to fit each event\n  // in the outer pattern.\n  squeezeJoin() {\n    // A pattern of patterns, which we call the 'outer' pattern, with patterns\n    // as values which we call the 'inner' patterns.\n    const pat_of_pats = this;\n    function query(state) {\n      // Get the events with the inner patterns. Ignore continuous events (without 'wholes')\n      const haps = pat_of_pats.discreteOnly().query(state);\n      // A function to map over the events from the outer pattern.\n      function flatHap(outerHap) {\n        // Get the inner pattern, slowed and shifted so that the 'whole'\n        // timespan of the outer event corresponds to the first cycle of the\n        // inner event\n        const inner_pat = outerHap.value._focusSpan(outerHap.wholeOrPart());\n        // Get the inner events, from the timespan of the outer event's part\n        const innerHaps = inner_pat.query(state.setSpan(outerHap.part));\n        // A function to map over the inner events, to combine them with the\n        // outer event\n        function munge(outer, inner) {\n          let whole = undefined;\n          if (inner.whole && outer.whole) {\n            whole = inner.whole.intersection(outer.whole);\n            if (!whole) {\n              // The wholes are present, but don't intersect\n              return undefined;\n            }\n          }\n          const part = inner.part.intersection(outer.part);\n          if (!part) {\n            // The parts don't intersect\n            return undefined;\n          }\n          const context = inner.combineContext(outer);\n          return new Hap(whole, part, inner.value, context);\n        }\n        return innerHaps.map((innerHap) => munge(outerHap, innerHap));\n      }\n      const result = flatten(haps.map(flatHap));\n      // remove undefineds\n      return result.filter((x) => x);\n    }\n    return new Pattern(query);\n  }\n\n  squeezeBind(func) {\n    return this.fmap(func).squeezeJoin();\n  }\n\n  //////////////////////////////////////////////////////////////////////\n  // Utility methods mainly for internal use\n\n  /**\n   * Query haps inside the given time span.\n   *\n   * @param {Fraction | number} begin from time\n   * @param {Fraction | number} end to time\n   * @returns Hap[]\n   * @example\n   * const pattern = sequence('a', ['b', 'c'])\n   * const haps = pattern.queryArc(0, 1)\n   * console.log(haps)\n   * silence\n   * @noAutocomplete\n   */\n  queryArc(begin, end, controls = {}) {\n    try {\n      return this.query(new State(new TimeSpan(begin, end), controls));\n    } catch (err) {\n      logger(`[query]: ${err.message}`, 'error');\n      return [];\n    }\n  }\n\n  /**\n   * Returns a new pattern, with queries split at cycle boundaries. This makes\n   * some calculations easier to express, as all haps are then constrained to\n   * happen within a cycle.\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  splitQueries() {\n    const pat = this;\n    const q = (state) => {\n      return flatten(state.span.spanCycles.map((subspan) => pat.query(state.setSpan(subspan))));\n    };\n    return new Pattern(q);\n  }\n\n  /**\n   * Returns a new pattern, where the given function is applied to the query\n   * timespan before passing it to the original pattern.\n   * @param {Function} func the function to apply\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  withQuerySpan(func) {\n    return new Pattern((state) => this.query(state.withSpan(func)));\n  }\n\n  withQuerySpanMaybe(func) {\n    const pat = this;\n    return new Pattern((state) => {\n      const newState = state.withSpan(func);\n      if (!newState.span) {\n        return [];\n      }\n      return pat.query(newState);\n    });\n  }\n\n  /**\n   * As with `withQuerySpan`, but the function is applied to both the\n   * begin and end time of the query timespan.\n   * @param {Function} func the function to apply\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  withQueryTime(func) {\n    return new Pattern((state) => this.query(state.withSpan((span) => span.withTime(func))));\n  }\n\n  /**\n   * Similar to `withQuerySpan`, but the function is applied to the timespans\n   * of all haps returned by pattern queries (both `part` timespans, and where\n   * present, `whole` timespans).\n   * @param {Function} func\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  withHapSpan(func) {\n    return new Pattern((state) => this.query(state).map((hap) => hap.withSpan(func)));\n  }\n\n  /**\n   * As with `withHapSpan`, but the function is applied to both the\n   * begin and end time of the hap timespans.\n   * @param {Function} func the function to apply\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  withHapTime(func) {\n    return this.withHapSpan((span) => span.withTime(func));\n  }\n\n  /**\n   * Returns a new pattern with the given function applied to the list of haps returned by every query.\n   * @param {Function} func\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  withHaps(func) {\n    const result = new Pattern((state) => func(this.query(state), state));\n    result.tactus = this.tactus;\n    return result;\n  }\n\n  /**\n   * As with `withHaps`, but applies the function to every hap, rather than every list of haps.\n   * @param {Function} func\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  withHap(func) {\n    return this.withHaps((haps) => haps.map(func));\n  }\n\n  /**\n   * Returns a new pattern with the context field set to every hap set to the given value.\n   * @param {*} context\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  setContext(context) {\n    return this.withHap((hap) => hap.setContext(context));\n  }\n\n  /**\n   * Returns a new pattern with the given function applied to the context field of every hap.\n   * @param {Function} func\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  withContext(func) {\n    const result = this.withHap((hap) => hap.setContext(func(hap.context)));\n    if (this.__pure !== undefined) {\n      result.__pure = this.__pure;\n      result.__pure_loc = this.__pure_loc;\n    }\n    return result;\n  }\n\n  /**\n   * Returns a new pattern with the context field of every hap set to an empty object.\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  stripContext() {\n    return this.withHap((hap) => hap.setContext({}));\n  }\n\n  /**\n   * Returns a new pattern with the given location information added to the\n   * context of every hap.\n   * @param {Number} start start offset\n   * @param {Number} end end offset\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  withLoc(start, end) {\n    const location = {\n      start,\n      end,\n    };\n    const result = this.withContext((context) => {\n      const locations = (context.locations || []).concat([location]);\n      return { ...context, locations };\n    });\n    if (this.__pure) {\n      result.__pure = this.__pure;\n      result.__pure_loc = location;\n    }\n    return result;\n  }\n\n  /**\n   * Returns a new Pattern, which only returns haps that meet the given test.\n   * @param {Function} hap_test - a function which returns false for haps to be removed from the pattern\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  filterHaps(hap_test) {\n    return new Pattern((state) => this.query(state).filter(hap_test));\n  }\n\n  /**\n   * As with `filterHaps`, but the function is applied to values\n   * inside haps.\n   * @param {Function} value_test\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  filterValues(value_test) {\n    return new Pattern((state) => this.query(state).filter((hap) => value_test(hap.value))).setTactus(this.tactus);\n  }\n\n  /**\n   * Returns a new pattern, with haps containing undefined values removed from\n   * query results.\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  removeUndefineds() {\n    return this.filterValues((val) => val != undefined);\n  }\n\n  /**\n   * Returns a new pattern, with all haps without onsets filtered out. A hap\n   * with an onset is one with a `whole` timespan that begins at the same time\n   * as its `part` timespan.\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  onsetsOnly() {\n    // Returns a new pattern that will only return haps where the start\n    // of the 'whole' timespan matches the start of the 'part'\n    // timespan, i.e. the haps that include their 'onset'.\n    return this.filterHaps((hap) => hap.hasOnset());\n  }\n\n  /**\n   * Returns a new pattern, with 'continuous' haps (those without 'whole'\n   * timespans) removed from query results.\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  discreteOnly() {\n    // removes continuous haps that don't have a 'whole' timespan\n    return this.filterHaps((hap) => hap.whole);\n  }\n\n  /**\n   * Combines adjacent haps with the same value and whole.  Only\n   * intended for use in tests.\n   * @noAutocomplete\n   */\n  defragmentHaps() {\n    // remove continuous haps\n    const pat = this.discreteOnly();\n\n    return pat.withHaps((haps) => {\n      const result = [];\n      for (var i = 0; i < haps.length; ++i) {\n        var searching = true;\n        var a = haps[i];\n        while (searching) {\n          const a_value = JSON.stringify(haps[i].value);\n          var found = false;\n\n          for (var j = i + 1; j < haps.length; j++) {\n            const b = haps[j];\n\n            if (a.whole.equals(b.whole)) {\n              if (a.part.begin.eq(b.part.end)) {\n                if (a_value === JSON.stringify(b.value)) {\n                  // eat the matching hap into 'a'\n                  a = new Hap(a.whole, new TimeSpan(b.part.begin, a.part.end), a.value);\n                  haps.splice(j, 1);\n                  // restart the search\n                  found = true;\n                  break;\n                }\n              } else if (b.part.begin.eq(a.part.end)) {\n                if (a_value == JSON.stringify(b.value)) {\n                  // eat the matching hap into 'a'\n                  a = new Hap(a.whole, new TimeSpan(a.part.begin, b.part.end), a.value);\n                  haps.splice(j, 1);\n                  // restart the search\n                  found = true;\n                  break;\n                }\n              }\n            }\n          }\n\n          searching = found;\n        }\n        result.push(a);\n      }\n      return result;\n    });\n  }\n\n  /**\n   * Queries the pattern for the first cycle, returning Haps. Mainly of use when\n   * debugging a pattern.\n   * @param {Boolean} with_context - set to true, otherwise the context field\n   * will be stripped from the resulting haps.\n   * @returns [Hap]\n   * @noAutocomplete\n   */\n  firstCycle(with_context = false) {\n    var self = this;\n    if (!with_context) {\n      self = self.stripContext();\n    }\n    return self.query(new State(new TimeSpan(Fraction(0), Fraction(1))));\n  }\n\n  /**\n   * Accessor for a list of values returned by querying the first cycle.\n   * @noAutocomplete\n   */\n  get firstCycleValues() {\n    return this.firstCycle().map((hap) => hap.value);\n  }\n\n  /**\n   * More human-readable version of the `firstCycleValues` accessor.\n   * @noAutocomplete\n   */\n  get showFirstCycle() {\n    return this.firstCycle().map(\n      (hap) => `${hap.value}: ${hap.whole.begin.toFraction()} - ${hap.whole.end.toFraction()}`,\n    );\n  }\n\n  /**\n   * Returns a new pattern, which returns haps sorted in temporal order. Mainly\n   * of use when comparing two patterns for equality, in tests.\n   * @returns Pattern\n   * @noAutocomplete\n   */\n  sortHapsByPart() {\n    return this.withHaps((haps) =>\n      haps.sort((a, b) =>\n        a.part.begin\n          .sub(b.part.begin)\n          .or(a.part.end.sub(b.part.end))\n          .or(a.whole.begin.sub(b.whole.begin).or(a.whole.end.sub(b.whole.end))),\n      ),\n    );\n  }\n\n  asNumber() {\n    return this.fmap(parseNumeral);\n  }\n\n  //////////////////////////////////////////////////////////////////////\n  // Operators - see 'make composers' later..\n\n  _opIn(other, func) {\n    return this.fmap(func).appLeft(reify(other));\n  }\n  _opOut(other, func) {\n    return this.fmap(func).appRight(reify(other));\n  }\n  _opMix(other, func) {\n    return this.fmap(func).appBoth(reify(other));\n  }\n  _opSqueeze(other, func) {\n    const otherPat = reify(other);\n    return this.fmap((a) => otherPat.fmap((b) => func(a)(b))).squeezeJoin();\n  }\n  _opSqueezeOut(other, func) {\n    const thisPat = this;\n    const otherPat = reify(other);\n    return otherPat.fmap((a) => thisPat.fmap((b) => func(b)(a))).squeezeJoin();\n  }\n  _opReset(other, func) {\n    const otherPat = reify(other);\n    return otherPat.fmap((b) => this.fmap((a) => func(a)(b))).resetJoin();\n  }\n  _opRestart(other, func) {\n    const otherPat = reify(other);\n    return otherPat.fmap((b) => this.fmap((a) => func(a)(b))).restartJoin();\n  }\n\n  //////////////////////////////////////////////////////////////////////\n  // End-user methods.\n  // Those beginning with an underscore (_) are 'patternified',\n  // i.e. versions are created without the underscore, that are\n  // magically transformed to accept patterns for all their arguments.\n\n  //////////////////////////////////////////////////////////////////////\n  // Methods without corresponding toplevel functions\n\n  /**\n   * Layers the result of the given function(s). Like `superimpose`, but without the original pattern:\n   * @name layer\n   * @memberof Pattern\n   * @synonyms apply\n   * @returns Pattern\n   * @example\n   * \"<0 2 4 6 ~ 4 ~ 2 0!3 ~!5>*8\"\n   *   .layer(x=>x.add(\"0,2\"))\n   *   .scale('C minor').note()\n   */\n  layer(...funcs) {\n    return stack(...funcs.map((func) => func(this)));\n  }\n\n  /**\n   * Superimposes the result of the given function(s) on top of the original pattern:\n   * @name superimpose\n   * @memberof Pattern\n   * @returns Pattern\n   * @example\n   * \"<0 2 4 6 ~ 4 ~ 2 0!3 ~!5>*8\"\n   *   .superimpose(x=>x.add(2))\n   *   .scale('C minor').note()\n   */\n  superimpose(...funcs) {\n    return this.stack(...funcs.map((func) => func(this)));\n  }\n\n  //////////////////////////////////////////////////////////////////////\n  // Multi-pattern functions\n\n  /**\n   * Stacks the given pattern(s) to the current pattern.\n   * @name stack\n   * @memberof Pattern\n   * @example\n   * s(\"hh*4\").stack(\n   *   note(\"c4(5,8)\")\n   * )\n   */\n  stack(...pats) {\n    return stack(this, ...pats);\n  }\n\n  sequence(...pats) {\n    return sequence(this, ...pats);\n  }\n\n  /**\n   * Appends the given pattern(s) to the current pattern.\n   * @name seq\n   * @memberof Pattern\n   * @synonyms sequence, fastcat\n   * @example\n   * s(\"hh*4\").seq(\n   *   note(\"c4(5,8)\")\n   * )\n   */\n  seq(...pats) {\n    return sequence(this, ...pats);\n  }\n\n  /**\n   * Appends the given pattern(s) to the next cycle.\n   * @name cat\n   * @memberof Pattern\n   * @synonyms slowcat\n   * @example\n   * s(\"hh*4\").cat(\n   *   note(\"c4(5,8)\")\n   * )\n   */\n  cat(...pats) {\n    return cat(this, ...pats);\n  }\n\n  fastcat(...pats) {\n    return fastcat(this, ...pats);\n  }\n\n  slowcat(...pats) {\n    return slowcat(this, ...pats);\n  }\n\n  //////////////////////////////////////////////////////////////////////\n  // Context methods - ones that deal with metadata\n\n  onTrigger(onTrigger, dominant = true) {\n    return this.withHap((hap) =>\n      hap.setContext({\n        ...hap.context,\n        onTrigger: (...args) => {\n          // run previously set trigger, if it exists\n          hap.context.onTrigger?.(...args);\n          onTrigger(...args);\n        },\n        // if dominantTrigger is set to true, the default output (webaudio) will be disabled\n        // when using multiple triggers, you cannot flip this flag to false again!\n        // example: x.csound('CooLSynth').log() as well as x.log().csound('CooLSynth') should work the same\n        dominantTrigger: hap.context.dominantTrigger || dominant,\n      }),\n    );\n  }\n\n  log(func = (_, hap) => `[hap] ${hap.showWhole(true)}`, getData = (_, hap) => ({ hap })) {\n    return this.onTrigger((...args) => {\n      logger(func(...args), undefined, getData(...args));\n    }, false);\n  }\n\n  logValues(func = id) {\n    return this.log((_, hap) => func(hap.value));\n  }\n\n  //////////////////////////////////////////////////////////////////////\n  // Visualisation\n\n  drawLine() {\n    console.log(drawLine(this));\n    return this;\n  }\n}\n\n//////////////////////////////////////////////////////////////////////\n// functions relating to chords/patterns of lists/lists of patterns\n\n// returns Array<Hap[]> where each list of haps satisfies eq\nfunction groupHapsBy(eq, haps) {\n  let groups = [];\n  haps.forEach((hap) => {\n    const match = groups.findIndex(([other]) => eq(hap, other));\n    if (match === -1) {\n      groups.push([hap]);\n    } else {\n      groups[match].push(hap);\n    }\n  });\n  return groups;\n}\n\n// congruent haps = haps with equal spans\nconst congruent = (a, b) => a.spanEquals(b);\n// Pattern<Hap<T>> -> Pattern<Hap<T[]>>\n// returned pattern contains arrays of congruent haps\nPattern.prototype.collect = function () {\n  return this.withHaps((haps) =>\n    groupHapsBy(congruent, haps).map((_haps) => new Hap(_haps[0].whole, _haps[0].part, _haps, {})),\n  );\n};\n\n/**\n * Selects indices in in stacked notes.\n * @example\n * note(\"<[c,eb,g]!2 [c,f,ab] [d,f,ab]>\")\n * .arpWith(haps => haps[2])\n * */\nPattern.prototype.arpWith = function (func) {\n  return this.collect()\n    .fmap((v) => reify(func(v)))\n    .innerJoin()\n    .withHap((h) => new Hap(h.whole, h.part, h.value.value, h.combineContext(h.value)));\n};\n\n/**\n * Selects indices in in stacked notes.\n * @example\n * note(\"<[c,eb,g]!2 [c,f,ab] [d,f,ab]>\")\n * .arp(\"0 [0,2] 1 [0,2]\")\n * */\nPattern.prototype.arp = function (pat) {\n  return this.arpWith((haps) => pat.fmap((i) => haps[i % haps.length]));\n};\n\n/*\n * Takes a time duration followed by one or more patterns, and shifts the given patterns in time, so they are\n * distributed equally over the given time duration. They are then combined with the pattern 'weave' is called on, after it has been stretched out (i.e. slowed down by) the time duration.\n * @name weave\n * @memberof Pattern\n * @example pan(saw).weave(4, s(\"bd(3,8)\"), s(\"~ sd\"))\n * @example n(\"0 1 2 3 4 5 6 7\").weave(8, s(\"bd(3,8)\"), s(\"~ sd\"))\n\naddToPrototype('weave', function (t, ...pats) {\n  return this.weaveWith(t, ...pats.map((x) => set.out(x)));\n});\n\n*/\n/*\n * Like 'weave', but accepts functions rather than patterns, which are applied to the pattern.\n * @name weaveWith\n * @memberof Pattern\n\naddToPrototype('weaveWith', function (t, ...funcs) {\n  const pat = this;\n  const l = funcs.length;\n  t = Fraction(t);\n  if (l == 0) {\n    return silence;\n  }\n  return stack(...funcs.map((func, i) => pat.inside(t, func).early(Fraction(i).div(l))))._slow(t);\n});\n*/\n\n//////////////////////////////////////////////////////////////////////\n// compose matrix functions\n\nfunction _nonArrayObject(x) {\n  return !Array.isArray(x) && typeof x === 'object';\n}\nfunction _composeOp(a, b, func) {\n  if (_nonArrayObject(a) || _nonArrayObject(b)) {\n    if (!_nonArrayObject(a)) {\n      a = { value: a };\n    }\n    if (!_nonArrayObject(b)) {\n      b = { value: b };\n    }\n    return unionWithObj(a, b, func);\n  }\n  return func(a, b);\n}\n\n// Make composers\n(function () {\n  // pattern composers\n  const composers = {\n    set: [(a, b) => b],\n    keep: [(a) => a],\n    keepif: [(a, b) => (b ? a : undefined)],\n\n    // numerical functions\n    /**\n     *\n     * Assumes a pattern of numbers. Adds the given number to each item in the pattern.\n     * @name add\n     * @memberof Pattern\n     * @example\n     * // Here, the triad 0, 2, 4 is shifted by different amounts\n     * n(\"0 2 4\".add(\"<0 3 4 0>\")).scale(\"C:major\")\n     * // Without add, the equivalent would be:\n     * // n(\"<[0 2 4] [3 5 7] [4 6 8] [0 2 4]>\").scale(\"C:major\")\n     * @example\n     * // You can also use add with notes:\n     * note(\"c3 e3 g3\".add(\"<0 5 7 0>\"))\n     * // Behind the scenes, the notes are converted to midi numbers:\n     * // note(\"48 52 55\".add(\"<0 5 7 0>\"))\n     */\n    add: [numeralArgs((a, b) => a + b)], // support string concatenation\n    /**\n     *\n     * Like add, but the given numbers are subtracted.\n     * @name sub\n     * @memberof Pattern\n     * @example\n     * n(\"0 2 4\".sub(\"<0 1 2 3>\")).scale(\"C4:minor\")\n     * // See add for more information.\n     */\n    sub: [numeralArgs((a, b) => a - b)],\n    /**\n     *\n     * Multiplies each number by the given factor.\n     * @name mul\n     * @memberof Pattern\n     * @example\n     * \"<1 1.5 [1.66, <2 2.33>]>*4\".mul(150).freq()\n     */\n    mul: [numeralArgs((a, b) => a * b)],\n    /**\n     *\n     * Divides each number by the given factor.\n     * @name div\n     * @memberof Pattern\n     */\n    div: [numeralArgs((a, b) => a / b)],\n    mod: [numeralArgs(_mod)],\n    pow: [numeralArgs(Math.pow)],\n    band: [numeralArgs((a, b) => a & b)],\n    bor: [numeralArgs((a, b) => a | b)],\n    bxor: [numeralArgs((a, b) => a ^ b)],\n    blshift: [numeralArgs((a, b) => a << b)],\n    brshift: [numeralArgs((a, b) => a >> b)],\n\n    // TODO - force numerical comparison if both look like numbers?\n    lt: [(a, b) => a < b],\n    gt: [(a, b) => a > b],\n    lte: [(a, b) => a <= b],\n    gte: [(a, b) => a >= b],\n    eq: [(a, b) => a == b],\n    eqt: [(a, b) => a === b],\n    ne: [(a, b) => a != b],\n    net: [(a, b) => a !== b],\n    and: [(a, b) => a && b],\n    or: [(a, b) => a || b],\n\n    //  bitwise ops\n    func: [(a, b) => b(a)],\n  };\n\n  const hows = ['In', 'Out', 'Mix', 'Squeeze', 'SqueezeOut', 'Reset', 'Restart'];\n\n  // generate methods to do what and how\n  for (const [what, [op, preprocess]] of Object.entries(composers)) {\n    // make plain version, e.g. pat._add(value) adds that plain value\n    // to all the values in pat\n    Pattern.prototype['_' + what] = function (value) {\n      return this.fmap((x) => op(x, value));\n    };\n\n    // make patternified monster version\n    Object.defineProperty(Pattern.prototype, what, {\n      // a getter that returns a function, so 'pat' can be\n      // accessed by closures that are methods of that function..\n      get: function () {\n        const pat = this;\n\n        // wrap the 'in' function as default behaviour\n        const wrapper = (...other) => pat[what]['in'](...other);\n\n        // add methods to that function for each behaviour\n        for (const how of hows) {\n          wrapper[how.toLowerCase()] = function (...other) {\n            var howpat = pat;\n            other = sequence(other);\n            if (preprocess) {\n              howpat = preprocess(howpat);\n              other = preprocess(other);\n            }\n            var result;\n            // hack to remove undefs when doing 'keepif'\n            if (what === 'keepif') {\n              // avoid union, as we want to throw away the value of 'b' completely\n              result = howpat['_op' + how](other, (a) => (b) => op(a, b));\n              result = result.removeUndefineds();\n            } else {\n              result = howpat['_op' + how](other, (a) => (b) => _composeOp(a, b, op));\n            }\n            return result;\n          };\n        }\n        wrapper.squeezein = wrapper.squeeze;\n\n        return wrapper;\n      },\n    });\n\n    // Default op to 'set', e.g. pat.squeeze(pat2) = pat.set.squeeze(pat2)\n    for (const how of hows) {\n      Pattern.prototype[how.toLowerCase()] = function (...args) {\n        return this.set[how.toLowerCase()](args);\n      };\n    }\n  }\n\n  // binary composers\n  /**\n   * Applies the given structure to the pattern:\n   *\n   * @example\n   * note(\"c,eb,g\")\n   *   .struct(\"x ~ x ~ ~ x ~ x ~ ~ ~ x ~ x ~ ~\")\n   *   .slow(2)\n   */\n  Pattern.prototype.struct = function (...args) {\n    return this.keepif.out(...args);\n  };\n  Pattern.prototype.structAll = function (...args) {\n    return this.keep.out(...args);\n  };\n  /**\n   * Returns silence when mask is 0 or \"~\"\n   *\n   * @example\n   * note(\"c [eb,g] d [eb,g]\").mask(\"<1 [0 1]>\")\n   */\n  Pattern.prototype.mask = function (...args) {\n    return this.keepif.in(...args);\n  };\n  Pattern.prototype.maskAll = function (...args) {\n    return this.keep.in(...args);\n  };\n  /**\n   * Resets the pattern to the start of the cycle for each onset of the reset pattern.\n   *\n   * @example\n   * s(\"[<bd lt> sd]*2, hh*8\").reset(\"<x@3 x(5,8)>\")\n   */\n  Pattern.prototype.reset = function (...args) {\n    return this.keepif.reset(...args);\n  };\n  Pattern.prototype.resetAll = function (...args) {\n    return this.keep.reset(...args);\n  };\n  /**\n   * Restarts the pattern for each onset of the restart pattern.\n   * While reset will only reset the current cycle, restart will start from cycle 0.\n   *\n   * @example\n   * s(\"[<bd lt> sd]*2, hh*8\").restart(\"<x@3 x(5,8)>\")\n   */\n  Pattern.prototype.restart = function (...args) {\n    return this.keepif.restart(...args);\n  };\n  Pattern.prototype.restartAll = function (...args) {\n    return this.keep.restart(...args);\n  };\n})();\n\n// aliases\nexport const polyrhythm = stack;\nexport const pr = stack;\n\nexport const pm = polymeter;\n\n// methods that create patterns, which are added to patternified Pattern methods\n// TODO: remove? this is only used in old transpiler (shapeshifter)\nPattern.prototype.factories = {\n  pure,\n  stack,\n  slowcat,\n  fastcat,\n  cat,\n  timecat,\n  sequence,\n  seq,\n  polymeter,\n  pm,\n  polyrhythm,\n  pr,\n};\n// the magic happens in Pattern constructor. Keeping this in prototype enables adding methods from the outside (e.g. see tonal.ts)\n\n// Elemental patterns\n\n/**\n * Does absolutely nothing, but with a given metrical 'tactus'\n * @name gap\n * @param  {number} tactus\n * @example\n * gap(3) // \"~@3\"\n */\nexport const gap = (tactus) => new Pattern(() => [], Fraction(tactus));\n\n/**\n * Does absolutely nothing..\n * @name silence\n * @example\n * silence // \"~\"\n */\nexport const silence = gap(1);\n\n/* Like silence, but with a 'tactus' (relative duration) of 0 */\nexport const nothing = gap(0);\n\n/** A discrete value that repeats once per cycle.\n *\n * @returns {Pattern}\n * @example\n * pure('e4') // \"e4\"\n * @noAutocomplete\n */\nexport function pure(value) {\n  function query(state) {\n    return state.span.spanCycles.map((subspan) => new Hap(Fraction(subspan.begin).wholeCycle(), subspan, value));\n  }\n  const result = new Pattern(query, 1);\n  result.__pure = value;\n  return result;\n}\n\nexport function isPattern(thing) {\n  // thing?.constructor?.name !== 'Pattern' // <- this will fail when code is mangled\n  const is = thing instanceof Pattern || thing?._Pattern;\n  // TODO: find out how to check wrong core dependency. below will never work !thing === 'undefined'\n  // wrapping it in (..) will result other checks to log that warning (e.g. isPattern('kalimba'))\n  /* if (!thing instanceof Pattern) {\n    console.warn(\n      `Found Pattern that fails \"instanceof Pattern\" check.\n      This may happen if you are using multiple versions of @strudel/core.\n      Please check by running \"npm ls @strudel/core\".`,\n    );\n    console.log(thing);\n  } */\n  return is;\n}\n\nexport function reify(thing) {\n  // Turns something into a pattern, unless it's already a pattern\n  if (isPattern(thing)) {\n    return thing;\n  }\n  if (stringParser && typeof thing === 'string') {\n    return stringParser(thing);\n  }\n  return pure(thing);\n}\n\n/** The given items are played at the same time at the same length.\n *\n * @return {Pattern}\n * @synonyms polyrhythm, pr\n * @example\n * stack(\"g3\", \"b3\", [\"e4\", \"d4\"]).note()\n * // \"g3,b3,[e4,d4]\".note()\n */\nexport function stack(...pats) {\n  // Array test here is to avoid infinite recursions..\n  pats = pats.map((pat) => (Array.isArray(pat) ? sequence(...pat) : reify(pat)));\n  const query = (state) => flatten(pats.map((pat) => pat.query(state)));\n  const result = new Pattern(query);\n  result.tactus = lcm(...pats.map((pat) => pat.tactus));\n  return result;\n}\n\nfunction _stackWith(func, pats) {\n  pats = pats.map((pat) => (Array.isArray(pat) ? sequence(...pat) : reify(pat)));\n  if (pats.length === 0) {\n    return silence;\n  }\n  if (pats.length === 1) {\n    return pats[0];\n  }\n  const [left, ...right] = pats.map((pat) => pat.tactus);\n  const tactus = left.maximum(...right);\n  return stack(...func(tactus, pats));\n}\n\nexport function stackLeft(...pats) {\n  return _stackWith(\n    (tactus, pats) => pats.map((pat) => (pat.tactus.eq(tactus) ? pat : timecat(pat, gap(tactus.sub(pat.tactus))))),\n    pats,\n  );\n}\n\nexport function stackRight(...pats) {\n  return _stackWith(\n    (tactus, pats) => pats.map((pat) => (pat.tactus.eq(tactus) ? pat : timecat(gap(tactus.sub(pat.tactus)), pat))),\n    pats,\n  );\n}\n\nexport function stackCentre(...pats) {\n  return _stackWith(\n    (tactus, pats) =>\n      pats.map((pat) => {\n        if (pat.tactus.eq(tactus)) {\n          return pat;\n        }\n        const g = gap(tactus.sub(pat.tactus).div(2));\n        return timecat(g, pat, g);\n      }),\n    pats,\n  );\n}\n\nexport function stackBy(by, ...pats) {\n  const [left, ...right] = pats.map((pat) => pat.tactus);\n  const tactus = left.maximum(...right);\n  const lookup = {\n    centre: stackCentre,\n    left: stackLeft,\n    right: stackRight,\n    expand: stack,\n    repeat: (...args) => polymeterSteps(tactus, ...args),\n  };\n  return by\n    .inhabit(lookup)\n    .fmap((func) => func(...pats))\n    .innerJoin()\n    .setTactus(tactus);\n}\n\n/** Concatenation: combines a list of patterns, switching between them successively, one per cycle:\n *\n * synonyms: `cat`\n *\n * @return {Pattern}\n * @example\n * slowcat(\"e5\", \"b4\", [\"d5\", \"c5\"])\n *\n */\nexport function slowcat(...pats) {\n  // Array test here is to avoid infinite recursions..\n  pats = pats.map((pat) => (Array.isArray(pat) ? fastcat(...pat) : reify(pat)));\n\n  if (pats.length == 1) {\n    return pats[0];\n  }\n\n  const query = function (state) {\n    const span = state.span;\n    const pat_n = _mod(span.begin.sam(), pats.length);\n    const pat = pats[pat_n];\n    if (!pat) {\n      // pat_n can be negative, if the span is in the past..\n      return [];\n    }\n    // A bit of maths to make sure that cycles from constituent patterns aren't skipped.\n    // For example if three patterns are slowcat-ed, the fourth cycle of the result should\n    // be the second (rather than fourth) cycle from the first pattern.\n    const offset = span.begin.floor().sub(span.begin.div(pats.length).floor());\n    return pat.withHapTime((t) => t.add(offset)).query(state.setSpan(span.withTime((t) => t.sub(offset))));\n  };\n  return new Pattern(query).splitQueries();\n}\n\n/** Concatenation: combines a list of patterns, switching between them successively, one per cycle. Unlike slowcat, this version will skip cycles.\n * @param {...any} items - The items to concatenate\n * @return {Pattern}\n */\nexport function slowcatPrime(...pats) {\n  pats = pats.map(reify);\n  const query = function (state) {\n    const pat_n = Math.floor(state.span.begin) % pats.length;\n    const pat = pats[pat_n]; // can be undefined for same cases e.g. /#cHVyZSg0MikKICAuZXZlcnkoMyxhZGQoNykpCiAgLmxhdGUoLjUp\n    return pat?.query(state) || [];\n  };\n  return new Pattern(query).splitQueries();\n}\n\n/** The given items are con**cat**enated, where each one takes one cycle.\n *\n * @param {...any} items - The items to concatenate\n * @synonyms slowcat\n * @return {Pattern}\n * @example\n * cat(\"e5\", \"b4\", [\"d5\", \"c5\"]).note()\n * // \"<e5 b4 [d5 c5]>\".note()\n *\n */\nexport function cat(...pats) {\n  return slowcat(...pats);\n}\n\n/** Sequences patterns like `seq`, but each pattern has a length, relative to the whole.\n * This length can either be provided as a [length, pattern] pair, or inferred from\n * the pattern's 'tactus', generally inferred by the mininotation.\n * @return {Pattern}\n * @example\n * timecat([3,\"e3\"],[1, \"g3\"]).note()\n * // the same as \"e3@3 g3\".note()\n * @example\n * timecat(\"bd sd cp\",\"hh hh\").sound()\n * // the same as \"bd sd cp hh hh\".sound()\n */\nexport function timecat(...timepats) {\n  const findtactus = (x) => (Array.isArray(x) ? x : [x.tactus, x]);\n  timepats = timepats.map(findtactus);\n  if (timepats.length == 1) {\n    const result = reify(timepats[0][1]);\n    result.tactus = timepats[0][0];\n    return result;\n  }\n\n  const total = timepats.map((a) => a[0]).reduce((a, b) => a.add(b), Fraction(0));\n  let begin = Fraction(0);\n  const pats = [];\n  for (const [time, pat] of timepats) {\n    const end = begin.add(time);\n    pats.push(reify(pat)._compress(begin.div(total), end.div(total)));\n    begin = end;\n  }\n  const result = stack(...pats);\n  result.tactus = total;\n  return result;\n}\n\n/** Deprecated alias for `timecat` */\nexport const timeCat = timecat;\n\n/**\n * Allows to arrange multiple patterns together over multiple cycles.\n * Takes a variable number of arrays with two elements specifying the number of cycles and the pattern to use.\n *\n * @return {Pattern}\n * @example\n * arrange(\n *   [4, \"<c a f e>(3,8)\"],\n *   [2, \"<g a>(5,8)\"]\n * ).note()\n */\nexport function arrange(...sections) {\n  const total = sections.reduce((sum, [cycles]) => sum + cycles, 0);\n  sections = sections.map(([cycles, section]) => [cycles, section.fast(cycles)]);\n  return timecat(...sections).slow(total);\n}\n\nexport function fastcat(...pats) {\n  let result = slowcat(...pats);\n  if (pats.length > 1) {\n    result = result._fast(pats.length);\n    result.tactus = pats.length;\n  }\n  return result;\n}\n\n/** See `fastcat` */\nexport function sequence(...pats) {\n  return fastcat(...pats);\n}\n\n/**\n * Concatenates patterns stepwise, according to their 'tactus'.\n * Similar to `timecat`, but if an argument is a list, the whole pattern will be repeated for each element in the list.\n *\n * @return {Pattern}\n * @example\n * stepcat([\"bd cp\", \"mt\"], \"bd\").sound()\n */\nexport function stepcat(...groups) {\n  groups = groups.map((a) => (Array.isArray(a) ? a.map(reify) : [reify(a)]));\n\n  const cycles = lcm(...groups.map((x) => Fraction(x.length)));\n\n  let result = [];\n  for (let cycle = 0; cycle < cycles; ++cycle) {\n    result.push(...groups.map((x) => (x.length == 0 ? silence : x[cycle % x.length])));\n  }\n  result = result.filter((x) => x.tactus > 0);\n  const tactus = result.reduce((a, b) => a.add(b.tactus), Fraction(0));\n  result = timecat(...result);\n  result.tactus = tactus;\n  return result;\n}\n\n/** Like **cat**, but the items are crammed into one cycle.\n * @synonyms fastcat, sequence\n * @example\n * seq(\"e5\", \"b4\", [\"d5\", \"c5\"]).note()\n * // \"e5 b4 [d5 c5]\".note()\n *\n */\nexport function seq(...pats) {\n  return fastcat(...pats);\n}\n\nfunction _sequenceCount(x) {\n  if (Array.isArray(x)) {\n    if (x.length == 0) {\n      return [silence, 0];\n    }\n    if (x.length == 1) {\n      return _sequenceCount(x[0]);\n    }\n    return [fastcat(...x.map((a) => _sequenceCount(a)[0])), x.length];\n  }\n  return [reify(x), 1];\n}\n\n/**\n * Speeds a pattern up or down, to fit to the given metrical 'tactus'.\n * @example\n * s(\"bd sd cp\").toTactus(4)\n * // The same as s(\"{bd sd cp}%4\")\n */\nexport const toTactus = register('toTactus', function (targetTactus, pat) {\n  return pat.fast(Fraction(targetTactus).div(pat.tactus));\n});\n\nexport function _polymeterListSteps(steps, ...args) {\n  const seqs = args.map((a) => _sequenceCount(a));\n  if (seqs.length == 0) {\n    return silence;\n  }\n  if (steps == 0) {\n    steps = seqs[0][1];\n  }\n  const pats = [];\n  for (const seq of seqs) {\n    if (seq[1] == 0) {\n      continue;\n    }\n    if (steps == seq[1]) {\n      pats.push(seq[0]);\n    } else {\n      pats.push(seq[0]._fast(Fraction(steps).div(Fraction(seq[1]))));\n    }\n  }\n  return stack(...pats);\n}\n\n/**\n * Aligns one or more given patterns to the given number of steps per cycle.\n * This relies on patterns having coherent number of steps per cycle,\n *\n * @name polymeterSteps\n * @param  {number} steps how many items are placed in one cycle\n * @param  {any[]} patterns one or more patterns\n * @example\n * // the same as \"{c d, e f g}%4\"\n * polymeterSteps(4, \"c d\", \"e f g\")\n */\nexport function polymeterSteps(steps, ...args) {\n  if (args.length == 0) {\n    return silence;\n  }\n  if (Array.isArray(args[0])) {\n    // Support old behaviour\n    return _polymeterListSteps(steps, ...args);\n  }\n\n  return polymeter(...args).toTactus(steps);\n}\n\n/**\n * Combines the given lists of patterns with the same pulse, creating polymeters when different sized sequences are used.\n * @synonyms pm\n * @example\n * // The same as \"{c eb g, c2 g2}\"\n * polymeter(\"c eb g\", \"c2 g2\")\n *\n */\nexport function polymeter(...args) {\n  if (Array.isArray(args[0])) {\n    // Support old behaviour\n    return _polymeterListSteps(0, ...args);\n  }\n\n  if (args.length == 0) {\n    return silence;\n  }\n  const tactus = args[0].tactus;\n  const [head, ...tail] = args;\n\n  const result = stack(head, ...tail.map((pat) => pat._slow(pat.tactus.div(tactus))));\n  result.tactus = tactus;\n  return result;\n}\n\nexport const mask = curry((a, b) => reify(b).mask(a));\nexport const struct = curry((a, b) => reify(b).struct(a));\nexport const superimpose = curry((a, b) => reify(b).superimpose(...a));\n\n// operators\nexport const set = curry((a, b) => reify(b).set(a));\nexport const keep = curry((a, b) => reify(b).keep(a));\nexport const keepif = curry((a, b) => reify(b).keepif(a));\nexport const add = curry((a, b) => reify(b).add(a));\nexport const sub = curry((a, b) => reify(b).sub(a));\nexport const mul = curry((a, b) => reify(b).mul(a));\nexport const div = curry((a, b) => reify(b).div(a));\nexport const mod = curry((a, b) => reify(b).mod(a));\nexport const pow = curry((a, b) => reify(b).pow(a));\nexport const band = curry((a, b) => reify(b).band(a));\nexport const bor = curry((a, b) => reify(b).bor(a));\nexport const bxor = curry((a, b) => reify(b).bxor(a));\nexport const blshift = curry((a, b) => reify(b).blshift(a));\nexport const brshift = curry((a, b) => reify(b).brshift(a));\nexport const lt = curry((a, b) => reify(b).lt(a));\nexport const gt = curry((a, b) => reify(b).gt(a));\nexport const lte = curry((a, b) => reify(b).lte(a));\nexport const gte = curry((a, b) => reify(b).gte(a));\nexport const eq = curry((a, b) => reify(b).eq(a));\nexport const eqt = curry((a, b) => reify(b).eqt(a));\nexport const ne = curry((a, b) => reify(b).ne(a));\nexport const net = curry((a, b) => reify(b).net(a));\nexport const and = curry((a, b) => reify(b).and(a));\nexport const or = curry((a, b) => reify(b).or(a));\nexport const func = curry((a, b) => reify(b).func(a));\n\n/**\n * Registers a new pattern method. The method is added to the Pattern class + the standalone function is returned from register.\n *\n * @param {string} name name of the function\n * @param {function} func function with 1 or more params, where last is the current pattern\n * @noAutocomplete\n *\n */\nexport function register(name, func, patternify = true, preserveTactus = false) {\n  if (Array.isArray(name)) {\n    const result = {};\n    for (const name_item of name) {\n      result[name_item] = register(name_item, func, patternify);\n    }\n    return result;\n  }\n  const arity = func.length;\n  var pfunc; // the patternified function\n\n  if (patternify) {\n    pfunc = function (...args) {\n      args = args.map(reify);\n      const pat = args[args.length - 1];\n      let result;\n\n      if (arity === 1) {\n        result = func(pat);\n      } else {\n        const firstArgs = args.slice(0, -1);\n\n        if (firstArgs.every((arg) => arg.__pure != undefined)) {\n          const pureArgs = firstArgs.map((arg) => arg.__pure);\n          const pureLocs = firstArgs.filter((arg) => arg.__pure_loc).map((arg) => arg.__pure_loc);\n          result = func(...pureArgs, pat);\n          result = result.withContext((context) => {\n            const locations = (context.locations || []).concat(pureLocs);\n            return { ...context, locations };\n          });\n        } else {\n          const [left, ...right] = firstArgs;\n\n          let mapFn = (...args) => {\n            return func(...args, pat);\n          };\n          mapFn = curry(mapFn, null, arity - 1);\n          result = right.reduce((acc, p) => acc.appLeft(p), left.fmap(mapFn)).innerJoin();\n        }\n      }\n      if (preserveTactus) {\n        result.tactus = pat.tactus;\n      }\n      return result;\n    };\n  } else {\n    pfunc = function (...args) {\n      args = args.map(reify);\n      const result = func(...args);\n      if (preserveTactus) {\n        result.tactus = args[args.length - 1].tactus;\n      }\n      return result;\n    };\n  }\n\n  Pattern.prototype[name] = function (...args) {\n    // For methods that take a single argument (plus 'this'), allow\n    // multiple arguments but sequence them\n    if (arity === 2 && args.length !== 1) {\n      args = [sequence(...args)];\n    } else if (arity !== args.length + 1) {\n      throw new Error(`.${name}() expects ${arity - 1} inputs but got ${args.length}.`);\n    }\n    args = args.map(reify);\n    return pfunc(...args, this);\n  };\n\n  if (arity > 1) {\n    // There are patternified args, so lets make an unpatternified\n    // version, prefixed by '_'\n    Pattern.prototype['_' + name] = function (...args) {\n      return func(...args, this);\n    };\n  }\n\n  // toplevel functions get curried as well as patternified\n  // because pfunc uses spread args, we need to state the arity explicitly!\n  return curry(pfunc, null, arity);\n}\n\n//////////////////////////////////////////////////////////////////////\n// Numerical transformations\n\n/**\n * Assumes a numerical pattern. Returns a new pattern with all values rounded\n * to the nearest integer.\n * @name round\n * @memberof Pattern\n * @returns Pattern\n * @example\n * n(\"0.5 1.5 2.5\".round()).scale(\"C:major\")\n */\nexport const round = register('round', function (pat) {\n  return pat.asNumber().fmap((v) => Math.round(v));\n});\n\n/**\n * Assumes a numerical pattern. Returns a new pattern with all values set to\n * their mathematical floor. E.g. `3.7` replaced with to `3`, and `-4.2`\n * replaced with `-5`.\n * @name floor\n * @memberof Pattern\n * @returns Pattern\n * @example\n * note(\"42 42.1 42.5 43\".floor())\n */\nexport const floor = register('floor', function (pat) {\n  return pat.asNumber().fmap((v) => Math.floor(v));\n});\n\n/**\n * Assumes a numerical pattern. Returns a new pattern with all values set to\n * their mathematical ceiling. E.g. `3.2` replaced with `4`, and `-4.2`\n * replaced with `-4`.\n * @name ceil\n * @memberof Pattern\n * @returns Pattern\n * @example\n * note(\"42 42.1 42.5 43\".ceil())\n */\nexport const ceil = register('ceil', function (pat) {\n  return pat.asNumber().fmap((v) => Math.ceil(v));\n});\n/**\n * Assumes a numerical pattern, containing unipolar values in the range 0 ..\n * 1. Returns a new pattern with values scaled to the bipolar range -1 .. 1\n * @returns Pattern\n * @noAutocomplete\n */\nexport const toBipolar = register('toBipolar', function (pat) {\n  return pat.fmap((x) => x * 2 - 1);\n});\n\n/**\n * Assumes a numerical pattern, containing bipolar values in the range -1 .. 1\n * Returns a new pattern with values scaled to the unipolar range 0 .. 1\n * @returns Pattern\n * @noAutocomplete\n */\nexport const fromBipolar = register('fromBipolar', function (pat) {\n  return pat.fmap((x) => (x + 1) / 2);\n});\n\n/**\n * Assumes a numerical pattern, containing unipolar values in the range 0 .. 1.\n * Returns a new pattern with values scaled to the given min/max range.\n * Most useful in combination with continuous patterns.\n * @name range\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"[bd sd]*2,hh*8\")\n * .cutoff(sine.range(500,4000))\n */\nexport const range = register('range', function (min, max, pat) {\n  return pat.mul(max - min).add(min);\n});\n\n/**\n * Assumes a numerical pattern, containing unipolar values in the range 0 .. 1\n * Returns a new pattern with values scaled to the given min/max range,\n * following an exponential curve.\n * @name rangex\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"[bd sd]*2,hh*8\")\n * .cutoff(sine.rangex(500,4000))\n */\nexport const rangex = register('rangex', function (min, max, pat) {\n  return pat._range(Math.log(min), Math.log(max)).fmap(Math.exp);\n});\n\n/**\n * Assumes a numerical pattern, containing bipolar values in the range -1 .. 1\n * Returns a new pattern with values scaled to the given min/max range.\n * @name range2\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"[bd sd]*2,hh*8\")\n * .cutoff(sine2.range2(500,4000))\n */\nexport const range2 = register('range2', function (min, max, pat) {\n  return pat.fromBipolar()._range(min, max);\n});\n\n/**\n * Allows dividing numbers via list notation using \":\".\n * Returns a new pattern with just numbers.\n * @name ratio\n * @memberof Pattern\n * @returns Pattern\n * @example\n * ratio(\"1, 5:4, 3:2\").mul(110)\n * .freq().s(\"piano\")\n */\nexport const ratio = register('ratio', (pat) =>\n  pat.fmap((v) => {\n    if (!Array.isArray(v)) {\n      return v;\n    }\n    return v.slice(1).reduce((acc, n) => acc / n, v[0]);\n  }),\n);\n\n//////////////////////////////////////////////////////////////////////\n// Structural and temporal transformations\n\n/** Compress each cycle into the given timespan, leaving a gap\n * @example\n * cat(\n *   s(\"bd sd\").compress(.25,.75),\n *   s(\"~ bd sd ~\")\n * )\n */\nexport const compress = register('compress', function (b, e, pat) {\n  b = Fraction(b);\n  e = Fraction(e);\n  if (b.gt(e) || b.gt(1) || e.gt(1) || b.lt(0) || e.lt(0)) {\n    return silence;\n  }\n  return pat._fastGap(Fraction(1).div(e.sub(b)))._late(b);\n});\n\nexport const { compressSpan, compressspan } = register(['compressSpan', 'compressspan'], function (span, pat) {\n  return pat._compress(span.begin, span.end);\n});\n\n/**\n * speeds up a pattern like fast, but rather than it playing multiple times as fast would it instead leaves a gap in the remaining space of the cycle. For example, the following will play the sound pattern \"bd sn\" only once but compressed into the first half of the cycle, i.e. twice as fast.\n * @name fastGap\n * @synonyms fastgap\n * @example\n * s(\"bd sd\").fastGap(2)\n */\nexport const { fastGap, fastgap } = register(['fastGap', 'fastgap'], function (factor, pat) {\n  // A bit fiddly, to drop zero-width queries at the start of the next cycle\n  const qf = function (span) {\n    const cycle = span.begin.sam();\n    const bpos = span.begin.sub(cycle).mul(factor).min(1);\n    const epos = span.end.sub(cycle).mul(factor).min(1);\n    if (bpos >= 1) {\n      return undefined;\n    }\n    return new TimeSpan(cycle.add(bpos), cycle.add(epos));\n  };\n  // Also fiddly, to maintain the right 'whole' relative to the part\n  const ef = function (hap) {\n    const begin = hap.part.begin;\n    const end = hap.part.end;\n    const cycle = begin.sam();\n    const beginPos = begin.sub(cycle).div(factor).min(1);\n    const endPos = end.sub(cycle).div(factor).min(1);\n    const newPart = new TimeSpan(cycle.add(beginPos), cycle.add(endPos));\n    const newWhole = !hap.whole\n      ? undefined\n      : new TimeSpan(\n          newPart.begin.sub(begin.sub(hap.whole.begin).div(factor)),\n          newPart.end.add(hap.whole.end.sub(end).div(factor)),\n        );\n    return new Hap(newWhole, newPart, hap.value, hap.context);\n  };\n  return pat.withQuerySpanMaybe(qf).withHap(ef).splitQueries();\n});\n\n/**\n * Similar to `compress`, but doesn't leave gaps, and the 'focus' can be bigger than a cycle\n * @example\n * s(\"bd hh sd hh\").focus(1/4, 3/4)\n */\nexport const focus = register('focus', function (b, e, pat) {\n  b = Fraction(b);\n  e = Fraction(e);\n  return pat._fast(Fraction(1).div(e.sub(b))).late(b.cyclePos());\n});\n\nexport const { focusSpan, focusspan } = register(['focusSpan', 'focusspan'], function (span, pat) {\n  return pat._focus(span.begin, span.end);\n});\n\n/** The ply function repeats each event the given number of times.\n * @example\n * s(\"bd ~ sd cp\").ply(\"<1 2 3>\")\n */\nexport const ply = register('ply', function (factor, pat) {\n  const result = pat.fmap((x) => pure(x)._fast(factor)).squeezeJoin();\n  result.tactus = pat.tactus.mul(factor);\n  return result;\n});\n\n/**\n * Speed up a pattern by the given factor. Used by \"*\" in mini notation.\n *\n * @name fast\n * @synonyms density\n * @memberof Pattern\n * @param {number | Pattern} factor speed up factor\n * @returns Pattern\n * @example\n * s(\"bd hh sd hh\").fast(2) // s(\"[bd hh sd hh]*2\")\n */\nexport const { fast, density } = register(['fast', 'density'], function (factor, pat) {\n  if (factor === 0) {\n    return silence;\n  }\n  factor = Fraction(factor);\n  const fastQuery = pat.withQueryTime((t) => t.mul(factor));\n  const result = fastQuery.withHapTime((t) => t.div(factor));\n  result.tactus = factor.mul(pat.tactus);\n  return result;\n});\n\n/**\n * Both speeds up the pattern (like 'fast') and the sample playback (like 'speed').\n * @example\n * s(\"bd sd:2\").hurry(\"<1 2 4 3>\").slow(1.5)\n */\nexport const hurry = register('hurry', function (r, pat) {\n  return pat._fast(r).mul(pure({ speed: r }));\n});\n\n/**\n * Slow down a pattern over the given number of cycles. Like the \"/\" operator in mini notation.\n *\n * @name slow\n * @synonyms sparsity\n * @memberof Pattern\n * @param {number | Pattern} factor slow down factor\n * @returns Pattern\n * @example\n * s(\"bd hh sd hh\").slow(2) // s(\"[bd hh sd hh]/2\")\n */\nexport const { slow, sparsity } = register(['slow', 'sparsity'], function (factor, pat) {\n  if (factor === 0) {\n    return silence;\n  }\n  return pat._fast(Fraction(1).div(factor));\n});\n\n/**\n * Carries out an operation 'inside' a cycle.\n * @example\n * \"0 1 2 3 4 3 2 1\".inside(4, rev).scale('C major').note()\n * // \"0 1 2 3 4 3 2 1\".slow(4).rev().fast(4).scale('C major').note()\n */\nexport const inside = register('inside', function (factor, f, pat) {\n  return f(pat._slow(factor))._fast(factor);\n});\n\n/**\n * Carries out an operation 'outside' a cycle.\n * @example\n * \"<[0 1] 2 [3 4] 5>\".outside(4, rev).scale('C major').note()\n * // \"<[0 1] 2 [3 4] 5>\".fast(4).rev().slow(4).scale('C major').note()\n */\nexport const outside = register('outside', function (factor, f, pat) {\n  return f(pat._fast(factor))._slow(factor);\n});\n\n/**\n * Applies the given function every n cycles, starting from the last cycle.\n * @name lastOf\n * @memberof Pattern\n * @param {number} n how many cycles\n * @param {function} func function to apply\n * @returns Pattern\n * @example\n * note(\"c3 d3 e3 g3\").lastOf(4, x=>x.rev())\n */\nexport const lastOf = register('lastOf', function (n, func, pat) {\n  const pats = Array(n - 1).fill(pat);\n  pats.push(func(pat));\n  return slowcatPrime(...pats);\n});\n\n/**\n * Applies the given function every n cycles, starting from the first cycle.\n * @name firstOf\n * @memberof Pattern\n * @param {number} n how many cycles\n * @param {function} func function to apply\n * @returns Pattern\n * @example\n * note(\"c3 d3 e3 g3\").firstOf(4, x=>x.rev())\n */\n\n/**\n * An alias for `firstOf`\n * @name every\n * @memberof Pattern\n * @param {number} n how many cycles\n * @param {function} func function to apply\n * @returns Pattern\n * @example\n * note(\"c3 d3 e3 g3\").every(4, x=>x.rev())\n */\nexport const { firstOf, every } = register(['firstOf', 'every'], function (n, func, pat) {\n  const pats = Array(n - 1).fill(pat);\n  pats.unshift(func(pat));\n  return slowcatPrime(...pats);\n});\n\n/**\n * Like layer, but with a single function:\n * @name apply\n * @memberof Pattern\n * @example\n * \"<c3 eb3 g3>\".scale('C minor').apply(scaleTranspose(\"0,2,4\")).note()\n */\n// TODO: remove or dedupe with layer?\nexport const apply = register('apply', function (func, pat) {\n  return func(pat);\n});\n\n/**\n * Plays the pattern at the given cycles per minute.\n * @example\n * s(\"<bd sd>,hh*2\").cpm(90) // = 90 bpm\n */\n// this is redefined in repl.mjs, using the current cps as divisor\nexport const cpm = register('cpm', function (cpm, pat) {\n  return pat._fast(cpm / 60 / 1);\n});\n\n/**\n * Nudge a pattern to start earlier in time. Equivalent of Tidal's <~ operator\n *\n * @name early\n * @memberof Pattern\n * @param {number | Pattern} cycles number of cycles to nudge left\n * @returns Pattern\n * @example\n * \"bd ~\".stack(\"hh ~\".early(.1)).s()\n */\nexport const early = register(\n  'early',\n  function (offset, pat) {\n    offset = Fraction(offset);\n    return pat.withQueryTime((t) => t.add(offset)).withHapTime((t) => t.sub(offset));\n  },\n  true,\n  true,\n);\n\n/**\n * Nudge a pattern to start later in time. Equivalent of Tidal's ~> operator\n *\n * @name late\n * @memberof Pattern\n * @param {number | Pattern} cycles number of cycles to nudge right\n * @returns Pattern\n * @example\n * \"bd ~\".stack(\"hh ~\".late(.1)).s()\n */\nexport const late = register(\n  'late',\n  function (offset, pat) {\n    offset = Fraction(offset);\n    return pat._early(Fraction(0).sub(offset));\n  },\n  true,\n  true,\n);\n\n/**\n * Plays a portion of a pattern, specified by the beginning and end of a time span. The new resulting pattern is played over the time period of the original pattern:\n *\n * @example\n * s(\"bd*2 hh*3 [sd bd]*2 perc\").zoom(0.25, 0.75)\n * // s(\"hh*3 [sd bd]*2\") // equivalent\n */\nexport const zoom = register('zoom', function (s, e, pat) {\n  e = Fraction(e);\n  s = Fraction(s);\n  const d = e.sub(s);\n  return pat\n    .withQuerySpan((span) => span.withCycle((t) => t.mul(d).add(s)))\n    .withHapSpan((span) => span.withCycle((t) => t.sub(s).div(d)))\n    .splitQueries();\n});\n\nexport const { zoomArc, zoomarc } = register(['zoomArc', 'zoomarc'], function (a, pat) {\n  return pat.zoom(a.begin, a.end);\n});\n\n/**\n * Selects the given fraction of the pattern and repeats that part to fill the remainder of the cycle.\n * @param {number} fraction fraction to select\n * @example\n * s(\"lt ht mt cp, [hh oh]*2\").linger(\"<1 .5 .25 .125>\")\n */\nexport const linger = register(\n  'linger',\n  function (t, pat) {\n    if (t == 0) {\n      return silence;\n    } else if (t < 0) {\n      return pat._zoom(t.add(1), 1)._slow(t);\n    }\n    return pat._zoom(0, t)._slow(t);\n  },\n  true,\n  true,\n);\n\n/**\n * Samples the pattern at a rate of n events per cycle. Useful for turning a continuous pattern into a discrete one.\n * @param {number} segments number of segments per cycle\n * @example\n * note(saw.range(40,52).segment(24))\n */\nexport const segment = register('segment', function (rate, pat) {\n  return pat.struct(pure(true)._fast(rate)).setTactus(rate);\n});\n\n/**\n * Swaps 1s and 0s in a binary pattern.\n * @name invert\n * @synonyms inv\n * @example\n * s(\"bd\").struct(\"1 0 0 1 0 0 1 0\".lastOf(4, invert))\n */\nexport const { invert, inv } = register(\n  ['invert', 'inv'],\n  function (pat) {\n    // Swap true/false in a binary pattern\n    return pat.fmap((x) => !x);\n  },\n  true,\n  true,\n);\n\n/**\n * Applies the given function whenever the given pattern is in a true state.\n * @name when\n * @memberof Pattern\n * @param {Pattern} binary_pat\n * @param {function} func\n * @returns Pattern\n * @example\n * \"c3 eb3 g3\".when(\"<0 1>/2\", x=>x.sub(\"5\")).note()\n */\nexport const when = register('when', function (on, func, pat) {\n  return on ? func(pat) : pat;\n});\n\n/**\n * Superimposes the function result on top of the original pattern, delayed by the given time.\n * @name off\n * @memberof Pattern\n * @param {Pattern | number} time offset time\n * @param {function} func function to apply\n * @returns Pattern\n * @example\n * \"c3 eb3 g3\".off(1/8, x=>x.add(7)).note()\n */\nexport const off = register('off', function (time_pat, func, pat) {\n  return stack(pat, func(pat.late(time_pat)));\n});\n\n/**\n * Returns a new pattern where every other cycle is played once, twice as\n * fast, and offset in time by one quarter of a cycle. Creates a kind of\n * breakbeat feel.\n * @returns Pattern\n */\nexport const brak = register('brak', function (pat) {\n  return pat.when(slowcat(false, true), (x) => fastcat(x, silence)._late(0.25));\n});\n\n/**\n * Reverse all haps in a pattern\n *\n * @name rev\n * @memberof Pattern\n * @returns Pattern\n * @example\n * note(\"c d e g\").rev()\n */\nexport const rev = register(\n  'rev',\n  function (pat) {\n    const query = function (state) {\n      const span = state.span;\n      const cycle = span.begin.sam();\n      const next_cycle = span.begin.nextSam();\n      const reflect = function (to_reflect) {\n        const reflected = to_reflect.withTime((time) => cycle.add(next_cycle.sub(time)));\n        // [reflected.begin, reflected.end] = [reflected.end, reflected.begin] -- didn't work\n        const tmp = reflected.begin;\n        reflected.begin = reflected.end;\n        reflected.end = tmp;\n        return reflected;\n      };\n      const haps = pat.query(state.setSpan(reflect(span)));\n      return haps.map((hap) => hap.withSpan(reflect));\n    };\n    return new Pattern(query).splitQueries();\n  },\n  false,\n  true,\n);\n\n/** Like press, but allows you to specify the amount by which each\n * event is shifted. pressBy(0.5) is the same as press, while\n * pressBy(1/3) shifts each event by a third of its timespan.\n * @example\n * stack(s(\"hh*4\"),\n *       s(\"bd mt sd ht\").pressBy(\"<0 0.5 0.25>\")\n *      ).slow(2)\n */\nexport const pressBy = register('pressBy', function (r, pat) {\n  return pat.fmap((x) => pure(x).compress(r, 1)).squeezeJoin();\n});\n\n/**\n * Syncopates a rhythm, by shifting each event halfway into its timespan.\n * @example\n * stack(s(\"hh*4\"),\n *       s(\"bd mt sd ht\").every(4, press)\n *      ).slow(2)\n */\nexport const press = register('press', function (pat) {\n  return pat._pressBy(0.5);\n});\n\n/**\n * Silences a pattern.\n * @example\n * stack(\n *   s(\"bd\").hush(),\n *   s(\"hh*3\")\n * )\n */\nPattern.prototype.hush = function () {\n  return silence;\n};\n\n/**\n * Applies `rev` to a pattern every other cycle, so that the pattern alternates between forwards and backwards.\n * @example\n * note(\"c d e g\").palindrome()\n */\nexport const palindrome = register(\n  'palindrome',\n  function (pat) {\n    return pat.lastOf(2, rev);\n  },\n  true,\n  true,\n);\n\n/**\n * Jux with adjustable stereo width. 0 = mono, 1 = full stereo.\n * @name juxBy\n * @synonyms juxby\n * @example\n * s(\"bd lt [~ ht] mt cp ~ bd hh\").juxBy(\"<0 .5 1>/2\", rev)\n */\nexport const { juxBy, juxby } = register(['juxBy', 'juxby'], function (by, func, pat) {\n  by /= 2;\n  const elem_or = function (dict, key, dflt) {\n    if (key in dict) {\n      return dict[key];\n    }\n    return dflt;\n  };\n  const left = pat.withValue((val) => Object.assign({}, val, { pan: elem_or(val, 'pan', 0.5) - by }));\n  const right = func(pat.withValue((val) => Object.assign({}, val, { pan: elem_or(val, 'pan', 0.5) + by })));\n\n  return stack(left, right).setTactus(lcm(left.tactus, right.tactus));\n});\n\n/**\n * The jux function creates strange stereo effects, by applying a function to a pattern, but only in the right-hand channel.\n * @example\n * s(\"bd lt [~ ht] mt cp ~ bd hh\").jux(rev)\n * @example\n * s(\"bd lt [~ ht] mt cp ~ bd hh\").jux(press)\n * @example\n * s(\"bd lt [~ ht] mt cp ~ bd hh\").jux(iter(4))\n */\nexport const jux = register('jux', function (func, pat) {\n  return pat._juxBy(1, func, pat);\n});\n\n/**\n * Superimpose and offset multiple times, applying the given function each time.\n * @name echoWith\n * @synonyms echowith, stutWith, stutwith\n * @param {number} times how many times to repeat\n * @param {number} time cycle offset between iterations\n * @param {function} func function to apply, given the pattern and the iteration index\n * @example\n * \"<0 [2 4]>\"\n * .echoWith(4, 1/8, (p,n) => p.add(n*2))\n * .scale(\"C:minor\").note()\n */\nexport const { echoWith, echowith, stutWith, stutwith } = register(\n  ['echoWith', 'echowith', 'stutWith', 'stutwith'],\n  function (times, time, func, pat) {\n    return stack(...listRange(0, times - 1).map((i) => func(pat.late(Fraction(time).mul(i)), i)));\n  },\n);\n\n/**\n * Superimpose and offset multiple times, gradually decreasing the velocity\n * @name echo\n * @memberof Pattern\n * @returns Pattern\n * @param {number} times how many times to repeat\n * @param {number} time cycle offset between iterations\n * @param {number} feedback velocity multiplicator for each iteration\n * @example\n * s(\"bd sd\").echo(3, 1/6, .8)\n */\nexport const echo = register('echo', function (times, time, feedback, pat) {\n  return pat._echoWith(times, time, (pat, i) => pat.gain(Math.pow(feedback, i)));\n});\n\n/**\n * Deprecated. Like echo, but the last 2 parameters are flipped.\n * @name stut\n * @param {number} times how many times to repeat\n * @param {number} feedback velocity multiplicator for each iteration\n * @param {number} time cycle offset between iterations\n * @example\n * s(\"bd sd\").stut(3, .8, 1/6)\n */\nexport const stut = register('stut', function (times, feedback, time, pat) {\n  return pat._echoWith(times, time, (pat, i) => pat.gain(Math.pow(feedback, i)));\n});\n\n/**\n * Divides a pattern into a given number of subdivisions, plays the subdivisions in order, but increments the starting subdivision each cycle. The pattern wraps to the first subdivision after the last subdivision is played.\n * @name iter\n * @memberof Pattern\n * @returns Pattern\n * @example\n * note(\"0 1 2 3\".scale('A minor')).iter(4)\n */\n\nconst _iter = function (times, pat, back = false) {\n  times = Fraction(times);\n  return slowcat(\n    ...listRange(0, times.sub(1)).map((i) =>\n      back ? pat.late(Fraction(i).div(times)) : pat.early(Fraction(i).div(times)),\n    ),\n  );\n};\n\nexport const iter = register(\n  'iter',\n  function (times, pat) {\n    return _iter(times, pat, false);\n  },\n  true,\n  true,\n);\n\n/**\n * Like `iter`, but plays the subdivisions in reverse order. Known as iter' in tidalcycles\n * @name iterBack\n * @synonyms iterback\n * @memberof Pattern\n * @returns Pattern\n * @example\n * note(\"0 1 2 3\".scale('A minor')).iterBack(4)\n */\nexport const { iterBack, iterback } = register(\n  ['iterBack', 'iterback'],\n  function (times, pat) {\n    return _iter(times, pat, true);\n  },\n  true,\n  true,\n);\n\n/**\n * Repeats each cycle the given number of times.\n * @name repeatCycles\n * @memberof Pattern\n * @returns Pattern\n * @example\n * note(irand(12).add(34)).segment(4).repeatCycles(2).s(\"gm_acoustic_guitar_nylon\")\n */\nexport const { repeatCycles } = register(\n  'repeatCycles',\n  function (n, pat) {\n    return slowcat(...Array(n).fill(pat));\n  },\n  true,\n  true,\n);\n\n/**\n * Divides a pattern into a given number of parts, then cycles through those parts in turn, applying the given function to each part in turn (one part per cycle).\n * @name chunk\n * @synonyms slowChunk, slowchunk\n * @memberof Pattern\n * @returns Pattern\n * @example\n * \"0 1 2 3\".chunk(4, x=>x.add(7))\n * .scale(\"A:minor\").note()\n */\nconst _chunk = function (n, func, pat, back = false, fast = false) {\n  const binary = Array(n - 1).fill(false);\n  binary.unshift(true);\n  // Invert the 'back' because we want to shift the pattern forwards,\n  // and so time backwards\n  const binary_pat = _iter(n, sequence(...binary), !back);\n  if (!fast) {\n    pat = pat.repeatCycles(n);\n  }\n  return pat.when(binary_pat, func);\n};\n\nexport const { chunk, slowchunk, slowChunk } = register(['chunk', 'slowchunk', 'slowChunk'], function (n, func, pat) {\n  return _chunk(n, func, pat, false, false);\n});\n\n/**\n * Like `chunk`, but cycles through the parts in reverse order. Known as chunk' in tidalcycles\n * @name chunkBack\n * @synonyms chunkback\n * @memberof Pattern\n * @returns Pattern\n * @example\n * \"0 1 2 3\".chunkBack(4, x=>x.add(7))\n * .scale(\"A:minor\").note()\n */\nexport const { chunkBack, chunkback } = register(['chunkBack', 'chunkback'], function (n, func, pat) {\n  return _chunk(n, func, pat, true);\n});\n\n/**\n * Like `chunk`, but the cycles of the source pattern aren't repeated\n * for each set of chunks.\n * @name fastChunk\n * @synonyms fastchunk\n * @memberof Pattern\n * @returns Pattern\n * @example\n * \"<0 8> 1 2 3 4 5 6 7\"\n * .fastChunk(4, x => x.color('red')).slow(2)\n * .scale(\"C2:major\").note()\n */\nexport const { fastchunk, fastChunk } = register(['fastchunk', 'fastChunk'], function (n, func, pat) {\n  return _chunk(n, func, pat, false, true);\n});\n\n// TODO - redefine elsewhere in terms of mask\nexport const bypass = register(\n  'bypass',\n  function (on, pat) {\n    on = Boolean(parseInt(on));\n    return on ? silence : pat;\n  },\n  true,\n  true,\n);\n\n/**\n * Loops the pattern inside at `offset` for `cycles`.\n * @param {number} offset start point of loop in cycles\n * @param {number} cycles loop length in cycles\n * @example\n * note(\"<c d e f>\").ribbon(1, 2).fast(2)\n * @example\n * // Looping a portion of randomness\n * note(irand(8).segment(4).scale('C3 minor')).ribbon(1337, 2)\n */\nexport const ribbon = register('ribbon', (offset, cycles, pat) => pat.early(offset).restart(pure(1).slow(cycles)));\n\nexport const hsla = register('hsla', (h, s, l, a, pat) => {\n  return pat.color(`hsla(${h}turn,${s * 100}%,${l * 100}%,${a})`);\n});\n\nexport const hsl = register('hsl', (h, s, l, pat) => {\n  return pat.color(`hsl(${h}turn,${s * 100}%,${l * 100}%)`);\n});\n\n/**\n * Tags each Hap with an identifier. Good for filtering. The function populates Hap.context.tags (Array).\n * @name tag\n * @noAutocomplete\n * @param {string} tag anything unique\n */\nPattern.prototype.tag = function (tag) {\n  return this.withContext((ctx) => ({ ...ctx, tags: (ctx.tags || []).concat([tag]) }));\n};\n\n//////////////////////////////////////////////////////////////////////\n// Control-related functions, i.e. ones that manipulate patterns of\n// objects\n\n/**\n * Cuts each sample into the given number of parts, allowing you to explore a technique known as 'granular synthesis'.\n * It turns a pattern of samples into a pattern of parts of samples.\n * @name chop\n * @memberof Pattern\n * @returns Pattern\n * @example\n * samples({ rhodes: 'https://cdn.freesound.org/previews/132/132051_316502-lq.mp3' })\n * s(\"rhodes\")\n *  .chop(4)\n *  .rev() // reverse order of chops\n *  .loopAt(2) // fit sample into 2 cycles\n *\n */\nexport const chop = register('chop', function (n, pat) {\n  const slices = Array.from({ length: n }, (x, i) => i);\n  const slice_objects = slices.map((i) => ({ begin: i / n, end: (i + 1) / n }));\n  const func = function (o) {\n    return sequence(slice_objects.map((slice_o) => Object.assign({}, o, slice_o)));\n  };\n  return pat.squeezeBind(func).setTactus(pat.tactus.mul(n));\n});\n\n/**\n * Cuts each sample into the given number of parts, triggering progressive portions of each sample at each loop.\n * @name striate\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"numbers:0 numbers:1 numbers:2\").striate(6).slow(3)\n */\nexport const striate = register('striate', function (n, pat) {\n  const slices = Array.from({ length: n }, (x, i) => i);\n  const slice_objects = slices.map((i) => ({ begin: i / n, end: (i + 1) / n }));\n  const slicePat = slowcat(...slice_objects);\n  return pat.set(slicePat)._fast(n);\n});\n\n/**\n * Makes the sample fit the given number of cycles by changing the speed.\n * @name loopAt\n * @memberof Pattern\n * @returns Pattern\n * @example\n * samples({ rhodes: 'https://cdn.freesound.org/previews/132/132051_316502-lq.mp3' })\n * s(\"rhodes\").loopAt(2)\n */\n// TODO - global cps clock\nconst _loopAt = function (factor, pat, cps = 0.5) {\n  return pat\n    .speed((1 / factor) * cps)\n    .unit('c')\n    .slow(factor);\n};\n\n/**\n * Chops samples into the given number of slices, triggering those slices with a given pattern of slice numbers.\n * Instead of a number, it also accepts a list of numbers from 0 to 1 to slice at specific points.\n * @name slice\n * @memberof Pattern\n * @returns Pattern\n * @example\n * samples('github:tidalcycles/dirt-samples')\n * s(\"breaks165\").slice(8, \"0 1 <2 2*2> 3 [4 0] 5 6 7\".every(3, rev)).slow(0.75)\n * @example\n * samples('github:tidalcycles/dirt-samples')\n * s(\"breaks125\").fit().slice([0,.25,.5,.75], \"0 1 1 <2 3>\")\n */\n\nexport const slice = register(\n  'slice',\n  function (npat, ipat, opat) {\n    return npat\n      .innerBind((n) =>\n        ipat.outerBind((i) =>\n          opat.outerBind((o) => {\n            // If it's not an object, assume it's a string and make it a 's' control parameter\n            o = o instanceof Object ? o : { s: o };\n            const begin = Array.isArray(n) ? n[i] : i / n;\n            const end = Array.isArray(n) ? n[i + 1] : (i + 1) / n;\n            return pure({ begin, end, _slices: n, ...o });\n          }),\n        ),\n      )\n      .setTactus(ipat.tactus);\n  },\n  false, // turns off auto-patternification\n);\n\n/**\n * Works the same as slice, but changes the playback speed of each slice to match the duration of its step.\n * @name splice\n * @example\n * samples('github:tidalcycles/dirt-samples')\n * s(\"breaks165\")\n * .splice(8,  \"0 1 [2 3 0]@2 3 0@2 7\")\n */\n\nexport const splice = register(\n  'splice',\n  function (npat, ipat, opat) {\n    const sliced = slice(npat, ipat, opat);\n    return new Pattern((state) => {\n      // TODO - default cps to 0.5\n      const cps = state.controls._cps || 1;\n      const haps = sliced.query(state);\n      return haps.map((hap) =>\n        hap.withValue((v) => ({\n          ...{\n            speed: (cps / v._slices / hap.whole.duration) * (v.speed || 1),\n            unit: 'c',\n          },\n          ...v,\n        })),\n      );\n    }).setTactus(ipat.tactus);\n  },\n  false, // turns off auto-patternification\n);\n\nexport const { loopAt, loopat } = register(['loopAt', 'loopat'], function (factor, pat) {\n  return new Pattern((state) => _loopAt(factor, pat, state.controls._cps).query(state));\n});\n\n/**\n * Makes the sample fit its event duration. Good for rhythmical loops like drum breaks.\n * Similar to `loopAt`.\n * @name fit\n * @example\n * samples({ rhodes: 'https://cdn.freesound.org/previews/132/132051_316502-lq.mp3' })\n * s(\"rhodes/2\").fit()\n */\nexport const fit = register('fit', (pat) =>\n  pat.withHaps((haps, state) =>\n    haps.map((hap) =>\n      hap.withValue((v) => ({\n        ...v,\n        speed: (state.controls._cps || 1) / hap.whole.duration,\n        unit: 'c',\n      })),\n    ),\n  ),\n);\n\n/**\n * Makes the sample fit the given number of cycles and cps value, by\n * changing the speed. Please note that at some point cps will be\n * given by a global clock and this function will be\n * deprecated/removed.\n * @name loopAtCps\n * @memberof Pattern\n * @returns Pattern\n * @example\n * samples({ rhodes: 'https://cdn.freesound.org/previews/132/132051_316502-lq.mp3' })\n * s(\"rhodes\").loopAtCps(4,1.5).cps(1.5)\n */\n// TODO - global cps clock\nexport const { loopAtCps, loopatcps } = register(['loopAtCps', 'loopatcps'], function (factor, cps, pat) {\n  return _loopAt(factor, pat, cps);\n});\n\n/** exposes a custom value at query time. basically allows mutating state without evaluation */\nexport const ref = (accessor) =>\n  pure(1)\n    .withValue(() => reify(accessor()))\n    .innerJoin();\n\nlet fadeGain = (p) => (p < 0.5 ? 1 : 1 - (p - 0.5) / 0.5);\n\n/**\n * Cross-fades between left and right from 0 to 1:\n * - 0 = (full left, no right)\n * - .5 = (both equal)\n * - 1 = (no left, full right)\n *\n * @name xfade\n * @example\n * xfade(s(\"bd*2\"), \"<0 .25 .5 .75 1>\", s(\"hh*8\"))\n */\nexport let xfade = (a, pos, b) => {\n  pos = reify(pos);\n  a = reify(a);\n  b = reify(b);\n  let gaina = pos.fmap((v) => ({ gain: fadeGain(v) }));\n  let gainb = pos.fmap((v) => ({ gain: fadeGain(1 - v) }));\n  return stack(a.mul(gaina), b.mul(gainb));\n};\n\n// the prototype version is actually flipped so left/right makes sense\nPattern.prototype.xfade = function (pos, b) {\n  return xfade(this, pos, b);\n};\n","/*\ncontrols.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/controls.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport { Pattern, register, sequence } from './pattern.mjs';\n\nexport function createParam(names) {\n  let isMulti = Array.isArray(names);\n  names = !isMulti ? [names] : names;\n  const name = names[0];\n\n  const withVal = (xs) => {\n    let bag;\n    // check if we have an object with an unnamed control (.value)\n    if (typeof xs === 'object' && xs.value !== undefined) {\n      bag = { ...xs }; // grab props that are already there\n      xs = xs.value; // grab the unnamed control for this one\n      delete bag.value;\n    }\n    if (isMulti && Array.isArray(xs)) {\n      const result = bag || {};\n      xs.forEach((x, i) => {\n        if (i < names.length) {\n          result[names[i]] = x;\n        }\n      });\n      return result;\n    } else if (bag) {\n      bag[name] = xs;\n      return bag;\n    } else {\n      return { [name]: xs };\n    }\n  };\n\n  const func = (...pats) => sequence(...pats).withValue(withVal);\n\n  const setter = function (...pats) {\n    if (!pats.length) {\n      return this.fmap(withVal);\n    }\n    return this.set(func(...pats));\n  };\n  Pattern.prototype[name] = setter;\n  return func;\n}\n\nfunction registerControl(names, ...aliases) {\n  const name = Array.isArray(names) ? names[0] : names;\n  let bag = {};\n  bag[name] = createParam(names);\n  aliases.forEach((alias) => {\n    bag[alias] = bag[name];\n    Pattern.prototype[alias] = Pattern.prototype[name];\n  });\n  return bag;\n}\n\n/**\n * Select a sound / sample by name. When using mininotation, you can also optionally supply 'n' and 'gain' parameters\n * separated by ':'.\n *\n * @name s\n * @param {string | Pattern} sound The sound / pattern of sounds to pick\n * @synonyms sound\n * @example\n * s(\"bd hh\")\n * @example\n * s(\"bd:0 bd:1 bd:0:0.3 bd:1:1.4\")\n *\n */\nexport const { s, sound } = registerControl(['s', 'n', 'gain'], 'sound');\n\n/**\n * Define a custom webaudio node to use as a sound source.\n *\n * @name source\n * @param {function} getSource\n * @synonyms src\n *\n */\nexport const { source, src } = registerControl('source', 'src');\n/**\n * Selects the given index from the sample map.\n * Numbers too high will wrap around.\n * `n` can also be used to play midi numbers, but it is recommended to use `note` instead.\n *\n * @name n\n * @param {number | Pattern} value sample index starting from 0\n * @example\n * s(\"bd sd [~ bd] sd,hh*6\").n(\"<0 1>\")\n */\n// also see https://github.com/tidalcycles/strudel/pull/63\nexport const { n } = registerControl('n');\n/**\n * Plays the given note name or midi number. A note name consists of\n *\n * - a letter (a-g or A-G)\n * - optional accidentals (b or #)\n * - optional octave number (0-9). Defaults to 3\n *\n * Examples of valid note names: `c`, `bb`, `Bb`, `f#`, `c3`, `A4`, `Eb2`, `c#5`\n *\n * You can also use midi numbers instead of note names, where 69 is mapped to A4 440Hz in 12EDO.\n *\n * @name note\n * @example\n * note(\"c a f e\")\n * @example\n * note(\"c4 a4 f4 e4\")\n * @example\n * note(\"60 69 65 64\")\n */\nexport const { note } = registerControl(['note', 'n']);\n\n/**\n * A pattern of numbers that speed up (or slow down) samples while they play. Currently only supported by osc / superdirt.\n *\n * @name accelerate\n * @param {number | Pattern} amount acceleration.\n * @superdirtOnly\n * @example\n * s(\"sax\").accelerate(\"<0 1 2 4 8 16>\").slow(2).osc()\n *\n */\nexport const { accelerate } = registerControl('accelerate');\n/**\n *\n * Sets the velocity from 0 to 1. Is multiplied together with gain.\n * @name velocity\n * @example\n * s(\"hh*8\")\n * .gain(\".4!2 1 .4!2 1 .4 1\")\n * .velocity(\".4 1\")\n */\nexport const { velocity } = registerControl('velocity');\n/**\n * Controls the gain by an exponential amount.\n *\n * @name gain\n * @param {number | Pattern} amount gain.\n * @example\n * s(\"hh*8\").gain(\".4!2 1 .4!2 1 .4 1\").fast(2)\n *\n */\nexport const { gain } = registerControl('gain');\n/**\n * Gain applied after all effects have been processed.\n *\n * @name postgain\n * @example\n * s(\"bd sd [~ bd] sd,hh*8\")\n * .compressor(\"-20:20:10:.002:.02\").postgain(1.5)\n *\n */\nexport const { postgain } = registerControl('postgain');\n/**\n * Like `gain`, but linear.\n *\n * @name amp\n * @param {number | Pattern} amount gain.\n * @superdirtOnly\n * @example\n * s(\"bd*8\").amp(\".1*2 .5 .1*2 .5 .1 .5\").osc()\n *\n */\nexport const { amp } = registerControl('amp');\n/**\n * Amplitude envelope attack time: Specifies how long it takes for the sound to reach its peak value, relative to the onset.\n *\n * @name attack\n * @param {number | Pattern} attack time in seconds.\n * @synonyms att\n * @example\n * note(\"c3 e3 f3 g3\").attack(\"<0 .1 .5>\")\n *\n */\nexport const { attack, att } = registerControl('attack', 'att');\n\n/**\n * Sets the Frequency Modulation Harmonicity Ratio.\n * Controls the timbre of the sound.\n * Whole numbers and simple ratios sound more natural,\n * while decimal numbers and complex ratios sound metallic.\n *\n * @name fmh\n * @param {number | Pattern} harmonicity\n * @example\n * note(\"c e g b g e\")\n * .fm(4)\n * .fmh(\"<1 2 1.5 1.61>\")\n * .scope()\n *\n */\nexport const { fmh } = registerControl(['fmh', 'fmi'], 'fmh');\n/**\n * Sets the Frequency Modulation of the synth.\n * Controls the modulation index, which defines the brightness of the sound.\n *\n * @name fm\n * @param {number | Pattern} brightness modulation index\n * @synonyms fmi\n * @example\n * note(\"c e g b g e\")\n * .fm(\"<0 1 2 8 32>\")\n * .scope()\n *\n */\nexport const { fmi, fm } = registerControl(['fmi', 'fmh'], 'fm');\n// fm envelope\n/**\n * Ramp type of fm envelope. Exp might be a bit broken..\n *\n * @name fmenv\n * @param {number | Pattern} type lin | exp\n * @example\n * note(\"c e g b g e\")\n * .fm(4)\n * .fmdecay(.2)\n * .fmsustain(0)\n * .fmenv(\"<exp lin>\")\n * .scope()\n *\n */\nexport const { fmenv } = registerControl('fmenv');\n/**\n * Attack time for the FM envelope: time it takes to reach maximum modulation\n *\n * @name fmattack\n * @param {number | Pattern} time attack time\n * @example\n * note(\"c e g b g e\")\n * .fm(4)\n * .fmattack(\"<0 .05 .1 .2>\")\n * .scope()\n *\n */\nexport const { fmattack } = registerControl('fmattack');\n/**\n * Decay time for the FM envelope: seconds until the sustain level is reached after the attack phase.\n *\n * @name fmdecay\n * @param {number | Pattern} time decay time\n * @example\n * note(\"c e g b g e\")\n * .fm(4)\n * .fmdecay(\"<.01 .05 .1 .2>\")\n * .fmsustain(.4)\n * .scope()\n *\n */\nexport const { fmdecay } = registerControl('fmdecay');\n/**\n * Sustain level for the FM envelope: how much modulation is applied after the decay phase\n *\n * @name fmsustain\n * @param {number | Pattern} level sustain level\n * @example\n * note(\"c e g b g e\")\n * .fm(4)\n * .fmdecay(.1)\n * .fmsustain(\"<1 .75 .5 0>\")\n * .scope()\n *\n */\nexport const { fmsustain } = registerControl('fmsustain');\n// these are not really useful... skipping for now\nexport const { fmrelease } = registerControl('fmrelease');\nexport const { fmvelocity } = registerControl('fmvelocity');\n\n/**\n * Select the sound bank to use. To be used together with `s`. The bank name (+ \"_\") will be prepended to the value of `s`.\n *\n * @name bank\n * @param {string | Pattern} bank the name of the bank\n * @example\n * s(\"bd sd [~ bd] sd\").bank('RolandTR909') // = s(\"RolandTR909_bd RolandTR909_sd\")\n *\n */\nexport const { bank } = registerControl('bank');\n\n// analyser node send amount 0 - 1 (used by scope)\nexport const { analyze } = registerControl('analyze');\n// fftSize of analyser\nexport const { fft } = registerControl('fft');\n\n/**\n * Amplitude envelope decay time: the time it takes after the attack time to reach the sustain level.\n * Note that the decay is only audible if the sustain value is lower than 1.\n *\n * @name decay\n * @param {number | Pattern} time decay time in seconds\n * @example\n * note(\"c3 e3 f3 g3\").decay(\"<.1 .2 .3 .4>\").sustain(0)\n *\n */\nexport const { decay, dec } = registerControl('decay', 'dec');\n/**\n * Amplitude envelope sustain level: The level which is reached after attack / decay, being sustained until the offset.\n *\n * @name sustain\n * @param {number | Pattern} gain sustain level between 0 and 1\n * @synonyms sus\n * @example\n * note(\"c3 e3 f3 g3\").decay(.2).sustain(\"<0 .1 .4 .6 1>\")\n *\n */\nexport const { sustain, sus } = registerControl('sustain', 'sus');\n/**\n * Amplitude envelope release time: The time it takes after the offset to go from sustain level to zero.\n *\n * @name release\n * @param {number | Pattern} time release time in seconds\n * @synonyms rel\n * @example\n * note(\"c3 e3 g3 c4\").release(\"<0 .1 .4 .6 1>/2\")\n *\n */\nexport const { release, rel } = registerControl('release', 'rel');\nexport const { hold } = registerControl('hold');\n// TODO: in tidal, it seems to be normalized\n/**\n * Sets the center frequency of the **b**and-**p**ass **f**ilter. When using mininotation, you\n * can also optionally supply the 'bpq' parameter separated by ':'.\n *\n * @name bpf\n * @param {number | Pattern} frequency center frequency\n * @synonyms bandf, bp\n * @example\n * s(\"bd sd [~ bd] sd,hh*6\").bpf(\"<1000 2000 4000 8000>\")\n *\n */\nexport const { bandf, bpf, bp } = registerControl(['bandf', 'bandq', 'bpenv'], 'bpf', 'bp');\n// TODO: in tidal, it seems to be normalized\n/**\n * Sets the **b**and-**p**ass **q**-factor (resonance).\n *\n * @name bpq\n * @param {number | Pattern} q q factor\n * @synonyms bandq\n * @example\n * s(\"bd sd [~ bd] sd\").bpf(500).bpq(\"<0 1 2 3>\")\n *\n */\n// currently an alias of 'bandq' https://github.com/tidalcycles/strudel/issues/496\n// ['bpq'],\nexport const { bandq, bpq } = registerControl('bandq', 'bpq');\n/**\n * a pattern of numbers from 0 to 1. Skips the beginning of each sample, e.g. `0.25` to cut off the first quarter from each sample.\n *\n * @memberof Pattern\n * @name begin\n * @param {number | Pattern} amount between 0 and 1, where 1 is the length of the sample\n * @example\n * samples({ rave: 'rave/AREUREADY.wav' }, 'github:tidalcycles/dirt-samples')\n * s(\"rave\").begin(\"<0 .25 .5 .75>\").fast(2)\n *\n */\nexport const { begin } = registerControl('begin');\n/**\n * The same as .begin, but cuts off the end off each sample.\n *\n * @memberof Pattern\n * @name end\n * @param {number | Pattern} length 1 = whole sample, .5 = half sample, .25 = quarter sample etc..\n * @example\n * s(\"bd*2,oh*4\").end(\"<.1 .2 .5 1>\").fast(2)\n *\n */\nexport const { end } = registerControl('end');\n/**\n * Loops the sample.\n * Note that the tempo of the loop is not synced with the cycle tempo.\n * To change the loop region, use loopBegin / loopEnd.\n *\n * @name loop\n * @param {number | Pattern} on If 1, the sample is looped\n * @example\n * s(\"casio\").loop(1)\n *\n */\nexport const { loop } = registerControl('loop');\n/**\n * Begin to loop at a specific point in the sample (inbetween `begin` and `end`).\n * Note that the loop point must be inbetween `begin` and `end`, and before `loopEnd`!\n * Note: Samples starting with wt_ will automatically loop! (wt = wavetable)\n *\n * @name loopBegin\n * @param {number | Pattern} time between 0 and 1, where 1 is the length of the sample\n * @synonyms loopb\n * @example\n * s(\"space\").loop(1)\n * .loopBegin(\"<0 .125 .25>\").scope()\n */\nexport const { loopBegin, loopb } = registerControl('loopBegin', 'loopb');\n/**\n *\n * End the looping section at a specific point in the sample (inbetween `begin` and `end`).\n * Note that the loop point must be inbetween `begin` and `end`, and after `loopBegin`!\n *\n * @name loopEnd\n * @param {number | Pattern} time between 0 and 1, where 1 is the length of the sample\n * @synonyms loope\n * @example\n * s(\"space\").loop(1)\n * .loopEnd(\"<1 .75 .5 .25>\").scope()\n */\nexport const { loopEnd, loope } = registerControl('loopEnd', 'loope');\n/**\n * bit crusher effect.\n *\n * @name crush\n * @param {number | Pattern} depth between 1 (for drastic reduction in bit-depth) to 16 (for barely no reduction).\n * @example\n * s(\"<bd sd>,hh*3\").fast(2).crush(\"<16 8 7 6 5 4 3 2>\")\n *\n */\n// ['clhatdecay'],\nexport const { crush } = registerControl('crush');\n/**\n * fake-resampling for lowering the sample rate. Caution: This effect seems to only work in chromium based browsers\n *\n * @name coarse\n * @param {number | Pattern} factor 1 for original 2 for half, 3 for a third and so on.\n * @example\n * s(\"bd sd [~ bd] sd,hh*8\").coarse(\"<1 4 8 16 32>\")\n *\n */\nexport const { coarse } = registerControl('coarse');\n\n/**\n * Allows you to set the output channels on the interface\n *\n * @name channels\n * @synonyms ch\n *\n * @param {number | Pattern} channels pattern the output channels\n * @example\n * note(\"e a d b g\").channels(\"3:4\")\n *\n */\nexport const { channels, ch } = registerControl('channels', 'ch');\n\n// superdirt only\nexport const { phaserrate, phasr } = registerControl('phaserrate', 'phasr');\n\n/**\n * Phaser audio effect that approximates popular guitar pedals.\n *\n * @name phaser\n * @synonyms ph\n * @param {number | Pattern} speed speed of modulation\n * @example\n * n(run(8)).scale(\"D:pentatonic\").s(\"sawtooth\").release(0.5)\n * .phaser(\"<1 2 4 8>\")\n *\n */\nexport const { phaser, ph } = registerControl(['phaser', 'phaserdepth', 'phasercenter', 'phasersweep'], 'ph');\n\n/**\n * The frequency sweep range of the lfo for the phaser effect. Defaults to 2000\n *\n * @name phasersweep\n * @synonyms phs\n * @param {number | Pattern} phasersweep most useful values are between 0 and 4000\n * @example\n * n(run(8)).scale(\"D:pentatonic\").s(\"sawtooth\").release(0.5)\n * .phaser(2).phasersweep(\"<800 2000 4000>\")\n *\n */\nexport const { phasersweep, phs } = registerControl('phasersweep', 'phs');\n\n/**\n *  The center frequency of the phaser in HZ. Defaults to 1000\n *\n * @name phasercenter\n * @synonyms phc\n * @param {number | Pattern} centerfrequency in HZ\n * @example\n * n(run(8)).scale(\"D:pentatonic\").s(\"sawtooth\").release(0.5)\n * .phaser(2).phasercenter(\"<800 2000 4000>\")\n *\n */\n\nexport const { phasercenter, phc } = registerControl('phasercenter', 'phc');\n\n/**\n * The amount the signal is affected by the phaser effect. Defaults to 0.75\n *\n * @name phaserdepth\n * @synonyms phd\n * @param {number | Pattern} depth number between 0 and 1\n * @example\n * n(run(8)).scale(\"D:pentatonic\").s(\"sawtooth\").release(0.5)\n * .phaser(2).phaserdepth(\"<0 .5 .75 1>\")\n *\n */\n// also a superdirt control\nexport const { phaserdepth, phd, phasdp } = registerControl('phaserdepth', 'phd', 'phasdp');\n\n/**\n * choose the channel the pattern is sent to in superdirt\n *\n * @name channel\n * @param {number | Pattern} channel channel number\n *\n */\nexport const { channel } = registerControl('channel');\n/**\n * In the style of classic drum-machines, `cut` will stop a playing sample as soon as another samples with in same cutgroup is to be played. An example would be an open hi-hat followed by a closed one, essentially muting the open.\n *\n * @name cut\n * @param {number | Pattern} group cut group number\n * @example\n * s(\"[oh hh]*4\").cut(1)\n *\n */\nexport const { cut } = registerControl('cut');\n/**\n * Applies the cutoff frequency of the **l**ow-**p**ass **f**ilter.\n *\n * When using mininotation, you can also optionally add the 'lpq' parameter, separated by ':'.\n *\n * @name lpf\n * @param {number | Pattern} frequency audible between 0 and 20000\n * @synonyms cutoff, ctf, lp\n * @example\n * s(\"bd sd [~ bd] sd,hh*6\").lpf(\"<4000 2000 1000 500 200 100>\")\n * @example\n * s(\"bd*16\").lpf(\"1000:0 1000:10 1000:20 1000:30\")\n *\n */\nexport const { cutoff, ctf, lpf, lp } = registerControl(['cutoff', 'resonance', 'lpenv'], 'ctf', 'lpf', 'lp');\n\n/**\n * Sets the lowpass filter envelope modulation depth.\n * @name lpenv\n * @param {number | Pattern} modulation depth of the lowpass filter envelope between 0 and _n_\n * @synonyms lpe\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .lpf(500)\n * .lpa(.5)\n * .lpenv(\"<4 2 1 0 -1 -2 -4>/4\")\n */\nexport const { lpenv, lpe } = registerControl('lpenv', 'lpe');\n/**\n * Sets the highpass filter envelope modulation depth.\n * @name hpenv\n * @param {number | Pattern} modulation depth of the highpass filter envelope between 0 and _n_\n * @synonyms hpe\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .hpf(500)\n * .hpa(.5)\n * .hpenv(\"<4 2 1 0 -1 -2 -4>/4\")\n */\nexport const { hpenv, hpe } = registerControl('hpenv', 'hpe');\n/**\n * Sets the bandpass filter envelope modulation depth.\n * @name bpenv\n * @param {number | Pattern} modulation depth of the bandpass filter envelope between 0 and _n_\n * @synonyms bpe\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .bpf(500)\n * .bpa(.5)\n * .bpenv(\"<4 2 1 0 -1 -2 -4>/4\")\n */\nexport const { bpenv, bpe } = registerControl('bpenv', 'bpe');\n/**\n * Sets the attack duration for the lowpass filter envelope.\n * @name lpattack\n * @param {number | Pattern} attack time of the filter envelope\n * @synonyms lpa\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .lpf(500)\n * .lpa(\"<.5 .25 .1 .01>/4\")\n * .lpenv(4)\n */\nexport const { lpattack, lpa } = registerControl('lpattack', 'lpa');\n/**\n * Sets the attack duration for the highpass filter envelope.\n * @name hpattack\n * @param {number | Pattern} attack time of the highpass filter envelope\n * @synonyms hpa\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .hpf(500)\n * .hpa(\"<.5 .25 .1 .01>/4\")\n * .hpenv(4)\n */\nexport const { hpattack, hpa } = registerControl('hpattack', 'hpa');\n/**\n * Sets the attack duration for the bandpass filter envelope.\n * @name bpattack\n * @param {number | Pattern} attack time of the bandpass filter envelope\n * @synonyms bpa\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .bpf(500)\n * .bpa(\"<.5 .25 .1 .01>/4\")\n * .bpenv(4)\n */\nexport const { bpattack, bpa } = registerControl('bpattack', 'bpa');\n/**\n * Sets the decay duration for the lowpass filter envelope.\n * @name lpdecay\n * @param {number | Pattern} decay time of the filter envelope\n * @synonyms lpd\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .lpf(500)\n * .lpd(\"<.5 .25 .1 0>/4\")\n * .lps(0.2)\n * .lpenv(4)\n */\nexport const { lpdecay, lpd } = registerControl('lpdecay', 'lpd');\n/**\n * Sets the decay duration for the highpass filter envelope.\n * @name hpdecay\n * @param {number | Pattern} decay time of the highpass filter envelope\n * @synonyms hpd\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .hpf(500)\n * .hpd(\"<.5 .25 .1 0>/4\")\n * .hps(0.2)\n * .hpenv(4)\n */\nexport const { hpdecay, hpd } = registerControl('hpdecay', 'hpd');\n/**\n * Sets the decay duration for the bandpass filter envelope.\n * @name bpdecay\n * @param {number | Pattern} decay time of the bandpass filter envelope\n * @synonyms bpd\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .bpf(500)\n * .bpd(\"<.5 .25 .1 0>/4\")\n * .bps(0.2)\n * .bpenv(4)\n */\nexport const { bpdecay, bpd } = registerControl('bpdecay', 'bpd');\n/**\n * Sets the sustain amplitude for the lowpass filter envelope.\n * @name lpsustain\n * @param {number | Pattern} sustain amplitude of the lowpass filter envelope\n * @synonyms lps\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .lpf(500)\n * .lpd(.5)\n * .lps(\"<0 .25 .5 1>/4\")\n * .lpenv(4)\n */\nexport const { lpsustain, lps } = registerControl('lpsustain', 'lps');\n/**\n * Sets the sustain amplitude for the highpass filter envelope.\n * @name hpsustain\n * @param {number | Pattern} sustain amplitude of the highpass filter envelope\n * @synonyms hps\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .hpf(500)\n * .hpd(.5)\n * .hps(\"<0 .25 .5 1>/4\")\n * .hpenv(4)\n */\nexport const { hpsustain, hps } = registerControl('hpsustain', 'hps');\n/**\n * Sets the sustain amplitude for the bandpass filter envelope.\n * @name bpsustain\n * @param {number | Pattern} sustain amplitude of the bandpass filter envelope\n * @synonyms bps\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .bpf(500)\n * .bpd(.5)\n * .bps(\"<0 .25 .5 1>/4\")\n * .bpenv(4)\n */\nexport const { bpsustain, bps } = registerControl('bpsustain', 'bps');\n/**\n * Sets the release time for the lowpass filter envelope.\n * @name lprelease\n * @param {number | Pattern} release time of the filter envelope\n * @synonyms lpr\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .clip(.5)\n * .lpf(500)\n * .lpenv(4)\n * .lpr(\"<.5 .25 .1 0>/4\")\n * .release(.5)\n */\nexport const { lprelease, lpr } = registerControl('lprelease', 'lpr');\n/**\n * Sets the release time for the highpass filter envelope.\n * @name hprelease\n * @param {number | Pattern} release time of the highpass filter envelope\n * @synonyms hpr\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .clip(.5)\n * .hpf(500)\n * .hpenv(4)\n * .hpr(\"<.5 .25 .1 0>/4\")\n * .release(.5)\n */\nexport const { hprelease, hpr } = registerControl('hprelease', 'hpr');\n/**\n * Sets the release time for the bandpass filter envelope.\n * @name bprelease\n * @param {number | Pattern} release time of the bandpass filter envelope\n * @synonyms bpr\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .clip(.5)\n * .bpf(500)\n * .bpenv(4)\n * .bpr(\"<.5 .25 .1 0>/4\")\n * .release(.5)\n */\nexport const { bprelease, bpr } = registerControl('bprelease', 'bpr');\n/**\n * Sets the filter type. The 24db filter is more aggressive. More types might be added in the future.\n * @name ftype\n * @param {number | Pattern} type 12db (default) or 24db\n * @example\n * note(\"c2 e2 f2 g2\")\n * .sound('sawtooth')\n * .lpf(500)\n * .bpenv(4)\n * .ftype(\"12db 24db\")\n */\nexport const { ftype } = registerControl('ftype');\nexport const { fanchor } = registerControl('fanchor');\n/**\n * Applies the cutoff frequency of the **h**igh-**p**ass **f**ilter.\n *\n * When using mininotation, you can also optionally add the 'hpq' parameter, separated by ':'.\n *\n * @name hpf\n * @param {number | Pattern} frequency audible between 0 and 20000\n * @synonyms hp, hcutoff\n * @example\n * s(\"bd sd [~ bd] sd,hh*8\").hpf(\"<4000 2000 1000 500 200 100>\")\n * @example\n * s(\"bd sd [~ bd] sd,hh*8\").hpf(\"<2000 2000:25>\")\n *\n */\n// currently an alias of 'hcutoff' https://github.com/tidalcycles/strudel/issues/496\n// ['hpf'],\n/**\n * Applies a vibrato to the frequency of the oscillator.\n *\n * @name vib\n * @synonyms vibrato, v\n * @param {number | Pattern} frequency of the vibrato in hertz\n * @example\n * note(\"a e\")\n * .vib(\"<.5 1 2 4 8 16>\")\n * @example\n * // change the modulation depth with \":\"\n * note(\"a e\")\n * .vib(\"<.5 1 2 4 8 16>:12\")\n */\nexport const { vib, vibrato, v } = registerControl(['vib', 'vibmod'], 'vibrato', 'v');\n/**\n * Adds pink noise to the mix\n *\n * @name noise\n * @param {number | Pattern} wet wet amount\n * @example\n * sound(\"<white pink brown>/2\")\n */\nexport const { noise } = registerControl('noise');\n/**\n * Sets the vibrato depth in semitones. Only has an effect if `vibrato` | `vib` | `v` is is also set\n *\n * @name vibmod\n * @synonyms vmod\n * @param {number | Pattern} depth of vibrato (in semitones)\n * @example\n * note(\"a e\").vib(4)\n * .vibmod(\"<.25 .5 1 2 12>\")\n * @example\n * // change the vibrato frequency with \":\"\n * note(\"a e\")\n * .vibmod(\"<.25 .5 1 2 12>:8\")\n */\nexport const { vibmod, vmod } = registerControl(['vibmod', 'vib'], 'vmod');\nexport const { hcutoff, hpf, hp } = registerControl(['hcutoff', 'hresonance', 'hpenv'], 'hpf', 'hp');\n/**\n * Controls the **h**igh-**p**ass **q**-value.\n *\n * @name hpq\n * @param {number | Pattern} q resonance factor between 0 and 50\n * @synonyms hresonance\n * @example\n * s(\"bd sd [~ bd] sd,hh*8\").hpf(2000).hpq(\"<0 10 20 30>\")\n *\n */\nexport const { hresonance, hpq } = registerControl('hresonance', 'hpq');\n/**\n * Controls the **l**ow-**p**ass **q**-value.\n *\n * @name lpq\n * @param {number | Pattern} q resonance factor between 0 and 50\n * @synonyms resonance\n * @example\n * s(\"bd sd [~ bd] sd,hh*8\").lpf(2000).lpq(\"<0 10 20 30>\")\n *\n */\n// currently an alias of 'resonance' https://github.com/tidalcycles/strudel/issues/496\nexport const { resonance, lpq } = registerControl('resonance', 'lpq');\n/**\n * DJ filter, below 0.5 is low pass filter, above is high pass filter.\n *\n * @name djf\n * @param {number | Pattern} cutoff below 0.5 is low pass filter, above is high pass filter\n * @example\n * n(\"0 3 7 [10,24]\").s('superzow').octave(3).djf(\"<.5 .25 .5 .75>\").osc()\n *\n */\nexport const { djf } = registerControl('djf');\n// ['cutoffegint'],\n// TODO: does not seem to work\n/**\n * Sets the level of the delay signal.\n *\n * When using mininotation, you can also optionally add the 'delaytime' and 'delayfeedback' parameter,\n * separated by ':'.\n *\n *\n * @name delay\n * @param {number | Pattern} level between 0 and 1\n * @example\n * s(\"bd bd\").delay(\"<0 .25 .5 1>\")\n * @example\n * s(\"bd bd\").delay(\"0.65:0.25:0.9 0.65:0.125:0.7\")\n *\n */\nexport const { delay } = registerControl(['delay', 'delaytime', 'delayfeedback']);\n/**\n * Sets the level of the signal that is fed back into the delay.\n * Caution: Values >= 1 will result in a signal that gets louder and louder! Don't do it\n *\n * @name delayfeedback\n * @param {number | Pattern} feedback between 0 and 1\n * @synonyms delayfb, dfb\n * @example\n * s(\"bd\").delay(.25).delayfeedback(\"<.25 .5 .75 1>\")\n *\n */\nexport const { delayfeedback, delayfb, dfb } = registerControl('delayfeedback', 'delayfb', 'dfb');\n/**\n * Sets the time of the delay effect.\n *\n * @name delaytime\n * @param {number | Pattern} seconds between 0 and Infinity\n * @synonyms delayt, dt\n * @example\n * s(\"bd bd\").delay(.25).delaytime(\"<.125 .25 .5 1>\")\n *\n */\nexport const { delaytime, delayt, dt } = registerControl('delaytime', 'delayt', 'dt');\n/* // TODO: test\n * Specifies whether delaytime is calculated relative to cps.\n *\n * @name lock\n * @param {number | Pattern} enable When set to 1, delaytime is a direct multiple of a cycle.\n * @example\n * s(\"sd\").delay().lock(1).osc()\n *\n */\nexport const { lock } = registerControl('lock');\n/**\n * Set detune for stacked voices of supported oscillators\n *\n * @name detune\n * @param {number | Pattern} amount\n * @synonyms det\n * @example\n * note(\"d f a a# a d3\").fast(2).s(\"supersaw\").detune(\"<.1 .2 .5 24.1>\")\n *\n */\nexport const { detune, det } = registerControl('detune', 'det');\n/**\n * Set number of stacked voices for supported oscillators\n *\n * @name unison\n * @param {number | Pattern} numvoices\n * @example\n * note(\"d f a a# a d3\").fast(2).s(\"supersaw\").unison(\"<1 2 7>\")\n *\n */\nexport const { unison } = registerControl('unison');\n\n/**\n * Set the stereo pan spread for supported oscillators\n *\n * @name spread\n * @param {number | Pattern} spread between 0 and 1\n * @example\n * note(\"d f a a# a d3\").fast(2).s(\"supersaw\").spread(\"<0 .3 1>\")\n *\n */\nexport const { spread } = registerControl('spread');\n/**\n * Set dryness of reverb. See `room` and `size` for more information about reverb.\n *\n * @name dry\n * @param {number | Pattern} dry 0 = wet, 1 = dry\n * @example\n * n(\"[0,3,7](3,8)\").s(\"superpiano\").room(.7).dry(\"<0 .5 .75 1>\").osc()\n * @superdirtOnly\n *\n */\nexport const { dry } = registerControl('dry');\n// TODO: does not seem to do anything\n/*\n * Used when using `begin`/`end` or `chop`/`striate` and friends, to change the fade out time of the 'grain' envelope.\n *\n * @name fadeTime\n * @param {number | Pattern} time between 0 and 1\n * @example\n * s(\"oh*4\").end(.1).fadeTime(\"<0 .2 .4 .8>\").osc()\n *\n */\nexport const { fadeTime, fadeOutTime } = registerControl('fadeTime', 'fadeOutTime');\n// TODO: see above\nexport const { fadeInTime } = registerControl('fadeInTime');\n/**\n * Set frequency of sound.\n *\n * @name freq\n * @param {number | Pattern} frequency in Hz. the audible range is between 20 and 20000 Hz\n * @example\n * freq(\"220 110 440 110\").s(\"superzow\").osc()\n * @example\n * freq(\"110\".mul.out(\".5 1.5 .6 [2 3]\")).s(\"superzow\").osc()\n *\n */\nexport const { freq } = registerControl('freq');\n// pitch envelope\n/**\n * Attack time of pitch envelope.\n *\n * @name pattack\n * @synonyms patt\n * @param {number | Pattern} time time in seconds\n * @example\n * note(\"c eb g bb\").pattack(\"0 .1 .25 .5\").slow(2)\n *\n */\nexport const { pattack, patt } = registerControl('pattack', 'patt');\n/**\n * Decay time of pitch envelope.\n *\n * @name pdecay\n * @synonyms pdec\n * @param {number | Pattern} time time in seconds\n * @example\n * note(\"<c eb g bb>\").pdecay(\"<0 .1 .25 .5>\")\n *\n */\nexport const { pdecay, pdec } = registerControl('pdecay', 'pdec');\n// TODO: how to use psustain?!\nexport const { psustain, psus } = registerControl('psustain', 'psus');\n/**\n * Release time of pitch envelope\n *\n * @name prelease\n * @synonyms prel\n * @param {number | Pattern} time time in seconds\n * @example\n * note(\"<c eb g bb> ~\")\n * .release(.5) // to hear the pitch release\n * .prelease(\"<0 .1 .25 .5>\")\n *\n */\nexport const { prelease, prel } = registerControl('prelease', 'prel');\n/**\n * Amount of pitch envelope. Negative values will flip the envelope.\n * If you don't set other pitch envelope controls, `pattack:.2` will be the default.\n *\n * @name penv\n * @param {number | Pattern} semitones change in semitones\n * @example\n * note(\"c\")\n * .penv(\"<12 7 1 .5 0 -1 -7 -12>\")\n *\n */\nexport const { penv } = registerControl('penv');\n/**\n * Curve of envelope. Defaults to linear. exponential is good for kicks\n *\n * @name pcurve\n * @param {number | Pattern} type 0 = linear, 1 = exponential\n * @example\n * note(\"g1*4\")\n * .s(\"sine\").pdec(.5)\n * .penv(32)\n * .pcurve(\"<0 1>\")\n *\n */\nexport const { pcurve } = registerControl('pcurve');\n/**\n * Sets the range anchor of the envelope:\n * - anchor 0: range = [note, note + penv]\n * - anchor 1: range = [note - penv, note]\n * If you don't set an anchor, the value will default to the psustain value.\n *\n * @name panchor\n * @param {number | Pattern} anchor anchor offset\n * @example\n * note(\"c c4\").penv(12).panchor(\"<0 .5 1 .5>\")\n *\n */\nexport const { panchor } = registerControl('panchor');\n// TODO: https://tidalcycles.org/docs/configuration/MIDIOSC/control-voltage/#gate\nexport const { gate, gat } = registerControl('gate', 'gat');\n// ['hatgrain'],\n// ['lagogo'],\n// ['lclap'],\n// ['lclaves'],\n// ['lclhat'],\n// ['lcrash'],\n// TODO:\n// https://tidalcycles.org/docs/reference/audio_effects/#leslie-1\n// https://tidalcycles.org/docs/reference/audio_effects/#leslie\n/**\n * Emulation of a Leslie speaker: speakers rotating in a wooden amplified cabinet.\n *\n * @name leslie\n * @param {number | Pattern} wet between 0 and 1\n * @example\n * n(\"0,4,7\").s(\"supersquare\").leslie(\"<0 .4 .6 1>\").osc()\n * @superdirtOnly\n *\n */\nexport const { leslie } = registerControl('leslie');\n/**\n * Rate of modulation / rotation for leslie effect\n *\n * @name lrate\n * @param {number | Pattern} rate 6.7 for fast, 0.7 for slow\n * @example\n * n(\"0,4,7\").s(\"supersquare\").leslie(1).lrate(\"<1 2 4 8>\").osc()\n * @superdirtOnly\n *\n */\n// TODO: the rate seems to \"lag\" (in the example, 1 will be fast)\nexport const { lrate } = registerControl('lrate');\n/**\n * Physical size of the cabinet in meters. Be careful, it might be slightly larger than your computer. Affects the Doppler amount (pitch warble)\n *\n * @name lsize\n * @param {number | Pattern} meters somewhere between 0 and 1\n * @example\n * n(\"0,4,7\").s(\"supersquare\").leslie(1).lrate(2).lsize(\"<.1 .5 1>\").osc()\n * @superdirtOnly\n *\n */\nexport const { lsize } = registerControl('lsize');\n/**\n * Sets the displayed text for an event on the pianoroll\n *\n * @name label\n * @param {string} label text to display\n */\nexport const { activeLabel } = registerControl('activeLabel');\nexport const { label } = registerControl(['label', 'activeLabel']);\n// ['lfo'],\n// ['lfocutoffint'],\n// ['lfodelay'],\n// ['lfoint'],\n// ['lfopitchint'],\n// ['lfoshape'],\n// ['lfosync'],\n// ['lhitom'],\n// ['lkick'],\n// ['llotom'],\n// ['lophat'],\n// ['lsnare'],\n// TODO: what is this? not found in tidal doc\nexport const { degree } = registerControl('degree');\n// TODO: what is this? not found in tidal doc\nexport const { mtranspose } = registerControl('mtranspose');\n// TODO: what is this? not found in tidal doc\nexport const { ctranspose } = registerControl('ctranspose');\n// TODO: what is this? not found in tidal doc\nexport const { harmonic } = registerControl('harmonic');\n// TODO: what is this? not found in tidal doc\nexport const { stepsPerOctave } = registerControl('stepsPerOctave');\n// TODO: what is this? not found in tidal doc\nexport const { octaveR } = registerControl('octaveR');\n// TODO: why is this needed? what's the difference to late / early? Answer: it's in seconds, and delays the message at\n// OSC time (so can't be negative, at least not beyond the latency value)\nexport const { nudge } = registerControl('nudge');\n// TODO: the following doc is just a guess, it's not documented in tidal doc.\n/**\n * Sets the default octave of a synth.\n *\n * @name octave\n * @param {number | Pattern} octave octave number\n * @example\n * n(\"0,4,7\").s('supersquare').octave(\"<3 4 5 6>\").osc()\n * @superDirtOnly\n */\nexport const { octave } = registerControl('octave');\n\n// ['ophatdecay'],\n// TODO: example\n/**\n * An `orbit` is a global parameter context for patterns. Patterns with the same orbit will share the same global effects.\n *\n * @name orbit\n * @param {number | Pattern} number\n * @example\n * stack(\n *   s(\"hh*6\").delay(.5).delaytime(.25).orbit(1),\n *   s(\"~ sd ~ sd\").delay(.5).delaytime(.125).orbit(2)\n * )\n */\nexport const { orbit } = registerControl('orbit');\n// TODO: what is this? not found in tidal doc Answer: gain is limited to maximum of 2. This allows you to go over that\nexport const { overgain } = registerControl('overgain');\n// TODO: what is this? not found in tidal doc. Similar to above, but limited to 1\nexport const { overshape } = registerControl('overshape');\n/**\n * Sets position in stereo.\n *\n * @name pan\n * @param {number | Pattern} pan between 0 and 1, from left to right (assuming stereo), once round a circle (assuming multichannel)\n * @example\n * s(\"[bd hh]*2\").pan(\"<.5 1 .5 0>\")\n * @example\n * s(\"bd rim sd rim bd ~ cp rim\").pan(sine.slow(2))\n *\n */\nexport const { pan } = registerControl('pan');\n// TODO: this has no effect (see example)\n/*\n * Controls how much multichannel output is fanned out\n *\n * @name panspan\n * @param {number | Pattern} span between -inf and inf, negative is backwards ordering\n * @example\n * s(\"[bd hh]*2\").pan(\"<.5 1 .5 0>\").panspan(\"<0 .5 1>\").osc()\n *\n */\nexport const { panspan } = registerControl('panspan');\n// TODO: this has no effect (see example)\n/*\n * Controls how much multichannel output is spread\n *\n * @name pansplay\n * @param {number | Pattern} spread between 0 and 1\n * @example\n * s(\"[bd hh]*2\").pan(\"<.5 1 .5 0>\").pansplay(\"<0 .5 1>\").osc()\n *\n */\nexport const { pansplay } = registerControl('pansplay');\nexport const { panwidth } = registerControl('panwidth');\nexport const { panorient } = registerControl('panorient');\n// ['pitch1'],\n// ['pitch2'],\n// ['pitch3'],\n// ['portamento'],\n// TODO: LFO rate see https://tidalcycles.org/docs/patternlib/tutorials/synthesizers/#supersquare\nexport const { rate } = registerControl('rate');\n// TODO: slide param for certain synths\nexport const { slide } = registerControl('slide');\n// TODO: detune? https://tidalcycles.org/docs/patternlib/tutorials/synthesizers/#supersquare\nexport const { semitone } = registerControl('semitone');\n\n// TODO: synth param\nexport const { voice } = registerControl('voice');\n// voicings // https://github.com/tidalcycles/strudel/issues/506\n// chord to voice, like C Eb Fm7 G7. the symbols can be defined via addVoicings\nexport const { chord } = registerControl('chord');\n// which dictionary to use for the voicings\nexport const { dictionary, dict } = registerControl('dictionary', 'dict');\n// the top note to align the voicing to, defaults to c5\nexport const { anchor } = registerControl('anchor');\n// how the voicing is offset from the anchored position\nexport const { offset } = registerControl('offset');\n// how many octaves are voicing steps spread apart, defaults to 1\nexport const { octaves } = registerControl('octaves');\n// below = anchor note will be removed from the voicing, useful for melody harmonization\nexport const { mode } = registerControl(['mode', 'anchor']);\n\n/**\n * Sets the level of reverb.\n *\n * When using mininotation, you can also optionally add the 'size' parameter, separated by ':'.\n *\n * @name room\n * @param {number | Pattern} level between 0 and 1\n * @example\n * s(\"bd sd [~ bd] sd\").room(\"<0 .2 .4 .6 .8 1>\")\n * @example\n * s(\"bd sd [~ bd] sd\").room(\"<0.9:1 0.9:4>\")\n *\n */\nexport const { room } = registerControl(['room', 'size']);\n/**\n * Reverb lowpass starting frequency (in hertz).\n * When this property is changed, the reverb will be recaculated, so only change this sparsely..\n *\n * @name roomlp\n * @synonyms rlp\n * @param {number} frequency between 0 and 20000hz\n * @example\n * s(\"bd sd [~ bd] sd\").room(0.5).rlp(10000)\n * @example\n * s(\"bd sd [~ bd] sd\").room(0.5).rlp(5000)\n */\nexport const { roomlp, rlp } = registerControl('roomlp', 'rlp');\n/**\n * Reverb lowpass frequency at -60dB (in hertz).\n * When this property is changed, the reverb will be recaculated, so only change this sparsely..\n *\n * @name roomdim\n * @synonyms rdim\n * @param {number} frequency between 0 and 20000hz\n * @example\n * s(\"bd sd [~ bd] sd\").room(0.5).rlp(10000).rdim(8000)\n * @example\n * s(\"bd sd [~ bd] sd\").room(0.5).rlp(5000).rdim(400)\n *\n */\nexport const { roomdim, rdim } = registerControl('roomdim', 'rdim');\n/**\n * Reverb fade time (in seconds).\n * When this property is changed, the reverb will be recaculated, so only change this sparsely..\n *\n * @name roomfade\n * @synonyms rfade\n * @param {number} seconds for the reverb to fade\n * @example\n * s(\"bd sd [~ bd] sd\").room(0.5).rlp(10000).rfade(0.5)\n * @example\n * s(\"bd sd [~ bd] sd\").room(0.5).rlp(5000).rfade(4)\n *\n */\nexport const { roomfade, rfade } = registerControl('roomfade', 'rfade');\n/**\n * Sets the sample to use as an impulse response for the reverb.\n * @name iresponse\n * @param {string | Pattern} sample to use as an impulse response\n * @synonyms ir\n * @example\n * s(\"bd sd [~ bd] sd\").room(.8).ir(\"<shaker_large:0 shaker_large:2>\")\n *\n */\nexport const { ir, iresponse } = registerControl(['ir', 'i'], 'iresponse');\n/**\n * Sets the room size of the reverb, see `room`.\n * When this property is changed, the reverb will be recaculated, so only change this sparsely..\n *\n * @name roomsize\n * @param {number | Pattern} size between 0 and 10\n * @synonyms rsize, sz, size\n * @example\n * s(\"bd sd [~ bd] sd\").room(.8).rsize(1)\n * @example\n * s(\"bd sd [~ bd] sd\").room(.8).rsize(4)\n *\n */\n// TODO: find out why :\n// s(\"bd sd [~ bd] sd\").room(.8).roomsize(\"<0 .2 .4 .6 .8 [1,0]>\").osc()\n// .. does not work. Is it because room is only one effect?\nexport const { roomsize, size, sz, rsize } = registerControl('roomsize', 'size', 'sz', 'rsize');\n// ['sagogo'],\n// ['sclap'],\n// ['sclaves'],\n// ['scrash'],\n/**\n * (Deprecated) Wave shaping distortion. WARNING: can suddenly get unpredictably loud.\n * Please use distort instead, which has a more predictable response curve\n * second option in optional array syntax (ex: \".9:.5\") applies a postgain to the output\n *\n *\n * @name shape\n * @param {number | Pattern} distortion between 0 and 1\n * @example\n * s(\"bd sd [~ bd] sd,hh*8\").shape(\"<0 .2 .4 .6 .8>\")\n *\n */\nexport const { shape } = registerControl(['shape', 'shapevol']);\n/**\n * Wave shaping distortion. CAUTION: it can get loud.\n * Second option in optional array syntax (ex: \".9:.5\") applies a postgain to the output.\n * Most useful values are usually between 0 and 10 (depending on source gain). If you are feeling adventurous, you can turn it up to 11 and beyond ;)\n *\n * @name distort\n * @synonyms dist\n * @param {number | Pattern} distortion\n * @example\n * s(\"bd sd [~ bd] sd,hh*8\").distort(\"<0 2 3 10:.5>\")\n * @example\n * note(\"d1!8\").s(\"sine\").penv(36).pdecay(.12).decay(.23).distort(\"8:.4\")\n *\n */\nexport const { distort, dist } = registerControl(['distort', 'distortvol'], 'dist');\n/**\n * Dynamics Compressor. The params are `compressor(\"threshold:ratio:knee:attack:release\")`\n * More info [here](https://developer.mozilla.org/en-US/docs/Web/API/DynamicsCompressorNode?retiredLocale=de#instance_properties)\n *\n * @name compressor\n * @example\n * s(\"bd sd [~ bd] sd,hh*8\")\n * .compressor(\"-20:20:10:.002:.02\")\n *\n */\nexport const { compressor } = registerControl([\n  'compressor',\n  'compressorRatio',\n  'compressorKnee',\n  'compressorAttack',\n  'compressorRelease',\n]);\nexport const { compressorKnee } = registerControl('compressorKnee');\nexport const { compressorRatio } = registerControl('compressorRatio');\nexport const { compressorAttack } = registerControl('compressorAttack');\nexport const { compressorRelease } = registerControl('compressorRelease');\n/**\n * Changes the speed of sample playback, i.e. a cheap way of changing pitch.\n *\n * @name speed\n * @param {number | Pattern} speed -inf to inf, negative numbers play the sample backwards.\n * @example\n * s(\"bd*6\").speed(\"1 2 4 1 -2 -4\")\n * @example\n * speed(\"1 1.5*2 [2 1.1]\").s(\"piano\").clip(1)\n *\n */\nexport const { speed } = registerControl('speed');\n/**\n * Used in conjunction with `speed`, accepts values of \"r\" (rate, default behavior), \"c\" (cycles), or \"s\" (seconds). Using `unit \"c\"` means `speed` will be interpreted in units of cycles, e.g. `speed \"1\"` means samples will be stretched to fill a cycle. Using `unit \"s\"` means the playback speed will be adjusted so that the duration is the number of seconds specified by `speed`.\n *\n * @name unit\n * @param {number | string | Pattern} unit see description above\n * @example\n * speed(\"1 2 .5 3\").s(\"bd\").unit(\"c\").osc()\n * @superdirtOnly\n *\n */\nexport const { unit } = registerControl('unit');\n/**\n * Made by Calum Gunn. Reminiscent of some weird mixture of filter, ring-modulator and pitch-shifter. The SuperCollider manual defines Squiz as:\n *\n * \"A simplistic pitch-raising algorithm. It's not meant to sound natural; its sound is reminiscent of some weird mixture of filter, ring-modulator and pitch-shifter, depending on the input. The algorithm works by cutting the signal into fragments (delimited by upwards-going zero-crossings) and squeezing those fragments in the time domain (i.e. simply playing them back faster than they came in), leaving silences inbetween. All the parameters apart from memlen can be modulated.\"\n *\n * @name squiz\n * @param {number | Pattern} squiz Try passing multiples of 2 to it - 2, 4, 8 etc.\n * @example\n * squiz(\"2 4/2 6 [8 16]\").s(\"bd\").osc()\n * @superdirtOnly\n *\n */\nexport const { squiz } = registerControl('squiz');\n// TODO: what is this? not found in tidal doc\n// ['stutterdepth'],\n// TODO: what is this? not found in tidal doc\n// ['stuttertime'],\n// TODO: what is this? not found in tidal doc\n// ['timescale'],\n// TODO: what is this? not found in tidal doc\n// ['timescalewin'],\n// ['tomdecay'],\n// ['vcfegint'],\n// ['vcoegint'],\n// TODO: Use a rest (~) to override the effect <- vowel\n/**\n *\n * Formant filter to make things sound like vowels.\n *\n * @name vowel\n * @param {string | Pattern} vowel You can use a e i o u ae aa oe ue y uh un en an on, corresponding to [a] [e] [i] [o] [u] [æ] [ɑ] [ø] [y] [ɯ] [ʌ] [œ̃] [ɛ̃] [ɑ̃] [ɔ̃]. Aliases: aa = å = ɑ, oe = ø = ö, y = ı, ae = æ.\n * @example\n * note(\"[c2 <eb2 <g2 g1>>]*2\").s('sawtooth')\n * .vowel(\"<a e i <o u>>\")\n * @example\n * s(\"bd sd mt ht bd [~ cp] ht lt\").vowel(\"[a|e|i|o|u]\")\n *\n */\nexport const { vowel } = registerControl('vowel');\n/* // TODO: find out how it works\n * Made by Calum Gunn. Divides an audio stream into tiny segments, using the signal's zero-crossings as segment boundaries, and discards a fraction of them. Takes a number between 1 and 100, denoted the percentage of segments to drop. The SuperCollider manual describes the Waveloss effect this way:\n *\n * Divide an audio stream into tiny segments, using the signal's zero-crossings as segment boundaries, and discard a fraction of them (i.e. replace them with silence of the same length). The technique was described by Trevor Wishart in a lecture. Parameters: the filter drops drop out of out of chunks. mode can be 1 to drop chunks in a simple deterministic fashion (e.g. always dropping the first 30 out of a set of 40 segments), or 2 to drop chunks randomly but in an appropriate proportion.)\n *\n * mode: ?\n * waveloss: ?\n *\n * @name waveloss\n */\nexport const { waveloss } = registerControl('waveloss');\n/*\n * Noise crackle density\n *\n * @name density\n * @param {number | Pattern} density between 0 and x\n * @example\n * s(\"crackle*4\").density(\"<0.01 0.04 0.2 0.5>\".slow(4))\n *\n */\nexport const { density } = registerControl('density');\n// ['modwheel'],\nexport const { expression } = registerControl('expression');\nexport const { sustainpedal } = registerControl('sustainpedal');\n/* // TODO: doesn't seem to do anything\n *\n * Tremolo Audio DSP effect\n *\n * @name tremolodepth\n * @param {number | Pattern} depth between 0 and 1\n * @example\n * n(\"0,4,7\").tremolodepth(\"<0 .3 .6 .9>\").osc()\n *\n */\nexport const { tremolodepth, tremdp } = registerControl('tremolodepth', 'tremdp');\nexport const { tremolorate, tremr } = registerControl('tremolorate', 'tremr');\n\nexport const { fshift } = registerControl('fshift');\nexport const { fshiftnote } = registerControl('fshiftnote');\nexport const { fshiftphase } = registerControl('fshiftphase');\n\nexport const { triode } = registerControl('triode');\nexport const { krush } = registerControl('krush');\nexport const { kcutoff } = registerControl('kcutoff');\nexport const { octer } = registerControl('octer');\nexport const { octersub } = registerControl('octersub');\nexport const { octersubsub } = registerControl('octersubsub');\nexport const { ring } = registerControl('ring');\nexport const { ringf } = registerControl('ringf');\nexport const { ringdf } = registerControl('ringdf');\nexport const { freeze } = registerControl('freeze');\nexport const { xsdelay } = registerControl('xsdelay');\nexport const { tsdelay } = registerControl('tsdelay');\nexport const { real } = registerControl('real');\nexport const { imag } = registerControl('imag');\nexport const { enhance } = registerControl('enhance');\nexport const { partials } = registerControl('partials');\nexport const { comb } = registerControl('comb');\nexport const { smear } = registerControl('smear');\nexport const { scram } = registerControl('scram');\nexport const { binshift } = registerControl('binshift');\nexport const { hbrick } = registerControl('hbrick');\nexport const { lbrick } = registerControl('lbrick');\nexport const { midichan } = registerControl('midichan');\nexport const { control } = registerControl('control');\nexport const { ccn } = registerControl('ccn');\nexport const { ccv } = registerControl('ccv');\nexport const { polyTouch } = registerControl('polyTouch');\nexport const { midibend } = registerControl('midibend');\nexport const { miditouch } = registerControl('miditouch');\nexport const { ctlNum } = registerControl('ctlNum');\nexport const { frameRate } = registerControl('frameRate');\nexport const { frames } = registerControl('frames');\nexport const { hours } = registerControl('hours');\nexport const { midicmd } = registerControl('midicmd');\nexport const { minutes } = registerControl('minutes');\nexport const { progNum } = registerControl('progNum');\nexport const { seconds } = registerControl('seconds');\nexport const { songPtr } = registerControl('songPtr');\nexport const { uid } = registerControl('uid');\nexport const { val } = registerControl('val');\nexport const { cps } = registerControl('cps');\n/**\n * Multiplies the duration with the given number. Also cuts samples off at the end if they exceed the duration.\n *\n * @name clip\n * @synonyms legato\n * @param {number | Pattern} factor >= 0\n * @example\n * note(\"c a f e\").s(\"piano\").clip(\"<.5 1 2>\")\n *\n */\nexport const { clip, legato } = registerControl('clip', 'legato');\n\n/**\n * Sets the duration of the event in cycles. Similar to clip / legato, it also cuts samples off at the end if they exceed the duration.\n *\n * @name duration\n * @synonyms dur\n * @param {number | Pattern} seconds >= 0\n * @example\n * note(\"c a f e\").s(\"piano\").dur(\"<.5 1 2>\")\n *\n */\nexport const { duration, dur } = registerControl('duration', 'dur');\n\n// ZZFX\nexport const { zrand } = registerControl('zrand');\nexport const { curve } = registerControl('curve');\n// superdirt duplicate\n// export const {slide]} = registerControl('slide']);\nexport const { deltaSlide } = registerControl('deltaSlide');\nexport const { pitchJump } = registerControl('pitchJump');\nexport const { pitchJumpTime } = registerControl('pitchJumpTime');\nexport const { lfo, repeatTime } = registerControl('lfo', 'repeatTime');\n// noise on the frequency or as bubo calls it \"frequency fog\" :)\nexport const { znoise } = registerControl('znoise');\nexport const { zmod } = registerControl('zmod');\n// like crush but scaled differently\nexport const { zcrush } = registerControl('zcrush');\nexport const { zdelay } = registerControl('zdelay');\nexport const { tremolo } = registerControl('tremolo');\nexport const { zzfx } = registerControl('zzfx');\n\n/**\n * Sets the color of the hap in visualizations like pianoroll or highlighting.\n * @name color\n * @synonyms colour\n * @param {string} color Hexadecimal or CSS color name\n */\nexport const { color, colour } = registerControl(['color', 'colour']);\n\n// TODO: slice / splice https://www.youtube.com/watch?v=hKhPdO0RKDQ&list=PL2lW1zNIIwj3bDkh-Y3LUGDuRcoUigoDs&index=13\n\nexport let createParams = (...names) =>\n  names.reduce((acc, name) => Object.assign(acc, { [name]: createParam(name) }), {});\n\n/**\n * ADSR envelope: Combination of Attack, Decay, Sustain, and Release.\n *\n * @name adsr\n * @param {number | Pattern} time attack time in seconds\n * @param {number | Pattern} time decay time in seconds\n * @param {number | Pattern} gain sustain level (0 to 1)\n * @param {number | Pattern} time release time in seconds\n * @example\n * note(\"[c3 bb2 f3 eb3]*2\").sound(\"sawtooth\").lpf(600).adsr(\".1:.1:.5:.2\")\n */\nexport const adsr = register('adsr', (adsr, pat) => {\n  adsr = !Array.isArray(adsr) ? [adsr] : adsr;\n  const [attack, decay, sustain, release] = adsr;\n  return pat.set({ attack, decay, sustain, release });\n});\nexport const ad = register('ad', (t, pat) => {\n  t = !Array.isArray(t) ? [t] : t;\n  const [attack, decay = attack] = t;\n  return pat.attack(attack).decay(decay);\n});\nexport const ds = register('ds', (t, pat) => {\n  t = !Array.isArray(t) ? [t] : t;\n  const [decay, sustain = 0] = t;\n  return pat.set({ decay, sustain });\n});\nexport const ar = register('ar', (t, pat) => {\n  t = !Array.isArray(t) ? [t] : t;\n  const [attack, release = attack] = t;\n  return pat.set({ attack, release });\n});\n","/*\neuclid.mjs - Bjorklund/Euclidean/Diaspora rhythms\nCopyright (C) 2023 Rohan Drape and strudel contributors\n\nSee <https://github.com/tidalcycles/strudel/blob/main/packages/core/euclid.mjs> for authors of this file.\n\nThe Bjorklund algorithm implementation is ported from the Haskell Music Theory Haskell module by Rohan Drape -\nhttps://rohandrape.net/?t=hmt\n\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport { Pattern, timeCat, register, silence } from './pattern.mjs';\nimport { rotate, flatten, splitAt, zipWith } from './util.mjs';\nimport Fraction from './fraction.mjs';\n\nconst left = function (n, x) {\n  const [ons, offs] = n;\n  const [xs, ys] = x;\n  const [_xs, __xs] = splitAt(offs, xs);\n  return [\n    [offs, ons - offs],\n    [zipWith((a, b) => a.concat(b), _xs, ys), __xs],\n  ];\n};\n\nconst right = function (n, x) {\n  const [ons, offs] = n;\n  const [xs, ys] = x;\n  const [_ys, __ys] = splitAt(ons, ys);\n  const result = [\n    [ons, offs - ons],\n    [zipWith((a, b) => a.concat(b), xs, _ys), __ys],\n  ];\n  return result;\n};\n\nconst _bjork = function (n, x) {\n  const [ons, offs] = n;\n  return Math.min(ons, offs) <= 1 ? [n, x] : _bjork(...(ons > offs ? left(n, x) : right(n, x)));\n};\n\nexport const bjork = function (ons, steps) {\n  const inverted = ons < 0;\n  ons = Math.abs(ons);\n  const offs = steps - ons;\n  const x = Array(ons).fill([1]);\n  const y = Array(offs).fill([0]);\n  const result = _bjork([ons, offs], [x, y]);\n  const p = flatten(result[1][0]).concat(flatten(result[1][1]));\n  if (inverted) {\n    return p.map((x) => (x === 0 ? 1 : 0));\n  }\n  return p;\n};\n\n/**\n * Changes the structure of the pattern to form an euclidean rhythm.\n * Euclidian rhythms are rhythms obtained using the greatest common\n * divisor of two numbers.  They were described in 2004 by Godfried\n * Toussaint, a canadian computer scientist.  Euclidian rhythms are\n * really useful for computer/algorithmic music because they can\n * describe a large number of rhythms with a couple of numbers.\n *\n * @memberof Pattern\n * @name euclid\n * @param {number} pulses the number of onsets / beats\n * @param {number} steps the number of steps to fill\n * @returns Pattern\n * @example\n * // The Cuban tresillo pattern.\n * note(\"c3\").euclid(3,8)\n */\n\n/**\n * Like `euclid`, but has an additional parameter for 'rotating' the resulting sequence.\n * @memberof Pattern\n * @name euclidRot\n * @param {number} pulses the number of onsets / beats\n * @param {number} steps the number of steps to fill\n * @param {number} rotation offset in steps\n * @returns Pattern\n * @example\n * // A Samba rhythm necklace from Brazil\n * note(\"c3\").euclidRot(3,16,14)\n */\n\n/**\n * @example // A thirteenth century Persian rhythm called Khafif-e-ramal.\n * note(\"c3\").euclid(2,5)\n * @example // The archetypal pattern of the Cumbia from Colombia, as well as a Calypso rhythm from Trinidad.\n * note(\"c3\").euclid(3,4)\n * @example // Another thirteenth century Persian rhythm by the name of Khafif-e-ramal, as well as a Rumanian folk-dance rhythm.\n * note(\"c3\").euclidRot(3,5,2)\n * @example // A Ruchenitza rhythm used in a Bulgarian folk-dance.\n * note(\"c3\").euclid(3,7)\n * @example // The Cuban tresillo pattern.\n * note(\"c3\").euclid(3,8)\n * @example // Another Ruchenitza Bulgarian folk-dance rhythm.\n * note(\"c3\").euclid(4,7)\n * @example // The Aksak rhythm of Turkey.\n * note(\"c3\").euclid(4,9)\n * @example // The metric pattern used by Frank Zappa in his piece titled Outside Now.\n * note(\"c3\").euclid(4,11)\n * @example // Yields the York-Samai pattern, a popular Arab rhythm.\n * note(\"c3\").euclid(5,6)\n * @example // The Nawakhat pattern, another popular Arab rhythm.\n * note(\"c3\").euclid(5,7)\n * @example // The Cuban cinquillo pattern.\n * note(\"c3\").euclid(5,8)\n * @example // A popular Arab rhythm called Agsag-Samai.\n * note(\"c3\").euclid(5,9)\n * @example // The metric pattern used by Moussorgsky in Pictures at an Exhibition.\n * note(\"c3\").euclid(5,11)\n * @example // The Venda clapping pattern of a South African children’s song.\n * note(\"c3\").euclid(5,12)\n * @example // The Bossa-Nova rhythm necklace of Brazil.\n * note(\"c3\").euclid(5,16)\n * @example // A typical rhythm played on the Bendir (frame drum).\n * note(\"c3\").euclid(7,8)\n * @example // A common West African bell pattern.\n * note(\"c3\").euclid(7,12)\n * @example // A Samba rhythm necklace from Brazil.\n * note(\"c3\").euclidRot(7,16,14)\n * @example // A rhythm necklace used in the Central African Republic.\n * note(\"c3\").euclid(9,16)\n * @example // A rhythm necklace of the Aka Pygmies of Central Africa.\n * note(\"c3\").euclidRot(11,24,14)\n * @example // Another rhythm necklace of the Aka Pygmies of the upper Sangha.\n * note(\"c3\").euclidRot(13,24,5)\n */\n\nconst _euclidRot = function (pulses, steps, rotation) {\n  const b = bjork(pulses, steps);\n  if (rotation) {\n    return rotate(b, -rotation);\n  }\n  return b;\n};\n\nexport const euclid = register('euclid', function (pulses, steps, pat) {\n  return pat.struct(_euclidRot(pulses, steps, 0));\n});\n\nexport const { euclidrot, euclidRot } = register(['euclidrot', 'euclidRot'], function (pulses, steps, rotation, pat) {\n  return pat.struct(_euclidRot(pulses, steps, rotation));\n});\n\n/**\n * Similar to `euclid`, but each pulse is held until the next pulse,\n * so there will be no gaps.\n * @name euclidLegato\n * @memberof Pattern\n * @param {number} pulses the number of onsets / beats\n * @param {number} steps the number of steps to fill\n * @example\n * note(\"c3\").euclidLegato(3,8)\n */\n\nconst _euclidLegato = function (pulses, steps, rotation, pat) {\n  if (pulses < 1) {\n    return silence;\n  }\n  const bin_pat = _euclidRot(pulses, steps, rotation);\n  const gapless = bin_pat\n    .join('')\n    .split('1')\n    .slice(1)\n    .map((s) => [s.length + 1, true]);\n  return pat.struct(timeCat(...gapless));\n};\n\nexport const euclidLegato = register(['euclidLegato'], function (pulses, steps, pat) {\n  return _euclidLegato(pulses, steps, 0, pat);\n});\n\n/**\n * Similar to `euclid`, but each pulse is held until the next pulse,\n * so there will be no gaps, and has an additional parameter for 'rotating'\n * the resulting sequence\n * @name euclidLegatoRot\n * @memberof Pattern\n * @param {number} pulses the number of onsets / beats\n * @param {number} steps the number of steps to fill\n * @param {number} rotation offset in steps\n * @example\n * note(\"c3\").euclidLegatoRot(3,5,2)\n */\nexport const euclidLegatoRot = register(['euclidLegatoRot'], function (pulses, steps, rotation, pat) {\n  return _euclidLegato(pulses, steps, rotation, pat);\n});\n","// will move to https://github.com/felixroos/zyklus\n// TODO: started flag\n\nfunction createClock(\n  getTime,\n  callback, // called slightly before each cycle\n  duration = 0.05, // duration of each cycle\n  interval = 0.1, // interval between callbacks\n  overlap = 0.1, // overlap between callbacks\n  setInterval = globalThis.setInterval,\n  clearInterval = globalThis.clearInterval,\n  round = true,\n) {\n  let tick = 0; // counts callbacks\n  let phase = 0; // next callback time\n  let precision = 10 ** 4; // used to round phase\n  let minLatency = 0.01;\n  const setDuration = (setter) => (duration = setter(duration));\n  overlap = overlap || interval / 2;\n  const onTick = () => {\n    const t = getTime();\n    const lookahead = t + interval + overlap; // the time window for this tick\n    if (phase === 0) {\n      phase = t + minLatency;\n    }\n    // callback as long as we're inside the lookahead\n    while (phase < lookahead) {\n      phase = round ? Math.round(phase * precision) / precision : phase;\n      phase >= t && callback(phase, duration, tick, t);\n      phase < t && console.log('TOO LATE', phase); // what if latency is added from outside?\n      phase += duration; // increment phase by duration\n      tick++;\n    }\n  };\n  let intervalID;\n  const start = () => {\n    clear(); // just in case start was called more than once\n    onTick();\n    intervalID = setInterval(onTick, interval * 1000);\n  };\n  const clear = () => {\n    intervalID !== undefined && clearInterval(intervalID);\n    intervalID = undefined;\n  };\n  const pause = () => clear();\n  const stop = () => {\n    tick = 0;\n    phase = 0;\n    clear();\n  };\n  const getPhase = () => phase;\n  // setCallback\n  return { setDuration, start, stop, pause, duration, interval, getPhase, minLatency };\n}\nexport default createClock;\n","/*\nsignal.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/signal.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport { Hap } from './hap.mjs';\nimport { Pattern, fastcat, reify, silence, stack, register } from './pattern.mjs';\nimport Fraction from './fraction.mjs';\nimport { id, _mod, clamp, objectMap } from './util.mjs';\n\nexport function steady(value) {\n  // A continuous value\n  return new Pattern((state) => [new Hap(undefined, state.span, value)]);\n}\n\nexport const signal = (func) => {\n  const query = (state) => [new Hap(undefined, state.span, func(state.span.midpoint()))];\n  return new Pattern(query);\n};\n\nexport const isaw = signal((t) => 1 - (t % 1));\nexport const isaw2 = isaw.toBipolar();\n\n/**\n *  A sawtooth signal between 0 and 1.\n *\n * @return {Pattern}\n * @example\n * note(\"<c3 [eb3,g3] g2 [g3,bb3]>*8\")\n * .clip(saw.slow(2))\n * @example\n * n(saw.range(0,8).segment(8))\n * .scale('C major')\n *\n */\nexport const saw = signal((t) => t % 1);\nexport const saw2 = saw.toBipolar();\n\nexport const sine2 = signal((t) => Math.sin(Math.PI * 2 * t));\n\n/**\n *  A sine signal between 0 and 1.\n *\n * @return {Pattern}\n * @example\n * n(sine.segment(16).range(0,15))\n * .scale(\"C:minor\")\n *\n */\nexport const sine = sine2.fromBipolar();\n\n/**\n *  A cosine signal between 0 and 1.\n *\n * @return {Pattern}\n * @example\n * n(stack(sine,cosine).segment(16).range(0,15))\n * .scale(\"C:minor\")\n *\n */\nexport const cosine = sine._early(Fraction(1).div(4));\nexport const cosine2 = sine2._early(Fraction(1).div(4));\n\n/**\n *  A square signal between 0 and 1.\n *\n * @return {Pattern}\n * @example\n * n(square.segment(4).range(0,7)).scale(\"C:minor\")\n *\n */\nexport const square = signal((t) => Math.floor((t * 2) % 2));\nexport const square2 = square.toBipolar();\n\n/**\n *  A triangle signal between 0 and 1.\n *\n * @return {Pattern}\n * @example\n * n(tri.segment(8).range(0,7)).scale(\"C:minor\")\n *\n */\nexport const tri = fastcat(isaw, saw);\nexport const tri2 = fastcat(isaw2, saw2);\n\nexport const time = signal(id);\n\n// random signals\n\nconst xorwise = (x) => {\n  const a = (x << 13) ^ x;\n  const b = (a >> 17) ^ a;\n  return (b << 5) ^ b;\n};\n\n// stretch 300 cycles over the range of [0,2**29 == 536870912) then apply the xorshift algorithm\nconst _frac = (x) => x - Math.trunc(x);\n\nconst timeToIntSeed = (x) => xorwise(Math.trunc(_frac(x / 300) * 536870912));\n\nconst intSeedToRand = (x) => (x % 536870912) / 536870912;\n\nconst timeToRand = (x) => Math.abs(intSeedToRand(timeToIntSeed(x)));\n\nconst timeToRandsPrime = (seed, n) => {\n  const result = [];\n  // eslint-disable-next-line\n  for (let i = 0; i < n; ++n) {\n    result.push(intSeedToRand(seed));\n    seed = xorwise(seed);\n  }\n  return result;\n};\n\nconst timeToRands = (t, n) => timeToRandsPrime(timeToIntSeed(t), n);\n\n/**\n *\n */\n\n/**\n * A discrete pattern of numbers from 0 to n-1\n * @example\n * n(run(4)).scale(\"C4:pentatonic\")\n * // n(\"0 1 2 3\").scale(\"C4:pentatonic\")\n */\nexport const run = (n) => saw.range(0, n).floor().segment(n);\n\n/**\n * A continuous pattern of random numbers, between 0 and 1.\n *\n * @name rand\n * @example\n * // randomly change the cutoff\n * s(\"bd*4,hh*8\").cutoff(rand.range(500,8000))\n *\n */\nexport const rand = signal(timeToRand);\n/**\n * A continuous pattern of random numbers, between -1 and 1\n */\nexport const rand2 = rand.toBipolar();\n\nexport const _brandBy = (p) => rand.fmap((x) => x < p);\n\n/**\n * A continuous pattern of 0 or 1 (binary random), with a probability for the value being 1\n *\n * @name brandBy\n * @param {number} probability - a number between 0 and 1\n * @example\n * s(\"hh*10\").pan(brandBy(0.2))\n */\nexport const brandBy = (pPat) => reify(pPat).fmap(_brandBy).innerJoin();\n\n/**\n * A continuous pattern of 0 or 1 (binary random)\n *\n * @name brand\n * @example\n * s(\"hh*10\").pan(brand)\n */\nexport const brand = _brandBy(0.5);\n\nexport const _irand = (i) => rand.fmap((x) => Math.trunc(x * i));\n\n/**\n * A continuous pattern of random integers, between 0 and n-1.\n *\n * @name irand\n * @param {number} n max value (exclusive)\n * @example\n * // randomly select scale notes from 0 - 7 (= C to C)\n * n(irand(8)).struct(\"x x*2 x x*3\").scale(\"C:minor\")\n *\n */\nexport const irand = (ipat) => reify(ipat).fmap(_irand).innerJoin();\n\nconst _pick = function (lookup, pat, modulo = true) {\n  const array = Array.isArray(lookup);\n  const len = Object.keys(lookup).length;\n\n  lookup = objectMap(lookup, reify);\n\n  if (len === 0) {\n    return silence;\n  }\n  return pat.fmap((i) => {\n    let key = i;\n    if (array) {\n      key = modulo ? Math.round(key) % len : clamp(Math.round(key), 0, lookup.length - 1);\n    }\n    return lookup[key];\n  });\n};\n\n/** * Picks patterns (or plain values) either from a list (by index) or a lookup table (by name).\n * Similar to `inhabit`, but maintains the structure of the original patterns.\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n * @example\n * note(\"<0 1 2!2 3>\".pick([\"g a\", \"e f\", \"f g f g\" , \"g c d\"]))\n * @example\n * sound(\"<0 1 [2,0]>\".pick([\"bd sd\", \"cp cp\", \"hh hh\"]))\n * @example\n * sound(\"<0!2 [0,1] 1>\".pick([\"bd(3,8)\", \"sd sd\"]))\n * @example\n * s(\"<a!2 [a,b] b>\".pick({a: \"bd(3,8)\", b: \"sd sd\"}))\n */\n\nexport const pick = function (lookup, pat) {\n  // backward compatibility - the args used to be flipped\n  if (Array.isArray(pat)) {\n    [pat, lookup] = [lookup, pat];\n  }\n  return __pick(lookup, pat);\n};\n\nconst __pick = register('pick', function (lookup, pat) {\n  return _pick(lookup, pat, false).innerJoin();\n});\n\n/** * The same as `pick`, but if you pick a number greater than the size of the list,\n * it wraps around, rather than sticking at the maximum value.\n * For example, if you pick the fifth pattern of a list of three, you'll get the\n * second one.\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n */\n\nexport const pickmod = register('pickmod', function (lookup, pat) {\n  return _pick(lookup, pat, true).innerJoin();\n});\n\n/** * pickF lets you use a pattern of numbers to pick which function to apply to another pattern.\n * @param {Pattern} pat\n * @param {Pattern} lookup a pattern of indices\n * @param {function[]} funcs the array of functions from which to pull\n * @returns {Pattern}\n * @example\n * s(\"bd [rim hh]\").pickF(\"<0 1 2>\", [rev,jux(rev),fast(2)])\n * @example\n * note(\"<c2 d2>(3,8)\").s(\"square\")\n *     .pickF(\"<0 2> 1\", [jux(rev),fast(2),x=>x.lpf(800)])\n */\nexport const pickF = register('pickF', function (lookup, funcs, pat) {\n  return pat.apply(pick(lookup, funcs));\n});\n\n/** * The same as `pickF`, but if you pick a number greater than the size of the functions list,\n * it wraps around, rather than sticking at the maximum value.\n * @param {Pattern} pat\n * @param {Pattern} lookup a pattern of indices\n * @param {function[]} funcs the array of functions from which to pull\n * @returns {Pattern}\n */\nexport const pickmodF = register('pickmodF', function (lookup, funcs, pat) {\n  return pat.apply(pickmod(lookup, funcs));\n});\n\n/** * Similar to `pick`, but it applies an outerJoin instead of an innerJoin.\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n */\nexport const pickOut = register('pickOut', function (lookup, pat) {\n  return _pick(lookup, pat, false).outerJoin();\n});\n\n/** * The same as `pickOut`, but if you pick a number greater than the size of the list,\n * it wraps around, rather than sticking at the maximum value.\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n */\nexport const pickmodOut = register('pickmodOut', function (lookup, pat) {\n  return _pick(lookup, pat, true).outerJoin();\n});\n\n/** * Similar to `pick`, but the choosen pattern is restarted when its index is triggered.\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n */\nexport const pickRestart = register('pickRestart', function (lookup, pat) {\n  return _pick(lookup, pat, false).restartJoin();\n});\n\n/** * The same as `pickRestart`, but if you pick a number greater than the size of the list,\n * it wraps around, rather than sticking at the maximum value.\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n */\nexport const pickmodRestart = register('pickmodRestart', function (lookup, pat) {\n  return _pick(lookup, pat, true).restartJoin();\n});\n\n/** * Similar to `pick`, but the choosen pattern is reset when its index is triggered.\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n */\nexport const pickReset = register('pickReset', function (lookup, pat) {\n  return _pick(lookup, pat, false).resetJoin();\n});\n\n/** * The same as `pickReset`, but if you pick a number greater than the size of the list,\n * it wraps around, rather than sticking at the maximum value.\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n */\nexport const pickmodReset = register('pickmodReset', function (lookup, pat) {\n  return _pick(lookup, pat, true).resetJoin();\n});\n\n/**\n/** * Picks patterns (or plain values) either from a list (by index) or a lookup table (by name).\n * Similar to `pick`, but cycles are squeezed into the target ('inhabited') pattern.\n * @name inhabit\n * @synonyms pickSqueeze\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n * @example\n * \"<a b [a,b]>\".inhabit({a: s(\"bd(3,8)\"),\n                          b: s(\"cp sd\")\n                         })\n * @example\n * s(\"a@2 [a b] a\".inhabit({a: \"bd(3,8)\", b: \"sd sd\"})).slow(4)\n */\nexport const { inhabit, pickSqueeze } = register(['inhabit', 'pickSqueeze'], function (lookup, pat) {\n  return _pick(lookup, pat, false).squeezeJoin();\n});\n\n/** * The same as `inhabit`, but if you pick a number greater than the size of the list,\n * it wraps around, rather than sticking at the maximum value.\n * For example, if you pick the fifth pattern of a list of three, you'll get the\n * second one.\n * @name inhabitmod\n * @synonyms pickmodSqueeze\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n */\n\nexport const { inhabitmod, pickmodSqueeze } = register(['inhabitmod', 'pickmodSqueeze'], function (lookup, pat) {\n  return _pick(lookup, pat, true).squeezeJoin();\n});\n\n/**\n * Pick from the list of values (or patterns of values) via the index using the given\n * pattern of integers. The selected pattern will be compressed to fit the duration of the selecting event\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n * @example\n * note(squeeze(\"<0@2 [1!2] 2>\", [\"g a\", \"f g f g\" , \"g a c d\"]))\n */\n\nexport const squeeze = (pat, xs) => {\n  xs = xs.map(reify);\n  if (xs.length == 0) {\n    return silence;\n  }\n  return pat\n    .fmap((i) => {\n      const key = _mod(Math.round(i), xs.length);\n      return xs[key];\n    })\n    .squeezeJoin();\n};\n\nexport const __chooseWith = (pat, xs) => {\n  xs = xs.map(reify);\n  if (xs.length == 0) {\n    return silence;\n  }\n\n  return pat.range(0, xs.length).fmap((i) => {\n    const key = Math.min(Math.max(Math.floor(i), 0), xs.length - 1);\n    return xs[key];\n  });\n};\n/**\n * Choose from the list of values (or patterns of values) using the given\n * pattern of numbers, which should be in the range of 0..1\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n * @example\n * note(\"c2 g2!2 d2 f1\").s(chooseWith(sine.fast(2), [\"sawtooth\", \"triangle\", \"bd:6\"]))\n */\nexport const chooseWith = (pat, xs) => {\n  return __chooseWith(pat, xs).outerJoin();\n};\n\n/**\n * As with {chooseWith}, but the structure comes from the chosen values, rather\n * than the pattern you're using to choose with.\n * @param {Pattern} pat\n * @param {*} xs\n * @returns {Pattern}\n */\nexport const chooseInWith = (pat, xs) => {\n  return __chooseWith(pat, xs).innerJoin();\n};\n\n/**\n * Chooses randomly from the given list of elements.\n * @param  {...any} xs values / patterns to choose from.\n * @returns {Pattern} - a continuous pattern.\n * @example\n * note(\"c2 g2!2 d2 f1\").s(choose(\"sine\", \"triangle\", \"bd:6\"))\n */\nexport const choose = (...xs) => chooseWith(rand, xs);\n\n/**\n * Chooses from the given list of values (or patterns of values), according\n * to the pattern that the method is called on. The pattern should be in\n * the range 0 .. 1.\n * @param  {...any} xs\n * @returns {Pattern}\n */\nPattern.prototype.choose = function (...xs) {\n  return chooseWith(this, xs);\n};\n\n/**\n * As with choose, but the pattern that this method is called on should be\n * in the range -1 .. 1\n * @param  {...any} xs\n * @returns {Pattern}\n */\nPattern.prototype.choose2 = function (...xs) {\n  return chooseWith(this.fromBipolar(), xs);\n};\n\n/**\n * Picks one of the elements at random each cycle.\n * @synonyms randcat\n * @returns {Pattern}\n * @example\n * chooseCycles(\"bd\", \"hh\", \"sd\").s().fast(8)\n * @example\n * s(\"bd | hh | sd\").fast(8)\n */\nexport const chooseCycles = (...xs) => chooseInWith(rand.segment(1), xs);\n\nexport const randcat = chooseCycles;\n\nconst _wchooseWith = function (pat, ...pairs) {\n  const values = pairs.map((pair) => reify(pair[0]));\n  const weights = [];\n  let accum = 0;\n  for (const pair of pairs) {\n    accum += pair[1];\n    weights.push(accum);\n  }\n  const total = accum;\n  const match = function (r) {\n    const find = r * total;\n    return values[weights.findIndex((x) => x > find, weights)];\n  };\n  return pat.fmap(match);\n};\n\nconst wchooseWith = (...args) => _wchooseWith(...args).outerJoin();\n\n/**\n * Chooses randomly from the given list of elements by giving a probability to each element\n * @param {...any} pairs arrays of value and weight\n * @returns {Pattern} - a continuous pattern.\n * @example\n * note(\"c2 g2!2 d2 f1\").s(wchoose([\"sine\",10], [\"triangle\",1], [\"bd:6\",1]))\n */\nexport const wchoose = (...pairs) => wchooseWith(rand, ...pairs);\n\n/**\n * Picks one of the elements at random each cycle by giving a probability to each element\n * @synonyms wrandcat\n * @returns {Pattern}\n * @example\n * wchooseCycles([\"bd\",10], [\"hh\",1], [\"sd\",1]).s().fast(8)\n */\nexport const wchooseCycles = (...pairs) => _wchooseWith(rand, ...pairs).innerJoin();\n\nexport const wrandcat = wchooseCycles;\n\n// this function expects pat to be a pattern of floats...\nexport const perlinWith = (pat) => {\n  const pata = pat.fmap(Math.floor);\n  const patb = pat.fmap((t) => Math.floor(t) + 1);\n  const smootherStep = (x) => 6.0 * x ** 5 - 15.0 * x ** 4 + 10.0 * x ** 3;\n  const interp = (x) => (a) => (b) => a + smootherStep(x) * (b - a);\n  return pat.sub(pata).fmap(interp).appBoth(pata.fmap(timeToRand)).appBoth(patb.fmap(timeToRand));\n};\n\n/**\n * Generates a continuous pattern of [perlin noise](https://en.wikipedia.org/wiki/Perlin_noise), in the range 0..1.\n *\n * @name perlin\n * @example\n * // randomly change the cutoff\n * s(\"bd*4,hh*8\").cutoff(perlin.range(500,8000))\n *\n */\nexport const perlin = perlinWith(time.fmap((v) => Number(v)));\n\nexport const degradeByWith = register('degradeByWith', (withPat, x, pat) =>\n  pat.fmap((a) => (_) => a).appLeft(withPat.filterValues((v) => v > x)),\n);\n\n/**\n * Randomly removes events from the pattern by a given amount.\n * 0 = 0% chance of removal\n * 1 = 100% chance of removal\n *\n * @name degradeBy\n * @memberof Pattern\n * @param {number} amount - a number between 0 and 1\n * @returns Pattern\n * @example\n * s(\"hh*8\").degradeBy(0.2)\n * @example\n * s(\"[hh?0.2]*8\")\n */\nexport const degradeBy = register('degradeBy', function (x, pat) {\n  return pat._degradeByWith(rand, x);\n});\n\n/**\n *\n * Randomly removes 50% of events from the pattern. Shorthand for `.degradeBy(0.5)`\n *\n * @name degrade\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"hh*8\").degrade()\n * @example\n * s(\"[hh?]*8\")\n */\nexport const degrade = register('degrade', (pat) => pat._degradeBy(0.5));\n\n/**\n * Inverse of `degradeBy`: Randomly removes events from the pattern by a given amount.\n * 0 = 100% chance of removal\n * 1 = 0% chance of removal\n * Events that would be removed by degradeBy are let through by undegradeBy and vice versa (see second example).\n *\n * @name undegradeBy\n * @memberof Pattern\n * @param {number} amount - a number between 0 and 1\n * @returns Pattern\n * @example\n * s(\"hh*8\").undegradeBy(0.2)\n * @example\n * s(\"hh*10\").layer(\n *   x => x.degradeBy(0.2).pan(0),\n *   x => x.undegradeBy(0.8).pan(1)\n * )\n */\nexport const undegradeBy = register('undegradeBy', function (x, pat) {\n  return pat._degradeByWith(\n    rand.fmap((r) => 1 - r),\n    x,\n  );\n});\n\n/**\n * Inverse of `degrade`: Randomly removes 50% of events from the pattern. Shorthand for `.undegradeBy(0.5)`\n * Events that would be removed by degrade are let through by undegrade and vice versa (see second example).\n *\n * @name undegrade\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"hh*8\").undegrade()\n * @example\n * s(\"hh*10\").layer(\n *   x => x.degrade().pan(0),\n *   x => x.undegrade().pan(1)\n * )\n */\nexport const undegrade = register('undegrade', (pat) => pat._undegradeBy(0.5));\n\n/**\n *\n * Randomly applies the given function by the given probability.\n * Similar to `someCyclesBy`\n *\n * @name sometimesBy\n * @memberof Pattern\n * @param {number | Pattern} probability - a number between 0 and 1\n * @param {function} function - the transformation to apply\n * @returns Pattern\n * @example\n * s(\"hh*8\").sometimesBy(.4, x=>x.speed(\"0.5\"))\n */\n\nexport const sometimesBy = register('sometimesBy', function (patx, func, pat) {\n  return reify(patx)\n    .fmap((x) => stack(pat._degradeBy(x), func(pat._undegradeBy(1 - x))))\n    .innerJoin();\n});\n\n/**\n *\n * Applies the given function with a 50% chance\n *\n * @name sometimes\n * @memberof Pattern\n * @param {function} function - the transformation to apply\n * @returns Pattern\n * @example\n * s(\"hh*8\").sometimes(x=>x.speed(\"0.5\"))\n */\nexport const sometimes = register('sometimes', function (func, pat) {\n  return pat._sometimesBy(0.5, func);\n});\n\n/**\n *\n * Randomly applies the given function by the given probability on a cycle by cycle basis.\n * Similar to `sometimesBy`\n *\n * @name someCyclesBy\n * @memberof Pattern\n * @param {number | Pattern} probability - a number between 0 and 1\n * @param {function} function - the transformation to apply\n * @returns Pattern\n * @example\n * s(\"bd,hh*8\").someCyclesBy(.3, x=>x.speed(\"0.5\"))\n */\n\nexport const someCyclesBy = register('someCyclesBy', function (patx, func, pat) {\n  return reify(patx)\n    .fmap((x) =>\n      stack(\n        pat._degradeByWith(rand._segment(1), x),\n        func(pat._degradeByWith(rand.fmap((r) => 1 - r)._segment(1), 1 - x)),\n      ),\n    )\n    .innerJoin();\n});\n\n/**\n *\n * Shorthand for `.someCyclesBy(0.5, fn)`\n *\n * @name someCycles\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"bd,hh*8\").someCycles(x=>x.speed(\"0.5\"))\n */\nexport const someCycles = register('someCycles', function (func, pat) {\n  return pat._someCyclesBy(0.5, func);\n});\n\n/**\n *\n * Shorthand for `.sometimesBy(0.75, fn)`\n *\n * @name often\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"hh*8\").often(x=>x.speed(\"0.5\"))\n */\nexport const often = register('often', function (func, pat) {\n  return pat.sometimesBy(0.75, func);\n});\n\n/**\n *\n * Shorthand for `.sometimesBy(0.25, fn)`\n *\n * @name rarely\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"hh*8\").rarely(x=>x.speed(\"0.5\"))\n */\nexport const rarely = register('rarely', function (func, pat) {\n  return pat.sometimesBy(0.25, func);\n});\n\n/**\n *\n * Shorthand for `.sometimesBy(0.1, fn)`\n *\n * @name almostNever\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"hh*8\").almostNever(x=>x.speed(\"0.5\"))\n */\nexport const almostNever = register('almostNever', function (func, pat) {\n  return pat.sometimesBy(0.1, func);\n});\n\n/**\n *\n * Shorthand for `.sometimesBy(0.9, fn)`\n *\n * @name almostAlways\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"hh*8\").almostAlways(x=>x.speed(\"0.5\"))\n */\nexport const almostAlways = register('almostAlways', function (func, pat) {\n  return pat.sometimesBy(0.9, func);\n});\n\n/**\n *\n * Shorthand for `.sometimesBy(0, fn)` (never calls fn)\n *\n * @name never\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"hh*8\").never(x=>x.speed(\"0.5\"))\n */\nexport const never = register('never', function (_, pat) {\n  return pat;\n});\n\n/**\n *\n * Shorthand for `.sometimesBy(1, fn)` (always calls fn)\n *\n * @name always\n * @memberof Pattern\n * @returns Pattern\n * @example\n * s(\"hh*8\").always(x=>x.speed(\"0.5\"))\n */\nexport const always = register('always', function (func, pat) {\n  return func(pat);\n});\n","/*\nspeak.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/speak.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport { register } from './index.mjs';\n\nlet synth;\ntry {\n  synth = window?.speechSynthesis;\n} catch (err) {\n  console.warn('cannot use window: not in browser?');\n}\n\nlet allVoices = synth?.getVoices();\n// console.log('voices', allVoices);\n\nfunction triggerSpeech(words, lang, voice) {\n  synth.cancel();\n  const utterance = new SpeechSynthesisUtterance(words);\n  utterance.lang = lang;\n  allVoices = synth.getVoices();\n  const voices = allVoices.filter((v) => v.lang.includes(lang));\n  if (typeof voice === 'number') {\n    utterance.voice = voices[voice % voices.length];\n  } else if (typeof voice === 'string') {\n    utterance.voice = voices.find((voice) => voice.name === voice);\n  }\n  // console.log(utterance.voice?.name, utterance.voice?.lang);\n  speechSynthesis.speak(utterance);\n}\n\nexport const speak = register('speak', function (lang, voice, pat) {\n  return pat.onTrigger((_, hap) => {\n    triggerSpeech(hap.value, lang, voice);\n  });\n});\n","/*\nevaluate.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/evaluate.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport { isPattern } from './index.mjs';\n\nexport const evalScope = async (...args) => {\n  const results = await Promise.allSettled(args);\n  const modules = results.filter((result) => result.status === 'fulfilled').map((r) => r.value);\n  results.forEach((result, i) => {\n    if (result.status === 'rejected') {\n      console.warn(`evalScope: module with index ${i} could not be loaded:`, result.reason);\n    }\n  });\n  // Object.assign(globalThis, ...modules);\n  // below is a fix for above commented out line\n  // same error as https://github.com/vitest-dev/vitest/issues/1807 when running this on astro server\n  modules.forEach((module) => {\n    Object.entries(module).forEach(([name, value]) => {\n      globalThis[name] = value;\n    });\n  });\n  return modules;\n};\n\nfunction safeEval(str, options = {}) {\n  const { wrapExpression = true, wrapAsync = true } = options;\n  if (wrapExpression) {\n    str = `{${str}}`;\n  }\n  if (wrapAsync) {\n    str = `(async ()=>${str})()`;\n  }\n  const body = `\"use strict\";return (${str})`;\n  return Function(body)();\n}\n\nexport const evaluate = async (code, transpiler) => {\n  let meta = {};\n  if (transpiler) {\n    // transform syntactically correct js code to semantically usable code\n    const transpiled = transpiler(code);\n    code = transpiled.output;\n    meta = transpiled;\n  }\n  // if no transpiler is given, we expect a single instruction (!wrapExpression)\n  const options = { wrapExpression: !!transpiler };\n  let evaluated = await safeEval(code, options);\n  return { mode: 'javascript', pattern: evaluated, meta };\n};\n","/*\nneocyclist.mjs - event scheduler like cyclist, except recieves clock pulses from clockworker in order to sync across multiple instances.\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/neocyclist.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport { logger } from './logger.mjs';\n\nexport class NeoCyclist {\n  constructor({ onTrigger, onToggle, getTime }) {\n    this.started = false;\n    this.cps = 0.5;\n    this.lastTick = 0; // absolute time when last tick (clock callback) happened\n    this.getTime = getTime; // get absolute time\n    this.time_at_last_tick_message = 0;\n\n    this.num_cycles_at_cps_change = 0;\n    this.onToggle = onToggle;\n    this.latency = 0.1; // fixed trigger time offset\n    this.cycle = 0;\n    this.id = Math.round(Date.now() * Math.random());\n    this.worker_time_dif;\n    this.worker = new SharedWorker(new URL('./clockworker.js', import.meta.url));\n    this.worker.port.start();\n\n    this.channel = new BroadcastChannel('strudeltick');\n    let weight = 0; // the amount of weight that is applied to the current average when averaging a new time dif\n    const maxWeight = 20;\n    const precision = 10 ** 3; //round off time diff to prevent accumulating outliers\n\n    // the clock of the worker and the audio context clock can drift apart over time\n    // aditionally, the message time of the worker pinging the callback to process haps can be inconsistent.\n    // we need to keep a rolling weighted average of the time difference between the worker clock and audio context clock\n    // in order to schedule events consistently.\n    const setTimeReference = (num_seconds_at_cps_change, num_seconds_since_cps_change, tickdeadline) => {\n      const time_dif = getTime() - (num_seconds_at_cps_change + num_seconds_since_cps_change) + tickdeadline;\n      if (this.worker_time_dif == null) {\n        this.worker_time_dif = time_dif;\n      } else {\n        const w = 1; //weight of new time diff;\n        const new_dif =\n          Math.round(((this.worker_time_dif * weight + time_dif * w) / (weight + w)) * precision) / precision;\n\n        if (new_dif != this.worker_time_dif) {\n          // reset the weight so the clock recovers faster from an audio context freeze/dropout if it happens\n          weight = 4;\n        }\n        this.worker_time_dif = new_dif;\n      }\n      weight = Math.min(weight + 1, maxWeight);\n    };\n\n    const tickCallback = (payload) => {\n      const {\n        num_cycles_at_cps_change,\n        cps,\n        num_seconds_at_cps_change,\n        num_seconds_since_cps_change,\n        begin,\n        end,\n        tickdeadline,\n        cycle,\n      } = payload;\n      this.cps = cps;\n      this.cycle = cycle;\n\n      setTimeReference(num_seconds_at_cps_change, num_seconds_since_cps_change, tickdeadline);\n\n      processHaps(begin, end, num_cycles_at_cps_change, num_seconds_at_cps_change);\n\n      this.time_at_last_tick_message = this.getTime();\n    };\n\n    const processHaps = (begin, end, num_cycles_at_cps_change, seconds_at_cps_change) => {\n      if (this.started === false) {\n        return;\n      }\n\n      const haps = this.pattern.queryArc(begin, end, { _cps: this.cps });\n\n      haps.forEach((hap) => {\n        if (hap.hasOnset()) {\n          const targetTime =\n            (hap.whole.begin - num_cycles_at_cps_change) / this.cps +\n            seconds_at_cps_change +\n            this.latency +\n            this.worker_time_dif;\n          const duration = hap.duration / this.cps;\n          onTrigger?.(hap, 0, duration, this.cps, targetTime);\n        }\n      });\n    };\n\n    // receive messages from worker clock and process them\n    this.channel.onmessage = (message) => {\n      if (!this.started) {\n        return;\n      }\n      const { payload, type } = message.data;\n\n      switch (type) {\n        case 'tick': {\n          tickCallback(payload);\n        }\n      }\n    };\n  }\n  sendMessage(type, payload) {\n    this.worker.port.postMessage({ type, payload, id: this.id });\n  }\n\n  now() {\n    const gap = (this.getTime() - this.time_at_last_tick_message) * this.cps;\n    return this.cycle + gap;\n  }\n  setCps(cps = 1) {\n    this.sendMessage('cpschange', { cps });\n  }\n  setCycle(cycle) {\n    this.sendMessage('setcycle', { cycle });\n  }\n  setStarted(started) {\n    this.sendMessage('toggle', { started });\n    this.started = started;\n    this.onToggle?.(started);\n  }\n  start() {\n    logger('[cyclist] start');\n    this.setStarted(true);\n  }\n  stop() {\n    this.worker_time_dif = null;\n    logger('[cyclist] stop');\n    this.setStarted(false);\n  }\n  setPattern(pat, autostart = false) {\n    this.pattern = pat;\n    if (autostart && !this.started) {\n      this.start();\n    }\n  }\n\n  log(begin, end, haps) {\n    const onsets = haps.filter((h) => h.hasOnset());\n    console.log(`${begin.toFixed(4)} - ${end.toFixed(4)} ${Array(onsets.length).fill('I').join('')}`);\n  }\n}\n","/*\ncyclist.mjs - event scheduler for a single strudel instance. for multi-instance scheduler, see - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/neocyclist.mjs>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/cyclist.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport createClock from './zyklus.mjs';\nimport { logger } from './logger.mjs';\n\nexport class Cyclist {\n  constructor({ interval, onTrigger, onToggle, onError, getTime, latency = 0.1, setInterval, clearInterval }) {\n    this.started = false;\n    this.cps = 0.5;\n    this.num_ticks_since_cps_change = 0;\n    this.lastTick = 0; // absolute time when last tick (clock callback) happened\n    this.lastBegin = 0; // query begin of last tick\n    this.lastEnd = 0; // query end of last tick\n    this.getTime = getTime; // get absolute time\n    this.num_cycles_at_cps_change = 0;\n    this.seconds_at_cps_change; // clock phase when cps was changed\n    this.onToggle = onToggle;\n    this.latency = latency; // fixed trigger time offset\n    this.clock = createClock(\n      getTime,\n      // called slightly before each cycle\n      (phase, duration, _, t) => {\n        if (this.num_ticks_since_cps_change === 0) {\n          this.num_cycles_at_cps_change = this.lastEnd;\n          this.seconds_at_cps_change = phase;\n        }\n        this.num_ticks_since_cps_change++;\n        const seconds_since_cps_change = this.num_ticks_since_cps_change * duration;\n        const num_cycles_since_cps_change = seconds_since_cps_change * this.cps;\n\n        try {\n          const begin = this.lastEnd;\n          this.lastBegin = begin;\n          const end = this.num_cycles_at_cps_change + num_cycles_since_cps_change;\n          this.lastEnd = end;\n\n          // query the pattern for events\n          const haps = this.pattern.queryArc(begin, end, { _cps: this.cps });\n\n          this.lastTick = phase;\n\n          haps.forEach((hap) => {\n            if (hap.hasOnset()) {\n              const targetTime =\n                (hap.whole.begin - this.num_cycles_at_cps_change) / this.cps + this.seconds_at_cps_change + latency;\n              const duration = hap.duration / this.cps;\n              // the following line is dumb and only here for backwards compatibility\n              // see https://github.com/tidalcycles/strudel/pull/1004\n              const deadline = targetTime - phase;\n              onTrigger?.(hap, deadline, duration, this.cps, targetTime);\n            }\n          });\n        } catch (e) {\n          logger(`[cyclist] error: ${e.message}`);\n          onError?.(e);\n        }\n      },\n      interval, // duration of each cycle\n      0.1,\n      0.1,\n      setInterval,\n      clearInterval,\n    );\n  }\n  now() {\n    if (!this.started) {\n      return 0;\n    }\n    const secondsSinceLastTick = this.getTime() - this.lastTick - this.clock.duration;\n    return this.lastBegin + secondsSinceLastTick * this.cps; // + this.clock.minLatency;\n  }\n  setStarted(v) {\n    this.started = v;\n    this.onToggle?.(v);\n  }\n  start() {\n    this.num_ticks_since_cps_change = 0;\n    this.num_cycles_at_cps_change = 0;\n    if (!this.pattern) {\n      throw new Error('Scheduler: no pattern set! call .setPattern first.');\n    }\n    logger('[cyclist] start');\n    this.clock.start();\n    this.setStarted(true);\n    globalThis.haps_from_outputs = null;\n  }\n  pause() {\n    logger('[cyclist] pause');\n    this.clock.pause();\n    this.setStarted(false);\n  }\n  stop() {\n    logger('[cyclist] stop');\n    this.clock.stop();\n    this.lastEnd = 0;\n    this.setStarted(false);\n  }\n  setPattern(pat, autostart = false) {\n    this.pattern = pat;\n    if (autostart && !this.started) {\n      this.start();\n    }\n  }\n  setCps(cps = 0.5) {\n    if (this.cps === cps) {\n      return;\n    }\n    this.cps = cps;\n    this.num_ticks_since_cps_change = 0;\n  }\n  log(begin, end, haps) {\n    const onsets = haps.filter((h) => h.hasOnset());\n    console.log(`${begin.toFixed(4)} - ${end.toFixed(4)} ${Array(onsets.length).fill('I').join('')}`);\n  }\n}\n","let time;\nexport function getTime() {\n  if (!time) {\n    throw new Error('no time set! use setTime to define a time source');\n  }\n  return time();\n}\n\nexport function setTime(func) {\n  time = func;\n}\n","import { NeoCyclist } from './neocyclist.mjs';\nimport { Cyclist } from './cyclist.mjs';\nimport { evaluate as _evaluate } from './evaluate.mjs';\nimport { logger } from './logger.mjs';\nimport { setTime } from './time.mjs';\nimport { evalScope } from './evaluate.mjs';\nimport { register, Pattern, isPattern, silence, stack } from './pattern.mjs';\n\nexport function repl({\n  defaultOutput,\n  onEvalError,\n  beforeEval,\n  afterEval,\n  getTime,\n  transpiler,\n  onToggle,\n  editPattern,\n  onUpdateState,\n  sync = false,\n  setInterval,\n  clearInterval,\n}) {\n  const state = {\n    schedulerError: undefined,\n    evalError: undefined,\n    code: '// LOADING',\n    activeCode: '// LOADING',\n    pattern: undefined,\n    miniLocations: [],\n    widgets: [],\n    pending: false,\n    started: false,\n  };\n\n  const updateState = (update) => {\n    Object.assign(state, update);\n    state.isDirty = state.code !== state.activeCode;\n    state.error = state.evalError || state.schedulerError;\n    onUpdateState?.(state);\n  };\n\n  const schedulerOptions = {\n    onTrigger: getTrigger({ defaultOutput, getTime }),\n    getTime,\n    onToggle: (started) => {\n      updateState({ started });\n      onToggle?.(started);\n    },\n    setInterval,\n    clearInterval,\n  };\n\n  // NeoCyclist uses a shared worker to communicate between instances, which is not supported on mobile chrome\n  const scheduler =\n    sync && typeof SharedWorker != 'undefined' ? new NeoCyclist(schedulerOptions) : new Cyclist(schedulerOptions);\n  let pPatterns = {};\n  let allTransform;\n\n  const hush = function () {\n    pPatterns = {};\n    allTransform = undefined;\n    return silence;\n  };\n\n  const setPattern = (pattern, autostart = true) => {\n    pattern = editPattern?.(pattern) || pattern;\n    scheduler.setPattern(pattern, autostart);\n  };\n  setTime(() => scheduler.now()); // TODO: refactor?\n\n  const stop = () => scheduler.stop();\n  const start = () => scheduler.start();\n  const pause = () => scheduler.pause();\n  const toggle = () => scheduler.toggle();\n  const setCps = (cps) => scheduler.setCps(cps);\n  const setCpm = (cpm) => scheduler.setCps(cpm / 60);\n  const all = function (transform) {\n    allTransform = transform;\n    return silence;\n  };\n\n  // set pattern methods that use this repl via closure\n  const injectPatternMethods = () => {\n    Pattern.prototype.p = function (id) {\n      pPatterns[id] = this;\n      return this;\n    };\n    Pattern.prototype.q = function (id) {\n      return silence;\n    };\n    try {\n      for (let i = 1; i < 10; ++i) {\n        Object.defineProperty(Pattern.prototype, `d${i}`, {\n          get() {\n            return this.p(i);\n          },\n          configurable: true,\n        });\n        Object.defineProperty(Pattern.prototype, `p${i}`, {\n          get() {\n            return this.p(i);\n          },\n          configurable: true,\n        });\n        Pattern.prototype[`q${i}`] = silence;\n      }\n    } catch (err) {\n      console.warn('injectPatternMethods: error:', err);\n    }\n    const cpm = register('cpm', function (cpm, pat) {\n      return pat._fast(cpm / 60 / scheduler.cps);\n    });\n    return evalScope({\n      all,\n      hush,\n      cpm,\n      setCps,\n      setcps: setCps,\n      setCpm,\n      setcpm: setCpm,\n    });\n  };\n\n  const evaluate = async (code, autostart = true, shouldHush = true) => {\n    if (!code) {\n      throw new Error('no code to evaluate');\n    }\n    try {\n      updateState({ code, pending: true });\n      await injectPatternMethods();\n      await beforeEval?.({ code });\n      shouldHush && hush();\n      let { pattern, meta } = await _evaluate(code, transpiler);\n      if (Object.keys(pPatterns).length) {\n        pattern = stack(...Object.values(pPatterns));\n      }\n      if (allTransform) {\n        pattern = allTransform(pattern);\n      }\n      if (!isPattern(pattern)) {\n        const message = `got \"${typeof evaluated}\" instead of pattern`;\n        throw new Error(message + (typeof evaluated === 'function' ? ', did you forget to call a function?' : '.'));\n      }\n      logger(`[eval] code updated`);\n      setPattern(pattern, autostart);\n      updateState({\n        miniLocations: meta?.miniLocations || [],\n        widgets: meta?.widgets || [],\n        activeCode: code,\n        pattern,\n        evalError: undefined,\n        schedulerError: undefined,\n        pending: false,\n      });\n      afterEval?.({ code, pattern, meta });\n      return pattern;\n    } catch (err) {\n      logger(`[eval] error: ${err.message}`, 'error');\n      updateState({ evalError: err, pending: false });\n      onEvalError?.(err);\n    }\n  };\n  const setCode = (code) => updateState({ code });\n  return { scheduler, evaluate, start, stop, pause, setCps, setPattern, setCode, toggle, state };\n}\n\nexport const getTrigger =\n  ({ getTime, defaultOutput }) =>\n  async (hap, deadline, duration, cps, t) => {\n    // TODO: get rid of deadline after https://github.com/tidalcycles/strudel/pull/1004\n    try {\n      if (!hap.context.onTrigger || !hap.context.dominantTrigger) {\n        await defaultOutput(hap, deadline, duration, cps, t);\n      }\n      if (hap.context.onTrigger) {\n        // call signature of output / onTrigger is different...\n        await hap.context.onTrigger(getTime() + deadline, hap, getTime(), cps, t);\n      }\n    } catch (err) {\n      logger(`[cyclist] error: ${err.message}`, 'error');\n    }\n  };\n","/*\nui.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/ui.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nexport const backgroundImage = function (src, animateOptions = {}) {\n  const container = document.getElementById('code');\n  const bg = 'background-image:url(' + src + ');background-size:contain;';\n  container.style = bg;\n  const { className: initialClassName } = container;\n  const handleOption = (option, value) => {\n    ({\n      style: () => (container.style = bg + ';' + value),\n      className: () => (container.className = value + ' ' + initialClassName),\n    })[option]();\n  };\n  const funcOptions = Object.entries(animateOptions).filter(([_, v]) => typeof v === 'function');\n  const stringOptions = Object.entries(animateOptions).filter(([_, v]) => typeof v === 'string');\n  stringOptions.forEach(([option, value]) => handleOption(option, value));\n\n  if (funcOptions.length === 0) {\n    return;\n  }\n};\n\nexport const cleanupUi = () => {\n  const container = document.getElementById('code');\n  if (container) {\n    container.style = '';\n  }\n};\n","/*\nindex.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/core/index.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport * as controls from './controls.mjs'; // legacy\nexport * from './euclid.mjs';\nimport Fraction from './fraction.mjs';\nimport createClock from './zyklus.mjs';\nimport { logger } from './logger.mjs';\nexport { Fraction, controls, createClock };\nexport * from './controls.mjs';\nexport * from './hap.mjs';\nexport * from './pattern.mjs';\nexport * from './signal.mjs';\nexport * from './state.mjs';\nexport * from './timespan.mjs';\nexport * from './util.mjs';\nexport * from './speak.mjs';\nexport * from './evaluate.mjs';\nexport * from './repl.mjs';\nexport * from './cyclist.mjs';\nexport * from './logger.mjs';\nexport * from './time.mjs';\nexport * from './ui.mjs';\nexport { default as drawLine } from './drawLine.mjs';\n// below won't work with runtime.mjs (json import fails)\n/* import * as p from './package.json';\nexport const version = p.version; */\nlogger('🌀 @strudel/core loaded 🌀');\nif (globalThis._strudelLoaded) {\n  console.warn(\n    `@strudel/core was loaded more than once...\nThis might happen when you have multiple versions of strudel installed. \nPlease check with \"npm ls @strudel/core\".`,\n  );\n}\nglobalThis._strudelLoaded = true;\n","/*\ndraw.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/canvas/draw.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport { Pattern, getTime, State, TimeSpan } from '@strudel/core';\n\nexport const getDrawContext = (id = 'test-canvas', options) => {\n  let { contextType = '2d', pixelated = false, pixelRatio = window.devicePixelRatio } = options || {};\n  let canvas = document.querySelector('#' + id);\n  if (!canvas) {\n    canvas = document.createElement('canvas');\n    canvas.id = id;\n    canvas.width = window.innerWidth * pixelRatio;\n    canvas.height = window.innerHeight * pixelRatio;\n    canvas.style = 'pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0';\n    pixelated && (canvas.style.imageRendering = 'pixelated');\n    document.body.prepend(canvas);\n    let timeout;\n    window.addEventListener('resize', () => {\n      timeout && clearTimeout(timeout);\n      timeout = setTimeout(() => {\n        canvas.width = window.innerWidth * pixelRatio;\n        canvas.height = window.innerHeight * pixelRatio;\n      }, 200);\n    });\n  }\n  return canvas.getContext(contextType);\n};\n\nlet animationFrames = {};\nfunction stopAnimationFrame(id) {\n  if (animationFrames[id] !== undefined) {\n    cancelAnimationFrame(animationFrames[id]);\n    delete animationFrames[id];\n  }\n}\nfunction stopAllAnimations() {\n  Object.keys(animationFrames).forEach((id) => stopAnimationFrame(id));\n}\n\nlet memory = {};\nPattern.prototype.draw = function (fn, options) {\n  if (typeof window === 'undefined') {\n    return this;\n  }\n  let { id = 1, lookbehind = 0, lookahead = 0 } = options;\n  let __t = Math.max(getTime(), 0);\n  stopAnimationFrame(id);\n  lookbehind = Math.abs(lookbehind);\n  // init memory, clear future haps of old pattern\n  memory[id] = (memory[id] || []).filter((h) => !h.isInFuture(__t));\n  let newFuture = this.queryArc(__t, __t + lookahead).filter((h) => h.hasOnset());\n  memory[id] = memory[id].concat(newFuture);\n\n  let last;\n  const animate = () => {\n    const _t = getTime();\n    const t = _t + lookahead;\n    // filter out haps that are too far in the past\n    memory[id] = memory[id].filter((h) => h.isInNearPast(lookbehind, _t));\n    // begin where we left off in last frame, but max -0.1s (inactive tab throttles to 1fps)\n    let begin = Math.max(last || t, t - 1 / 10);\n    const haps = this.queryArc(begin, t).filter((h) => h.hasOnset());\n    memory[id] = memory[id].concat(haps);\n    last = t; // makes sure no haps are missed\n    fn(memory[id], _t, t, this);\n    animationFrames[id] = requestAnimationFrame(animate);\n  };\n  animationFrames[id] = requestAnimationFrame(animate);\n  return this;\n};\n\nexport const cleanupDraw = (clearScreen = true) => {\n  const ctx = getDrawContext();\n  clearScreen && ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.width);\n  stopAllAnimations();\n  if (window.strudelScheduler) {\n    clearInterval(window.strudelScheduler);\n  }\n};\n\nPattern.prototype.onPaint = function () {\n  console.warn('[draw] onPaint was not overloaded. Some drawings might not work');\n  return this;\n};\n\n// const round = (x) => Math.round(x * 1000) / 1000;\n\n// encapsulates starting and stopping animation frames\nexport class Framer {\n  constructor(onFrame, onError) {\n    this.onFrame = onFrame;\n    this.onError = onError;\n  }\n  start() {\n    const self = this;\n    let frame = requestAnimationFrame(function updateHighlights(time) {\n      try {\n        self.onFrame(time);\n      } catch (err) {\n        self.onError(err);\n      }\n      frame = requestAnimationFrame(updateHighlights);\n    });\n    self.cancel = () => {\n      cancelAnimationFrame(frame);\n    };\n  }\n  stop() {\n    if (this.cancel) {\n      this.cancel();\n    }\n  }\n}\n\n// syncs animation frames to a cyclist scheduler\n// see vite-vanilla-repl-cm6 for an example\nexport class Drawer {\n  constructor(onDraw, drawTime) {\n    this.visibleHaps = [];\n    this.lastFrame = null;\n    this.drawTime = drawTime;\n    this.framer = new Framer(\n      () => {\n        if (!this.scheduler) {\n          console.warn('Drawer: no scheduler');\n          return;\n        }\n        const lookbehind = Math.abs(this.drawTime[0]);\n        const lookahead = this.drawTime[1];\n        // calculate current frame time (think right side of screen for pianoroll)\n        const phase = this.scheduler.now() + lookahead;\n        // first frame just captures the phase\n        if (this.lastFrame === null) {\n          this.lastFrame = phase;\n          return;\n        }\n        // query haps from last frame till now. take last 100ms max\n        const haps = this.scheduler.pattern.queryArc(Math.max(this.lastFrame, phase - 1 / 10), phase);\n        this.lastFrame = phase;\n        this.visibleHaps = (this.visibleHaps || [])\n          // filter out haps that are too far in the past (think left edge of screen for pianoroll)\n          .filter((h) => h.endClipped >= phase - lookbehind - lookahead)\n          // add new haps with onset (think right edge bars scrolling in)\n          .concat(haps.filter((h) => h.hasOnset()));\n        const time = phase - lookahead;\n        onDraw(this.visibleHaps, time, this);\n      },\n      (err) => {\n        console.warn('draw error', err);\n      },\n    );\n  }\n  setDrawTime(drawTime) {\n    this.drawTime = drawTime;\n  }\n  invalidate(scheduler = this.scheduler, t) {\n    if (!scheduler) {\n      return;\n    }\n    // TODO: scheduler.now() seems to move even when it's stopped, this hints at a bug...\n    t = t ?? scheduler.now();\n    this.scheduler = scheduler;\n    let [_, lookahead] = this.drawTime;\n    const [begin, end] = [Math.max(t, 0), t + lookahead + 0.1];\n    // remove all future haps\n    this.visibleHaps = this.visibleHaps.filter((h) => h.whole.begin < t);\n    // query future haps\n    const futureHaps = scheduler.pattern.queryArc(begin, end); // +0.1 = workaround for weird holes in query..\n    // append future haps\n    this.visibleHaps = this.visibleHaps.concat(futureHaps);\n  }\n  start(scheduler) {\n    this.scheduler = scheduler;\n    this.invalidate();\n    this.framer.start();\n  }\n  stop() {\n    if (this.framer) {\n      this.framer.stop();\n    }\n  }\n}\n\nexport function getComputedPropertyValue(name) {\n  if (typeof window === 'undefined') {\n    return '#fff';\n  }\n  return getComputedStyle(document.documentElement).getPropertyValue(name);\n}\n\nlet theme = {};\nexport function getTheme() {\n  return theme;\n}\nexport function setTheme(_theme) {\n  theme = _theme;\n}\n","import { Pattern, silence, register, pure, createParams } from '@strudel/core';\nimport { getDrawContext } from './draw.mjs';\n\nlet clearColor = '#22222210';\n\nPattern.prototype.animate = function ({ callback, sync = false, smear = 0.5 } = {}) {\n  window.frame && cancelAnimationFrame(window.frame);\n  const ctx = getDrawContext();\n  let { clientWidth: ww, clientHeight: wh } = ctx.canvas;\n  ww *= window.devicePixelRatio;\n  wh *= window.devicePixelRatio;\n  let smearPart = smear === 0 ? '99' : Number((1 - smear) * 100).toFixed(0);\n  smearPart = smearPart.length === 1 ? `0${smearPart}` : smearPart;\n  clearColor = `#200010${smearPart}`;\n  const render = (t) => {\n    let frame;\n    /*     if (sync) {\n      t = scheduler.now();\n      frame = this.queryArc(t, t);\n    } else { */\n    t = Math.round(t);\n    frame = this.slow(1000).queryArc(t, t);\n    // }\n    ctx.fillStyle = clearColor;\n    ctx.fillRect(0, 0, ww, wh);\n    frame.forEach((f) => {\n      let { x, y, w, h, s, r, angle = 0, fill = 'darkseagreen' } = f.value;\n      w *= ww;\n      h *= wh;\n      if (r !== undefined && angle !== undefined) {\n        const radians = angle * 2 * Math.PI;\n        const [cx, cy] = [(ww - w) / 2, (wh - h) / 2];\n        x = cx + Math.cos(radians) * r * cx;\n        y = cy + Math.sin(radians) * r * cy;\n      } else {\n        x *= ww - w;\n        y *= wh - h;\n      }\n      const val = { ...f.value, x, y, w, h };\n      ctx.fillStyle = fill;\n      if (s === 'rect') {\n        ctx.fillRect(x, y, w, h);\n      } else if (s === 'ellipse') {\n        ctx.beginPath();\n        ctx.ellipse(x + w / 2, y + h / 2, w / 2, h / 2, 0, 0, 2 * Math.PI);\n        ctx.fill();\n      }\n      callback && callback(ctx, val, f);\n    });\n    window.frame = requestAnimationFrame(render);\n  };\n  window.frame = requestAnimationFrame(render);\n  return silence;\n};\n\nexport const { x, y, w, h, angle, r, fill, smear } = createParams('x', 'y', 'w', 'h', 'angle', 'r', 'fill', 'smear');\n\nexport const rescale = register('rescale', function (f, pat) {\n  return pat.mul(x(f).w(f).y(f).h(f));\n});\n\nexport const moveXY = register('moveXY', function (dx, dy, pat) {\n  return pat.add(x(dx).y(dy));\n});\n\nexport const zoomIn = register('zoomIn', function (f, pat) {\n  const d = pure(1).sub(f).div(2);\n  return pat.rescale(f).move(d, d);\n});\n","/*\npianoroll.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/canvas/pianoroll.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport { Pattern, noteToMidi, freqToMidi } from '@strudel/core';\nimport { getTheme, getDrawContext } from './draw.mjs';\n\nconst scale = (normalized, min, max) => normalized * (max - min) + min;\nconst getValue = (e) => {\n  let { value } = e;\n  if (typeof e.value !== 'object') {\n    value = { value };\n  }\n  let { note, n, freq, s } = value;\n  if (freq) {\n    return freqToMidi(freq);\n  }\n  note = note ?? n;\n  if (typeof note === 'string') {\n    try {\n      // TODO: n(run(32)).scale(\"D:minor\") fails when trying to query negative time..\n      return noteToMidi(note);\n    } catch (err) {\n      // console.warn(`error converting note to midi: ${err}`); // this spams to crazy\n      return 0;\n    }\n  }\n  if (typeof note === 'number') {\n    return note;\n  }\n  if (s) {\n    return '_' + s;\n  }\n  return value;\n};\n\nPattern.prototype.pianoroll = function (options = {}) {\n  let { cycles = 4, playhead = 0.5, overscan = 0, hideNegative = false, ctx = getDrawContext(), id = 1 } = options;\n\n  let from = -cycles * playhead;\n  let to = cycles * (1 - playhead);\n  const inFrame = (hap, t) => (!hideNegative || hap.whole.begin >= 0) && hap.isWithinTime(t + from, t + to);\n  this.draw(\n    (haps, time) => {\n      pianoroll({\n        ...options,\n        time,\n        ctx,\n        haps: haps.filter((hap) => inFrame(hap, time)),\n      });\n    },\n    {\n      lookbehind: from - overscan,\n      lookahead: to + overscan,\n      id,\n    },\n  );\n  return this;\n};\n\n// this function allows drawing a pianoroll without ties to Pattern.prototype\n// it will probably replace the above in the future\n\n/**\n * Displays a midi-style piano roll\n *\n * @name pianoroll\n * @param {Object} options Object containing all the optional following parameters as key value pairs:\n * @param {integer} cycles number of cycles to be displayed at the same time - defaults to 4\n * @param {number} playhead location of the active notes on the time axis - 0 to 1, defaults to 0.5\n * @param {boolean} vertical displays the roll vertically - 0 by default\n * @param {boolean} labels displays labels on individual notes (see the label function) - 0 by default\n * @param {boolean} flipTime reverse the direction of the roll - 0 by default\n * @param {boolean} flipValues reverse the relative location of notes on the value axis - 0 by default\n * @param {number} overscan lookup X cycles outside of the cycles window to display notes in advance - 1 by default\n * @param {boolean} hideNegative hide notes with negative time (before starting playing the pattern) - 0 by default\n * @param {boolean} smear notes leave a solid trace - 0 by default\n * @param {boolean} fold notes takes the full value axis width - 0 by default\n * @param {string} active hexadecimal or CSS color of the active notes - defaults to #FFCA28\n * @param {string} inactive hexadecimal or CSS color of the inactive notes - defaults to #7491D2\n * @param {string} background hexadecimal or CSS color of the background - defaults to transparent\n * @param {string} playheadColor hexadecimal or CSS color of the line representing the play head - defaults to white\n * @param {boolean} fill notes are filled with color (otherwise only the label is displayed) - 0 by default\n * @param {boolean} fillActive active notes are filled with color - 0 by default\n * @param {boolean} stroke notes are shown with colored borders - 0 by default\n * @param {boolean} strokeActive active notes are shown with colored borders - 0 by default\n * @param {boolean} hideInactive only active notes are shown - 0 by default\n * @param {boolean} colorizeInactive use note color for inactive notes - 1 by default\n * @param {string} fontFamily define the font used by notes labels - defaults to 'monospace'\n * @param {integer} minMidi minimum note value to display on the value axis - defaults to 10\n * @param {integer} maxMidi maximum note value to display on the value axis - defaults to 90\n * @param {boolean} autorange automatically calculate the minMidi and maxMidi parameters - 0 by default\n *\n * @example\n * note(\"C2 A2 G2\").euclid(5,8).s('piano').clip(1).color('salmon').pianoroll({vertical:1, labels:1})\n */\nexport function pianoroll({\n  time,\n  haps,\n  cycles = 4,\n  playhead = 0.5,\n  flipTime = 0,\n  flipValues = 0,\n  hideNegative = false,\n  inactive = getTheme().foreground,\n  active = getTheme().foreground,\n  background = 'transparent',\n  smear = 0,\n  playheadColor = 'white',\n  minMidi = 10,\n  maxMidi = 90,\n  autorange = 0,\n  timeframe: timeframeProp,\n  fold = 0,\n  vertical = 0,\n  labels = false,\n  fill = 1,\n  fillActive = false,\n  strokeActive = true,\n  stroke,\n  hideInactive = 0,\n  colorizeInactive = 1,\n  fontFamily,\n  ctx,\n  id,\n} = {}) {\n  const w = ctx.canvas.width;\n  const h = ctx.canvas.height;\n  let from = -cycles * playhead;\n  let to = cycles * (1 - playhead);\n\n  if (id) {\n    haps = haps.filter((hap) => hap.hasTag(id));\n  }\n\n  if (timeframeProp) {\n    console.warn('timeframe is deprecated! use from/to instead');\n    from = 0;\n    to = timeframeProp;\n  }\n  const timeAxis = vertical ? h : w;\n  const valueAxis = vertical ? w : h;\n  let timeRange = vertical ? [timeAxis, 0] : [0, timeAxis]; // pixel range for time\n  const timeExtent = to - from; // number of seconds that fit inside the canvas frame\n  const valueRange = vertical ? [0, valueAxis] : [valueAxis, 0]; // pixel range for values\n  let valueExtent = maxMidi - minMidi + 1; // number of \"slots\" for values, overwritten if autorange true\n  let barThickness = valueAxis / valueExtent; // pixels per value, overwritten if autorange true\n  let foldValues = [];\n  flipTime && timeRange.reverse();\n  flipValues && valueRange.reverse();\n\n  // onQuery\n  const { min, max, values } = haps.reduce(\n    ({ min, max, values }, e) => {\n      const v = getValue(e);\n      return {\n        min: v < min ? v : min,\n        max: v > max ? v : max,\n        values: values.includes(v) ? values : [...values, v],\n      };\n    },\n    { min: Infinity, max: -Infinity, values: [] },\n  );\n  if (autorange) {\n    minMidi = min;\n    maxMidi = max;\n    valueExtent = maxMidi - minMidi + 1;\n  }\n  foldValues = values.sort((a, b) =>\n    typeof a === 'number' && typeof b === 'number'\n      ? a - b\n      : typeof a === 'number'\n        ? 1\n        : String(a).localeCompare(String(b)),\n  );\n  barThickness = fold ? valueAxis / foldValues.length : valueAxis / valueExtent;\n  ctx.fillStyle = background;\n  ctx.globalAlpha = 1; // reset!\n  if (!smear) {\n    ctx.clearRect(0, 0, w, h);\n    ctx.fillRect(0, 0, w, h);\n  }\n  haps.forEach((event) => {\n    const isActive = event.whole.begin <= time && event.endClipped > time;\n    let strokeCurrent = stroke ?? (strokeActive && isActive);\n    let fillCurrent = (!isActive && fill) || (isActive && fillActive);\n    if (hideInactive && !isActive) {\n      return;\n    }\n    let color = event.value?.color;\n    active = color || active;\n    inactive = colorizeInactive ? color || inactive : inactive;\n    color = isActive ? active : inactive;\n    ctx.fillStyle = fillCurrent ? color : 'transparent';\n    ctx.strokeStyle = color;\n    const { velocity = 1, gain = 1 } = event.value || {};\n    ctx.globalAlpha = velocity * gain;\n    const timeProgress = (event.whole.begin - (flipTime ? to : from)) / timeExtent;\n    const timePx = scale(timeProgress, ...timeRange);\n    let durationPx = scale(event.duration / timeExtent, 0, timeAxis);\n    const value = getValue(event);\n    const valueProgress = fold\n      ? foldValues.indexOf(value) / foldValues.length\n      : (Number(value) - minMidi) / valueExtent;\n    const valuePx = scale(valueProgress, ...valueRange);\n    let margin = 0;\n    const offset = scale(time / timeExtent, ...timeRange);\n    let coords;\n    if (vertical) {\n      coords = [\n        valuePx + 1 - (flipValues ? barThickness : 0), // x\n        timeAxis - offset + timePx + margin + 1 - (flipTime ? 0 : durationPx), // y\n        barThickness - 2, // width\n        durationPx - 2, // height\n      ];\n    } else {\n      coords = [\n        timePx - offset + margin + 1 - (flipTime ? durationPx : 0), // x\n        valuePx + 1 - (flipValues ? 0 : barThickness), // y\n        durationPx - 2, // widith\n        barThickness - 2, // height\n      ];\n    }\n    /* const xFactor = Math.sin(performance.now() / 500) + 1;\n      coords[0] *= xFactor; */\n\n    if (strokeCurrent) {\n      ctx.strokeRect(...coords);\n    }\n    if (fillCurrent) {\n      ctx.fillRect(...coords);\n    }\n    //ctx.ellipse(...ellipseFromRect(...coords))\n    if (labels) {\n      const defaultLabel = event.value.note ?? event.value.s + (event.value.n ? `:${event.value.n}` : '');\n      const { label: inactiveLabel, activeLabel } = event.value;\n      const customLabel = isActive ? activeLabel || inactiveLabel : inactiveLabel;\n      const label = customLabel ?? defaultLabel;\n      let measure = vertical ? durationPx : barThickness * 0.75;\n      ctx.font = `${measure}px ${fontFamily || 'monospace'}`;\n      // font color\n      ctx.fillStyle = /* isActive &&  */ !fillCurrent ? color : 'black';\n      ctx.textBaseline = 'top';\n      ctx.fillText(label, ...coords);\n    }\n  });\n  ctx.globalAlpha = 1; // reset!\n  const playheadPosition = scale(-from / timeExtent, ...timeRange);\n  // draw playhead\n  ctx.strokeStyle = playheadColor;\n  ctx.beginPath();\n  if (vertical) {\n    ctx.moveTo(0, playheadPosition);\n    ctx.lineTo(valueAxis, playheadPosition);\n  } else {\n    ctx.moveTo(playheadPosition, 0);\n    ctx.lineTo(playheadPosition, valueAxis);\n  }\n  ctx.stroke();\n  return this;\n}\n\nexport function getDrawOptions(drawTime, options = {}) {\n  let [lookbehind, lookahead] = drawTime;\n  lookbehind = Math.abs(lookbehind);\n  const cycles = lookahead + lookbehind;\n  const playhead = lookbehind / cycles;\n  return { fold: 1, ...options, cycles, playhead };\n}\n\nexport const getPunchcardPainter =\n  (options = {}) =>\n  (ctx, time, haps, drawTime) =>\n    pianoroll({ ctx, time, haps, ...getDrawOptions(drawTime, options) });\n\nPattern.prototype.punchcard = function (options) {\n  return this.onPaint(getPunchcardPainter(options));\n};\n\n/**\n * Displays a vertical pianoroll with event labels.\n * Supports all the same options as pianoroll.\n *\n * @name wordfall\n */\nPattern.prototype.wordfall = function (options) {\n  return this.punchcard({ vertical: 1, labels: 1, stroke: 0, fillActive: 1, active: 'white', ...options });\n};\n\n/* Pattern.prototype.pianoroll = function (options) {\n  return this.onPaint((ctx, time, haps, drawTime) =>\n    pianoroll({ ctx, time, haps, ...getDrawOptions(drawTime, { fold: 0, ...options }) }),\n  );\n}; */\n\nexport function drawPianoroll(options) {\n  const { drawTime, ...rest } = options;\n  pianoroll({ ...getDrawOptions(drawTime), ...rest });\n}\n","import { Pattern } from '@strudel/core';\nimport { getTheme } from './draw.mjs';\n\n// polar coords -> xy\nfunction fromPolar(angle, radius, cx, cy) {\n  const radians = ((angle - 90) * Math.PI) / 180;\n  return [cx + Math.cos(radians) * radius, cy + Math.sin(radians) * radius];\n}\n\nconst xyOnSpiral = (angle, margin, cx, cy, rotate = 0) => fromPolar((angle + rotate) * 360, margin * angle, cx, cy); // TODO: logSpiral\n\n// draw spiral / segment of spiral\nfunction spiralSegment(options) {\n  let {\n    ctx,\n    from = 0,\n    to = 3,\n    margin = 50,\n    cx = 100,\n    cy = 100,\n    rotate = 0,\n    thickness = margin / 2,\n    color = getTheme().foreground,\n    cap = 'round',\n    stretch = 1,\n    fromOpacity = 1,\n    toOpacity = 1,\n  } = options;\n  from *= stretch;\n  to *= stretch;\n  rotate *= stretch;\n  ctx.lineWidth = thickness;\n  ctx.lineCap = cap;\n  ctx.strokeStyle = color;\n  ctx.globalAlpha = fromOpacity;\n\n  ctx.beginPath();\n  let [sx, sy] = xyOnSpiral(from, margin, cx, cy, rotate);\n  ctx.moveTo(sx, sy);\n\n  const increment = 1 / 60;\n  let angle = from;\n  while (angle <= to) {\n    const [x, y] = xyOnSpiral(angle, margin, cx, cy, rotate);\n    //ctx.lineWidth = angle*thickness;\n    ctx.globalAlpha = ((angle - from) / (to - from)) * toOpacity;\n    ctx.lineTo(x, y);\n    angle += increment;\n  }\n  ctx.stroke();\n}\n\nfunction drawSpiral(options) {\n  let {\n    stretch = 1,\n    size = 80,\n    thickness = size / 2,\n    cap = 'butt', // round butt squar,\n    inset = 3, // start angl,\n    playheadColor = '#ffffff',\n    playheadLength = 0.02,\n    playheadThickness = thickness,\n    padding = 0,\n    steady = 1,\n    activeColor = getTheme().foreground,\n    inactiveColor = getTheme().gutterForeground,\n    colorizeInactive = 0,\n    fade = true,\n    // logSpiral = true,\n    ctx,\n    time,\n    haps,\n    drawTime,\n    id,\n  } = options;\n\n  if (id) {\n    haps = haps.filter((hap) => hap.hasTag(id));\n  }\n\n  const [w, h] = [ctx.canvas.width, ctx.canvas.height];\n  ctx.clearRect(0, 0, w * 2, h * 2);\n  const [cx, cy] = [w / 2, h / 2];\n  const settings = {\n    margin: size / stretch,\n    cx,\n    cy,\n    stretch,\n    cap,\n    thickness,\n  };\n\n  const playhead = {\n    ...settings,\n    thickness: playheadThickness,\n    from: inset - playheadLength,\n    to: inset,\n    color: playheadColor,\n  };\n\n  const [min] = drawTime;\n  const rotate = steady * time;\n  haps.forEach((hap) => {\n    const isActive = hap.whole.begin <= time && hap.endClipped > time;\n    const from = hap.whole.begin - time + inset;\n    const to = hap.endClipped - time + inset - padding;\n    const hapColor = hap.value?.color || activeColor;\n    const color = colorizeInactive || isActive ? hapColor : inactiveColor;\n    const opacity = fade ? 1 - Math.abs((hap.whole.begin - time) / min) : 1;\n    spiralSegment({\n      ctx,\n      ...settings,\n      from,\n      to,\n      rotate,\n      color,\n      fromOpacity: opacity,\n      toOpacity: opacity,\n    });\n  });\n  spiralSegment({\n    ctx,\n    ...playhead,\n    rotate,\n  });\n}\n\nPattern.prototype.spiral = function (options = {}) {\n  return this.onPaint((ctx, time, haps, drawTime) => drawSpiral({ ctx, time, haps, drawTime, ...options }));\n};\n","import { clean } from '../clean-stores/index.js'\n\nlet listenerQueue = []\n\nexport let atom = (initialValue, level) => {\n  let listeners = []\n  let $atom = {\n    get() {\n      if (!$atom.lc) {\n        $atom.listen(() => {})()\n      }\n      return $atom.value\n    },\n    l: level || 0,\n    lc: 0,\n    listen(listener, listenerLevel) {\n      $atom.lc = listeners.push(listener, listenerLevel || $atom.l) / 2\n\n      return () => {\n        let index = listeners.indexOf(listener)\n        if (~index) {\n          listeners.splice(index, 2)\n          if (!--$atom.lc) $atom.off()\n        }\n      }\n    },\n    notify(changedKey) {\n      let runListenerQueue = !listenerQueue.length\n      for (let i = 0; i < listeners.length; i += 2) {\n        listenerQueue.push(\n          listeners[i],\n          listeners[i + 1],\n          $atom.value,\n          changedKey,\n        )\n      }\n\n      if (runListenerQueue) {\n        for (let i = 0; i < listenerQueue.length; i += 4) {\n          let skip\n          for (let j = i + 1; !skip && (j += 4) < listenerQueue.length;) {\n            if (listenerQueue[j] < listenerQueue[i + 1]) {\n              skip = listenerQueue.push(\n               listenerQueue[i],\n               listenerQueue[i + 1],\n               listenerQueue[i + 2],\n               listenerQueue[i + 3]\n             )\n            }\n          }\n\n          if (!skip) {\n            listenerQueue[i](listenerQueue[i + 2], listenerQueue[i + 3])\n          }\n        }\n        listenerQueue.length = 0\n      }\n    },\n    off() {}, /* It will be called on last listener unsubscribing.\n                 We will redefine it in onMount and onStop. */\n    set(data) {\n      if ($atom.value !== data) {\n        $atom.value = data\n        $atom.notify()\n      }\n    },\n    subscribe(listener, listenerLevel) {\n      let unbind = $atom.listen(listener, listenerLevel)\n      listener($atom.value)\n      return unbind\n    },\n    value: initialValue\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    $atom[clean] = () => {\n      listeners = []\n      $atom.lc = 0\n      $atom.off()\n    }\n  }\n\n  return $atom\n}\n","import { atom } from '../atom/index.js'\n\nexport let map = (value = {}) => {\n  let $map = atom(value)\n\n  $map.setKey = function (key, newValue) {\n    if (typeof newValue === 'undefined') {\n      if (key in $map.value) {\n        $map.value = { ...$map.value }\n        delete $map.value[key]\n        $map.notify(key)\n      }\n    } else if ($map.value[key] !== newValue) {\n      $map.value = {\n        ...$map.value,\n        [key]: newValue\n      }\n      $map.notify(key)\n    }\n  }\n\n  return $map\n}\n"],"names":["MAX_CYCLE_LEN","P","assign","n","s","InvalidParameter","newFraction","d","DivisionByZero","f","Fraction","a","gcd","factorize","num","factors","i","parse","p1","p2","v","w","x","y","z","A","B","C","D","N","M","NonIntegerParameter","modpow","b","e","m","r","cycleLen","rem","t","cycleStart","len","rem1","rem2","places","k","eps","thisABS","cont","excludeWhole","whole","str","res","dec","cycLen","cycOff","TimeSpan","other","others","max","fraction","fractions","lcm","begin","end","spans","end_sam","next_begin","func_time","sam","intersect_begin","intersect_end","result","Hap","part","value","context","stateful","duration","currentTime","margin","min","func","tag","state","newState","newValue","compact","is_whole","State","span","controls","logKey","debounce","lastMessage","lastTime","logger","message","type","data","isNoteWithOctave","name","isNote","tokenizeNote","note","pc","acc","oct","chromas","accs","noteToMidi","defaultOctave","chroma","offset","o","char","midiToFreq","freqToMidi","freq","valueToMidi","fallbackValue","getFreq","noteOrMidi","pcs","midi2note","_mod","nanFallback","fallback","getSoundIndex","numSounds","getPlayableNoteValue","hap","getFrequency","rotate","arr","pipe","funcs","g","args","compose","removeUndefineds","xs","flatten","id","constant","listRange","_","curry","overload","arity","fn","curried","partial","args2","parseNumeral","numOrString","asNumber","mapArgs","mapFn","numeralArgs","parseFractional","specialValue","fractionalArgs","splitAt","index","zipWith","ys","clamp","solfeggio","indian","german","byzantine","japanese","english","sol2note","notation","unicodeToBase64","text","utf8Bytes","base64ToUnicode","base64String","code2hash","code","hash2code","hash","objectMap","obj","unionWithObj","common","anyFunctor","drawLine","pat","chars","cycle","pos","lines","emptyLine","haps","durations","charFraction","totalSlots","line","matches","missingLines","stringParser","setStringParser","parser","Pattern","query","tactus","whole_func","pat_val","pat_func","hap_funcs","hap_vals","apply","hap_func","hap_val","span_a","span_b","new_whole","new_part","new_value","new_context","choose_whole","withWhole","match","restart","pat_of_pats","outer_hap","inner_hap","flatHap","outerHap","innerHaps","munge","outer","inner","innerHap","err","q","subspan","start","location","locations","hap_test","value_test","val","searching","a_value","found","j","with_context","self","reify","otherPat","thisPat","stack","pats","sequence","cat","fastcat","slowcat","onTrigger","dominant","getData","groupHapsBy","eq","groups","congruent","_haps","h","_nonArrayObject","_composeOp","composers","hows","what","op","preprocess","wrapper","how","howpat","polyrhythm","pr","pm","polymeter","pure","timecat","seq","gap","silence","nothing","isPattern","thing","_stackWith","left","right","stackLeft","stackRight","stackCentre","stackBy","by","lookup","polymeterSteps","pat_n","slowcatPrime","timepats","findtactus","total","time","timeCat","arrange","sections","sum","cycles","section","stepcat","_sequenceCount","toTactus","register","targetTactus","_polymeterListSteps","steps","seqs","head","tail","mask","struct","superimpose","set","keep","keepif","add","sub","mul","div","mod","pow","band","bor","bxor","blshift","brshift","lt","gt","lte","gte","eqt","ne","net","and","or","patternify","preserveTactus","name_item","pfunc","firstArgs","arg","pureArgs","pureLocs","p","round","floor","ceil","toBipolar","fromBipolar","range","rangex","range2","ratio","compress","compressSpan","compressspan","fastGap","fastgap","factor","qf","bpos","epos","ef","beginPos","endPos","newPart","newWhole","focus","focusSpan","focusspan","ply","fast","density","hurry","slow","sparsity","inside","outside","lastOf","firstOf","every","cpm","early","late","zoom","zoomArc","zoomarc","linger","segment","rate","invert","inv","when","on","off","time_pat","brak","rev","next_cycle","reflect","to_reflect","reflected","tmp","pressBy","press","palindrome","juxBy","juxby","elem_or","dict","key","dflt","jux","echoWith","echowith","stutWith","stutwith","times","echo","feedback","stut","_iter","back","iter","iterBack","iterback","repeatCycles","_chunk","binary","binary_pat","chunk","slowchunk","slowChunk","chunkBack","chunkback","fastchunk","fastChunk","bypass","ribbon","hsla","l","hsl","ctx","chop","slice_objects","slice_o","striate","slicePat","_loopAt","cps","slice","npat","ipat","opat","splice","sliced","loopAt","loopat","fit","loopAtCps","loopatcps","ref","accessor","fadeGain","xfade","gaina","gainb","createParam","names","isMulti","withVal","bag","setter","registerControl","aliases","alias","sound","source","src","accelerate","velocity","gain","postgain","amp","attack","att","fmh","fmi","fm","fmenv","fmattack","fmdecay","fmsustain","fmrelease","fmvelocity","bank","analyze","fft","decay","sustain","sus","release","rel","hold","bandf","bpf","bp","bandq","bpq","loop","loopBegin","loopb","loopEnd","loope","crush","coarse","channels","ch","phaserrate","phasr","phaser","ph","phasersweep","phs","phasercenter","phc","phaserdepth","phd","phasdp","channel","cut","cutoff","ctf","lpf","lp","lpenv","lpe","hpenv","hpe","bpenv","bpe","lpattack","lpa","hpattack","hpa","bpattack","bpa","lpdecay","lpd","hpdecay","hpd","bpdecay","bpd","lpsustain","lps","hpsustain","hps","bpsustain","bps","lprelease","lpr","hprelease","hpr","bprelease","bpr","ftype","fanchor","vib","vibrato","noise","vibmod","vmod","hcutoff","hpf","hp","hresonance","hpq","resonance","lpq","djf","delay","delayfeedback","delayfb","dfb","delaytime","delayt","dt","lock","detune","det","unison","spread","dry","fadeTime","fadeOutTime","fadeInTime","pattack","patt","pdecay","pdec","psustain","psus","prelease","prel","penv","pcurve","panchor","gate","gat","leslie","lrate","lsize","activeLabel","label","degree","mtranspose","ctranspose","harmonic","stepsPerOctave","octaveR","nudge","octave","orbit","overgain","overshape","pan","panspan","pansplay","panwidth","panorient","slide","semitone","voice","chord","dictionary","anchor","octaves","mode","room","roomlp","rlp","roomdim","rdim","roomfade","rfade","ir","iresponse","roomsize","size","sz","rsize","shape","distort","dist","compressor","compressorKnee","compressorRatio","compressorAttack","compressorRelease","speed","unit","squiz","vowel","waveloss","expression","sustainpedal","tremolodepth","tremdp","tremolorate","tremr","fshift","fshiftnote","fshiftphase","triode","krush","kcutoff","octer","octersub","octersubsub","ring","ringf","ringdf","freeze","xsdelay","tsdelay","real","imag","enhance","partials","comb","smear","scram","binshift","hbrick","lbrick","midichan","control","ccn","ccv","polyTouch","midibend","miditouch","ctlNum","frameRate","frames","hours","midicmd","minutes","progNum","seconds","songPtr","uid","clip","legato","dur","zrand","curve","deltaSlide","pitchJump","pitchJumpTime","lfo","repeatTime","znoise","zmod","zcrush","zdelay","tremolo","zzfx","color","colour","createParams","adsr","ad","ds","ar","ons","offs","_xs","__xs","_ys","__ys","_bjork","bjork","inverted","_euclidRot","pulses","rotation","euclid","euclidrot","euclidRot","_euclidLegato","gapless","euclidLegato","euclidLegatoRot","createClock","getTime","callback","interval","overlap","setInterval","clearInterval","tick","phase","precision","minLatency","setDuration","onTick","lookahead","intervalID","clear","steady","signal","isaw","isaw2","saw","saw2","sine2","sine","cosine","cosine2","square","square2","tri","tri2","xorwise","_frac","timeToIntSeed","intSeedToRand","timeToRand","run","rand","rand2","_brandBy","brandBy","pPat","brand","_irand","irand","_pick","modulo","array","pick","__pick","pickmod","pickF","pickmodF","pickOut","pickmodOut","pickRestart","pickmodRestart","pickReset","pickmodReset","inhabit","pickSqueeze","inhabitmod","pickmodSqueeze","squeeze","__chooseWith","chooseWith","chooseInWith","choose","chooseCycles","randcat","_wchooseWith","pairs","values","pair","weights","accum","find","wchooseWith","wchoose","wchooseCycles","wrandcat","perlinWith","pata","patb","smootherStep","interp","perlin","degradeByWith","withPat","degradeBy","degrade","undegradeBy","undegrade","sometimesBy","patx","sometimes","someCyclesBy","someCycles","often","rarely","almostNever","almostAlways","never","always","synth","allVoices","triggerSpeech","words","lang","utterance","voices","speak","evalScope","results","modules","module","safeEval","options","wrapExpression","wrapAsync","body","evaluate","transpiler","meta","transpiled","NeoCyclist","onToggle","weight","maxWeight","setTimeReference","num_seconds_at_cps_change","num_seconds_since_cps_change","tickdeadline","time_dif","new_dif","tickCallback","payload","num_cycles_at_cps_change","processHaps","seconds_at_cps_change","targetTime","started","autostart","onsets","Cyclist","onError","latency","num_cycles_since_cps_change","deadline","secondsSinceLastTick","setTime","repl","defaultOutput","onEvalError","beforeEval","afterEval","editPattern","onUpdateState","sync","updateState","update","schedulerOptions","getTrigger","scheduler","pPatterns","allTransform","hush","setPattern","pattern","stop","pause","toggle","setCps","setCpm","all","transform","injectPatternMethods","shouldHush","_evaluate","backgroundImage","animateOptions","container","bg","initialClassName","handleOption","option","funcOptions","cleanupUi","getDrawContext","contextType","pixelated","pixelRatio","canvas","timeout","animationFrames","stopAnimationFrame","stopAllAnimations","memory","lookbehind","__t","newFuture","last","animate","_t","cleanupDraw","clearScreen","Framer","onFrame","frame","updateHighlights","Drawer","onDraw","drawTime","futureHaps","getComputedPropertyValue","theme","getTheme","setTheme","_theme","clearColor","ww","wh","smearPart","render","angle","fill","radians","cx","cy","rescale","moveXY","dx","dy","zoomIn","scale","normalized","getValue","playhead","overscan","hideNegative","from","to","inFrame","pianoroll","flipTime","flipValues","inactive","active","background","playheadColor","minMidi","maxMidi","autorange","timeframeProp","fold","vertical","labels","fillActive","strokeActive","stroke","hideInactive","colorizeInactive","fontFamily","timeAxis","valueAxis","timeRange","timeExtent","valueRange","valueExtent","barThickness","foldValues","event","isActive","strokeCurrent","fillCurrent","timeProgress","timePx","durationPx","valueProgress","valuePx","coords","defaultLabel","inactiveLabel","measure","playheadPosition","getDrawOptions","getPunchcardPainter","drawPianoroll","rest","fromPolar","radius","xyOnSpiral","spiralSegment","thickness","cap","stretch","fromOpacity","toOpacity","sx","sy","increment","drawSpiral","inset","playheadLength","playheadThickness","padding","activeColor","inactiveColor","fade","settings","hapColor","opacity","listenerQueue","atom","initialValue","level","listeners","$atom","listener","listenerLevel","changedKey","runListenerQueue","skip","unbind","map","$map"],"mappings":"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","x_google_ignoreList":[0,26,27]}