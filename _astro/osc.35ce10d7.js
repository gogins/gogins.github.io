import{c as T,g as tt}from"./index.3d4af9ee.js";import{P as nt,p as Se,l as rt}from"./index.a2044bc2.js";var Oe={exports:{}};(function(D,C){(function(y,u){D.exports=u()})(T,function(){function y(r,t){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(r);t&&(e=e.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),n.push.apply(n,e)}return n}function u(r){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(e){S(r,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))})}return r}function f(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function U(r,t){for(var n=0;n<t.length;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}function l(r,t,n){return t&&U(r.prototype,t),n&&U(r,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function S(r,t,n){return t in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n,r}function g(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),t&&j(r,t)}function p(r){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},p(r)}function j(r,t){return j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,e){return n.__proto__=e,n},j(r,t)}function z(r,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(r)}function d(r){var t=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var n,e=p(r);if(t){var o=p(this).constructor;n=Reflect.construct(e,arguments,o)}else n=e.apply(this,arguments);return z(this,n)}}function Ee(r,t){for(;!Object.prototype.hasOwnProperty.call(r,t)&&(r=p(r))!==null;);return r}function v(){return v=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(r,t,n){var e=Ee(r,t);if(e){var o=Object.getOwnPropertyDescriptor(e,t);return o.get?o.get.call(arguments.length<3?r:n):o.value}},v.apply(this,arguments)}function m(r){return Number(r)===r&&r%1==0}function ne(r){return Number(r)===r}function w(r){return typeof r=="string"}function re(r){return typeof r=="boolean"}function oe(r){return r===1/0}function x(r){return Object.prototype.toString.call(r)==="[object Array]"}function G(r){return Object.prototype.toString.call(r)==="[object Object]"}function B(r){return typeof r=="function"}function se(r){return r instanceof Uint8Array}function Ce(r){return r instanceof Date}function A(r){return r===void 0}function ie(r){return r===null}function _(r){return r+3&-4}function ae(r){return Object.prototype.hasOwnProperty.call(typeof T<"u"?T:window,r)}function Pe(r){return r.buffer?new DataView(r.buffer):r instanceof ArrayBuffer?new DataView(r):new DataView(new Uint8Array(r))}function ue(r){if(m(r))return"i";if(t=r,Number(t)===t&&t%1!=0)return"f";if(w(r))return"s";if(se(r))return"b";if(re(r))return r?"T":"F";if(ie(r))return"N";if(oe(r))return"I";var t;throw new Error("OSC typeTag() found unknown value type")}function L(r){var t="";if(x(r))return"/".concat(r.join("/"));if(w(r))return(t=r).length>1&&t[t.length-1]==="/"&&(t=t.slice(0,t.length-1)),t.length>1&&t[0]!=="/"&&(t="/".concat(t)),t;throw new Error("OSC prepareAddress() needs addresses of type array or string")}function ce(r){if(!w(r))throw new Error("OSC prepareRegExPattern() needs strings");return r.replace(/\./g,"\\.").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\{/g,"(").replace(/\}/g,")").replace(/,/g,"|").replace(/\[!/g,"[^").replace(/\?/g,".").replace(/\*/g,".*")}var fe=function(){function r(){f(this,r),this.data=[],this.byteLength=0}return l(r,[{key:"add",value:function(t){if(re(t)||oe(t)||ie(t))return this;var n=t.pack();return this.byteLength+=n.byteLength,this.data.push(n),this}},{key:"merge",value:function(){var t=new Uint8Array(this.byteLength),n=0;return this.data.forEach(function(e){t.set(e,n),n+=e.byteLength}),t}}]),r}(),P=function(){function r(t){f(this,r),this.value=t,this.offset=0}return l(r,[{key:"pack",value:function(t,n){if(!t||!n)throw new Error("OSC Atomic cant't be packed without given method or byteLength");var e=new Uint8Array(n),o=new DataView(e.buffer);if(A(this.value))throw new Error("OSC Atomic cant't be encoded with empty value");return o[t](this.offset,this.value,!1),e}},{key:"unpack",value:function(t,n,e){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(!(t&&n&&e))throw new Error("OSC Atomic cant't be unpacked without given dataView, method or byteLength");if(!(t instanceof DataView))throw new Error("OSC Atomic expects an instance of type DataView");return this.value=t[n](o,!1),this.offset=o+e,this.offset}}]),r}(),W=function(r){g(n,r);var t=d(n);function n(e){if(f(this,n),e&&!m(e))throw new Error("OSC AtomicInt32 constructor expects value of type number");return t.call(this,e)}return l(n,[{key:"pack",value:function(){return v(p(n.prototype),"pack",this).call(this,"setInt32",4)}},{key:"unpack",value:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return v(p(n.prototype),"unpack",this).call(this,e,"getInt32",4,o)}}]),n}(P),le="utf-8";function Ae(r){if(ae("Buffer"))return Buffer.from(r).toString(le);if(ae("TextDecoder"))return new TextDecoder(le).decode(new Int8Array(r));for(var t="",n=0;n<r.length;n+=65537)t+=String.fromCharCode.apply(null,r.slice(n,n+65537));return t}var b=function(r){g(n,r);var t=d(n);function n(e){if(f(this,n),e&&!w(e))throw new Error("OSC AtomicString constructor expects value of type string");return t.call(this,e)}return l(n,[{key:"pack",value:function(){if(A(this.value))throw new Error("OSC AtomicString can not be encoded with empty value");for(var e="".concat(this.value,"\0"),o=_(e.length),s=new Uint8Array(o),i=0;i<e.length;i+=1)s[i]=e.charCodeAt(i);return s}},{key:"unpack",value:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!(e instanceof DataView))throw new Error("OSC AtomicString expects an instance of type DataView");for(var s,i=o,a=[];i<e.byteLength;i+=1){if((s=e.getUint8(i))===0){i+=1;break}a.push(s)}if(i===e.length)throw new Error("OSC AtomicString found a malformed OSC string");return this.offset=_(i),this.value=Ae(a),this.offset}}]),n}(P),he=2208988800,pe=4294967296,$=function(){function r(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(f(this,r),!m(t)||!m(n))throw new Error("OSC Timetag constructor expects values of type integer number");this.seconds=t,this.fractions=n}return l(r,[{key:"timestamp",value:function(t){var n;if(typeof t=="number"){n=t/1e3;var e=Math.floor(n);return this.seconds=e+he,this.fractions=Math.round(pe*(n-e)),t}return 1e3*((n=this.seconds-he)+Math.round(this.fractions/pe))}}]),r}(),M=function(r){g(n,r);var t=d(n);function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();f(this,n);var o=new $;return e instanceof $?o=e:m(e)?o.timestamp(e):Ce(e)&&o.timestamp(e.getTime()),t.call(this,o)}return l(n,[{key:"pack",value:function(){if(A(this.value))throw new Error("OSC AtomicTimetag can not be encoded with empty value");var e=this.value,o=e.seconds,s=e.fractions,i=new Uint8Array(8),a=new DataView(i.buffer);return a.setInt32(0,o,!1),a.setInt32(4,s,!1),i}},{key:"unpack",value:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!(e instanceof DataView))throw new Error("OSC AtomicTimetag expects an instance of type DataView");var s=e.getUint32(o,!1),i=e.getUint32(o+4,!1);return this.value=new $(s,i),this.offset=o+8,this.offset}}]),n}(P),de=function(r){g(n,r);var t=d(n);function n(e){if(f(this,n),e&&!se(e))throw new Error("OSC AtomicBlob constructor expects value of type Uint8Array");return t.call(this,e)}return l(n,[{key:"pack",value:function(){if(A(this.value))throw new Error("OSC AtomicBlob can not be encoded with empty value");var e=_(this.value.byteLength),o=new Uint8Array(e+4);return new DataView(o.buffer).setInt32(0,this.value.byteLength,!1),o.set(this.value,4),o}},{key:"unpack",value:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!(e instanceof DataView))throw new Error("OSC AtomicBlob expects an instance of type DataView");var s=e.getInt32(o,!1);return this.value=new Uint8Array(e.buffer,o+4,s),this.offset=_(o+4+s),this.offset}}]),n}(P),ge=function(r){g(n,r);var t=d(n);function n(e){if(f(this,n),e&&!ne(e))throw new Error("OSC AtomicFloat32 constructor expects value of type float");return t.call(this,e)}return l(n,[{key:"pack",value:function(){return v(p(n.prototype),"pack",this).call(this,"setFloat32",4)}},{key:"unpack",value:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return v(p(n.prototype),"unpack",this).call(this,e,"getFloat32",4,o)}}]),n}(P),ve=function(r){g(n,r);var t=d(n);function n(e){if(f(this,n),e&&!ne(e))throw new Error("OSC AtomicFloat64 constructor expects value of type float");return t.call(this,e)}return l(n,[{key:"pack",value:function(){return v(p(n.prototype),"pack",this).call(this,"setFloat64",8)}},{key:"unpack",value:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return v(p(n.prototype),"unpack",this).call(this,e,"getFloat64",8,o)}}]),n}(P),Ie=BigInt("9223372036854775807"),De=BigInt("-9223372036854775808"),we=function(r){g(n,r);var t=d(n);function n(e){if(f(this,n),e&&typeof e!="bigint")throw new Error("OSC AtomicInt64 constructor expects value of type BigInt");if(e&&(e<De||e>Ie))throw new Error("OSC AtomicInt64 value is out of bounds");var o;return e&&(o=BigInt.asIntN(64,e)),t.call(this,o)}return l(n,[{key:"pack",value:function(){return v(p(n.prototype),"pack",this).call(this,"setBigInt64",8)}},{key:"unpack",value:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return v(p(n.prototype),"unpack",this).call(this,e,"getBigInt64",8,o)}}]),n}(P),je=BigInt("18446744073709551615"),ye=function(r){g(n,r);var t=d(n);function n(e){if(f(this,n),e&&typeof e!="bigint")throw new Error("OSC AtomicUInt64 constructor expects value of type BigInt");if(e&&(e<0||e>je))throw new Error("OSC AtomicUInt64 value is out of bounds");var o;return e&&(o=BigInt.asUintN(64,e)),t.call(this,o)}return l(n,[{key:"pack",value:function(){return v(p(n.prototype),"pack",this).call(this,"setBigUint64",8)}},{key:"unpack",value:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return v(p(n.prototype),"unpack",this).call(this,e,"getBigUint64",8,o)}}]),n}(P),Z=!0,q=!1,J=null,K=1/0,Q=function(){function r(t,n){var e=this;if(f(this,r),this.offset=0,this.address="",this.types="",this.args=[],!A(t)){if(!w(t)&&!x(t))throw new Error("OSC Message constructor first argument (address) must be a string or array");this.address=L(t)}if(!A(n)){if(!x(n))throw new Error("OSC Message constructor second argument (args) must be an array");n.forEach(function(o){return e.add(o.type,o.value)})}}return l(r,[{key:"add",value:function(t,n){if(A(t))throw new Error("OSC Message needs a valid OSC Atomic Data Type");t==="N"?this.args.push(J):t==="T"?this.args.push(Z):t==="F"?this.args.push(q):t==="I"?this.args.push(K):this.args.push(n),this.types+=t}},{key:"pack",value:function(){var t=this;if(this.address.length===0||this.address[0]!=="/")throw new Error("OSC Message has an invalid address");var n=new fe;if(n.add(new b(this.address)),n.add(new b(",".concat(this.types))),this.args.length>0){var e;if(this.args.length>this.types.length)throw new Error("OSC Message argument and type tag mismatch");this.args.forEach(function(o,s){var i=t.types[s];if(i==="i")e=new W(o);else if(i==="h")e=new we(o);else if(i==="t")e=new ye(o);else if(i==="f")e=new ge(o);else if(i==="d")e=new ve(o);else if(i==="s")e=new b(o);else if(i==="b")e=new de(o);else if(i==="T")e=Z;else if(i==="F")e=q;else if(i==="N")e=J;else{if(i!=="I")throw new Error("OSC Message found unknown argument type");e=K}n.add(e)})}return n.merge()}},{key:"unpack",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC Message expects an instance of type DataView.");var e=new b;e.unpack(t,n);var o=new b;if(o.unpack(t,e.offset),e.value.length===0||e.value[0]!=="/")throw new Error("OSC Message found malformed or missing address string");if(o.value.length===0&&o.value[0]!==",")throw new Error("OSC Message found malformed or missing type string");for(var s,i,a=o.offset,c=[],h=1;h<o.value.length;h+=1){if(s=null,(i=o.value[h])==="i")s=new W;else if(i==="h")s=new we;else if(i==="t")s=new ye;else if(i==="f")s=new ge;else if(i==="d")s=new ve;else if(i==="s")s=new b;else if(i==="b")s=new de;else if(i==="T")c.push(Z);else if(i==="F")c.push(q);else if(i==="N")c.push(J);else{if(i!=="I")throw new Error("OSC Message found unsupported argument type");c.push(K)}s&&(a=s.unpack(t,a),c.push(s.value))}return this.offset=a,this.address=e.value,this.types=o.value,this.args=c,this.offset}}]),r}(),O=function(r){g(n,r);var t=d(n);function n(e){var o,s;f(this,n);for(var i=arguments.length,a=new Array(i>1?i-1:0),c=1;c<i;c++)a[c-1]=arguments[c];return a.length>0&&a[0]instanceof Array&&(s=a.shift()),o=t.call(this,e,s),a.length>0&&(o.types=a.map(function(h){return ue(h)}).join(""),o.args=a),o}return l(n,[{key:"add",value:function(e){v(p(n.prototype),"add",this).call(this,ue(e),e)}}]),n}(Q),R="#bundle",I=function(){function r(){var t=this;f(this,r),this.offset=0,this.timetag=new M,this.bundleElements=[];for(var n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];e.length>0&&(e[0]instanceof Date||m(e[0])?this.timetag=new M(e[0]):x(e[0])?(e[0].forEach(function(s){t.add(s)}),e.length>1&&(e[1]instanceof Date||m(e[1]))&&(this.timetag=new M(e[1]))):e.forEach(function(s){t.add(s)}))}return l(r,[{key:"timestamp",value:function(t){if(!m(t))throw new Error("OSC Bundle needs an integer for setting the timestamp");this.timetag=new M(t)}},{key:"add",value:function(t){if(!(t instanceof O||t instanceof r))throw new Error("OSC Bundle contains only Messages and Bundles");this.bundleElements.push(t)}},{key:"pack",value:function(){var t=new fe;return t.add(new b(R)),this.timetag||(this.timetag=new M),t.add(this.timetag),this.bundleElements.forEach(function(n){t.add(new W(n.pack().byteLength)),t.add(n)}),t.merge()}},{key:"unpack",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC Bundle expects an instance of type DataView");var e=new b;if(e.unpack(t,n),e.value!==R)throw new Error("OSC Bundle does not contain a valid #bundle head");var o=new M,s=o.unpack(t,e.offset);for(this.bundleElements=[];s<t.byteLength;){var i=new b,a=new W;s=a.unpack(t,s);var c=void 0;i.unpack(t,s),s=(c=i.value===R?new r:new O).unpack(t,s),this.bundleElements.push(c)}return this.offset=s,this.timetag=o,this.offset}}]),r}(),H=function(){function r(t){if(f(this,r),t&&!(t instanceof O||t instanceof I))throw new Error("OSC Packet value has to be Message or Bundle");this.value=t,this.offset=0}return l(r,[{key:"pack",value:function(){if(!this.value)throw new Error("OSC Packet can not be encoded with empty body");return this.value.pack()}},{key:"unpack",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC Packet expects an instance of type DataView");if(t.byteLength%4!=0)throw new Error("OSC Packet byteLength has to be a multiple of four");var e,o=new b;return o.unpack(t,n),(e=o.value===R?new I:new O).unpack(t,n),this.offset=e.offset,this.value=e,this.offset}}]),r}(),xe={discardLateMessages:!1},Be=function(){function r(t){f(this,r),this.options=u(u({},xe),t),this.addressHandlers=[],this.eventHandlers={open:[],error:[],close:[]},this.uuid=0}return l(r,[{key:"dispatch",value:function(t,n){var e=this;if(!(t instanceof H))throw new Error("OSC EventHander dispatch() accepts only arguments of type Packet");if(!t.value)throw new Error("OSC EventHander dispatch() can't read empty Packets");if(t.value instanceof I){var o=t.value;return o.bundleElements.forEach(function(i){if(i instanceof I){if(o.timetag.value.timestamp()<i.timetag.value.timestamp())throw new Error("OSC Bundle timestamp is older than the timestamp of enclosed Bundles");return e.dispatch(i)}if(i instanceof O){var a=i;return e.notify(a.address,a,o.timetag.value.timestamp(),n)}throw new Error("OSC EventHander dispatch() can't dispatch unknown Packet value")})}if(t.value instanceof O){var s=t.value;return this.notify(s.address,s,0,n)}throw new Error("OSC EventHander dispatch() can't dispatch unknown Packet value")}},{key:"call",value:function(t,n,e){var o=!1;if(w(t)&&t in this.eventHandlers)return this.eventHandlers[t].forEach(function(a){a.callback(n,e),o=!0}),o;var s=Object.keys(this.addressHandlers),i=this.addressHandlers;return s.forEach(function(a){var c=!1,h=new RegExp(ce(L(t)),"g");if(h.test(a)&&a.length===h.lastIndex&&(c=!0),!c){var E=new RegExp(ce(L(a)),"g");E.test(t)&&t.length===E.lastIndex&&(c=!0)}c&&i[a].forEach(function(Y){Y.callback(n,e),o=!0})}),o}},{key:"notify",value:function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];if(n.length===0)throw new Error("OSC EventHandler can not be called without any argument");if(n[0]instanceof H)return this.dispatch(n[0],n[1]);if(n[0]instanceof I||n[0]instanceof O)return this.dispatch(new H(n[0]),n[1]);if(!w(n[0])){var o=new H;return o.unpack(Pe(n[0])),this.dispatch(o,n[1])}var s=n[0],i=null;n.length>1&&(i=n[1]);var a=null;if(n.length>2)if(m(n[2]))a=n[2];else{if(!(n[2]instanceof Date))throw new Error("OSC EventHandler timestamp has to be a number or Date");a=n[2].getTime()}var c=null;if(n.length>=3&&(c=n[3]),a){var h=Date.now();if(h>a&&!this.options.discardLateMessages)return this.call(s,i,c);var E=this;return setTimeout(function(){E.call(s,i,c)},a-h),!0}return this.call(s,i,c)}},{key:"on",value:function(t,n){if(!w(t)&&!x(t))throw new Error("OSC EventHandler accepts only strings or arrays for address patterns");if(!B(n))throw new Error("OSC EventHandler callback has to be a function");this.uuid+=1;var e={id:this.uuid,callback:n};if(w(t)&&t in this.eventHandlers)return this.eventHandlers[t].push(e),this.uuid;var o=L(t);return o in this.addressHandlers||(this.addressHandlers[o]=[]),this.addressHandlers[o].push(e),this.uuid}},{key:"off",value:function(t,n){if(!w(t)&&!x(t))throw new Error("OSC EventHandler accepts only strings or arrays for address patterns");if(!m(n))throw new Error("OSC EventHandler subscription id has to be a number");var e,o;return w(t)&&t in this.eventHandlers?(e=t,o=this.eventHandlers):(e=L(t),o=this.addressHandlers),e in o&&o[e].some(function(s,i){return s.id===n&&(o[e].splice(i,1),!0)})}}]),r}(),N=function(){function r(){if(f(this,r),this.constructor===r)throw new Error("Plugin is an abstract class. Please create or use an implementation!")}return l(r,[{key:"status",value:function(){throw new Error("Abstract method!")}},{key:"open",value:function(){throw new Error("Abstract method!")}},{key:"close",value:function(){throw new Error("Abstract method!")}},{key:"send",value:function(t){throw new Error("Abstract method!")}}]),r}(),Me=0,He=1,Te=2,Le=3,Ne=function(r){g(n,r);var t=d(n);function n(){throw f(this,n),t.call(this),new Error("DatagramPlugin can not be used in browser context")}return l(n,[{key:"registerNotify",value:function(e){this.notify=e}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var e=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=u(u({},this.options.open),o),i=s.port,a=s.exclusive;this.socketStatus=Me,this.socket.bind({address:s.host,port:i,exclusive:a},function(){e.socketStatus=He,e.notify("open")})}},{key:"close",value:function(){var e=this;this.socketStatus=Te,this.socket.close(function(){e.socketStatus=Le,e.notify("close")})}},{key:"send",value:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=u(u({},this.options.send),o),i=s.port,a=s.host;this.socket.send(Buffer.from(e),0,e.byteLength,i,a)}}]),n}(N),me=typeof WebSocket<"u"?WebSocket:typeof MozWebSocket<"u"?MozWebSocket:typeof T<"u"?T.WebSocket||T.MozWebSocket:typeof window<"u"?window.WebSocket||window.MozWebSocket:typeof self<"u"?self.WebSocket||self.MozWebSocket:void 0,X=void 0,Ve=0,Ue=1,_e=2,We=3,F={udpServer:{host:"localhost",port:41234,exclusive:!1},udpClient:{host:"localhost",port:41235},wsServer:{host:"localhost",port:8080},receiver:"ws"};function ke(r,t){return u(u(u(u({},F),r),t),{},{udpServer:u(u(u({},F.udpServer),r.udpServer),t.udpServer),udpClient:u(u(u({},F.udpClient),r.udpClient),t.udpClient),wsServer:u(u(u({},F.wsServer),r.wsServer),t.wsServer)})}var Re=function(r){g(n,r);var t=d(n);function n(){throw f(this,n),t.call(this),new Error("BridgePlugin can not be used in browser context")}return l(n,[{key:"registerNotify",value:function(e){this.notify=e}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var e=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=ke(this.options,o);this.socketStatus=Ve,this.socket.bind({address:s.udpServer.host,port:s.udpServer.port,exclusive:s.udpServer.exclusive},function(){var i={};s.wsServer.server?i.server=s.wsServer.server:i=s.wsServer,e.websocket=new X(i),e.websocket.binaryType="arraybuffer",e.websocket.on("listening",function(){e.socketStatus=Ue,e.notify("open")}),e.websocket.on("error",function(a){e.notify("error",a)}),e.websocket.on("connection",function(a){a.on("message",function(c,h){e.send(c,{receiver:"udp"}),e.notify(new Uint8Array(c),h)})})})}},{key:"close",value:function(){var e=this;this.socketStatus=_e,this.socket.close(function(){e.websocket.close(function(){e.socketStatus=We,e.notify("close")})})}},{key:"send",value:function(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=ke(this.options,o),i=s.receiver;if(i==="udp"){var a=e instanceof Buffer?e:Buffer.from(e);this.socket.send(a,0,a.byteLength,s.udpClient.port,s.udpClient.host)}else{if(i!=="ws")throw new Error("BridgePlugin can not send message to unknown receiver");this.websocket.clients.forEach(function(c){c.send(e,{binary:!0})})}}}]),n}(N),Fe=-1,ze=0,Ge=1,$e=2,Ze=3,qe={host:"localhost",port:8080,secure:!1,protocol:[]},be=function(r){g(n,r);var t=d(n);function n(e){var o;if(f(this,n),o=t.call(this),!me)throw new Error("WebsocketClientPlugin can't find a WebSocket class");return o.options=u(u({},qe),e),o.socket=null,o.socketStatus=Fe,o.notify=function(){},o}return l(n,[{key:"registerNotify",value:function(e){this.notify=e}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var e=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=u(u({},this.options),o),i=s.port,a=s.host,c=s.secure,h=s.protocol;this.socket&&this.close();var E=c?"wss":"ws",Y={address:a,family:E,port:i,size:0};this.socket=new me("".concat(E,"://").concat(a,":").concat(i),h),this.socket.binaryType="arraybuffer",this.socketStatus=ze,this.socket.onopen=function(){e.socketStatus=Ge,e.notify("open")},this.socket.onclose=function(){e.socketStatus=Ze,e.notify("close")},this.socket.onerror=function(ee){e.notify("error",ee)},this.socket.onmessage=function(ee){e.notify(ee.data,Y)}}},{key:"close",value:function(){this.socketStatus=$e,this.socket.close()}},{key:"send",value:function(e){this.socket.send(e)}}]),n}(N),Je=0,Ke=1,Qe=2,Xe=3,Ye=function(r){g(n,r);var t=d(n);function n(e){throw f(this,n),t.call(this),new Error("WebsocketServerPlugin can not be used in browser context")}return l(n,[{key:"registerNotify",value:function(e){this.notify=e}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var e=this,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=u(u({},this.options),o),i=s.port,a=s.host,c={address:a,family:"wsserver",port:i,size:0};this.socket&&this.close(),s.server?this.socket=new X({server:s.server}):this.socket=new X({host:a,port:i}),this.socket.binaryType="arraybuffer",this.socketStatus=Je,this.socket.on("listening",function(){e.socketStatus=Ke,e.notify("open")}),this.socket.on("error",function(h){e.notify("error",h)}),this.socket.on("connection",function(h){h.on("message",function(E){e.notify(new Uint8Array(E),c)})})}},{key:"close",value:function(){var e=this;this.socketStatus=Qe,this.socket.close(function(){e.socketStatus=Xe,e.notify("close")})}},{key:"send",value:function(e){this.socket.clients.forEach(function(o){o.send(e,{binary:!0})})}}]),n}(N),et={discardLateMessages:!1,plugin:new be},k=function(){function r(t){if(f(this,r),t&&!G(t))throw new Error("OSC options argument has to be an object.");this.options=u(u({},et),t),this.eventHandler=new Be({discardLateMessages:this.options.discardLateMessages});var n=this.eventHandler;this.options.plugin&&this.options.plugin.registerNotify&&this.options.plugin.registerNotify(function(){return n.notify.apply(n,arguments)})}return l(r,[{key:"on",value:function(t,n){if(!w(t)||!B(n))throw new Error("OSC on() needs event- or address string and callback function");return this.eventHandler.on(t,n)}},{key:"off",value:function(t,n){if(!w(t)||!m(n))throw new Error("OSC off() needs string and number (subscriptionId) to unsubscribe");return this.eventHandler.off(t,n)}},{key:"open",value:function(t){if(t&&!G(t))throw new Error("OSC open() options argument needs to be an object");if(!this.options.plugin||!B(this.options.plugin.open))throw new Error("OSC Plugin API #open is not implemented!");return this.options.plugin.open(t)}},{key:"status",value:function(){if(!this.options.plugin||!B(this.options.plugin.status))throw new Error("OSC Plugin API #status is not implemented!");return this.options.plugin.status()}},{key:"close",value:function(){if(!this.options.plugin||!B(this.options.plugin.close))throw new Error("OSC Plugin API #close is not implemented!");return this.options.plugin.close()}},{key:"send",value:function(t,n){if(!this.options.plugin||!B(this.options.plugin.send))throw new Error("OSC Plugin API #send is not implemented!");if(!(t instanceof Q||t instanceof O||t instanceof I||t instanceof H))throw new Error("OSC send() needs Messages, Bundles or Packets");if(n&&!G(n))throw new Error("OSC send() options argument has to be an object");return this.options.plugin.send(t.pack(),n)}}]),r}();return k.STATUS={IS_NOT_INITIALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3},k.Packet=H,k.Bundle=I,k.Message=O,k.TypedMessage=Q,k.Plugin=N,k.DatagramPlugin=Ne,k.WebsocketClientPlugin=be,k.WebsocketServerPlugin=Ye,k.BridgePlugin=Re,k})})(Oe);var ot=Oe.exports;const te=tt(ot);let V;function st(){return V||(V=new Promise((D,C)=>{const y=new te;y.open(),y.on("open",()=>{const u=y.options?.plugin?.socket?.url;rt(`[osc] connected${u?` to ${u}`:""}`),D(y)}),y.on("close",()=>{V=void 0,console.log("[osc] disconnected"),C("OSC connection closed")}),y.on("error",u=>C(u))}).catch(D=>{throw V=void 0,new Error("Could not connect to OSC server. Is it running?")})),V}nt.prototype.osc=function(){return this.onTrigger(async(D,C,y,u=1)=>{C.ensureObjectValue();const f=await st(),U=C.wholeOrPart().begin.valueOf(),l=C.duration.valueOf(),S=Object.assign({},{cps:u,cycle:U,delta:l},C.value);S.n&&(S.n=Se(S.n)),S.note&&(S.note=Se(S.note));const g=Object.entries(S).flat(),p=(D-y)*1e3,j=Math.floor(Date.now()+p),z=new te.Message("/dirt/play",...g),d=new te.Bundle([z],j);d.timestamp(j),f.send(d)})};
//# sourceMappingURL=osc.35ce10d7.js.map
