import{j as e}from"./jsx-runtime.7_bh7l-E.js";import{h as S,w as Fe,x as Be,y as Le,z as He,A as $e,B as pe,C as fe,D as _,j as xe,E as B,s as x,F as Ue,G as Ke,H as se,I as We,u as ge,J as ve,K as A,L as ze,M as Ze,r as Ge,q as be,N as Ve,O as qe,v as Xe,m as L,P as H,Q as Je,R as ae,S as Ye,T as re,U as Qe,g as et,V as tt,W as nt}from"./util.DLPoamJT.js";import{c as b,B as K,a as st}from"./PatternsTab.DT4cTR2-.js";import{l as X,j as at,h as rt,K as ot}from"./index.lg0qkVDO.js";import{u as we}from"./useEvent.BOPqR2Wl.js";import{r as m,R as it}from"./index.CPLOniuq.js";import{j as lt,a as ct,S as dt,t as ut,d as oe}from"./preload-helper.s5mF4tiM.js";import{s as ht,g as ie,e as mt,i as pt,w as ft,f as xt,h as gt,j as vt}from"./scope.Dtq5cmHt.js";/* empty css                      */import{g as je}from"./index.DrQ6bw7J.js";import{clearHydra as le}from"./hydra.CpN15i8b.js";import{oscTriggerTauri as bt}from"./oscbridge.DCsPx5KG.js";import{i as wt}from"./utils.CYk0bZBi.js";import{oscTrigger as jt}from"./osc.DCJTolPU.js";import"./_commonjsHelpers.BosuxZz1.js";function J({active:t}){return e.jsx("div",{className:"overflow-hidden opacity-50 fixed top-0 left-0 w-full z-[1000]",children:e.jsx("div",{className:b("h-[2px] block w-full",t?"bg-foreground animate-train":"bg-transparent"),children:e.jsx("div",{})})})}function yt(){const[t,n]=m.useState([]),{fontFamily:s,fontSize:a}=S();return Ct(m.useCallback(r=>{const{message:c,type:d,data:o}=r.detail;n(i=>{const u=i.length?i[i.length-1]:void 0,l=Fe(12);if(d==="loaded-sample"){const p=i.findIndex(({data:{url:g},type:f})=>f==="load-sample"&&g===o.url);i[p]={message:c,type:d,id:l,data:o}}else u&&u.message===c?i=i.slice(0,-1).concat([{message:c,type:d,count:(u.count??1)+1,id:l,data:o}]):i=i.concat([{message:c,type:d,id:l,data:o}]);return i.slice(-20)})},[])),e.jsx("div",{id:"console-tab",className:"break-all px-4 dark:text-white text-stone-900 text-sm py-2 space-y-1",style:{fontFamily:s,fontSize:a},children:t.map((r,c)=>{const d=Tt(r.message),o=r.data?.hap?.value?.color;return e.jsxs("div",{className:b(r.type==="error"&&"text-red-500",r.type==="highlight"&&"underline"),style:o?{color:o}:{},children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:d}}),r.count?` (${r.count})`:""]},r.id)})})}function Tt(t){var n,s,a,r;return s=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,n=t.replace(s,'<a class="underline" href="$1" target="_blank">$1</a>'),a=/(^|[^\/])(www\.[\S]+(\b|$))/gim,n=n.replace(a,'$1<a class="underline" href="http://$2" target="_blank">$2</a>'),r=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,n=n.replace(r,'<a class="underline" href="mailto:$1">$1</a>'),n}function Ct(t){we(X.key,t)}function Et(){const[t,n]=m.useState([]);m.useEffect(()=>(Be("",{dir:Le,recursive:!0}).then(o=>n([{name:"~/music",children:o}])).catch(o=>{console.log("error loadin files",o)}),()=>{}),[]);const s=m.useMemo(()=>t[t.length-1],[t]),a=m.useMemo(()=>t.slice(1).map(o=>o.name).join("/"),[t]),r=m.useMemo(()=>s?.children.filter(o=>!!o.children),[s]),c=m.useMemo(()=>s?.children.filter(o=>!o.children&&He(o.name)),[s]),d=o=>n(i=>i.concat([o]));return e.jsxs("div",{className:"px-4 flex flex-col h-full",children:[e.jsx("div",{className:"flex justify-between font-mono pb-1",children:e.jsxs("div",{children:[e.jsx("span",{children:"samples('"}),t?.map((o,i)=>i<t.length-1?e.jsxs(m.Fragment,{children:[e.jsx("span",{className:"cursor-pointer underline",onClick:()=>n(u=>u.slice(0,i+1)),children:o.name}),e.jsx("span",{children:"/"})]},i):e.jsx("span",{className:"cursor-pointer underline",children:o.name},i)),e.jsx("span",{children:"')"})]})}),e.jsxs("div",{className:"overflow-auto",children:[!r?.length&&!c?.length&&e.jsx("span",{className:"text-gray-500",children:"Nothing here"}),r?.map((o,i)=>e.jsx("div",{className:"cursor-pointer",onClick:()=>d(o),children:o.name},i)),c?.map((o,i)=>e.jsx("div",{className:"text-gray-500 cursor-pointer select-none",onClick:async()=>$e(`${a}/${o.name}`),children:o.name},i))]})]})}const Nt=lt.docs.filter(({name:t,description:n})=>t&&!t.startsWith("_")&&!!n).sort((t,n)=>t.name.localeCompare(n.name)),kt=t=>{var n=document.createElement("div");return n.innerHTML=t,n.textContent||n.innerText||""};function St(){const[t,n]=m.useState(""),s=m.useMemo(()=>Nt.filter(a=>t?a.name.includes(t)||(a.synonyms?.some(r=>r.includes(t))??!1):!0),[t]);return e.jsxs("div",{className:"flex h-full w-full p-2 text-foreground overflow-hidden",children:[e.jsxs("div",{className:"h-full  flex flex-col gap-2 w-1/3 max-w-72 ",children:[e.jsx("div",{class:"w-full flex",children:e.jsx("input",{className:"w-full p-1 bg-background rounded-md border-none",placeholder:"Search",value:t,onInput:a=>n(a.target.value)})}),e.jsx("div",{className:"flex flex-col h-full overflow-y-auto  gap-1.5 bg-background bg-opacity-50  rounded-md",children:s.map((a,r)=>e.jsxs("a",{className:"cursor-pointer flex-none hover:bg-lineHighlight overflow-x-hidden  px-1 text-ellipsis",onClick:()=>{const c=document.getElementById(`doc-${r}`);document.getElementById("reference-container").scrollTo(0,c.offsetTop)},children:[a.name," "]},r))})]}),e.jsx("div",{className:"break-normal flex-grow flex-col overflow-y-auto overflow-x-hidden   px-2 flex relative",id:"reference-container",children:e.jsxs("div",{className:"prose dark:prose-invert min-w-full px-1 ",children:[e.jsx("h2",{children:"API Reference"}),e.jsx("p",{children:"This is the long list functions you can use! Remember that you don't need to remember all of those and that you can already make music with a small set of functions!"}),s.map((a,r)=>e.jsxs("section",{children:[e.jsx("h3",{id:`doc-${r}`,children:a.name}),!!a.synonyms_text&&e.jsxs("p",{children:["Synonyms: ",e.jsx("code",{children:a.synonyms_text})]}),e.jsx("p",{dangerouslySetInnerHTML:{__html:a.description}}),e.jsx("ul",{children:a.params?.map(({name:c,type:d,description:o},i)=>e.jsxs("li",{children:[c," : ",d.names?.join(" | ")," ",o?e.jsxs(e.Fragment,{children:[" - ",kt(o)]}):""]},i))}),a.examples?.map((c,d)=>e.jsx("pre",{children:c},d))]},r))]})})]})}function ye({value:t,options:n,onChange:s,onClick:a,isDisabled:r}){return e.jsxs("select",{disabled:r,onClick:a,className:"p-2 bg-background rounded-md text-foreground",value:t??"",onChange:c=>s(c.target.value),children:[n.size==0&&e.jsx("option",{value:t,children:`${t??"select an option"}`}),Array.from(n.keys()).map(c=>e.jsx("option",{className:"bg-background",value:c,children:n.get(c)},c))]})}const Rt=new Map;function Pt({audioDeviceName:t,onChange:n,isDisabled:s}){const[a,r]=m.useState(Rt),c=a.size>0,d=()=>{c||pe().then(u=>{r(u)})},o=u=>{if(!c)return;const l=a.get(u);n(u),fe(l)},i=new Map;return Array.from(a.keys()).forEach(u=>{i.set(u,u)}),e.jsx(ye,{isDisabled:s,options:i,onClick:d,value:t,onChange:o})}function _t({target:t,onChange:n,isDisabled:s}){const a=c=>{n(c)},r=new Map([[_.webaudio,_.webaudio],[_.osc,_.osc]]);return e.jsxs("div",{className:" flex flex-col gap-1",children:[e.jsx(ye,{isDisabled:s,options:r,value:t,onChange:a}),t===_.osc&&e.jsx("div",{children:e.jsxs("p",{className:"text-sm italic",children:["âš  All events routed to OSC, audio is silenced! See"," ",e.jsx("a",{className:"text-blue-500",href:"https://strudel.cc/learn/input-output/",children:"Docs"})]})})]})}function y({label:t,value:n,onChange:s,disabled:a=!1}){return e.jsxs("label",{children:[e.jsx("input",{disabled:a,type:"checkbox",checked:n,onChange:s})," "+t]})}function ce({value:t,options:n,onChange:s}){return e.jsx("select",{className:"p-2 bg-background rounded-md text-foreground",value:t,onChange:a=>s(a.target.value),children:Object.entries(n).map(([a,r])=>e.jsx("option",{className:"bg-background",value:a,children:r},a))})}function Mt({value:t,onChange:n,step:s=1,...a}){return e.jsxs("div",{className:"flex space-x-2 gap-1",children:[e.jsx("input",{className:"p-2 grow",type:"range",value:t,step:s,onChange:r=>n(Number(r.target.value)),...a}),e.jsx("input",{type:"number",value:t,step:s,className:"w-16 bg-background rounded-md",onChange:r=>n(Number(r.target.value))})]})}function T({label:t,children:n}){return e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{children:t}),n]})}const At=Object.fromEntries(Object.keys(ct).map(t=>[t,t])),It={monospace:"monospace",Courier:"Courier",JetBrains:"JetBrains",Hack:"Hack",FiraCode:"FiraCode","FiraCode-SemiBold":"FiraCode SemiBold",teletext:"teletext",mode7:"mode7",BigBlueTerminal:"BigBlueTerminal",x3270:"x3270",Monocraft:"Monocraft",PressStart:"PressStart2P","we-come-in-peace":"we-come-in-peace",galactico:"galactico"},G="Changing this setting requires the window to reload itself. OK?";function Dt({started:t}){const{theme:n,keybindings:s,isBracketClosingEnabled:a,isBracketMatchingEnabled:r,isLineNumbersDisplayed:c,isPatternHighlightingEnabled:d,isActiveLineHighlighted:o,isAutoCompletionEnabled:i,isTooltipEnabled:u,isFlashEnabled:l,isButtonRowHidden:p,isCSSAnimationDisabled:g,isSyncEnabled:f,isLineWrappingEnabled:I,fontSize:R,fontFamily:D,panelPosition:z,audioDeviceName:O,audioEngineTarget:Z,togglePanelTrigger:F}=S(),ee=xe(),te=AudioContext.prototype.setSinkId!=null;return e.jsxs("div",{className:"text-foreground p-4 space-y-4 w-full",children:[te&&e.jsx(T,{label:"Audio Output Device",children:e.jsx(Pt,{isDisabled:t,audioDeviceName:O,onChange:h=>{B(G).then(v=>{if(v==!0)return x.setKey("audioDeviceName",h),window.location.reload()})}})}),e.jsx(T,{label:"Audio Engine Target",children:e.jsx(_t,{target:Z,onChange:h=>{B(G).then(v=>{if(v==!0)return x.setKey("audioEngineTarget",h),window.location.reload()})}})}),e.jsx(T,{label:"Theme",children:e.jsx(ce,{options:At,value:n,onChange:h=>x.setKey("theme",h)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(T,{label:"Font Family",children:e.jsx(ce,{options:It,value:D,onChange:h=>x.setKey("fontFamily",h)})}),e.jsx(T,{label:"Font Size",children:e.jsx(Mt,{value:R,onChange:h=>x.setKey("fontSize",h),min:10,max:40,step:2})})]}),e.jsx(T,{label:"Keybindings",children:e.jsx(K,{value:s,onChange:h=>x.setKey("keybindings",h),items:{codemirror:"Codemirror",vim:"Vim",emacs:"Emacs",vscode:"VSCode"}})}),e.jsx(T,{label:"Panel Position",children:e.jsx(K,{value:z,onChange:h=>x.setKey("panelPosition",h),items:{bottom:"Bottom",right:"Right"}})}),e.jsx(T,{label:"Open Panel on:                       ",children:e.jsx(K,{value:F,onChange:h=>x.setKey("togglePanelTrigger",h),items:{click:"Click",hover:"Hover"}})}),e.jsxs(T,{label:"More Settings",children:[e.jsx(y,{label:"Enable bracket matching",onChange:h=>x.setKey("isBracketMatchingEnabled",h.target.checked),value:r}),e.jsx(y,{label:"Auto close brackets",onChange:h=>x.setKey("isBracketClosingEnabled",h.target.checked),value:a}),e.jsx(y,{label:"Display line numbers",onChange:h=>x.setKey("isLineNumbersDisplayed",h.target.checked),value:c}),e.jsx(y,{label:"Highlight active line",onChange:h=>x.setKey("isActiveLineHighlighted",h.target.checked),value:o}),e.jsx(y,{label:"Highlight events in code",onChange:h=>x.setKey("isPatternHighlightingEnabled",h.target.checked),value:d}),e.jsx(y,{label:"Enable auto-completion",onChange:h=>x.setKey("isAutoCompletionEnabled",h.target.checked),value:i}),e.jsx(y,{label:"Enable tooltips on Ctrl and hover",onChange:h=>x.setKey("isTooltipEnabled",h.target.checked),value:u}),e.jsx(y,{label:"Enable line wrapping",onChange:h=>x.setKey("isLineWrappingEnabled",h.target.checked),value:I}),e.jsx(y,{label:"Enable flashing on evaluation",onChange:h=>x.setKey("isFlashEnabled",h.target.checked),value:l}),e.jsx(y,{label:"Sync across Browser Tabs / Windows",onChange:h=>{const v=h.target.checked;B(G).then(w=>{w&&(x.setKey("isSyncEnabled",v),window.location.reload())})},disabled:ee,value:f}),e.jsx(y,{label:"Hide top buttons",onChange:h=>x.setKey("isButtonRowHidden",h.target.checked),value:p}),e.jsx(y,{label:"Disable CSS Animations",onChange:h=>x.setKey("isCSSAnimationDisabled",h.target.checked),value:g})]}),e.jsx(T,{label:"Zen Mode",children:"Try clicking the logo in the top left!"}),e.jsx(T,{label:"Reset Settings",children:e.jsx("button",{className:"bg-background p-2 max-w-[300px] rounded-md hover:opacity-50",onClick:()=>{B("Sure?").then(h=>{h&&x.set(Ue)})},children:"restore default settings"})})]})}function Ot({onComplete:t}){let n=it.createRef();const[s,a]=m.useState(!1),r=m.useCallback(async()=>{n.current.files?.length&&(a(!0),await Ke(se,n.current.files).then(()=>{We(se,()=>{t(),a(!1)})}))});return e.jsxs("label",{style:{alignItems:"center"},className:"flex bg-background ml-2 pl-2 pr-2 max-w-[300px] rounded-md hover:opacity-50 whitespace-nowrap cursor-pointer",children:[e.jsx("input",{disabled:s,ref:n,id:"audio_file",style:{display:"none"},type:"file",directory:"",webkitdirectory:"",multiple:!0,accept:"audio/*, .wav, .mp3, .m4a, .flac, .aac, .ogg",onChange:()=>{r()}}),s?"importing...":"import sounds"]})}const Ft=t=>Array.isArray(t)?t.length:typeof t=="object"?Object.values(t).length:1;function Bt(){const t=ge(ht),{soundsFilter:n}=S(),[s,a]=m.useState(""),r=m.useMemo(()=>{if(!t)return[];let d=Object.entries(t).filter(([o])=>!o.startsWith("_")).sort((o,i)=>o[0].localeCompare(i[0])).filter(([o])=>o.toLowerCase().includes(s.toLowerCase()));return n==="user"?d.filter(([o,{data:i}])=>!i.prebake):n==="drums"?d.filter(([o,{data:i}])=>i.type==="sample"&&i.tag==="drum-machines"):n==="samples"?d.filter(([o,{data:i}])=>i.type==="sample"&&i.tag!=="drum-machines"):n==="synths"?d.filter(([o,{data:i}])=>["synth","soundfont"].includes(i.type)):d},[t,n,s]),c=m.useRef();return we("mouseup",()=>{const d=c.current;c.current=void 0,d?.then(o=>{o?.stop(ie().currentTime+.01)})}),e.jsxs("div",{id:"sounds-tab",className:"px-4 flex flex-col w-full h-full  dark:text-white text-stone-900",children:[e.jsx("input",{className:"w-full p-1 bg-background rounded-md my-2",placeholder:"Search",value:s,onChange:d=>a(d.target.value)}),e.jsxs("div",{className:"pb-2 flex shrink-0 flex-wrap",children:[e.jsx(K,{value:n,onChange:d=>x.setKey("soundsFilter",d),items:{samples:"samples",drums:"drum-machines",synths:"Synths",user:"User"}}),e.jsx(Ot,{onComplete:()=>x.setKey("soundsFilter","user")})]}),e.jsxs("div",{className:"min-h-0 max-h-full grow overflow-auto font-mono text-sm break-normal pb-2",children:[r.map(([d,{data:o,onTrigger:i}])=>e.jsxs("span",{className:"cursor-pointer hover:opacity-50",onMouseDown:async()=>{const u=ie(),l={note:["synth","soundfont"].includes(o.type)?"a3":void 0,s:d,clip:1,release:.5,sustain:1,duration:.5},p=u.currentTime+.05,g=()=>c.current?.node?.disconnect();c.current=Promise.resolve(i(p,l,g)),c.current.then(f=>{mt(f?.node)})},children:[" ",d,o?.type==="sample"?`(${Ft(o.samples)})`:"",o?.type==="soundfont"?`(${o.fonts.length})`:""]},d)),r.length?"":"No custom sounds loaded in this pattern (yet)."]})]})}const Lt={ASSETS_PREFIX:void 0,BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SITE:"https://strudel.cc/",SSR:!1},{BASE_URL:V}=Lt,Ht=V.endsWith("/")?V.slice(0,-1):V;function $t({context:t}){return e.jsxs("div",{className:"prose dark:prose-invert min-w-full pt-2 font-sans pb-8 px-4 ",children:[e.jsx("h3",{children:"ê©œ welcome"}),e.jsxs("p",{children:["You have found ",e.jsx("span",{className:"underline",children:"strudel"}),", a new live coding platform to write dynamic music pieces in the browser! It is free and open-source and made for beginners and experts alike. To get started:",e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{className:"underline",children:"1. hit play"})," - ",e.jsx("span",{className:"underline",children:"2. change something"})," -"," ",e.jsx("span",{className:"underline",children:"3. hit update"}),e.jsx("br",{}),"If you don't like what you hear, try ",e.jsx("span",{className:"underline",children:"shuffle"}),"!"]}),e.jsxs("p",{children:["To learn more about what this all means, check out the"," ",e.jsx("a",{href:`${Ht}/workshop/getting-started/`,target:"_blank",children:"interactive tutorial"}),". Also feel free to join the"," ",e.jsx("a",{href:"https://discord.com/invite/HGEdXmRkzT",target:"_blank",children:"tidalcycles discord channel"})," ","to ask any questions, give feedback or just say hello."]}),e.jsx("h3",{children:"ê©œ about"}),e.jsxs("p",{children:["strudel is a JavaScript version of"," ",e.jsx("a",{href:"https://tidalcycles.org/",target:"_blank",children:"tidalcycles"}),", which is a popular live coding language for music, written in Haskell. Strudel is free/open source software: you can redistribute and/or modify it under the terms of the"," ",e.jsx("a",{href:"https://github.com/tidalcycles/strudel/blob/main/LICENSE",target:"_blank",children:"GNU Affero General Public License"}),". You can find the source code at"," ",e.jsx("a",{href:"https://github.com/tidalcycles/strudel",target:"_blank",children:"github"}),". Please consider to"," ",e.jsx("a",{href:"https://opencollective.com/tidalcycles",target:"_blank",children:"support this project"})," ","to ensure ongoing development ðŸ’–"]})]})}function Ut({title:t,titleId:n,...s},a){return m.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":n},s),t?m.createElement("title",{id:n},t):null,m.createElement("path",{fillRule:"evenodd",d:"M9.78 4.22a.75.75 0 0 1 0 1.06L7.06 8l2.72 2.72a.75.75 0 1 1-1.06 1.06L5.47 8.53a.75.75 0 0 1 0-1.06l3.25-3.25a.75.75 0 0 1 1.06 0Z",clipRule:"evenodd"}))}const Kt=m.forwardRef(Ut);function Wt({title:t,titleId:n,...s},a){return m.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":n},s),t?m.createElement("title",{id:n},t):null,m.createElement("path",{d:"M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z"}))}const zt=m.forwardRef(Wt),Zt=typeof window<"u"&&window.__TAURI__;function Te({context:t}){const n=S(),{isPanelOpen:s,activeFooter:a}=n;return e.jsxs(Ce,{settings:n,className:b(s?"min-h-[360px] max-h-[360px]":"min-h-12 max-h-12","overflow-hidden flex flex-col"),children:[s&&e.jsx("div",{className:"flex h-full overflow-auto pr-10 ",children:e.jsx(Ee,{context:t,tab:a})}),e.jsx("div",{className:"absolute right-4 pt-4",children:e.jsx(ke,{settings:n})}),e.jsx("div",{className:"flex  justify-between min-h-12 max-h-12 grid-cols-2 items-center",children:e.jsx(Ne,{setTab:ve,tab:a})})]})}function Gt({context:t}){const n=S(),{activeFooter:s,isPanelOpen:a}=n;return e.jsx(Ce,{settings:n,className:b(a?"min-w-[min(600px,80vw)] max-w-[min(600px,80vw)]":"min-w-12 max-w-12"),children:a?e.jsxs("div",{className:b("flex flex-col h-full"),children:[e.jsxs("div",{className:"flex justify-between w-full ",children:[e.jsx(Ne,{setTab:ve,tab:s}),e.jsx(ke,{settings:n})]}),e.jsx("div",{className:"overflow-auto h-full",children:e.jsx(Ee,{context:t,tab:s})})]}):e.jsx("button",{onClick:r=>{A(!0)},"aria-label":"open menu panel",className:b("flex flex-col hover:bg-lineBackground items-center cursor-pointer justify-center w-full  h-full"),children:e.jsx(Kt,{className:"text-foreground opacity-50 w-6 h-6"})})})}const C={welcome:"intro",patterns:"patterns",sounds:"sounds",reference:"reference",console:"console",settings:"settings"};Zt&&(C.files="files");function Ce({children:t,className:n,settings:s,...a}){const r=s.togglePanelTrigger==="hover";return e.jsx("nav",{onClick:()=>{s.isPanelOpen||A(!0)},onMouseEnter:()=>{r&&!s.isPanelOpen&&A(!0)},onMouseLeave:()=>{r&&!s.isPanelPinned&&A(!1)},"aria-label":"Menu Panel",className:b("bg-lineHighlight group overflow-x-auto",n),...a,children:t})}function Ee({context:t,tab:n}){switch(n){case C.patterns:return e.jsx(st,{context:t});case C.console:return e.jsx(yt,{});case C.sounds:return e.jsx(Bt,{});case C.reference:return e.jsx(St,{});case C.settings:return e.jsx(Dt,{started:t.started});case C.files:return e.jsx(Et,{});default:return e.jsx($t,{context:t})}}function Vt({label:t,isSelected:n,onClick:s}){return e.jsx(e.Fragment,{children:e.jsx("button",{onClick:s,className:b("h-8 px-2 text-foreground cursor-pointer hover:opacity-50 flex items-center space-x-1 border-b",n?"border-foreground":"border-transparent"),children:t})})}function Ne({setTab:t,tab:n,className:s}){return e.jsx("div",{className:b("flex select-none max-w-full overflow-auto pb-2",s),children:Object.keys(C).map(a=>{const r=C[a];return e.jsx(Vt,{isSelected:n===r,label:a,onClick:()=>t(r)},a)})})}function ke({settings:t}){const{togglePanelTrigger:n,isPanelPinned:s,isPanelOpen:a}=t,r=n==="hover";if(a)return r?e.jsx(qt,{pinned:s}):e.jsx(Xt,{onClick:()=>A(!1)})}function qt({pinned:t}){return e.jsx("button",{onClick:()=>ze(!t),className:b("text-foreground max-h-8 min-h-8 max-w-8 min-w-8 items-center justify-center p-1.5 group-hover:flex",t?"flex":"hidden"),"aria-label":"Pin Menu Panel",children:e.jsx("svg",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",className:"w-full h-full",opacity:t?1:".3",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588-.177 0-.335-.018-.46-.039l-3.134 3.134a6 6 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828-3.182 3.182c-.195.195-1.219.902-1.414.707s.512-1.22.707-1.414l3.182-3.182-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767 2.375-.72a6 6 0 0 1 1.013.16l3.134-3.133a3 3 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146"})})})}function Xt({onClick:t}){return e.jsx("button",{onClick:t,className:b("text-foreground max-h-8 min-h-8 max-w-8 min-w-8 items-center justify-center p-1.5 group-hover:flex"),"aria-label":"Close Menu",children:e.jsx(zt,{})})}function Y(t){const{editorRef:n,containerRef:s,init:a}=t;return e.jsx("section",{className:"text-gray-100 cursor-text pb-0 overflow-auto grow",id:"code",ref:r=>{s.current=r,n.current||a()}})}function Jt({title:t,titleId:n,...s},a){return m.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":n},s),t?m.createElement("title",{id:n},t):null,m.createElement("path",{fillRule:"evenodd",d:"M2 10a8 8 0 1 1 16 0 8 8 0 0 1-16 0Zm6.39-2.908a.75.75 0 0 1 .766.027l3.5 2.25a.75.75 0 0 1 0 1.262l-3.5 2.25A.75.75 0 0 1 8 12.25v-4.5a.75.75 0 0 1 .39-.658Z",clipRule:"evenodd"}))}const Se=m.forwardRef(Jt);function Re(t){const{started:n,handleTogglePlay:s}=t;if(!n)return e.jsxs("button",{onClick:()=>s(),className:"text-white text-2xl fixed left-[50%] top-[50%] translate-x-[-50%] translate-y-[-50%] z-[1000] m-auto p-4 bg-black rounded-md flex items-center space-x-2",children:[e.jsx(Se,{className:"w-6 h-6"}),e.jsx("span",{children:"play"})]})}function Q(t){const{error:n}=t;if(n!=null)return e.jsx("div",{className:"text-red-500 p-4 bg-lineHighlight animate-pulse",children:n.message||"Unknown Error :-/"})}function Yt(t){const{context:n}=t,{containerRef:s,editorRef:a,error:r,init:c,pending:d,started:o,handleTogglePlay:i}=n;return e.jsxs("div",{className:"h-full flex w-full flex-col relative",children:[e.jsx(J,{active:d}),e.jsx(Re,{started:o,handleTogglePlay:i}),e.jsx("div",{className:"grow flex relative overflow-hidden",children:e.jsx(Y,{containerRef:s,editorRef:a,init:c})}),e.jsx(Q,{error:r}),e.jsx(Te,{context:n})]})}function Qt({title:t,titleId:n,...s},a){return m.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":n},s),t?m.createElement("title",{id:n},t):null,m.createElement("path",{fillRule:"evenodd",d:"M2 10a8 8 0 1 1 16 0 8 8 0 0 1-16 0Zm5-2.25A.75.75 0 0 1 7.75 7h4.5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-.75.75h-4.5a.75.75 0 0 1-.75-.75v-4.5Z",clipRule:"evenodd"}))}const en=m.forwardRef(Qt),tn={ASSETS_PREFIX:void 0,BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SITE:"https://strudel.cc/",SSR:!1},{BASE_URL:q}=tn,de=q.endsWith("/")?q.slice(0,-1):q;function Pe({context:t,embedded:n=!1}){const{started:s,pending:a,isDirty:r,activeCode:c,handleTogglePlay:d,handleEvaluate:o,handleShuffle:i,handleShare:u}=t,l=typeof window<"u"&&(n||window.location!==window.parent.location),{isZen:p,isButtonRowHidden:g,isCSSAnimationDisabled:f}=S();return e.jsxs("header",{id:"header",className:b("flex-none text-black  z-[100] text-lg select-none h-20 md:h-14",!p&&!l&&"bg-lineHighlight",p?"h-12 w-8 fixed top-0 left-0":"sticky top-0 w-full py-1 justify-between",l?"flex":"md:flex"),children:[e.jsx("div",{className:"px-4 flex space-x-2 md:pt-0 select-none",children:e.jsxs("h1",{onClick:()=>{l&&window.open(window.location.href.replace("embed",""))},className:b(l?"text-l cursor-pointer":"text-xl","text-foreground font-bold flex space-x-2 items-center"),children:[e.jsx("div",{className:b("mt-[1px]",s&&!f&&"animate-spin","cursor-pointer text-blue-500",p&&"fixed top-2 right-4"),onClick:()=>{l||Ze(!p)},children:e.jsx("span",{className:"block rotate-90",children:"ê©œ"})}),!p&&e.jsxs("div",{className:"space-x-2",children:[e.jsx("span",{className:"",children:"strudel"}),e.jsx("span",{className:"text-sm font-medium",children:"REPL"}),!l&&g&&e.jsx("a",{href:`${de}/learn`,className:"text-sm opacity-25 font-medium",children:"DOCS"})]})]})}),!p&&!g&&e.jsxs("div",{className:"flex max-w-full overflow-auto text-foreground px-1 md:px-2",children:[e.jsx("button",{onClick:d,title:s?"stop":"play",className:b(l?"px-2":"p-2","hover:opacity-50",!s&&!f&&"animate-pulse"),children:a?e.jsx(e.Fragment,{children:"loading..."}):e.jsxs("span",{className:b("flex items-center space-x-2"),children:[s?e.jsx(en,{className:"w-6 h-6"}):e.jsx(Se,{className:"w-6 h-6"}),!l&&e.jsx("span",{children:s?"stop":"play"})]})}),e.jsx("button",{onClick:o,title:"update",className:b("flex items-center space-x-1",l?"px-2":"p-2",!r||!c?"opacity-50":"hover:opacity-50"),children:!l&&e.jsx("span",{children:"update"})}),!l&&e.jsx("button",{title:"shuffle",className:"hover:opacity-50 p-2 flex items-center space-x-1",onClick:i,children:e.jsx("span",{children:" shuffle"})}),!l&&e.jsx("button",{title:"share",className:b("cursor-pointer hover:opacity-50 flex items-center space-x-1",l?"px-2":"p-2"),onClick:u,children:e.jsx("span",{children:"share"})}),!l&&e.jsx("a",{title:"learn",href:`${de}/workshop/getting-started/`,className:b("hover:opacity-50 flex items-center space-x-1",l?"px-2":"p-2"),children:e.jsx("span",{children:"learn"})})]})]})}function nn(t){const{context:n}=t,{containerRef:s,editorRef:a,error:r,init:c,pending:d}=n,o=S(),{panelPosition:i,isZen:u}=o;return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsx(J,{active:d}),e.jsx(Pe,{context:n}),e.jsxs("div",{className:"grow flex relative overflow-hidden",children:[e.jsx(Y,{containerRef:s,editorRef:a,init:c}),!u&&i==="right"&&e.jsx(Gt,{context:n})]}),e.jsx(Q,{error:r}),!u&&i==="bottom"&&e.jsx(Te,{context:n})]})}function sn(t){const{context:n}=t,{pending:s,started:a,handleTogglePlay:r,containerRef:c,editorRef:d,error:o,init:i}=n;return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsx(J,{active:s}),e.jsx(Pe,{context:n,embedded:!0}),e.jsx(Re,{started:a,handleTogglePlay:r}),e.jsx("div",{className:"grow flex relative overflow-hidden",children:e.jsx(Y,{containerRef:c,editorRef:d,init:i})}),e.jsx(Q,{error:o})]})}const an=wt()?bt:jt,rn=(t,n,s,a,r)=>{const c=performance.now()/1e3;return an(null,t,c,a,r)},on=t=>(n,s)=>(t.set(n,s),s),ue=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,_e=536870912,he=_e*2,ln=(t,n)=>s=>{const a=n.get(s);let r=a===void 0?s.size:a<he?a+1:0;if(!s.has(r))return t(s,r);if(s.size<_e){for(;s.has(r);)r=Math.floor(Math.random()*he);return t(s,r)}if(s.size>ue)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;s.has(r);)r=Math.floor(Math.random()*ue);return t(s,r)},Me=new WeakMap,cn=on(Me),$=ln(cn,Me),dn=t=>t.method!==void 0&&t.method==="call",un=t=>t.error===null&&typeof t.id=="number",hn=t=>{const n=new Map([[0,()=>{}]]),s=new Map([[0,()=>{}]]),a=new Map,r=new Worker(t);return r.addEventListener("message",({data:u})=>{if(dn(u)){const{params:{timerId:l,timerType:p}}=u;if(p==="interval"){const g=n.get(l);if(typeof g=="number"){const f=a.get(g);if(f===void 0||f.timerId!==l||f.timerType!==p)throw new Error("The timer is in an undefined state.")}else if(typeof g<"u")g();else throw new Error("The timer is in an undefined state.")}else if(p==="timeout"){const g=s.get(l);if(typeof g=="number"){const f=a.get(g);if(f===void 0||f.timerId!==l||f.timerType!==p)throw new Error("The timer is in an undefined state.")}else if(typeof g<"u")g(),s.delete(l);else throw new Error("The timer is in an undefined state.")}}else if(un(u)){const{id:l}=u,p=a.get(l);if(p===void 0)throw new Error("The timer is in an undefined state.");const{timerId:g,timerType:f}=p;a.delete(l),f==="interval"?n.delete(g):s.delete(g)}else{const{error:{message:l}}=u;throw new Error(l)}}),{clearInterval:u=>{const l=$(a);a.set(l,{timerId:u,timerType:"interval"}),n.set(u,l),r.postMessage({id:l,method:"clear",params:{timerId:u,timerType:"interval"}})},clearTimeout:u=>{const l=$(a);a.set(l,{timerId:u,timerType:"timeout"}),s.set(u,l),r.postMessage({id:l,method:"clear",params:{timerId:u,timerType:"timeout"}})},setInterval:(u,l=0)=>{const p=$(n);return n.set(p,()=>{u(),typeof n.get(p)=="function"&&r.postMessage({id:null,method:"set",params:{delay:l,now:performance.now(),timerId:p,timerType:"interval"}})}),r.postMessage({id:null,method:"set",params:{delay:l,now:performance.now(),timerId:p,timerType:"interval"}}),p},setTimeout:(u,l=0)=>{const p=$(s);return s.set(p,u),r.postMessage({id:null,method:"set",params:{delay:l,now:performance.now(),timerId:p,timerType:"timeout"}}),p}}},mn=(t,n)=>{let s=null;return()=>{if(s!==null)return s;const a=new Blob([n],{type:"application/javascript; charset=utf-8"}),r=URL.createObjectURL(a);return s=t(r),setTimeout(()=>URL.revokeObjectURL(r)),s}},pn=`(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error('The given type "'.concat(i,'" is not supported'));(e=>{const r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error('The given method "'.concat(s.method,'" is not supported'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error('The given type "'.concat(d,'" is not supported'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();`,Ae=mn(hn,pn),fn=t=>Ae().clearInterval(t),xn=(...t)=>Ae().setInterval(...t),{latestCode:me}=x.get();let W,Ie,U,De,Oe;typeof window<"u"&&(Oe=pt(),W=Ge(),Ie=be(),U=je(),De=()=>U.clearRect(0,0,U.canvas.height,U.canvas.width));async function gn(t){return W?(await W).find(s=>s.packageName===t):void 0}function vn(){const{isSyncEnabled:t,audioEngineTarget:n}=S(),s=n!==_.osc,a=s?ft:rn,r=s?xt:ot,c=m.useCallback(()=>{const v=[-2,2],w=je(),P=new dt({sync:t,defaultOutput:a,getTime:r,setInterval:xn,clearInterval:fn,transpiler:ut,autodraw:!1,root:I.current,initialCode:"// LOADING",pattern:at,drawTime:v,drawContext:w,prebake:async()=>Promise.all([W,Ie]),onUpdateState:E=>{o({...E})},onToggle:E=>{E||le()},beforeEval:()=>Oe,afterEval:E=>{const{code:j}=E;window.parent?.postMessage(j),Ve(j),window.location.hash="#"+rt(j),D(j);const N=qe();Xe(j);const M={...N,code:j};let k=M.id;if(N.collection!==L.collection){if(j!==N.code){const ne=L.duplicate(M);k=ne.id,H(ne.data)}}else k=L.isValidID(k)?k:Je(),H(L.update(k,M).data);ae(k)},bgFill:!1});window.strudelMirror=P,Ye().then(async E=>{let j,N;if(E)j=E,N="I have loaded the code from the URL.";else if(me)j=me,N="Your last session has been loaded!";else{const{code:M,name:k}=await re();j=M,N=`A random code snippet named "${k}" has been loaded!`}P.setCode(j),D(j),X(`Welcome to Strudel! ${N} Press play or hit ctrl+enter to run it!`,"highlight")}),f.current=P},[]),[d,o]=m.useState({}),{started:i,isDirty:u,error:l,activeCode:p,pending:g}=d,f=m.useRef(),I=m.useRef(),R=ge(x,{keys:Object.keys(oe)});m.useEffect(()=>{let v={};Object.keys(oe).forEach(w=>{Object.prototype.hasOwnProperty.call(R,w)&&(v[w]=R[w])}),f.current?.updateSettings(v)},[R]),m.useEffect(()=>{const{audioDeviceName:v}=R;v!==Qe&&pe().then(w=>{const P=w.get(v);P!=null&&fe(P)})},[]);const D=v=>{const w=et(v);document.title=(w.title?`${w.title} - `:"")+"Strudel REPL"},z=async()=>{f.current?.toggle()},O=async()=>{(await gn("@strudel/tonal"))?.resetVoicings(),gt(),De(),le(),vt(),f.current.repl.setCps(.5),await be()},Z=async(v,w=!1)=>{H(v),f.current.setCode(v.code),w&&(await O(),F())},F=()=>{f.current.evaluate()};return{started:i,pending:g,isDirty:u,activeCode:p,handleTogglePlay:z,handleUpdate:Z,handleShuffle:async()=>{const v=await re(),w=v.code;X(`[repl] âœ¨ loading random tune "${v.id}"`),ae(v.id),H(v),await O(),f.current.setCode(w),f.current.repl.evaluate(w)},handleShare:async()=>tt(d.code),handleEvaluate:F,init:c,error:l,editorRef:f,containerRef:I}}function On({embedded:t=!1}){const n=t||nt(),s=xe()?Yt:n?sn:nn,a=vn();return e.jsx(s,{context:a})}export{On as Repl};
//# sourceMappingURL=Repl.BginFvP8.js.map
