{"version":3,"file":"scope.CyWYA9A5.js","sources":["../../../packages/superdough/feedbackdelay.mjs","../../../packages/superdough/reverbGen.mjs","../../../packages/superdough/reverb.mjs","../../../packages/superdough/vowel.mjs","../../../packages/superdough/logger.mjs","../../../packages/superdough/util.mjs","../../../packages/superdough/helpers.mjs","../../../packages/superdough/sampler.mjs","../../../packages/superdough/superdough.mjs","../../../packages/superdough/dspworklet.mjs","../../../packages/webaudio/webaudio.mjs","../../../packages/webaudio/scope.mjs"],"sourcesContent":["if (typeof DelayNode !== 'undefined') {\n  class FeedbackDelayNode extends DelayNode {\n    constructor(ac, wet, time, feedback) {\n      super(ac);\n      wet = Math.abs(wet);\n      this.delayTime.value = time;\n\n      const feedbackGain = ac.createGain();\n      feedbackGain.gain.value = Math.min(Math.abs(feedback), 0.995);\n      this.feedback = feedbackGain.gain;\n\n      const delayGain = ac.createGain();\n      delayGain.gain.value = wet;\n      this.delayGain = delayGain;\n\n      this.connect(feedbackGain);\n      this.connect(delayGain);\n      feedbackGain.connect(this);\n\n      this.connect = (target) => delayGain.connect(target);\n      return this;\n    }\n    start(t) {\n      this.delayGain.gain.setValueAtTime(this.delayGain.gain.value, t + this.delayTime.value);\n    }\n  }\n\n  AudioContext.prototype.createFeedbackDelay = function (wet, time, feedback) {\n    return new FeedbackDelayNode(this, wet, time, feedback);\n  };\n}\n","// Copyright 2014 Alan deLespinasse\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nvar reverbGen = {};\n\n/** Generates a reverb impulse response.\n\n @param {!Object} params TODO: Document the properties.\n @param {!function(!AudioBuffer)} callback Function to call when\n  the impulse response has been generated. The impulse response\n  is passed to this function as its parameter. May be called\n  immediately within the current execution context, or later. */\nreverbGen.generateReverb = function (params, callback) {\n  var audioContext = params.audioContext || new AudioContext();\n  var sampleRate = audioContext.sampleRate;\n  var numChannels = params.numChannels || 2;\n  // params.decayTime is the -60dB fade time. We let it go 50% longer to get to -90dB.\n  var totalTime = params.decayTime * 1.5;\n  var decaySampleFrames = Math.round(params.decayTime * sampleRate);\n  var numSampleFrames = Math.round(totalTime * sampleRate);\n  var fadeInSampleFrames = Math.round((params.fadeInTime || 0) * sampleRate);\n  // 60dB is a factor of 1 million in power, or 1000 in amplitude.\n  var decayBase = Math.pow(1 / 1000, 1 / decaySampleFrames);\n  var reverbIR = audioContext.createBuffer(numChannels, numSampleFrames, sampleRate);\n  for (var i = 0; i < numChannels; i++) {\n    var chan = reverbIR.getChannelData(i);\n    for (var j = 0; j < numSampleFrames; j++) {\n      chan[j] = randomSample() * Math.pow(decayBase, j);\n    }\n    for (var j = 0; j < fadeInSampleFrames; j++) {\n      chan[j] *= j / fadeInSampleFrames;\n    }\n  }\n\n  applyGradualLowpass(reverbIR, params.lpFreqStart || 0, params.lpFreqEnd || 0, params.decayTime, callback);\n};\n\n/** Creates a canvas element showing a graph of the given data.\n\n\n @param {!Float32Array} data An array of numbers, or a Float32Array.\n @param {number} width Width in pixels of the canvas.\n @param {number} height Height in pixels of the canvas.\n @param {number} min Minimum value of data for the graph (lower edge).\n @param {number} max Maximum value of data in the graph (upper edge).\n @return {!CanvasElement} The generated canvas element. */\nreverbGen.generateGraph = function (data, width, height, min, max) {\n  var canvas = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n  var gc = canvas.getContext('2d');\n  gc.fillStyle = '#000';\n  gc.fillRect(0, 0, canvas.width, canvas.height);\n  gc.fillStyle = '#fff';\n  var xscale = width / data.length;\n  var yscale = height / (max - min);\n  for (var i = 0; i < data.length; i++) {\n    gc.fillRect(i * xscale, height - (data[i] - min) * yscale, 1, 1);\n  }\n  return canvas;\n};\n\n/** Applies a constantly changing lowpass filter to the given sound.\n\n @private\n @param {!AudioBuffer} input\n @param {number} lpFreqStart\n @param {number} lpFreqEnd\n @param {number} lpFreqEndAt\n @param {!function(!AudioBuffer)} callback May be called\n  immediately within the current execution context, or later.*/\nvar applyGradualLowpass = function (input, lpFreqStart, lpFreqEnd, lpFreqEndAt, callback) {\n  if (lpFreqStart == 0) {\n    callback(input);\n    return;\n  }\n  var channelData = getAllChannelData(input);\n  var context = new OfflineAudioContext(input.numberOfChannels, channelData[0].length, input.sampleRate);\n  var player = context.createBufferSource();\n  player.buffer = input;\n  var filter = context.createBiquadFilter();\n\n  lpFreqStart = Math.min(lpFreqStart, input.sampleRate / 2);\n  lpFreqEnd = Math.min(lpFreqEnd, input.sampleRate / 2);\n\n  filter.type = 'lowpass';\n  filter.Q.value = 0.0001;\n  filter.frequency.setValueAtTime(lpFreqStart, 0);\n  filter.frequency.linearRampToValueAtTime(lpFreqEnd, lpFreqEndAt);\n\n  player.connect(filter);\n  filter.connect(context.destination);\n  player.start();\n  context.oncomplete = function (event) {\n    callback(event.renderedBuffer);\n  };\n  context.startRendering();\n\n  window.filterNode = filter;\n};\n\n/** @private\n @param {!AudioBuffer} buffer\n @return {!Array.<!Float32Array>} An array containing the Float32Array of each channel's samples. */\nvar getAllChannelData = function (buffer) {\n  var channels = [];\n  for (var i = 0; i < buffer.numberOfChannels; i++) {\n    channels[i] = buffer.getChannelData(i);\n  }\n  return channels;\n};\n\n/** @private\n @return {number} A random number from -1 to 1. */\nvar randomSample = function () {\n  return Math.random() * 2 - 1;\n};\n\nexport default reverbGen;\n","import reverbGen from './reverbGen.mjs';\n\nif (typeof AudioContext !== 'undefined') {\n  AudioContext.prototype.adjustLength = function (duration, buffer) {\n    const newLength = buffer.sampleRate * duration;\n    const newBuffer = this.createBuffer(buffer.numberOfChannels, buffer.length, buffer.sampleRate);\n    for (let channel = 0; channel < buffer.numberOfChannels; channel++) {\n      let oldData = buffer.getChannelData(channel);\n      let newData = newBuffer.getChannelData(channel);\n\n      for (let i = 0; i < newLength; i++) {\n        newData[i] = oldData[i] || 0;\n      }\n    }\n    return newBuffer;\n  };\n\n  AudioContext.prototype.createReverb = function (duration, fade, lp, dim, ir) {\n    const convolver = this.createConvolver();\n    convolver.generate = (d = 2, fade = 0.1, lp = 15000, dim = 1000, ir) => {\n      convolver.duration = d;\n      convolver.fade = fade;\n      convolver.lp = lp;\n      convolver.dim = dim;\n      convolver.ir = ir;\n      if (ir) {\n        convolver.buffer = this.adjustLength(d, ir);\n      } else {\n        reverbGen.generateReverb(\n          {\n            audioContext: this,\n            numChannels: 2,\n            decayTime: d,\n            fadeInTime: fade,\n            lpFreqStart: lp,\n            lpFreqEnd: dim,\n          },\n          (buffer) => {\n            convolver.buffer = buffer;\n          },\n        );\n      }\n    };\n    convolver.generate(duration, fade, lp, dim, ir);\n    return convolver;\n  };\n}\n","// credits to webdirt: https://github.com/dktr0/WebDirt/blob/41342e81d6ad694a2310d491fef7b7e8b0929efe/js-src/Graph.js#L597\nexport var vowelFormant = {\n  a: { freqs: [660, 1120, 2750, 3000, 3350], gains: [1, 0.5012, 0.0708, 0.0631, 0.0126], qs: [80, 90, 120, 130, 140] },\n  e: { freqs: [440, 1800, 2700, 3000, 3300], gains: [1, 0.1995, 0.1259, 0.1, 0.1], qs: [70, 80, 100, 120, 120] },\n  i: { freqs: [270, 1850, 2900, 3350, 3590], gains: [1, 0.0631, 0.0631, 0.0158, 0.0158], qs: [40, 90, 100, 120, 120] },\n  o: { freqs: [430, 820, 2700, 3000, 3300], gains: [1, 0.3162, 0.0501, 0.0794, 0.01995], qs: [40, 80, 100, 120, 120] },\n  u: { freqs: [370, 630, 2750, 3000, 3400], gains: [1, 0.1, 0.0708, 0.0316, 0.01995], qs: [40, 60, 100, 120, 120] },\n  ae: { freqs: [650, 1515, 2400, 3000, 3350], gains: [1, 0.5, 0.1008, 0.0631, 0.0126], qs: [80, 90, 120, 130, 140] },\n  aa: { freqs: [560, 900, 2570, 3000, 3300], gains: [1, 0.5, 0.0708, 0.0631, 0.0126], qs: [80, 90, 120, 130, 140] },\n  oe: { freqs: [500, 1430, 2300, 3000, 3300], gains: [1, 0.2, 0.0708, 0.0316, 0.01995], qs: [40, 60, 100, 120, 120] },\n  ue: { freqs: [250, 1750, 2150, 3200, 3300], gains: [1, 0.1, 0.0708, 0.0316, 0.01995], qs: [40, 60, 100, 120, 120] },\n  y: { freqs: [400, 1460, 2400, 3000, 3300], gains: [1, 0.2, 0.0708, 0.0316, 0.02995], qs: [40, 60, 100, 120, 120] },\n  uh: { freqs: [600, 1250, 2100, 3100, 3500], gains: [1, 0.3, 0.0608, 0.0316, 0.01995], qs: [40, 70, 100, 120, 130] },\n  un: { freqs: [500, 1240, 2280, 3000, 3500], gains: [1, 0.1, 0.1708, 0.0216, 0.02995], qs: [40, 60, 100, 120, 120] },\n  en: { freqs: [600, 1480, 2450, 3200, 3300], gains: [1, 0.15, 0.0708, 0.0316, 0.02995], qs: [40, 60, 100, 120, 120] },\n  an: { freqs: [700, 1050, 2500, 3000, 3300], gains: [1, 0.1, 0.0708, 0.0316, 0.02995], qs: [40, 60, 100, 120, 120] },\n  on: { freqs: [500, 1080, 2350, 3000, 3300], gains: [1, 0.1, 0.0708, 0.0316, 0.02995], qs: [40, 60, 100, 120, 120] },\n  get Ã¦() {\n    return this.ae;\n  },\n  get Ã¸() {\n    return this.oe;\n  },\n  get É() {\n    return this.aa;\n  },\n  get Ã¥() {\n    return this.aa;\n  },\n  get Ã¶() {\n    return this.oe;\n  },\n  get Ã¼() {\n    return this.ue;\n  },\n  get Ä±() {\n    return this.y;\n  },\n};\nif (typeof GainNode !== 'undefined') {\n  class VowelNode extends GainNode {\n    constructor(ac, letter) {\n      super(ac);\n      if (!vowelFormant[letter]) {\n        throw new Error('vowel: unknown vowel ' + letter);\n      }\n      const { gains, qs, freqs } = vowelFormant[letter];\n      const makeupGain = ac.createGain();\n      for (let i = 0; i < 5; i++) {\n        const gain = ac.createGain();\n        gain.gain.value = gains[i];\n        const filter = ac.createBiquadFilter();\n        filter.type = 'bandpass';\n        filter.Q.value = qs[i];\n        filter.frequency.value = freqs[i];\n        this.connect(filter);\n        filter.connect(gain);\n        gain.connect(makeupGain);\n      }\n      makeupGain.gain.value = 8; // how much makeup gain to add?\n      this.connect = (target) => makeupGain.connect(target);\n      return this;\n    }\n  }\n\n  AudioContext.prototype.createVowelFilter = function (letter) {\n    return new VowelNode(this, letter);\n  };\n}\n","let log = (msg) => console.log(msg);\n\nexport const logger = (...args) => log(...args);\n\nexport const setLogger = (fn) => {\n  log = fn;\n};\n","import { logger } from './logger.mjs';\n\n// currently duplicate with core util.mjs to skip dependency\n// TODO: add separate util module?\n\nexport const tokenizeNote = (note) => {\n  if (typeof note !== 'string') {\n    return [];\n  }\n  const [pc, acc = '', oct] = note.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1) || [];\n  if (!pc) {\n    return [];\n  }\n  return [pc, acc, oct ? Number(oct) : undefined];\n};\nconst chromas = { c: 0, d: 2, e: 4, f: 5, g: 7, a: 9, b: 11 };\nconst accs = { '#': 1, b: -1, s: 1, f: -1 };\n\nexport const noteToMidi = (note, defaultOctave = 3) => {\n  const [pc, acc, oct = defaultOctave] = tokenizeNote(note);\n  if (!pc) {\n    throw new Error('not a note: \"' + note + '\"');\n  }\n  const chroma = chromas[pc.toLowerCase()];\n  const offset = acc?.split('').reduce((o, char) => o + accs[char], 0) || 0;\n  return (Number(oct) + 1) * 12 + chroma + offset;\n};\nexport const midiToFreq = (n) => {\n  return Math.pow(2, (n - 69) / 12) * 440;\n};\nexport const clamp = (num, min, max) => Math.min(Math.max(num, min), max);\n\nexport const freqToMidi = (freq) => {\n  return (12 * Math.log(freq / 440)) / Math.LN2 + 69;\n};\n\nexport const valueToMidi = (value, fallbackValue) => {\n  if (typeof value !== 'object') {\n    throw new Error('valueToMidi: expected object value');\n  }\n  let { freq, note } = value;\n  if (typeof freq === 'number') {\n    return freqToMidi(freq);\n  }\n  if (typeof note === 'string') {\n    return noteToMidi(note);\n  }\n  if (typeof note === 'number') {\n    return note;\n  }\n  if (!fallbackValue) {\n    throw new Error('valueToMidi: expected freq or note to be set');\n  }\n  return fallbackValue;\n};\n\nexport function nanFallback(value, fallback = 0, silent) {\n  if (isNaN(Number(value))) {\n    !silent && logger(`\"${value}\" is not a number, falling back to ${fallback}`, 'warning');\n    return fallback;\n  }\n  return value;\n}\n// modulo that works with negative numbers e.g. _mod(-1, 3) = 2. Works on numbers (rather than patterns of numbers, as @mod@ from pattern.mjs does)\nexport const _mod = (n, m) => ((n % m) + m) % m;\n\n// round to nearest int, negative numbers will output a subtracted index\nexport const getSoundIndex = (n, numSounds) => {\n  return _mod(Math.round(nanFallback(n, 0)), numSounds);\n};\n","import { getAudioContext } from './superdough.mjs';\nimport { clamp, nanFallback } from './util.mjs';\n\nexport function gainNode(value) {\n  const node = getAudioContext().createGain();\n  node.gain.value = value;\n  return node;\n}\n\nconst getSlope = (y1, y2, x1, x2) => {\n  const denom = x2 - x1;\n  if (denom === 0) {\n    return 0;\n  }\n  return (y2 - y1) / (x2 - x1);\n};\n\nexport function getWorklet(ac, processor, params, config) {\n  const node = new AudioWorkletNode(ac, processor, config);\n  Object.entries(params).forEach(([key, value]) => {\n    node.parameters.get(key).value = value;\n  });\n  return node;\n}\n\nexport const getParamADSR = (\n  param,\n  attack,\n  decay,\n  sustain,\n  release,\n  min,\n  max,\n  begin,\n  end,\n  //exponential works better for frequency modulations (such as filter cutoff) due to human ear perception\n  curve = 'exponential',\n) => {\n  attack = nanFallback(attack);\n  decay = nanFallback(decay);\n  sustain = nanFallback(sustain);\n  release = nanFallback(release);\n  const ramp = curve === 'exponential' ? 'exponentialRampToValueAtTime' : 'linearRampToValueAtTime';\n  if (curve === 'exponential') {\n    min = min === 0 ? 0.001 : min;\n    max = max === 0 ? 0.001 : max;\n  }\n  const range = max - min;\n  const peak = max;\n  const sustainVal = min + sustain * range;\n  const duration = end - begin;\n\n  const envValAtTime = (time) => {\n    let val;\n    if (attack > time) {\n      let slope = getSlope(min, peak, 0, attack);\n      val = time * slope + (min > peak ? min : 0);\n    } else {\n      val = (time - attack) * getSlope(peak, sustainVal, 0, decay) + peak;\n    }\n    if (curve === 'exponential') {\n      val = val || 0.001;\n    }\n    return val;\n  };\n\n  param.setValueAtTime(min, begin);\n  if (attack > duration) {\n    //attack\n    param[ramp](envValAtTime(duration), end);\n  } else if (attack + decay > duration) {\n    //attack\n    param[ramp](envValAtTime(attack), begin + attack);\n    //decay\n    param[ramp](envValAtTime(duration), end);\n  } else {\n    //attack\n    param[ramp](envValAtTime(attack), begin + attack);\n    //decay\n    param[ramp](envValAtTime(attack + decay), begin + attack + decay);\n    //sustain\n    param.setValueAtTime(sustainVal, end);\n  }\n  //release\n  param[ramp](min, end + release);\n};\n\nexport function getCompressor(ac, threshold, ratio, knee, attack, release) {\n  const options = {\n    threshold: threshold ?? -3,\n    ratio: ratio ?? 10,\n    knee: knee ?? 10,\n    attack: attack ?? 0.005,\n    release: release ?? 0.05,\n  };\n  return new DynamicsCompressorNode(ac, options);\n}\n\n// changes the default values of the envelope based on what parameters the user has defined\n// so it behaves more like you would expect/familiar as other synthesis tools\n// ex: sound(val).decay(val) will behave as a decay only envelope. sound(val).attack(val).decay(val) will behave like an \"ad\" env, etc.\n\nexport const getADSRValues = (params, curve = 'linear', defaultValues) => {\n  const envmin = curve === 'exponential' ? 0.001 : 0.001;\n  const releaseMin = 0.01;\n  const envmax = 1;\n  const [a, d, s, r] = params;\n  if (a == null && d == null && s == null && r == null) {\n    return defaultValues ?? [envmin, envmin, envmax, releaseMin];\n  }\n  const sustain = s != null ? s : (a != null && d == null) || (a == null && d == null) ? envmax : envmin;\n  return [Math.max(a ?? 0, envmin), Math.max(d ?? 0, envmin), Math.min(sustain, envmax), Math.max(r ?? 0, releaseMin)];\n};\n\nexport function createFilter(context, type, frequency, Q, att, dec, sus, rel, fenv, start, end, fanchor, model, drive) {\n  const curve = 'exponential';\n  const [attack, decay, sustain, release] = getADSRValues([att, dec, sus, rel], curve, [0.005, 0.14, 0, 0.1]);\n  let filter;\n  let frequencyParam;\n  if (model === 'ladder') {\n    filter = getWorklet(context, 'ladder-processor', { frequency, q: Q, drive });\n    frequencyParam = filter.parameters.get('frequency');\n  } else {\n    filter = context.createBiquadFilter();\n    filter.type = type;\n    filter.Q.value = Q;\n    filter.frequency.value = frequency;\n    frequencyParam = filter.frequency;\n  }\n\n  // envelope is active when any of these values is set\n  const hasEnvelope = att ?? dec ?? sus ?? rel ?? fenv;\n  // Apply ADSR to filter frequency\n  if (hasEnvelope !== undefined) {\n    fenv = nanFallback(fenv, 1, true);\n    fanchor = nanFallback(fanchor, 0, true);\n    const fenvAbs = Math.abs(fenv);\n    const offset = fenvAbs * fanchor;\n    let min = clamp(2 ** -offset * frequency, 0, 20000);\n    let max = clamp(2 ** (fenvAbs - offset) * frequency, 0, 20000);\n    if (fenv < 0) [min, max] = [max, min];\n    getParamADSR(frequencyParam, attack, decay, sustain, release, min, max, start, end, curve);\n    return filter;\n  }\n  return filter;\n}\n\n// stays 1 until .5, then fades out\nlet wetfade = (d) => (d < 0.5 ? 1 : 1 - (d - 0.5) / 0.5);\n\n// mix together dry and wet nodes. 0 = only dry 1 = only wet\n// still not too sure about how this could be used more generally...\nexport function drywet(dry, wet, wetAmount = 0) {\n  const ac = getAudioContext();\n  if (!wetAmount) {\n    return dry;\n  }\n  let dry_gain = ac.createGain();\n  let wet_gain = ac.createGain();\n  dry.connect(dry_gain);\n  wet.connect(wet_gain);\n  dry_gain.gain.value = wetfade(wetAmount);\n  wet_gain.gain.value = wetfade(1 - wetAmount);\n  let mix = ac.createGain();\n  dry_gain.connect(mix);\n  wet_gain.connect(mix);\n  return mix;\n}\n\nlet curves = ['linear', 'exponential'];\nexport function getPitchEnvelope(param, value, t, holdEnd) {\n  // envelope is active when any of these values is set\n  const hasEnvelope = value.pattack ?? value.pdecay ?? value.psustain ?? value.prelease ?? value.penv;\n  if (!hasEnvelope) {\n    return;\n  }\n  const penv = nanFallback(value.penv, 1, true);\n  const curve = curves[value.pcurve ?? 0];\n  let [pattack, pdecay, psustain, prelease] = getADSRValues(\n    [value.pattack, value.pdecay, value.psustain, value.prelease],\n    curve,\n    [0.2, 0.001, 1, 0.001],\n  );\n  let panchor = value.panchor ?? psustain;\n  const cents = penv * 100; // penv is in semitones\n  const min = 0 - cents * panchor;\n  const max = cents - cents * panchor;\n  getParamADSR(param, pattack, pdecay, psustain, prelease, min, max, t, holdEnd, curve);\n}\n\nexport function getVibratoOscillator(param, value, t) {\n  const { vibmod = 0.5, vib } = value;\n  let vibratoOscillator;\n  if (vib > 0) {\n    vibratoOscillator = getAudioContext().createOscillator();\n    vibratoOscillator.frequency.value = vib;\n    const gain = getAudioContext().createGain();\n    // Vibmod is the amount of vibrato, in semitones\n    gain.gain.value = vibmod * 100;\n    vibratoOscillator.connect(gain);\n    gain.connect(param);\n    vibratoOscillator.start(t);\n    return vibratoOscillator;\n  }\n}\n// ConstantSource inherits AudioScheduledSourceNode, which has scheduling abilities\n// a bit of a hack, but it works very well :)\nexport function webAudioTimeout(audioContext, onComplete, startTime, stopTime) {\n  const constantNode = audioContext.createConstantSource();\n  constantNode.start(startTime);\n  constantNode.stop(stopTime);\n  constantNode.onended = () => {\n    onComplete();\n  };\n}\nconst mod = (freq, range = 1, type = 'sine') => {\n  const ctx = getAudioContext();\n  const osc = ctx.createOscillator();\n  osc.type = type;\n  osc.frequency.value = freq;\n  osc.start();\n  const g = new GainNode(ctx, { gain: range });\n  osc.connect(g); // -range, range\n  return { node: g, stop: (t) => osc.stop(t) };\n};\nconst fm = (frequencyparam, harmonicityRatio, modulationIndex, wave = 'sine') => {\n  const carrfreq = frequencyparam.value;\n  const modfreq = carrfreq * harmonicityRatio;\n  const modgain = modfreq * modulationIndex;\n  return mod(modfreq, modgain, wave);\n};\nexport function applyFM(param, value, begin) {\n  const {\n    fmh: fmHarmonicity = 1,\n    fmi: fmModulationIndex,\n    fmenv: fmEnvelopeType = 'exp',\n    fmattack: fmAttack,\n    fmdecay: fmDecay,\n    fmsustain: fmSustain,\n    fmrelease: fmRelease,\n    fmvelocity: fmVelocity,\n    fmwave: fmWaveform = 'sine',\n    duration,\n  } = value;\n  let modulator;\n  let stop = () => {};\n\n  if (fmModulationIndex) {\n    const ac = getAudioContext();\n    const envGain = ac.createGain();\n    const fmmod = fm(param, fmHarmonicity, fmModulationIndex, fmWaveform);\n\n    modulator = fmmod.node;\n    stop = fmmod.stop;\n    if (![fmAttack, fmDecay, fmSustain, fmRelease, fmVelocity].find((v) => v !== undefined)) {\n      // no envelope by default\n      modulator.connect(param);\n    } else {\n      const [attack, decay, sustain, release] = getADSRValues([fmAttack, fmDecay, fmSustain, fmRelease]);\n      const holdEnd = begin + duration;\n      getParamADSR(\n        envGain.gain,\n        attack,\n        decay,\n        sustain,\n        release,\n        0,\n        1,\n        begin,\n        holdEnd,\n        fmEnvelopeType === 'exp' ? 'exponential' : 'linear',\n      );\n      modulator.connect(envGain);\n      envGain.connect(param);\n    }\n  }\n  return { stop };\n}\n","import { noteToMidi, valueToMidi, getSoundIndex } from './util.mjs';\nimport { getAudioContext, registerSound } from './index.mjs';\nimport { getADSRValues, getParamADSR, getPitchEnvelope, getVibratoOscillator } from './helpers.mjs';\nimport { logger } from './logger.mjs';\n\nconst bufferCache = {}; // string: Promise<ArrayBuffer>\nconst loadCache = {}; // string: Promise<ArrayBuffer>\n\nexport const getCachedBuffer = (url) => bufferCache[url];\n\nfunction humanFileSize(bytes, si) {\n  var thresh = si ? 1000 : 1024;\n  if (bytes < thresh) return bytes + ' B';\n  var units = si\n    ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n    : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];\n  var u = -1;\n  do {\n    bytes /= thresh;\n    ++u;\n  } while (bytes >= thresh);\n  return bytes.toFixed(1) + ' ' + units[u];\n}\n\nexport const getSampleBufferSource = async (s, n, note, speed, freq, bank, resolveUrl) => {\n  let transpose = 0;\n  if (freq !== undefined && note !== undefined) {\n    logger('[sampler] hap has note and freq. ignoring note', 'warning');\n  }\n  let midi = valueToMidi({ freq, note }, 36);\n  transpose = midi - 36; // C3 is middle C\n\n  const ac = getAudioContext();\n\n  let sampleUrl;\n  let index = 0;\n  if (Array.isArray(bank)) {\n    index = getSoundIndex(n, bank.length);\n    sampleUrl = bank[index];\n  } else {\n    const midiDiff = (noteA) => noteToMidi(noteA) - midi;\n    // object format will expect keys as notes\n    const closest = Object.keys(bank)\n      .filter((k) => !k.startsWith('_'))\n      .reduce(\n        (closest, key, j) => (!closest || Math.abs(midiDiff(key)) < Math.abs(midiDiff(closest)) ? key : closest),\n        null,\n      );\n    transpose = -midiDiff(closest); // semitones to repitch\n    index = getSoundIndex(n, bank[closest].length);\n    sampleUrl = bank[closest][index];\n  }\n  if (resolveUrl) {\n    sampleUrl = await resolveUrl(sampleUrl);\n  }\n  let buffer = await loadBuffer(sampleUrl, ac, s, index);\n  if (speed < 0) {\n    // should this be cached?\n    buffer = reverseBuffer(buffer);\n  }\n  const bufferSource = ac.createBufferSource();\n  bufferSource.buffer = buffer;\n  const playbackRate = 1.0 * Math.pow(2, transpose / 12);\n  bufferSource.playbackRate.value = playbackRate;\n  return bufferSource;\n};\n\nexport const loadBuffer = (url, ac, s, n = 0) => {\n  const label = s ? `sound \"${s}:${n}\"` : 'sample';\n  url = url.replace('#', '%23');\n  if (!loadCache[url]) {\n    logger(`[sampler] load ${label}..`, 'load-sample', { url });\n    const timestamp = Date.now();\n    loadCache[url] = fetch(url)\n      .then((res) => res.arrayBuffer())\n      .then(async (res) => {\n        const took = Date.now() - timestamp;\n        const size = humanFileSize(res.byteLength);\n        // const downSpeed = humanFileSize(res.byteLength / took);\n        logger(`[sampler] load ${label}... done! loaded ${size} in ${took}ms`, 'loaded-sample', { url });\n        const decoded = await ac.decodeAudioData(res);\n        bufferCache[url] = decoded;\n        return decoded;\n      });\n  }\n  return loadCache[url];\n};\n\nexport function reverseBuffer(buffer) {\n  const ac = getAudioContext();\n  const reversed = ac.createBuffer(buffer.numberOfChannels, buffer.length, ac.sampleRate);\n  for (let channel = 0; channel < buffer.numberOfChannels; channel++) {\n    reversed.copyToChannel(buffer.getChannelData(channel).slice().reverse(), channel, channel);\n  }\n  return reversed;\n}\n\nexport const getLoadedBuffer = (url) => {\n  return bufferCache[url];\n};\n\nfunction resolveSpecialPaths(base) {\n  if (base.startsWith('bubo:')) {\n    const [_, repo] = base.split(':');\n    base = `github:Bubobubobubobubo/dough-${repo}`;\n  }\n  return base;\n}\n\nfunction githubPath(base, subpath = '') {\n  if (!base.startsWith('github:')) {\n    throw new Error('expected \"github:\" at the start of pseudoUrl');\n  }\n  let [_, path] = base.split('github:');\n  path = path.endsWith('/') ? path.slice(0, -1) : path;\n  if (path.split('/').length === 2) {\n    // assume main as default branch if none set\n    path += '/main';\n  }\n  return `https://raw.githubusercontent.com/${path}/${subpath}`;\n}\n\nexport const processSampleMap = (sampleMap, fn, baseUrl = sampleMap._base || '') => {\n  return Object.entries(sampleMap).forEach(([key, value]) => {\n    if (typeof value === 'string') {\n      value = [value];\n    }\n    if (typeof value !== 'object') {\n      throw new Error('wrong sample map format for ' + key);\n    }\n    baseUrl = value._base || baseUrl;\n    baseUrl = resolveSpecialPaths(baseUrl);\n    if (baseUrl.startsWith('github:')) {\n      baseUrl = githubPath(baseUrl, '');\n    }\n    const fullUrl = (v) => baseUrl + v;\n    if (Array.isArray(value)) {\n      //return [key, value.map(replaceUrl)];\n      value = value.map(fullUrl);\n    } else {\n      // must be object\n      value = Object.fromEntries(\n        Object.entries(value).map(([note, samples]) => {\n          return [note, (typeof samples === 'string' ? [samples] : samples).map(fullUrl)];\n        }),\n      );\n    }\n    fn(key, value);\n  });\n};\n\n// allows adding a custom url prefix handler\n// for example, it is used by the desktop app to load samples starting with '~/music'\nlet resourcePrefixHandlers = {};\nexport function registerSamplesPrefix(prefix, resolve) {\n  resourcePrefixHandlers[prefix] = resolve;\n}\n// finds a prefix handler for the given url (if any)\nfunction getSamplesPrefixHandler(url) {\n  const handler = Object.entries(resourcePrefixHandlers).find(([key]) => url.startsWith(key));\n  if (handler) {\n    return handler[1];\n  }\n  return;\n}\n\n/**\n * Loads a collection of samples to use with `s`\n * @example\n * samples('github:tidalcycles/dirt-samples');\n * s(\"[bd ~]*2, [~ hh]*2, ~ sd\")\n * @example\n * samples({\n *  bd: '808bd/BD0000.WAV',\n *  sd: '808sd/SD0010.WAV'\n *  }, 'https://raw.githubusercontent.com/tidalcycles/Dirt-Samples/master/');\n * s(\"[bd ~]*2, [~ hh]*2, ~ sd\")\n * @example\n * samples('shabda:noise,chimp:2')\n * s(\"noise <chimp:0*2 chimp:1>\")\n * @example\n * samples('shabda/speech/fr-FR/f:chocolat')\n * s(\"chocolat*4\")\n */\n\nexport const samples = async (sampleMap, baseUrl = sampleMap._base || '', options = {}) => {\n  if (typeof sampleMap === 'string') {\n    // check if custom prefix handler\n    const handler = getSamplesPrefixHandler(sampleMap);\n    if (handler) {\n      return handler(sampleMap);\n    }\n    sampleMap = resolveSpecialPaths(sampleMap);\n    if (sampleMap.startsWith('github:')) {\n      sampleMap = githubPath(sampleMap, 'strudel.json');\n    }\n    if (sampleMap.startsWith('local:')) {\n      sampleMap = `http://localhost:5432`;\n    }\n    if (sampleMap.startsWith('shabda:')) {\n      let [_, path] = sampleMap.split('shabda:');\n      sampleMap = `https://shabda.ndre.gr/${path}.json?strudel=1`;\n    }\n    if (sampleMap.startsWith('shabda/speech')) {\n      let [_, path] = sampleMap.split('shabda/speech');\n      path = path.startsWith('/') ? path.substring(1) : path;\n      let [params, words] = path.split(':');\n      let gender = 'f';\n      let language = 'en-GB';\n      if (params) {\n        [language, gender] = params.split('/');\n      }\n      sampleMap = `https://shabda.ndre.gr/speech/${words}.json?gender=${gender}&language=${language}&strudel=1'`;\n    }\n    if (typeof fetch !== 'function') {\n      // not a browser\n      return;\n    }\n    const base = sampleMap.split('/').slice(0, -1).join('/');\n    if (typeof fetch === 'undefined') {\n      // skip fetch when in node / testing\n      return;\n    }\n    return fetch(sampleMap)\n      .then((res) => res.json())\n      .then((json) => samples(json, baseUrl || json._base || base, options))\n      .catch((error) => {\n        console.error(error);\n        throw new Error(`error loading \"${sampleMap}\"`);\n      });\n  }\n  const { prebake, tag } = options;\n  processSampleMap(\n    sampleMap,\n    (key, value) =>\n      registerSound(key, (t, hapValue, onended) => onTriggerSample(t, hapValue, onended, value), {\n        type: 'sample',\n        samples: value,\n        baseUrl,\n        prebake,\n        tag,\n      }),\n    baseUrl,\n  );\n};\n\nconst cutGroups = [];\n\nexport async function onTriggerSample(t, value, onended, bank, resolveUrl) {\n  let {\n    s,\n    freq,\n    unit,\n    nudge = 0, // TODO: is this in seconds?\n    cut,\n    loop,\n    clip = undefined, // if set, samples will be cut off when the hap ends\n    n = 0,\n    note,\n    speed = 1, // sample playback speed\n    loopBegin = 0,\n    begin = 0,\n    loopEnd = 1,\n    end = 1,\n    duration,\n  } = value;\n  // load sample\n  if (speed === 0) {\n    // no playback\n    return;\n  }\n  loop = s.startsWith('wt_') ? 1 : value.loop;\n  const ac = getAudioContext();\n  // destructure adsr here, because the default should be different for synths and samples\n\n  let [attack, decay, sustain, release] = getADSRValues([value.attack, value.decay, value.sustain, value.release]);\n  //const soundfont = getSoundfontKey(s);\n  const time = t + nudge;\n\n  const bufferSource = await getSampleBufferSource(s, n, note, speed, freq, bank, resolveUrl);\n\n  // vibrato\n  let vibratoOscillator = getVibratoOscillator(bufferSource.detune, value, t);\n\n  // asny stuff above took too long?\n  if (ac.currentTime > t) {\n    logger(`[sampler] still loading sound \"${s}:${n}\"`, 'highlight');\n    // console.warn('sample still loading:', s, n);\n    return;\n  }\n  if (!bufferSource) {\n    logger(`[sampler] could not load \"${s}:${n}\"`, 'error');\n    return;\n  }\n  bufferSource.playbackRate.value = Math.abs(speed) * bufferSource.playbackRate.value;\n  if (unit === 'c') {\n    // are there other units?\n    bufferSource.playbackRate.value = bufferSource.playbackRate.value * bufferSource.buffer.duration * 1; //cps;\n  }\n  // \"The computation of the offset into the sound is performed using the sound buffer's natural sample rate,\n  // rather than the current playback rate, so even if the sound is playing at twice its normal speed,\n  // the midway point through a 10-second audio buffer is still 5.\"\n  const offset = begin * bufferSource.buffer.duration;\n  if (loop) {\n    bufferSource.loop = true;\n    bufferSource.loopStart = loopBegin * bufferSource.buffer.duration - offset;\n    bufferSource.loopEnd = loopEnd * bufferSource.buffer.duration - offset;\n  }\n  bufferSource.start(time, offset);\n  const envGain = ac.createGain();\n  const node = bufferSource.connect(envGain);\n  if (clip == null && loop == null && value.release == null) {\n    const bufferDuration = bufferSource.buffer.duration / bufferSource.playbackRate.value;\n    duration = (end - begin) * bufferDuration;\n  }\n  let holdEnd = t + duration;\n\n  getParamADSR(node.gain, attack, decay, sustain, release, 0, 1, t, holdEnd, 'linear');\n\n  // pitch envelope\n  getPitchEnvelope(bufferSource.detune, value, t, holdEnd);\n\n  const out = ac.createGain(); // we need a separate gain for the cutgroups because firefox...\n  node.connect(out);\n  bufferSource.onended = function () {\n    bufferSource.disconnect();\n    vibratoOscillator?.stop();\n    node.disconnect();\n    out.disconnect();\n    onended();\n  };\n  let envEnd = holdEnd + release + 0.01;\n  bufferSource.stop(envEnd);\n  const stop = (endTime, playWholeBuffer) => {};\n  const handle = { node: out, bufferSource, stop };\n\n  // cut groups\n  if (cut !== undefined) {\n    const prev = cutGroups[cut];\n    if (prev) {\n      prev.node.gain.setValueAtTime(1, time);\n      prev.node.gain.linearRampToValueAtTime(0, time + 0.01);\n    }\n    cutGroups[cut] = handle;\n  }\n\n  return handle;\n}\n","/*\nsuperdough.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/superdough/superdough.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport './feedbackdelay.mjs';\nimport './reverb.mjs';\nimport './vowel.mjs';\nimport { clamp, nanFallback, _mod } from './util.mjs';\nimport workletsUrl from './worklets.mjs?worker&url';\nimport { createFilter, gainNode, getCompressor, getWorklet } from './helpers.mjs';\nimport { map } from 'nanostores';\nimport { logger } from './logger.mjs';\nimport { loadBuffer } from './sampler.mjs';\n\nexport const soundMap = map();\n\nexport function registerSound(key, onTrigger, data = {}) {\n  soundMap.setKey(key, { onTrigger, data });\n}\n\nexport function getSound(s) {\n  return soundMap.get()[s];\n}\n\nconst defaultDefaultValues = {\n  s: 'triangle',\n  gain: 0.8,\n  postgain: 1,\n  density: '.03',\n  ftype: '12db',\n  fanchor: 0,\n  resonance: 1,\n  hresonance: 1,\n  bandq: 1,\n  channels: [1, 2],\n  phaserdepth: 0.75,\n  shapevol: 1,\n  distortvol: 1,\n  delay: 0,\n  delayfeedback: 0.5,\n  delaytime: 0.25,\n  orbit: 1,\n  i: 1,\n  velocity: 1,\n  fft: 8,\n};\n\nlet defaultControls = new Map(Object.entries(defaultDefaultValues));\n\nexport function setDefaultValue(key, value) {\n  defaultControls.set(key, value);\n}\nexport function getDefaultValue(key) {\n  return defaultControls.get(key);\n}\nexport function setDefaultValues(defaultsobj) {\n  Object.keys(defaultsobj).forEach((key) => {\n    setDefaultValue(key, defaultsobj[key]);\n  });\n}\nexport function resetDefaultValues() {\n  defaultControls = new Map(Object.entries(defaultDefaultValues));\n}\nexport function setVersionDefaults(version) {\n  resetDefaultValues();\n  if (version === '1.0') {\n    setDefaultValue('fanchor', 0.5);\n  }\n}\n\nexport const resetLoadedSounds = () => soundMap.set({});\n\nlet audioContext;\n\nexport const setDefaultAudioContext = () => {\n  audioContext = new AudioContext();\n  return audioContext;\n};\n\nexport const getAudioContext = () => {\n  if (!audioContext) {\n    return setDefaultAudioContext();\n  }\n\n  return audioContext;\n};\n\nlet workletsLoading;\nfunction loadWorklets() {\n  if (!workletsLoading) {\n    workletsLoading = getAudioContext().audioWorklet.addModule(workletsUrl);\n  }\n  return workletsLoading;\n}\n\n// this function should be called on first user interaction (to avoid console warning)\nexport async function initAudio(options = {}) {\n  const { disableWorklets = false } = options;\n  if (typeof window === 'undefined') {\n    return;\n  }\n  await getAudioContext().resume();\n  if (disableWorklets) {\n    logger('[superdough]: AudioWorklets disabled with disableWorklets');\n    return;\n  }\n  try {\n    await loadWorklets();\n    logger('[superdough] AudioWorklets loaded');\n  } catch (err) {\n    console.warn('could not load AudioWorklet effects', err);\n  }\n  logger('[superdough] ready');\n}\nlet audioReady;\nexport async function initAudioOnFirstClick(options) {\n  if (!audioReady) {\n    audioReady = new Promise((resolve) => {\n      document.addEventListener('click', async function listener() {\n        document.removeEventListener('click', listener);\n        await initAudio(options);\n        resolve();\n      });\n    });\n  }\n  return audioReady;\n}\n\nlet delays = {};\nconst maxfeedback = 0.98;\n\nlet channelMerger, destinationGain;\n//update the output channel configuration to match user's audio device\nexport function initializeAudioOutput() {\n  const audioContext = getAudioContext();\n  const maxChannelCount = audioContext.destination.maxChannelCount;\n  audioContext.destination.channelCount = maxChannelCount;\n  channelMerger = new ChannelMergerNode(audioContext, { numberOfInputs: audioContext.destination.channelCount });\n  destinationGain = new GainNode(audioContext);\n  channelMerger.connect(destinationGain);\n  destinationGain.connect(audioContext.destination);\n}\n\n// input: AudioNode, channels: ?Array<int>\nexport const connectToDestination = (input, channels = [0, 1]) => {\n  const ctx = getAudioContext();\n  if (channelMerger == null) {\n    initializeAudioOutput();\n  }\n  //This upmix can be removed if correct channel counts are set throughout the app,\n  // and then strudel could theoretically support surround sound audio files\n  const stereoMix = new StereoPannerNode(ctx);\n  input.connect(stereoMix);\n\n  const splitter = new ChannelSplitterNode(ctx, {\n    numberOfOutputs: stereoMix.channelCount,\n  });\n  stereoMix.connect(splitter);\n  channels.forEach((ch, i) => {\n    splitter.connect(channelMerger, i % stereoMix.channelCount, clamp(ch, 0, ctx.destination.channelCount - 1));\n  });\n};\n\nexport const panic = () => {\n  if (destinationGain == null) {\n    return;\n  }\n  destinationGain.gain.linearRampToValueAtTime(0, getAudioContext().currentTime + 0.01);\n  destinationGain = null;\n  channelMerger == null;\n};\n\nfunction getDelay(orbit, delaytime, delayfeedback, t) {\n  if (delayfeedback > maxfeedback) {\n    //logger(`delayfeedback was clamped to ${maxfeedback} to save your ears`);\n  }\n  delayfeedback = clamp(delayfeedback, 0, 0.98);\n  if (!delays[orbit]) {\n    const ac = getAudioContext();\n    const dly = ac.createFeedbackDelay(1, delaytime, delayfeedback);\n    dly.start?.(t); // for some reason, this throws when audion extension is installed..\n    connectToDestination(dly, [0, 1]);\n    delays[orbit] = dly;\n  }\n  delays[orbit].delayTime.value !== delaytime && delays[orbit].delayTime.setValueAtTime(delaytime, t);\n  delays[orbit].feedback.value !== delayfeedback && delays[orbit].feedback.setValueAtTime(delayfeedback, t);\n  return delays[orbit];\n}\n\nfunction getPhaser(time, end, frequency = 1, depth = 0.5, centerFrequency = 1000, sweep = 2000) {\n  //gain\n  const ac = getAudioContext();\n  const lfoGain = ac.createGain();\n  lfoGain.gain.value = sweep * 2;\n  // centerFrequency = centerFrequency * 2;\n  // sweep = sweep * 1.5;\n\n  const lfo = getWorklet(ac, 'lfo-processor', {\n    frequency,\n    depth: 1,\n    skew: 0,\n    phaseoffset: 0,\n    time,\n    end,\n    shape: 1,\n    dcoffset: -0.5,\n  });\n  lfo.connect(lfoGain);\n\n  //filters\n  const numStages = 2; //num of filters in series\n  let fOffset = 0;\n  const filterChain = [];\n  for (let i = 0; i < numStages; i++) {\n    const filter = ac.createBiquadFilter();\n    filter.type = 'notch';\n    filter.gain.value = 1;\n    filter.frequency.value = centerFrequency + fOffset;\n    filter.Q.value = 2 - Math.min(Math.max(depth * 2, 0), 1.9);\n\n    lfoGain.connect(filter.detune);\n    fOffset += 282;\n    if (i > 0) {\n      filterChain[i - 1].connect(filter);\n    }\n    filterChain.push(filter);\n  }\n  return filterChain[filterChain.length - 1];\n}\n\nfunction getFilterType(ftype) {\n  ftype = ftype ?? 0;\n  const filterTypes = ['12db', 'ladder', '24db'];\n  return typeof ftype === 'number' ? filterTypes[Math.floor(_mod(ftype, filterTypes.length))] : ftype;\n}\n\nlet reverbs = {};\nlet hasChanged = (now, before) => now !== undefined && now !== before;\nfunction getReverb(orbit, duration, fade, lp, dim, ir) {\n  // If no reverb has been created for a given orbit, create one\n  if (!reverbs[orbit]) {\n    const ac = getAudioContext();\n    const reverb = ac.createReverb(duration, fade, lp, dim, ir);\n    connectToDestination(reverb, [0, 1]);\n    reverbs[orbit] = reverb;\n  }\n  if (\n    hasChanged(duration, reverbs[orbit].duration) ||\n    hasChanged(fade, reverbs[orbit].fade) ||\n    hasChanged(lp, reverbs[orbit].lp) ||\n    hasChanged(dim, reverbs[orbit].dim) ||\n    reverbs[orbit].ir !== ir\n  ) {\n    // only regenerate when something has changed\n    // avoids endless regeneration on things like\n    // stack(s(\"a\"), s(\"b\").rsize(8)).room(.5)\n    // this only works when args may stay undefined until here\n    // setting default values breaks this\n    reverbs[orbit].generate(duration, fade, lp, dim, ir);\n  }\n  return reverbs[orbit];\n}\n\nexport let analysers = {},\n  analysersData = {};\n\nexport function getAnalyserById(id, fftSize = 1024) {\n  if (!analysers[id]) {\n    // make sure this doesn't happen too often as it piles up garbage\n    const analyserNode = getAudioContext().createAnalyser();\n    analyserNode.fftSize = fftSize;\n    // getDestination().connect(analyserNode);\n    analysers[id] = analyserNode;\n    analysersData[id] = new Float32Array(analysers[id].frequencyBinCount);\n  }\n  if (analysers[id].fftSize !== fftSize) {\n    analysers[id].fftSize = fftSize;\n    analysersData[id] = new Float32Array(analysers[id].frequencyBinCount);\n  }\n  return analysers[id];\n}\n\nexport function getAnalyzerData(type = 'time', id = 1) {\n  const getter = {\n    time: () => analysers[id]?.getFloatTimeDomainData(analysersData[id]),\n    frequency: () => analysers[id]?.getFloatFrequencyData(analysersData[id]),\n  }[type];\n  if (!getter) {\n    throw new Error(`getAnalyzerData: ${type} not supported. use one of ${Object.keys(getter).join(', ')}`);\n  }\n  getter();\n  return analysersData[id];\n}\n\nfunction effectSend(input, effect, wet) {\n  const send = gainNode(wet);\n  input.connect(send);\n  send.connect(effect);\n  return send;\n}\n\nexport function resetGlobalEffects() {\n  delays = {};\n  reverbs = {};\n  analysers = {};\n  analysersData = {};\n}\n\nexport const superdough = async (value, t, hapDuration) => {\n  t = typeof t === 'string' && t.startsWith('=') ? Number(t.slice(1)) : ac.currentTime + t;\n  let { stretch } = value;\n  if (stretch != null) {\n    //account for phase vocoder latency\n    const latency = 0.04;\n    t = t - latency;\n  }\n  const ac = getAudioContext();\n  if (typeof value !== 'object') {\n    throw new Error(\n      `expected hap.value to be an object, but got \"${value}\". Hint: append .note() or .s() to the end`,\n      'error',\n    );\n  }\n\n  // duration is passed as value too..\n  value.duration = hapDuration;\n  // calculate absolute time\n\n  if (t < ac.currentTime) {\n    console.warn(\n      `[superdough]: cannot schedule sounds in the past (target: ${t.toFixed(2)}, now: ${ac.currentTime.toFixed(2)})`,\n    );\n    return;\n  }\n  // destructure\n  let {\n    s = getDefaultValue('s'),\n    bank,\n    source,\n    gain = getDefaultValue('gain'),\n    postgain = getDefaultValue('postgain'),\n    density = getDefaultValue('density'),\n    // filters\n    fanchor = getDefaultValue('fanchor'),\n    drive = 0.69,\n    // low pass\n    cutoff,\n    lpenv,\n    lpattack,\n    lpdecay,\n    lpsustain,\n    lprelease,\n    resonance = getDefaultValue('resonance'),\n    // high pass\n    hpenv,\n    hcutoff,\n    hpattack,\n    hpdecay,\n    hpsustain,\n    hprelease,\n    hresonance = getDefaultValue('hresonance'),\n    // band pass\n    bpenv,\n    bandf,\n    bpattack,\n    bpdecay,\n    bpsustain,\n    bprelease,\n    bandq = getDefaultValue('bandq'),\n    channels = getDefaultValue('channels'),\n    //phaser\n    phaser,\n    phaserdepth = getDefaultValue('phaserdepth'),\n    phasersweep,\n    phasercenter,\n    //\n    coarse,\n    crush,\n    shape,\n    shapevol = getDefaultValue('shapevol'),\n    distort,\n    distortvol = getDefaultValue('distortvol'),\n    pan,\n    vowel,\n    delay = getDefaultValue('delay'),\n    delayfeedback = getDefaultValue('delayfeedback'),\n    delaytime = getDefaultValue('delaytime'),\n    orbit = getDefaultValue('orbit'),\n    room,\n    roomfade,\n    roomlp,\n    roomdim,\n    roomsize,\n    ir,\n    i = getDefaultValue('i'),\n    velocity = getDefaultValue('velocity'),\n    analyze, // analyser wet\n    fft = getDefaultValue('fft'), // fftSize 0 - 10\n    compressor: compressorThreshold,\n    compressorRatio,\n    compressorKnee,\n    compressorAttack,\n    compressorRelease,\n  } = value;\n\n  gain = nanFallback(gain, 1);\n\n  //music programs/audio gear usually increments inputs/outputs from 1, so imitate that behavior\n  channels = (Array.isArray(channels) ? channels : [channels]).map((ch) => ch - 1);\n\n  gain *= velocity; // velocity currently only multiplies with gain. it might do other things in the future\n  let toDisconnect = []; // audio nodes that will be disconnected when the source has ended\n  const onended = () => {\n    toDisconnect.forEach((n) => n?.disconnect());\n  };\n  if (bank && s) {\n    s = `${bank}_${s}`;\n  }\n\n  // get source AudioNode\n  let sourceNode;\n  if (source) {\n    sourceNode = source(t, value, hapDuration);\n  } else if (getSound(s)) {\n    const { onTrigger } = getSound(s);\n    const soundHandle = await onTrigger(t, value, onended);\n    if (soundHandle) {\n      sourceNode = soundHandle.node;\n      soundHandle.stop(t + hapDuration);\n    }\n  } else {\n    throw new Error(`sound ${s} not found! Is it loaded?`);\n  }\n  if (!sourceNode) {\n    // if onTrigger does not return anything, we will just silently skip\n    // this can be used for things like speed(0) in the sampler\n    return;\n  }\n\n  if (ac.currentTime > t) {\n    logger('[webaudio] skip hap: still loading', ac.currentTime - t);\n    return;\n  }\n  const chain = []; // audio nodes that will be connected to each other sequentially\n  chain.push(sourceNode);\n  stretch !== undefined && chain.push(getWorklet(ac, 'phase-vocoder-processor', { pitchFactor: stretch }));\n\n  // gain stage\n  chain.push(gainNode(gain));\n\n  //filter\n  const ftype = getFilterType(value.ftype);\n  if (cutoff !== undefined) {\n    let lp = () =>\n      createFilter(\n        ac,\n        'lowpass',\n        cutoff,\n        resonance,\n        lpattack,\n        lpdecay,\n        lpsustain,\n        lprelease,\n        lpenv,\n        t,\n        t + hapDuration,\n        fanchor,\n        ftype,\n        drive,\n      );\n    chain.push(lp());\n    if (ftype === '24db') {\n      chain.push(lp());\n    }\n  }\n\n  if (hcutoff !== undefined) {\n    let hp = () =>\n      createFilter(\n        ac,\n        'highpass',\n        hcutoff,\n        hresonance,\n        hpattack,\n        hpdecay,\n        hpsustain,\n        hprelease,\n        hpenv,\n        t,\n        t + hapDuration,\n        fanchor,\n      );\n    chain.push(hp());\n    if (ftype === '24db') {\n      chain.push(hp());\n    }\n  }\n\n  if (bandf !== undefined) {\n    let bp = () =>\n      createFilter(\n        ac,\n        'bandpass',\n        bandf,\n        bandq,\n        bpattack,\n        bpdecay,\n        bpsustain,\n        bprelease,\n        bpenv,\n        t,\n        t + hapDuration,\n        fanchor,\n      );\n    chain.push(bp());\n    if (ftype === '24db') {\n      chain.push(bp());\n    }\n  }\n\n  if (vowel !== undefined) {\n    const vowelFilter = ac.createVowelFilter(vowel);\n    chain.push(vowelFilter);\n  }\n\n  // effects\n  coarse !== undefined && chain.push(getWorklet(ac, 'coarse-processor', { coarse }));\n  crush !== undefined && chain.push(getWorklet(ac, 'crush-processor', { crush }));\n  shape !== undefined && chain.push(getWorklet(ac, 'shape-processor', { shape, postgain: shapevol }));\n  distort !== undefined && chain.push(getWorklet(ac, 'distort-processor', { distort, postgain: distortvol }));\n\n  compressorThreshold !== undefined &&\n    chain.push(\n      getCompressor(ac, compressorThreshold, compressorRatio, compressorKnee, compressorAttack, compressorRelease),\n    );\n\n  // panning\n  if (pan !== undefined) {\n    const panner = ac.createStereoPanner();\n    panner.pan.value = 2 * pan - 1;\n    chain.push(panner);\n  }\n  // phaser\n  if (phaser !== undefined && phaserdepth > 0) {\n    const phaserFX = getPhaser(t, t + hapDuration, phaser, phaserdepth, phasercenter, phasersweep);\n    chain.push(phaserFX);\n  }\n\n  // last gain\n  const post = new GainNode(ac, { gain: postgain });\n  chain.push(post);\n  connectToDestination(post, channels);\n\n  // delay\n  let delaySend;\n  if (delay > 0 && delaytime > 0 && delayfeedback > 0) {\n    const delyNode = getDelay(orbit, delaytime, delayfeedback, t);\n    delaySend = effectSend(post, delyNode, delay);\n  }\n  // reverb\n  let reverbSend;\n  if (room > 0) {\n    let roomIR;\n    if (ir !== undefined) {\n      let url;\n      let sample = getSound(ir);\n      if (Array.isArray(sample)) {\n        url = sample.data.samples[i % sample.data.samples.length];\n      } else if (typeof sample === 'object') {\n        url = Object.values(sample.data.samples).flat()[i % Object.values(sample.data.samples).length];\n      }\n      roomIR = await loadBuffer(url, ac, ir, 0);\n    }\n    const reverbNode = getReverb(orbit, roomsize, roomfade, roomlp, roomdim, roomIR);\n    reverbSend = effectSend(post, reverbNode, room);\n  }\n\n  // analyser\n  let analyserSend;\n  if (analyze) {\n    const analyserNode = getAnalyserById(analyze, 2 ** (fft + 5));\n    analyserSend = effectSend(post, analyserNode, 1);\n  }\n\n  // connect chain elements together\n  chain.slice(1).reduce((last, current) => last.connect(current), chain[0]);\n\n  // toDisconnect = all the node that should be disconnected in onended callback\n  // this is crucial for performance\n  toDisconnect = chain.concat([delaySend, reverbSend, analyserSend]);\n};\n\nexport const superdoughTrigger = (t, hap, ct, cps) => {\n  superdough(hap, t - ct, hap.duration / cps, cps);\n};\n","import { getAudioContext } from './superdough.mjs';\n\nlet worklet;\nexport async function dspWorklet(ac, code) {\n  const name = `dsp-worklet-${Date.now()}`;\n  const workletCode = `${code}\nlet __q = []; // trigger queue\nclass MyProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n    this.t = 0;\n    this.stopped = false;\n    this.port.onmessage = (e) => {\n      if(e.data==='stop') {\n        this.stopped = true;\n      } else if(e.data?.dough) {\n        __q.push(e.data)\n      } else {\n        msg?.(e.data)\n      }\n    };\n  }\n  process(inputs, outputs, parameters) {\n    const output = outputs[0];\n    if(__q.length) {\n      for(let i=0;i<__q.length;++i) {\n        const deadline = __q[i].time-currentTime;\n        if(deadline<=0) {\n          trigger(__q[i].dough)\n          __q.splice(i,1)\n        }\n      }\n    }\n    for (let i = 0; i < output[0].length; i++) {\n      const out = dsp(this.t / sampleRate);\n      output.forEach((channel) => {\n        channel[i] = out;\n      });\n      this.t++;\n    }\n  return !this.stopped;\n  }\n}\nregisterProcessor('${name}', MyProcessor);\n`;\n  const base64String = btoa(workletCode);\n  const dataURL = `data:text/javascript;base64,${base64String}`;\n  await ac.audioWorklet.addModule(dataURL);\n  const node = new AudioWorkletNode(ac, name);\n  const stop = () => node.port.postMessage('stop');\n  return { node, stop };\n}\nconst stop = () => {\n  if (worklet) {\n    worklet?.stop();\n    worklet?.node?.disconnect();\n  }\n};\n\nif (typeof window !== 'undefined') {\n  window.addEventListener('message', (e) => {\n    if (e.data === 'strudel-stop') {\n      stop();\n    } else if (e.data?.dough) {\n      worklet?.node.port.postMessage(e.data);\n    }\n  });\n}\n\nexport const dough = async (code) => {\n  const ac = getAudioContext();\n  stop();\n  worklet = await dspWorklet(ac, code);\n  worklet.node.connect(ac.destination);\n};\n\nexport function doughTrigger(time_deprecate, hap, currentTime, cps, targetTime) {\n  window.postMessage({ time: targetTime, dough: hap.value, currentTime, duration: hap.duration, cps });\n}\n","/*\nwebaudio.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/webaudio/webaudio.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport * as strudel from '@strudel/core';\nimport { superdough, getAudioContext, setLogger, doughTrigger } from 'superdough';\nconst { Pattern, logger, repl } = strudel;\n\nsetLogger(logger);\n\nconst hap2value = (hap) => {\n  hap.ensureObjectValue();\n  return hap.value;\n};\n\nexport const webaudioOutputTrigger = (t, hap, ct, cps) => superdough(hap2value(hap), t - ct, hap.duration / cps, cps);\n// uses more precise, absolute t if available, see https://github.com/tidalcycles/strudel/pull/1004\nexport const webaudioOutput = (hap, deadline, hapDuration, cps, t) =>\n  superdough(hap2value(hap), t ? `=${t}` : deadline, hapDuration);\n\nPattern.prototype.webaudio = function () {\n  return this.onTrigger(webaudioOutputTrigger);\n};\n\nexport function webaudioRepl(options = {}) {\n  options = {\n    getTime: () => getAudioContext().currentTime,\n    defaultOutput: webaudioOutput,\n    ...options,\n  };\n  return repl(options);\n}\n\nPattern.prototype.dough = function () {\n  return this.onTrigger(doughTrigger, 1);\n};\n","import { Pattern, clamp } from '@strudel/core';\nimport { getDrawContext, getTheme } from '@strudel/draw';\nimport { analysers, getAnalyzerData } from 'superdough';\n\nexport function drawTimeScope(\n  analyser,\n  {\n    align = true,\n    color = 'white',\n    thickness = 3,\n    scale = 0.25,\n    pos = 0.75,\n    trigger = 0,\n    ctx = getDrawContext(),\n    id = 1,\n  } = {},\n) {\n  ctx.lineWidth = thickness;\n  ctx.strokeStyle = color;\n  let canvas = ctx.canvas;\n\n  if (!analyser) {\n    // if analyser is undefined, draw straight line\n    // it may be undefined when no sound has been played yet\n    ctx.beginPath();\n    let y = pos * canvas.height;\n    ctx.moveTo(0, y);\n    ctx.lineTo(canvas.width, y);\n    ctx.stroke();\n    return;\n  }\n  const dataArray = getAnalyzerData('time', id);\n\n  ctx.beginPath();\n\n  const bufferSize = analyser.frequencyBinCount;\n  let triggerIndex = align\n    ? Array.from(dataArray).findIndex((v, i, arr) => i && arr[i - 1] > -trigger && v <= -trigger)\n    : 0;\n  triggerIndex = Math.max(triggerIndex, 0); // fallback to 0 when no trigger is found\n\n  const sliceWidth = (canvas.width * 1.0) / bufferSize;\n  let x = 0;\n  for (let i = triggerIndex; i < bufferSize; i++) {\n    const v = dataArray[i] + 1;\n    const y = (pos - scale * (v - 1)) * canvas.height;\n\n    if (i === 0) {\n      ctx.moveTo(x, y);\n    } else {\n      ctx.lineTo(x, y);\n    }\n    x += sliceWidth;\n  }\n  ctx.stroke();\n}\n\nexport function drawFrequencyScope(\n  analyser,\n  { color = 'white', scale = 0.25, pos = 0.75, lean = 0.5, min = -150, max = 0, ctx = getDrawContext(), id = 1 } = {},\n) {\n  if (!analyser) {\n    ctx.beginPath();\n    let y = pos * canvas.height;\n    ctx.moveTo(0, y);\n    ctx.lineTo(canvas.width, y);\n    ctx.stroke();\n    return;\n  }\n  const dataArray = getAnalyzerData('frequency', id);\n  const canvas = ctx.canvas;\n\n  ctx.fillStyle = color;\n  const bufferSize = analyser.frequencyBinCount;\n  const sliceWidth = (canvas.width * 1.0) / bufferSize;\n\n  let x = 0;\n  for (let i = 0; i < bufferSize; i++) {\n    const normalized = clamp((dataArray[i] - min) / (max - min), 0, 1);\n    const v = normalized * scale;\n    const h = v * canvas.height;\n    const y = (pos - v * lean) * canvas.height;\n\n    ctx.fillRect(x, y, Math.max(sliceWidth, 1), h);\n    x += sliceWidth;\n  }\n}\n\nfunction clearScreen(smear = 0, smearRGB = `0,0,0`, ctx = getDrawContext()) {\n  if (!smear) {\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n  } else {\n    ctx.fillStyle = `rgba(${smearRGB},${1 - smear})`;\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n  }\n}\n\n/**\n * Renders an oscilloscope for the frequency domain of the audio signal.\n * @name fscope\n * @param {string} color line color as hex or color name. defaults to white.\n * @param {number} scale scales the y-axis. Defaults to 0.25\n * @param {number} pos y-position relative to screen height. 0 = top, 1 = bottom of screen\n * @param {number} lean y-axis alignment where 0 = top and 1 = bottom\n * @param {number} min min value\n * @param {number} max max value\n * @example\n * s(\"sawtooth\").fscope()\n */\nPattern.prototype.fscope = function (config = {}) {\n  let id = config.id ?? 1;\n  return this.analyze(id).draw(\n    () => {\n      clearScreen(config.smear, '0,0,0', config.ctx);\n      analysers[id] && drawFrequencyScope(analysers[id], config);\n    },\n    { id },\n  );\n};\n\n/**\n * Renders an oscilloscope for the time domain of the audio signal.\n * @name scope\n * @synonyms tscope\n * @param {object} config optional config with options:\n * @param {boolean} align if 1, the scope will be aligned to the first zero crossing. defaults to 1\n * @param {string} color line color as hex or color name. defaults to white.\n * @param {number} thickness line thickness. defaults to 3\n * @param {number} scale scales the y-axis. Defaults to 0.25\n * @param {number} pos y-position relative to screen height. 0 = top, 1 = bottom of screen\n * @param {number} trigger amplitude value that is used to align the scope. defaults to 0.\n * @example\n * s(\"sawtooth\")._scope()\n */\nlet latestColor = {};\nPattern.prototype.tscope = function (config = {}) {\n  let id = config.id ?? 1;\n  return this.analyze(id).draw(\n    (haps) => {\n      config.color = haps[0]?.value?.color || getTheme().foreground;\n      latestColor[id] = config.color;\n      clearScreen(config.smear, '0,0,0', config.ctx);\n      drawTimeScope(analysers[id], config);\n    },\n    { id },\n  );\n};\n\nPattern.prototype.scope = Pattern.prototype.tscope;\n"],"names":["FeedbackDelayNode","ac","wet","time","feedback","feedbackGain","delayGain","target","t","reverbGen","params","callback","audioContext","sampleRate","numChannels","totalTime","decaySampleFrames","numSampleFrames","fadeInSampleFrames","decayBase","reverbIR","i","chan","j","randomSample","applyGradualLowpass","data","width","height","min","max","canvas","gc","xscale","yscale","input","lpFreqStart","lpFreqEnd","lpFreqEndAt","channelData","getAllChannelData","context","player","filter","event","buffer","channels","duration","newLength","newBuffer","channel","oldData","newData","fade","lp","dim","ir","convolver","d","vowelFormant","VowelNode","letter","gains","qs","freqs","makeupGain","gain","log","msg","logger","args","setLogger","fn","tokenizeNote","note","pc","acc","oct","chromas","accs","noteToMidi","defaultOctave","chroma","offset","o","char","midiToFreq","n","clamp","num","freqToMidi","freq","valueToMidi","value","fallbackValue","nanFallback","fallback","silent","_mod","m","getSoundIndex","numSounds","gainNode","node","getAudioContext","getSlope","y1","y2","x1","x2","getWorklet","processor","config","key","getParamADSR","param","attack","decay","sustain","release","begin","end","curve","ramp","range","peak","sustainVal","envValAtTime","val","slope","getCompressor","threshold","ratio","knee","options","getADSRValues","defaultValues","a","s","r","createFilter","type","frequency","Q","att","dec","sus","rel","fenv","start","fanchor","model","drive","frequencyParam","fenvAbs","wetfade","drywet","dry","wetAmount","dry_gain","wet_gain","mix","curves","getPitchEnvelope","holdEnd","penv","pattack","pdecay","psustain","prelease","panchor","cents","getVibratoOscillator","vibmod","vib","vibratoOscillator","webAudioTimeout","onComplete","startTime","stopTime","constantNode","mod","ctx","osc","g","fm","frequencyparam","harmonicityRatio","modulationIndex","wave","modfreq","modgain","applyFM","fmHarmonicity","fmModulationIndex","fmEnvelopeType","fmAttack","fmDecay","fmSustain","fmRelease","fmVelocity","fmWaveform","modulator","stop","envGain","fmmod","v","bufferCache","loadCache","getCachedBuffer","url","humanFileSize","bytes","si","thresh","units","u","getSampleBufferSource","speed","bank","resolveUrl","transpose","midi","sampleUrl","index","midiDiff","noteA","closest","k","loadBuffer","reverseBuffer","bufferSource","playbackRate","label","timestamp","res","took","size","decoded","reversed","getLoadedBuffer","resolveSpecialPaths","base","_","repo","githubPath","subpath","path","processSampleMap","sampleMap","baseUrl","fullUrl","samples","resourcePrefixHandlers","registerSamplesPrefix","prefix","resolve","getSamplesPrefixHandler","handler","words","gender","language","json","error","prebake","tag","registerSound","hapValue","onended","onTriggerSample","cutGroups","unit","nudge","cut","loop","clip","loopBegin","loopEnd","bufferDuration","out","envEnd","handle","endTime","playWholeBuffer","prev","soundMap","map","onTrigger","getSound","defaultDefaultValues","defaultControls","setDefaultValue","getDefaultValue","setDefaultValues","defaultsobj","resetDefaultValues","setVersionDefaults","version","resetLoadedSounds","setDefaultAudioContext","workletsLoading","loadWorklets","workletsUrl","initAudio","disableWorklets","err","audioReady","initAudioOnFirstClick","listener","delays","channelMerger","destinationGain","initializeAudioOutput","maxChannelCount","connectToDestination","stereoMix","splitter","ch","panic","getDelay","orbit","delaytime","delayfeedback","dly","getPhaser","depth","centerFrequency","sweep","lfoGain","numStages","fOffset","filterChain","getFilterType","ftype","filterTypes","reverbs","hasChanged","now","before","getReverb","reverb","analysers","analysersData","getAnalyserById","id","fftSize","analyserNode","getAnalyzerData","getter","effectSend","effect","send","resetGlobalEffects","superdough","hapDuration","stretch","source","postgain","density","cutoff","lpenv","lpattack","lpdecay","lpsustain","lprelease","resonance","hpenv","hcutoff","hpattack","hpdecay","hpsustain","hprelease","hresonance","bpenv","bandf","bpattack","bpdecay","bpsustain","bprelease","bandq","phaser","phaserdepth","phasersweep","phasercenter","coarse","crush","shape","shapevol","distort","distortvol","pan","vowel","delay","room","roomfade","roomlp","roomdim","roomsize","velocity","analyze","fft","compressorThreshold","compressorRatio","compressorKnee","compressorAttack","compressorRelease","toDisconnect","sourceNode","soundHandle","chain","hp","bp","vowelFilter","panner","phaserFX","post","delaySend","delyNode","reverbSend","roomIR","sample","reverbNode","analyserSend","last","current","superdoughTrigger","hap","ct","cps","worklet","dspWorklet","code","name","workletCode","dataURL","dough","doughTrigger","time_deprecate","currentTime","targetTime","Pattern","repl","strudel","hap2value","webaudioOutputTrigger","webaudioOutput","deadline","webaudioRepl","drawTimeScope","analyser","align","color","thickness","scale","pos","trigger","getDrawContext","dataArray","bufferSize","triggerIndex","arr","sliceWidth","x","y","drawFrequencyScope","lean","h","clearScreen","smear","smearRGB","haps","getTheme"],"mappings":"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"}