import{w as qt,P as U,x as Ct}from"./index.CEVOgZNG.js";import{o as At,e as kt,g as me}from"./index.xsBMAGf9.js";if(typeof DelayNode<"u"){class e extends DelayNode{constructor(n,o,a,s){super(n),o=Math.abs(o),this.delayTime.value=a;const r=n.createGain();r.gain.value=Math.min(Math.abs(s),.995),this.feedback=r.gain;const i=n.createGain();return i.gain.value=o,this.delayGain=i,this.connect(r),this.connect(i),r.connect(this),this.connect=c=>i.connect(c),this}start(n){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,n+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(t,n,o){return new e(this,t,n,o)}}var ye={};ye.generateReverb=function(e,t){for(var n=e.audioContext||new AudioContext,o=n.sampleRate,a=e.numChannels||2,s=e.decayTime*1.5,r=Math.round(e.decayTime*o),i=Math.round(s*o),c=Math.round((e.fadeInTime||0)*o),l=Math.pow(1/1e3,1/r),u=n.createBuffer(a,i,o),d=0;d<a;d++){for(var h=u.getChannelData(d),f=0;f<i;f++)h[f]=Bt()*Math.pow(l,f);for(var f=0;f<c;f++)h[f]*=f/c}St(u,e.lpFreqStart||0,e.lpFreqEnd||0,e.decayTime,t)};ye.generateGraph=function(e,t,n,o,a){var s=document.createElement("canvas");s.width=t,s.height=n;var r=s.getContext("2d");r.fillStyle="#000",r.fillRect(0,0,s.width,s.height),r.fillStyle="#fff";for(var i=t/e.length,c=n/(a-o),l=0;l<e.length;l++)r.fillRect(l*i,n-(e[l]-o)*c,1,1);return s};var St=function(e,t,n,o,a){if(t==0){a(e);return}var s=xt(e),r=new OfflineAudioContext(e.numberOfChannels,s[0].length,e.sampleRate),i=r.createBufferSource();i.buffer=e;var c=r.createBiquadFilter();t=Math.min(t,e.sampleRate/2),n=Math.min(n,e.sampleRate/2),c.type="lowpass",c.Q.value=1e-4,c.frequency.setValueAtTime(t,0),c.frequency.linearRampToValueAtTime(n,o),i.connect(c),c.connect(r.destination),i.start(),r.oncomplete=function(l){a(l.renderedBuffer)},r.startRendering(),window.filterNode=c},xt=function(e){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);return t},Bt=function(){return Math.random()*2-1};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(e,t){const n=t.sampleRate*e,o=this.createBuffer(t.numberOfChannels,t.length,t.sampleRate);for(let a=0;a<t.numberOfChannels;a++){let s=t.getChannelData(a),r=o.getChannelData(a);for(let i=0;i<n;i++)r[i]=s[i]||0}return o},AudioContext.prototype.createReverb=function(e,t,n,o,a){const s=this.createConvolver();return s.generate=(r=2,i=.1,c=15e3,l=1e3,u)=>{s.duration=r,s.fade=i,s.lp=c,s.dim=l,s.ir=u,u?s.buffer=this.adjustLength(r,u):ye.generateReverb({audioContext:this,numChannels:2,decayTime:r,fadeInTime:i,lpFreqStart:c,lpFreqEnd:l},d=>{s.buffer=d})},s.generate(e,t,n,o,a),s});var Pe={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},ae:{freqs:[650,1515,2400,3e3,3350],gains:[1,.5,.1008,.0631,.0126],qs:[80,90,120,130,140]},aa:{freqs:[560,900,2570,3e3,3300],gains:[1,.5,.0708,.0631,.0126],qs:[80,90,120,130,140]},oe:{freqs:[500,1430,2300,3e3,3300],gains:[1,.2,.0708,.0316,.01995],qs:[40,60,100,120,120]},ue:{freqs:[250,1750,2150,3200,3300],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},y:{freqs:[400,1460,2400,3e3,3300],gains:[1,.2,.0708,.0316,.02995],qs:[40,60,100,120,120]},uh:{freqs:[600,1250,2100,3100,3500],gains:[1,.3,.0608,.0316,.01995],qs:[40,70,100,120,130]},un:{freqs:[500,1240,2280,3e3,3500],gains:[1,.1,.1708,.0216,.02995],qs:[40,60,100,120,120]},en:{freqs:[600,1480,2450,3200,3300],gains:[1,.15,.0708,.0316,.02995],qs:[40,60,100,120,120]},an:{freqs:[700,1050,2500,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},on:{freqs:[500,1080,2350,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},get æ(){return this.ae},get ø(){return this.oe},get ɑ(){return this.aa},get å(){return this.aa},get ö(){return this.oe},get ü(){return this.ue},get ı(){return this.y}};if(typeof GainNode<"u"){class e extends GainNode{constructor(n,o){if(super(n),!Pe[o])throw new Error("vowel: unknown vowel "+o);const{gains:a,qs:s,freqs:r}=Pe[o],i=n.createGain();for(let c=0;c<5;c++){const l=n.createGain();l.gain.value=a[c];const u=n.createBiquadFilter();u.type="bandpass",u.Q.value=s[c],u.frequency.value=r[c],this.connect(u),u.connect(l),l.connect(i)}return i.gain.value=8,this.connect=c=>i.connect(c),this}}AudioContext.prototype.createVowelFilter=function(t){return new e(this,t)}}let Qe=e=>console.log(e);const B=(...e)=>Qe(...e),Rt=e=>{Qe=e},$t=e=>{if(typeof e!="string")return[];const[t,n="",o]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return t?[t,n,o?Number(o):void 0]:[]},Gt={c:0,d:2,e:4,f:5,g:7,a:9,b:11},Mt={"#":1,b:-1,s:1,f:-1},Ke=(e,t=3)=>{const[n,o,a=t]=$t(e);if(!n)throw new Error('not a note: "'+e+'"');const s=Gt[n.toLowerCase()],r=o?.split("").reduce((i,c)=>i+Mt[c],0)||0;return(Number(a)+1)*12+s+r},yn=e=>Math.pow(2,(e-69)/12)*440,ee=(e,t,n)=>Math.min(Math.max(e,t),n),Dt=e=>12*Math.log(e/440)/Math.LN2+69,Et=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:o}=e;if(typeof n=="number")return Dt(n);if(typeof o=="string")return Ke(o);if(typeof o=="number")return o;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t};function G(e,t=0,n){return isNaN(Number(e))?(!n&&B(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const Ye=(e,t)=>(e%t+t)%t,ze=(e,t)=>Ye(Math.round(G(e,0)),t),Ot="/assets/worklets-C2vj9UQA.js";function Ze(e){const t=T().createGain();return t.gain.value=e,t}const Le=(e,t,n,o)=>o-n===0?0:(t-e)/(o-n);function N(e,t,n,o){const a=new AudioWorkletNode(e,t,o);return Object.entries(n).forEach(([s,r])=>{a.parameters.get(s).value=r}),a}const oe=(e,t,n,o,a,s,r,i,c,l="exponential")=>{t=G(t),n=G(n),o=G(o),a=G(a);const u=l==="exponential"?"exponentialRampToValueAtTime":"linearRampToValueAtTime";l==="exponential"&&(s=s===0?.001:s,r=r===0?.001:r);const d=r-s,h=r,f=s+o*d,p=c-i,y=v=>{let m;if(t>v){let A=Le(s,h,0,t);m=v*A+(s>h?s:0)}else m=(v-t)*Le(h,f,0,n)+h;return l==="exponential"&&(m=m||.001),m};e.setValueAtTime(s,i),t>p?e[u](y(p),c):t+n>p?(e[u](y(t),i+t),e[u](y(p),c)):(e[u](y(t),i+t),e[u](y(t+n),i+t+n),e.setValueAtTime(f,c)),e[u](s,c+a)};function Ft(e,t,n,o,a,s){const r={threshold:t??-3,ratio:n??10,knee:o??10,attack:a??.005,release:s??.05};return new DynamicsCompressorNode(e,r)}const ae=(e,t="linear",n)=>{const[r,i,c,l]=e;if(r==null&&i==null&&c==null&&l==null)return n??[.001,.001,1,.01];const u=c??(r!=null&&i==null||r==null&&i==null?1:.001);return[Math.max(r??0,.001),Math.max(i??0,.001),Math.min(u,1),Math.max(l??0,.01)]};function ue(e,t,n,o,a,s,r,i,c,l,u,d,h,f){const p="exponential",[y,v,m,A]=ae([a,s,r,i],p,[.005,.14,0,.1]);let C,S;if(h==="ladder"?(C=N(e,"ladder-processor",{frequency:n,q:o,drive:f}),S=C.parameters.get("frequency")):(C=e.createBiquadFilter(),C.type=t,C.Q.value=o,C.frequency.value=n,S=C.frequency),(a??s??r??i??c)!==void 0){c=G(c,1,!0),d=G(d,0,!0);const M=Math.abs(c),W=M*d;let D=ee(2**-W*n,0,2e4),R=ee(2**(M-W)*n,0,2e4);return c<0&&([D,R]=[R,D]),oe(S,y,v,m,A,D,R,l,u,p),C}return C}let Ie=e=>e<.5?1:1-(e-.5)/.5;function vn(e,t,n=0){const o=T();if(!n)return e;let a=o.createGain(),s=o.createGain();e.connect(a),t.connect(s),a.gain.value=Ie(n),s.gain.value=Ie(1-n);let r=o.createGain();return a.connect(r),s.connect(r),r}let Nt=["linear","exponential"];function Wt(e,t,n,o){if(!(t.pattack??t.pdecay??t.psustain??t.prelease??t.penv))return;const s=G(t.penv,1,!0),r=Nt[t.pcurve??0];let[i,c,l,u]=ae([t.pattack,t.pdecay,t.psustain,t.prelease],r,[.2,.001,1,.001]),d=t.panchor??l;const h=s*100,f=0-h*d,p=h-h*d;oe(e,i,c,l,u,f,p,n,o,r)}function _t(e,t,n){const{vibmod:o=.5,vib:a}=t;let s;if(a>0){s=T().createOscillator(),s.frequency.value=a;const r=T().createGain();return r.gain.value=o*100,s.connect(r),r.connect(e),s.start(n),s}}function wn(e,t,n,o){const a=e.createConstantSource();a.start(n),a.stop(o),a.onended=()=>{t()}}const jt=(e,t=1,n="sine")=>{const o=T(),a=o.createOscillator();a.type=n,a.frequency.value=e,a.start();const s=new GainNode(o,{gain:t});return a.connect(s),{node:s,stop:r=>a.stop(r)}},Vt=(e,t,n,o="sine")=>{const s=e.value*t,r=s*n;return jt(s,r,o)};function bn(e,t,n){const{fmh:o=1,fmi:a,fmenv:s="exp",fmattack:r,fmdecay:i,fmsustain:c,fmrelease:l,fmvelocity:u,fmwave:d="sine",duration:h}=t;let f,p=()=>{};if(a){const v=T().createGain(),m=Vt(e,o,a,d);if(f=m.node,p=m.stop,![r,i,c,l,u].find(A=>A!==void 0))f.connect(e);else{const[A,C,S,O]=ae([r,i,c,l]),M=n+h;oe(v.gain,A,C,S,O,0,1,n,M,s==="exp"?"exponential":"linear"),f.connect(v),v.connect(e)}}return{stop:p}}const ve={},de={},Tn=e=>ve[e];function Pt(e,t){var n=t?1e3:1024;if(e<n)return e+" B";var o=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],a=-1;do e/=n,++a;while(e>=n);return e.toFixed(1)+" "+o[a]}const zt=async(e,t,n,o,a,s,r)=>{let i=0;a!==void 0&&n!==void 0&&B("[sampler] hap has note and freq. ignoring note","warning");let c=Et({freq:a,note:n},36);i=c-36;const l=T();let u,d=0;if(Array.isArray(s))d=ze(t,s.length),u=s[d];else{const y=m=>Ke(m)-c,v=Object.keys(s).filter(m=>!m.startsWith("_")).reduce((m,A,C)=>!m||Math.abs(y(A))<Math.abs(y(m))?A:m,null);i=-y(v),d=ze(t,s[v].length),u=s[v][d]}r&&(u=await r(u));let h=await Xe(u,l,e,d);o<0&&(h=Lt(h));const f=l.createBufferSource();f.buffer=h;const p=1*Math.pow(2,i/12);return f.playbackRate.value=p,f},Xe=(e,t,n,o=0)=>{const a=n?`sound "${n}:${o}"`:"sample";if(e=e.replace("#","%23"),!de[e]){B(`[sampler] load ${a}..`,"load-sample",{url:e});const s=Date.now();de[e]=fetch(e).then(r=>r.arrayBuffer()).then(async r=>{const i=Date.now()-s,c=Pt(r.byteLength);B(`[sampler] load ${a}... done! loaded ${c} in ${i}ms`,"loaded-sample",{url:e});const l=await t.decodeAudioData(r);return ve[e]=l,l})}return de[e]};function Lt(e){const t=T(),n=t.createBuffer(e.numberOfChannels,e.length,t.sampleRate);for(let o=0;o<e.numberOfChannels;o++)n.copyToChannel(e.getChannelData(o).slice().reverse(),o,o);return n}const qn=e=>ve[e];function Je(e){if(e.startsWith("bubo:")){const[t,n]=e.split(":");e=`github:Bubobubobubobubo/dough-${n}`}return e}function Ue(e,t=""){if(!e.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[n,o]=e.split("github:");return o=o.endsWith("/")?o.slice(0,-1):o,o.split("/").length===2&&(o+="/main"),`https://raw.githubusercontent.com/${o}/${t}`}const It=(e,t,n=e._base||"")=>Object.entries(e).forEach(([o,a])=>{if(typeof a=="string"&&(a=[a]),typeof a!="object")throw new Error("wrong sample map format for "+o);n=a._base||n,n=Je(n),n.startsWith("github:")&&(n=Ue(n,""));const s=r=>n+r;Array.isArray(a)?a=a.map(s):a=Object.fromEntries(Object.entries(a).map(([r,i])=>[r,(typeof i=="string"?[i]:i).map(s)])),t(o,a)});let et={};function Cn(e,t){et[e]=t}function Ht(e){const t=Object.entries(et).find(([n])=>e.startsWith(n));if(t)return t[1]}const Qt=async(e,t=e._base||"",n={})=>{if(typeof e=="string"){const s=Ht(e);if(s)return s(e);if(e=Je(e),e.startsWith("github:")&&(e=Ue(e,"strudel.json")),e.startsWith("local:")&&(e="http://localhost:5432"),e.startsWith("shabda:")){let[i,c]=e.split("shabda:");e=`https://shabda.ndre.gr/${c}.json?strudel=1`}if(e.startsWith("shabda/speech")){let[i,c]=e.split("shabda/speech");c=c.startsWith("/")?c.substring(1):c;let[l,u]=c.split(":"),d="f",h="en-GB";l&&([h,d]=l.split("/")),e=`https://shabda.ndre.gr/speech/${u}.json?gender=${d}&language=${h}&strudel=1'`}if(typeof fetch!="function")return;const r=e.split("/").slice(0,-1).join("/");return typeof fetch>"u"?void 0:fetch(e).then(i=>i.json()).then(i=>Qt(i,t||i._base||r,n)).catch(i=>{throw console.error(i),new Error(`error loading "${e}"`)})}const{prebake:o,tag:a}=n;It(e,(s,r)=>Yt(s,(i,c,l)=>Kt(i,c,l,r),{type:"sample",samples:r,baseUrl:t,prebake:o,tag:a}),t)},He=[];async function Kt(e,t,n,o,a){let{s,freq:r,unit:i,nudge:c=0,cut:l,loop:u,clip:d=void 0,n:h=0,note:f,speed:p=1,loopBegin:y=0,begin:v=0,loopEnd:m=1,end:A=1,duration:C}=t;if(p===0)return;u=s.startsWith("wt_")?1:t.loop;const S=T();let[O,M,W,D]=ae([t.attack,t.decay,t.sustain,t.release]);const R=e+c,w=await zt(s,h,f,p,r,o,a);let se=_t(w.detune,t,e);if(S.currentTime>e){B(`[sampler] still loading sound "${s}:${h}"`,"highlight");return}if(!w){B(`[sampler] could not load "${s}:${h}"`,"error");return}w.playbackRate.value=Math.abs(p)*w.playbackRate.value,i==="c"&&(w.playbackRate.value=w.playbackRate.value*w.buffer.duration*1);const _=v*w.buffer.duration;u&&(w.loop=!0,w.loopStart=y*w.buffer.duration-_,w.loopEnd=m*w.buffer.duration-_),w.start(R,_);const re=S.createGain(),I=w.connect(re);if(d==null&&u==null&&t.release==null){const $=w.buffer.duration/w.playbackRate.value;C=(A-v)*$}let H=e+C;oe(I.gain,O,M,W,D,0,1,e,H,"linear"),Wt(w.detune,t,e,H);const Q=S.createGain();I.connect(Q),w.onended=function(){w.disconnect(),se?.stop(),I.disconnect(),Q.disconnect(),n()};let ie=H+D+.01;w.stop(ie);const K={node:Q,bufferSource:w,stop:($,Ce)=>{}};if(l!==void 0){const $=He[l];$&&($.node.gain.setValueAtTime(1,R),$.node.gain.linearRampToValueAtTime(0,R+.01)),He[l]=K}return K}const we=At();function Yt(e,t,n={}){we.setKey(e,{onTrigger:t,data:n})}function fe(e){return we.get()[e]}const tt={s:"triangle",gain:.8,postgain:1,density:".03",ftype:"12db",fanchor:0,resonance:1,hresonance:1,bandq:1,channels:[1,2],phaserdepth:.75,shapevol:1,distortvol:1,delay:0,delayfeedback:.5,delaytime:.25,orbit:1,i:1,velocity:1,fft:8};let be=new Map(Object.entries(tt));function nt(e,t){be.set(e,t)}function q(e){return be.get(e)}function An(e){Object.keys(e).forEach(t=>{nt(t,e[t])})}function Zt(){be=new Map(Object.entries(tt))}function kn(e){Zt(),e==="1.0"&&nt("fanchor",.5)}const Sn=()=>we.set({});let te;const Xt=()=>(te=new AudioContext,te),T=()=>te||Xt();let he;function Jt(){return he||(he=T().audioWorklet.addModule(Ot)),he}async function Ut(e={}){const{disableWorklets:t=!1}=e;if(!(typeof window>"u")){if(await T().resume(),t){B("[superdough]: AudioWorklets disabled with disableWorklets");return}try{await Jt(),B("[superdough] AudioWorklets loaded")}catch(n){console.warn("could not load AudioWorklet effects",n)}B("[superdough] ready")}}let pe;async function xn(e){return pe||(pe=new Promise(t=>{document.addEventListener("click",async function n(){document.removeEventListener("click",n),await Ut(e),t()})})),pe}let E={},ne,P;function en(){const e=T(),t=e.destination.maxChannelCount;e.destination.channelCount=t,ne=new ChannelMergerNode(e,{numberOfInputs:e.destination.channelCount}),P=new GainNode(e),ne.connect(P),P.connect(e.destination)}const Te=(e,t=[0,1])=>{const n=T();ne==null&&en();const o=new StereoPannerNode(n);e.connect(o);const a=new ChannelSplitterNode(n,{numberOfOutputs:o.channelCount});o.connect(a),t.forEach((s,r)=>{a.connect(ne,r%o.channelCount,ee(s,0,n.destination.channelCount-1))})},Bn=()=>{P!=null&&(P.gain.linearRampToValueAtTime(0,T().currentTime+.01),P=null)};function tn(e,t,n,o){if(n=ee(n,0,.98),!E[e]){const s=T().createFeedbackDelay(1,t,n);s.start?.(o),Te(s,[0,1]),E[e]=s}return E[e].delayTime.value!==t&&E[e].delayTime.setValueAtTime(t,o),E[e].feedback.value!==n&&E[e].feedback.setValueAtTime(n,o),E[e]}function nn(e,t,n=1,o=.5,a=1e3,s=2e3){const r=T(),i=r.createGain();i.gain.value=s*2,N(r,"lfo-processor",{frequency:n,depth:1,skew:0,phaseoffset:0,time:e,end:t,shape:1,dcoffset:-.5}).connect(i);const l=2;let u=0;const d=[];for(let h=0;h<l;h++){const f=r.createBiquadFilter();f.type="notch",f.gain.value=1,f.frequency.value=a+u,f.Q.value=2-Math.min(Math.max(o*2,0),1.9),i.connect(f.detune),u+=282,h>0&&d[h-1].connect(f),d.push(f)}return d[d.length-1]}function on(e){e=e??0;const t=["12db","ladder","24db"];return typeof e=="number"?t[Math.floor(Ye(e,t.length))]:e}let x={},J=(e,t)=>e!==void 0&&e!==t;function an(e,t,n,o,a,s){if(!x[e]){const i=T().createReverb(t,n,o,a,s);Te(i,[0,1]),x[e]=i}return(J(t,x[e].duration)||J(n,x[e].fade)||J(o,x[e].lp)||J(a,x[e].dim)||x[e].ir!==s)&&x[e].generate(t,n,o,a,s),x[e]}let k={},z={};function sn(e,t=1024){if(!k[e]){const n=T().createAnalyser();n.fftSize=t,k[e]=n,z[e]=new Float32Array(k[e].frequencyBinCount)}return k[e].fftSize!==t&&(k[e].fftSize=t,z[e]=new Float32Array(k[e].frequencyBinCount)),k[e]}function ot(e="time",t=1){const n={time:()=>k[t]?.getFloatTimeDomainData(z[t]),frequency:()=>k[t]?.getFloatFrequencyData(z[t])}[e];if(!n)throw new Error(`getAnalyzerData: ${e} not supported. use one of ${Object.keys(n).join(", ")}`);return n(),z[t]}function ge(e,t,n){const o=Ze(n);return e.connect(o),o.connect(t),o}function Rn(){E={},x={},k={},z={}}const qe=async(e,t,n)=>{t=typeof t=="string"&&t.startsWith("=")?Number(t.slice(1)):a.currentTime+t;let{stretch:o}=e;o!=null&&(t=t-.04);const a=T();if(typeof e!="object")throw new Error(`expected hap.value to be an object, but got "${e}". Hint: append .note() or .s() to the end`,"error");if(e.duration=n,t<a.currentTime){console.warn(`[superdough]: cannot schedule sounds in the past (target: ${t.toFixed(2)}, now: ${a.currentTime.toFixed(2)})`);return}let{s=q("s"),bank:r,source:i,gain:c=q("gain"),postgain:l=q("postgain"),density:u=q("density"),fanchor:d=q("fanchor"),drive:h=.69,cutoff:f,lpenv:p,lpattack:y,lpdecay:v,lpsustain:m,lprelease:A,resonance:C=q("resonance"),hpenv:S,hcutoff:O,hpattack:M,hpdecay:W,hpsustain:D,hprelease:R,hresonance:w=q("hresonance"),bpenv:se,bandf:_,bpattack:re,bpdecay:I,bpsustain:H,bprelease:Q,bandq:ie=q("bandq"),channels:j=q("channels"),phaser:K,phaserdepth:$=q("phaserdepth"),phasersweep:Ce,phasercenter:ct,coarse:Ae,crush:ke,shape:Se,shapevol:lt=q("shapevol"),distort:xe,distortvol:ut=q("distortvol"),pan:Be,vowel:Re,delay:$e=q("delay"),delayfeedback:Ge=q("delayfeedback"),delaytime:Me=q("delaytime"),orbit:De=q("orbit"),room:Ee,roomfade:dt,roomlp:ft,roomdim:ht,roomsize:pt,ir:ce,i:Oe=q("i"),velocity:gt=q("velocity"),analyze:Fe,fft:mt=q("fft"),compressor:Ne,compressorRatio:yt,compressorKnee:vt,compressorAttack:wt,compressorRelease:bt}=e;c=G(c,1),j=(Array.isArray(j)?j:[j]).map(g=>g-1),c*=gt;let We=[];const Tt=()=>{We.forEach(g=>g?.disconnect())};r&&s&&(s=`${r}_${s}`);let Z;if(i)Z=i(t,e,n);else if(fe(s)){const{onTrigger:g}=fe(s),F=await g(t,e,Tt);F&&(Z=F.node,F.stop(t+n))}else throw new Error(`sound ${s} not found! Is it loaded?`);if(!Z)return;if(a.currentTime>t){B("[webaudio] skip hap: still loading",a.currentTime-t);return}const b=[];b.push(Z),o!==void 0&&b.push(N(a,"phase-vocoder-processor",{pitchFactor:o})),b.push(Ze(c));const X=on(e.ftype);if(f!==void 0){let g=()=>ue(a,"lowpass",f,C,y,v,m,A,p,t,t+n,d,X,h);b.push(g()),X==="24db"&&b.push(g())}if(O!==void 0){let g=()=>ue(a,"highpass",O,w,M,W,D,R,S,t,t+n,d);b.push(g()),X==="24db"&&b.push(g())}if(_!==void 0){let g=()=>ue(a,"bandpass",_,ie,re,I,H,Q,se,t,t+n,d);b.push(g()),X==="24db"&&b.push(g())}if(Re!==void 0){const g=a.createVowelFilter(Re);b.push(g)}if(Ae!==void 0&&b.push(N(a,"coarse-processor",{coarse:Ae})),ke!==void 0&&b.push(N(a,"crush-processor",{crush:ke})),Se!==void 0&&b.push(N(a,"shape-processor",{shape:Se,postgain:lt})),xe!==void 0&&b.push(N(a,"distort-processor",{distort:xe,postgain:ut})),Ne!==void 0&&b.push(Ft(a,Ne,yt,vt,wt,bt)),Be!==void 0){const g=a.createStereoPanner();g.pan.value=2*Be-1,b.push(g)}if(K!==void 0&&$>0){const g=nn(t,t+n,K,$,ct,Ce);b.push(g)}const Y=new GainNode(a,{gain:l});b.push(Y),Te(Y,j);let _e;if($e>0&&Me>0&&Ge>0){const g=tn(De,Me,Ge,t);_e=ge(Y,g,$e)}let je;if(Ee>0){let g;if(ce!==void 0){let le,V=fe(ce);Array.isArray(V)?le=V.data.samples[Oe%V.data.samples.length]:typeof V=="object"&&(le=Object.values(V.data.samples).flat()[Oe%Object.values(V.data.samples).length]),g=await Xe(le,a,ce,0)}const F=an(De,pt,dt,ft,ht,g);je=ge(Y,F,Ee)}let Ve;if(Fe){const g=sn(Fe,2**(mt+5));Ve=ge(Y,g,1)}b.slice(1).reduce((g,F)=>g.connect(F),b[0]),We=b.concat([_e,je,Ve])},$n=(e,t,n,o)=>{qe(t,e-n,t.duration/o)};let L;async function rn(e,t){const n=`dsp-worklet-${Date.now()}`,o=`${t}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${n}', MyProcessor);
`,s=`data:text/javascript;base64,${btoa(o)}`;await e.audioWorklet.addModule(s);const r=new AudioWorkletNode(e,n);return{node:r,stop:()=>r.port.postMessage("stop")}}const at=()=>{L&&(L?.stop(),L?.node?.disconnect())};typeof window<"u"&&window.addEventListener("message",e=>{e.data==="strudel-stop"?at():e.data?.dough&&L?.node.port.postMessage(e.data)});const Gn=async e=>{const t=T();at(),L=await rn(t,e),L.node.connect(t.destination)};function cn(e,t,n,o,a){window.postMessage({time:a,dough:t.value,currentTime:n,duration:t.duration,cps:o})}const{Pattern:st,logger:ln,repl:un}=qt;Rt(ln);const rt=e=>(e.ensureObjectValue(),e.value),dn=(e,t,n,o)=>qe(rt(t),e-n,t.duration/o),fn=(e,t,n,o,a)=>qe(rt(e),a?`=${a}`:t,n);st.prototype.webaudio=function(){return this.onTrigger(dn)};function Mn(e={}){return e={getTime:()=>T().currentTime,defaultOutput:fn,...e},un(e)}st.prototype.dough=function(){return this.onTrigger(cn,1)};function hn(e,{align:t=!0,color:n="white",thickness:o=3,scale:a=.25,pos:s=.75,trigger:r=0,ctx:i=me(),id:c=1}={}){i.lineWidth=o,i.strokeStyle=n;let l=i.canvas;if(!e){i.beginPath();let y=s*l.height;i.moveTo(0,y),i.lineTo(l.width,y),i.stroke();return}const u=ot("time",c);i.beginPath();const d=e.frequencyBinCount;let h=t?Array.from(u).findIndex((y,v,m)=>v&&m[v-1]>-r&&y<=-r):0;h=Math.max(h,0);const f=l.width*1/d;let p=0;for(let y=h;y<d;y++){const v=u[y]+1,m=(s-a*(v-1))*l.height;y===0?i.moveTo(p,m):i.lineTo(p,m),p+=f}i.stroke()}function pn(e,{color:t="white",scale:n=.25,pos:o=.75,lean:a=.5,min:s=-150,max:r=0,ctx:i=me(),id:c=1}={}){if(!e){i.beginPath();let p=o*u.height;i.moveTo(0,p),i.lineTo(u.width,p),i.stroke();return}const l=ot("frequency",c),u=i.canvas;i.fillStyle=t;const d=e.frequencyBinCount,h=u.width*1/d;let f=0;for(let p=0;p<d;p++){const v=Ct((l[p]-s)/(r-s),0,1)*n,m=v*u.height,A=(o-v*a)*u.height;i.fillRect(f,A,Math.max(h,1),m),f+=h}}function it(e=0,t="0,0,0",n=me()){e?(n.fillStyle=`rgba(${t},${1-e})`,n.fillRect(0,0,n.canvas.width,n.canvas.height)):n.clearRect(0,0,n.canvas.width,n.canvas.height)}U.prototype.fscope=function(e={}){let t=e.id??1;return this.analyze(t).draw(()=>{it(e.smear,"0,0,0",e.ctx),k[t]&&pn(k[t],e)},{id:t})};U.prototype.tscope=function(e={}){let t=e.id??1;return this.analyze(t).draw(n=>{e.color=n[0]?.value?.color||kt().foreground,e.color,it(e.smear,"0,0,0",e.ctx),hn(k[t],e)},{id:t})};U.prototype.scope=U.prototype.tscope;export{rn as $,en as A,kn as B,dn as C,Mn as D,hn as E,pn as F,fe as G,nt as H,q as I,An as J,Zt as K,Ut as L,Bn as M,k as N,z as O,sn as P,ot as Q,qe as R,$n as S,Tn as T,zt as U,Lt as V,qn as W,Ft as X,ue as Y,B as Z,Rt as _,ae as a,Gn as a0,cn as a1,oe as b,_t as c,Wt as d,Te as e,Rn as f,T as g,Sn as h,xn as i,vn as j,Ze as k,N as l,bn as m,wn as n,Ke as o,ee as p,yn as q,Yt as r,we as s,Cn as t,Xe as u,It as v,fn as w,Kt as x,Qt as y,Xt as z};
//# sourceMappingURL=scope.CyWYA9A5.js.map
