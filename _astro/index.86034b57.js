import{g as on}from"./_commonjsHelpers.de833af9.js";var le={exports:{}};/**
 * @license Fraction.js v4.2.0 05/03/2022
 * https://www.xarg.org/2014/03/rational-numbers-in-javascript/
 *
 * Copyright (c) 2021, Robert Eisele (robert@xarg.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/(function(e,t){(function(n){var r=2e3,s={s:1,n:0,d:1};function o(c,a){if(isNaN(c=parseInt(c,10)))throw w.InvalidParameter;return c*a}function i(c,a){if(a===0)throw w.DivisionByZero;var l=Object.create(w.prototype);l.s=c<0?-1:1,c=c<0?-c:c;var h=_(c,a);return l.n=c/h,l.d=a/h,l}function u(c){for(var a={},l=c,h=2,b=4;b<=l;){for(;l%h===0;)l/=h,a[h]=(a[h]||0)+1;b+=1+2*h++}return l!==c?l>1&&(a[l]=(a[l]||0)+1):a[c]=(a[c]||0)+1,a}var f=function(c,a){var l=0,h=1,b=1,C=0,N=0,G=0,I=1,j=1,q=0,k=1,x=1,B=1,W=1e7,A;if(c!=null)if(a!==void 0){if(l=c,h=a,b=l*h,l%1!==0||h%1!==0)throw w.NonIntegerParameter}else switch(typeof c){case"object":{if("d"in c&&"n"in c)l=c.n,h=c.d,"s"in c&&(l*=c.s);else if(0 in c)l=c[0],1 in c&&(h=c[1]);else throw w.InvalidParameter;b=l*h;break}case"number":{if(c<0&&(b=c,c=-c),c%1===0)l=c;else if(c>0){for(c>=1&&(j=Math.pow(10,Math.floor(1+Math.log(c)/Math.LN10)),c/=j);k<=W&&B<=W;)if(A=(q+x)/(k+B),c===A){k+B<=W?(l=q+x,h=k+B):B>k?(l=x,h=B):(l=q,h=k);break}else c>A?(q+=x,k+=B):(x+=q,B+=k),k>W?(l=x,h=B):(l=q,h=k);l*=j}else(isNaN(c)||isNaN(a))&&(h=l=NaN);break}case"string":{if(k=c.match(/\d+|./g),k===null)throw w.InvalidParameter;if(k[q]==="-"?(b=-1,q++):k[q]==="+"&&q++,k.length===q+1?N=o(k[q++],b):k[q+1]==="."||k[q]==="."?(k[q]!=="."&&(C=o(k[q++],b)),q++,(q+1===k.length||k[q+1]==="("&&k[q+3]===")"||k[q+1]==="'"&&k[q+3]==="'")&&(N=o(k[q],b),I=Math.pow(10,k[q].length),q++),(k[q]==="("&&k[q+2]===")"||k[q]==="'"&&k[q+2]==="'")&&(G=o(k[q+1],b),j=Math.pow(10,k[q+1].length)-1,q+=3)):k[q+1]==="/"||k[q+1]===":"?(N=o(k[q],b),I=o(k[q+2],1),q+=3):k[q+3]==="/"&&k[q+1]===" "&&(C=o(k[q],b),N=o(k[q+2],b),I=o(k[q+4],1),q+=5),k.length<=q){h=I*j,b=l=G+h*C+j*N;break}}default:throw w.InvalidParameter}if(h===0)throw w.DivisionByZero;s.s=b<0?-1:1,s.n=Math.abs(l),s.d=Math.abs(h)};function d(c,a,l){for(var h=1;a>0;c=c*c%l,a>>=1)a&1&&(h=h*c%l);return h}function m(c,a){for(;a%2===0;a/=2);for(;a%5===0;a/=5);if(a===1)return 0;for(var l=10%a,h=1;l!==1;h++)if(l=l*10%a,h>r)return 0;return h}function y(c,a,l){for(var h=1,b=d(10,l,a),C=0;C<300;C++){if(h===b)return C;h=h*10%a,b=b*10%a}return 0}function _(c,a){if(!c)return a;if(!a)return c;for(;;){if(c%=a,!c)return a;if(a%=c,!a)return c}}function w(c,a){if(f(c,a),this instanceof w)c=_(s.d,s.n),this.s=s.s,this.n=s.n/c,this.d=s.d/c;else return i(s.s*s.n,s.d)}w.DivisionByZero=new Error("Division by Zero"),w.InvalidParameter=new Error("Invalid argument"),w.NonIntegerParameter=new Error("Parameters must be integer"),w.prototype={s:1,n:0,d:1,abs:function(){return i(this.n,this.d)},neg:function(){return i(-this.s*this.n,this.d)},add:function(c,a){return f(c,a),i(this.s*this.n*s.d+s.s*this.d*s.n,this.d*s.d)},sub:function(c,a){return f(c,a),i(this.s*this.n*s.d-s.s*this.d*s.n,this.d*s.d)},mul:function(c,a){return f(c,a),i(this.s*s.s*this.n*s.n,this.d*s.d)},div:function(c,a){return f(c,a),i(this.s*s.s*this.n*s.d,this.d*s.n)},clone:function(){return i(this.s*this.n,this.d)},mod:function(c,a){if(isNaN(this.n)||isNaN(this.d))return new w(NaN);if(c===void 0)return i(this.s*this.n%this.d,1);if(f(c,a),s.n===0&&this.d===0)throw w.DivisionByZero;return i(this.s*(s.d*this.n)%(s.n*this.d),s.d*this.d)},gcd:function(c,a){return f(c,a),i(_(s.n,this.n)*_(s.d,this.d),s.d*this.d)},lcm:function(c,a){return f(c,a),s.n===0&&this.n===0?i(0,1):i(s.n*this.n,_(s.n,this.n)*_(s.d,this.d))},ceil:function(c){return c=Math.pow(10,c||0),isNaN(this.n)||isNaN(this.d)?new w(NaN):i(Math.ceil(c*this.s*this.n/this.d),c)},floor:function(c){return c=Math.pow(10,c||0),isNaN(this.n)||isNaN(this.d)?new w(NaN):i(Math.floor(c*this.s*this.n/this.d),c)},round:function(c){return c=Math.pow(10,c||0),isNaN(this.n)||isNaN(this.d)?new w(NaN):i(Math.round(c*this.s*this.n/this.d),c)},inverse:function(){return i(this.s*this.d,this.n)},pow:function(c,a){if(f(c,a),s.d===1)return s.s<0?i(Math.pow(this.s*this.d,s.n),Math.pow(this.n,s.n)):i(Math.pow(this.s*this.n,s.n),Math.pow(this.d,s.n));if(this.s<0)return null;var l=u(this.n),h=u(this.d),b=1,C=1;for(var N in l)if(N!=="1"){if(N==="0"){b=0;break}if(l[N]*=s.n,l[N]%s.d===0)l[N]/=s.d;else return null;b*=Math.pow(N,l[N])}for(var N in h)if(N!=="1"){if(h[N]*=s.n,h[N]%s.d===0)h[N]/=s.d;else return null;C*=Math.pow(N,h[N])}return s.s<0?i(C,b):i(b,C)},equals:function(c,a){return f(c,a),this.s*this.n*s.d===s.s*s.n*this.d},compare:function(c,a){f(c,a);var l=this.s*this.n*s.d-s.s*s.n*this.d;return(0<l)-(l<0)},simplify:function(c){if(isNaN(this.n)||isNaN(this.d))return this;c=c||.001;for(var a=this.abs(),l=a.toContinued(),h=1;h<l.length;h++){for(var b=i(l[h-1],1),C=h-2;C>=0;C--)b=b.inverse().add(l[C]);if(b.sub(a).abs().valueOf()<c)return b.mul(this.s)}return this},divisible:function(c,a){return f(c,a),!(!(s.n*this.d)||this.n*s.d%(s.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(c){var a,l="",h=this.n,b=this.d;return this.s<0&&(l+="-"),b===1?l+=h:(c&&(a=Math.floor(h/b))>0&&(l+=a,l+=" ",h%=b),l+=h,l+="/",l+=b),l},toLatex:function(c){var a,l="",h=this.n,b=this.d;return this.s<0&&(l+="-"),b===1?l+=h:(c&&(a=Math.floor(h/b))>0&&(l+=a,h%=b),l+="\\frac{",l+=h,l+="}{",l+=b,l+="}"),l},toContinued:function(){var c,a=this.n,l=this.d,h=[];if(isNaN(a)||isNaN(l))return h;do h.push(Math.floor(a/l)),c=a%l,a=l,l=c;while(a!==1);return h},toString:function(c){var a=this.n,l=this.d;if(isNaN(a)||isNaN(l))return"NaN";c=c||15;var h=m(a,l),b=y(a,l,h),C=this.s<0?"-":"";if(C+=a/l|0,a%=l,a*=10,a&&(C+="."),h){for(var N=b;N--;)C+=a/l|0,a%=l,a*=10;C+="(";for(var N=h;N--;)C+=a/l|0,a%=l,a*=10;C+=")"}else for(var N=c;a&&N--;)C+=a/l|0,a%=l,a*=10;return C}},Object.defineProperty(w,"__esModule",{value:!0}),w.default=w,w.Fraction=w,e.exports=w})()})(le);var cn=le.exports;const $=on(cn);$.prototype.sam=function(){return this.floor()};$.prototype.nextSam=function(){return this.sam().add(1)};$.prototype.wholeCycle=function(){return new M(this.sam(),this.nextSam())};$.prototype.cyclePos=function(){return this.sub(this.sam())};$.prototype.lt=function(e){return this.compare(e)<0};$.prototype.gt=function(e){return this.compare(e)>0};$.prototype.lte=function(e){return this.compare(e)<=0};$.prototype.gte=function(e){return this.compare(e)>=0};$.prototype.eq=function(e){return this.compare(e)==0};$.prototype.max=function(e){return this.gt(e)?this:e};$.prototype.min=function(e){return this.lt(e)?this:e};$.prototype.show=function(){return this.s*this.n+"/"+this.d};$.prototype.or=function(e){return this.eq(0)?e:this};const S=e=>$(e),an=(...e)=>e.reduce((t,n)=>t.gcd(n),S(1));S._original=$;class M{constructor(t,n){this.begin=S(t),this.end=S(n)}get spanCycles(){const t=[];var n=this.begin;const r=this.end,s=r.sam();if(n.equals(r))return[new M(n,r)];for(;r.gt(n);){if(n.sam().equals(s)){t.push(new M(n,this.end));break}const o=n.nextSam();t.push(new M(n,o)),n=o}return t}get duration(){return this.end.sub(this.begin)}cycleArc(){const t=this.begin.cyclePos(),n=t.add(this.duration);return new M(t,n)}withTime(t){return new M(t(this.begin),t(this.end))}withEnd(t){return new M(this.begin,t(this.end))}withCycle(t){const n=this.begin.sam(),r=n.add(t(this.begin.sub(n))),s=n.add(t(this.end.sub(n)));return new M(r,s)}intersection(t){const n=this.begin.max(t.begin),r=this.end.min(t.end);if(!n.gt(r)&&!(n.equals(r)&&(n.equals(this.end)&&this.begin.lt(this.end)||n.equals(t.end)&&t.begin.lt(t.end))))return new M(n,r)}intersection_e(t){const n=this.intersection(t);if(n==null)throw"TimeSpans do not intersect";return n}midpoint(){return this.begin.add(this.duration.div(S(2)))}equals(t){return this.begin.equals(t.begin)&&this.end.equals(t.end)}show(){return this.begin.show()+" → "+this.end.show()}}class E{constructor(t,n,r,s={},o=!1){this.whole=t,this.part=n,this.value=r,this.context=s,this.stateful=o,o&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){return this.whole.end.sub(this.whole.begin).mul(typeof this.value?.clip=="number"?this.value?.clip:1)}get endClipped(){return this.whole.begin.add(this.duration)}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(t){const n=this.whole?t(this.whole):void 0;return new E(n,t(this.part),this.value,this.context)}withValue(t){return new E(this.whole,this.part,t(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}resolveState(t){if(this.stateful&&this.hasOnset()){console.log("stateful");const n=this.value,[r,s]=n(t);return[r,new E(this.whole,this.part,s,this.context,!1)]}return[t,this]}spanEquals(t){return this.whole==null&&t.whole==null||this.whole.equals(t.whole)}equals(t){return this.spanEquals(t)&&this.part.equals(t.part)&&this.value===t.value}show(t=!1){const n=typeof this.value=="object"?t?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var r="";if(this.whole==null)r="~"+this.part.show;else{var s=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(r=this.whole.begin.show()+" ⇜ "),s||(r+="("),r+=this.part.show(),s||(r+=")"),this.whole.end.equals(this.part.end)||(r+=" ⇝ "+this.whole.end.show())}return"[ "+r+" | "+n+" ]"}showWhole(t=!1){return`${this.whole==null?"~":this.whole.show()}: ${typeof this.value=="object"?t?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value}`}combineContext(t){const n=this;return{...n.context,...t.context,locations:(n.context.locations||[]).concat(t.context.locations||[])}}setContext(t){return new E(this.whole,this.part,this.value,t)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class rt{constructor(t,n={}){this.span=t,this.controls=n}setSpan(t){return new rt(t,this.controls)}withSpan(t){return this.setSpan(t(this.span))}setControls(t){return new rt(this.span,t)}}const un=e=>/^[a-gA-G][#bs]*[0-9]$/.test(e),bt=e=>/^[a-gA-G][#bsf]*[0-9]?$/.test(e),fe=e=>{if(typeof e!="string")return[];const[t,n="",r]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return t?[t,n,r?Number(r):void 0]:[]},ln={c:0,d:2,e:4,f:5,g:7,a:9,b:11},fn={"#":1,b:-1,s:1,f:-1},ut=(e,t=3)=>{const[n,r,s=t]=fe(e);if(!n)throw new Error('not a note: "'+e+'"');const o=ln[n.toLowerCase()],i=r?.split("").reduce((u,f)=>u+fn[f],0)||0;return(Number(s)+1)*12+o+i},at=e=>Math.pow(2,(e-69)/12)*440,Bt=e=>12*Math.log(e/440)/Math.LN2+69,hn=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:r}=e;if(typeof n=="number")return Bt(n);if(typeof r=="string")return ut(r);if(typeof r=="number")return r;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t},he=e=>at(typeof e=="number"?e:ut(e)),pn=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],dn=e=>{const t=Math.floor(e/12)-1;return pn[e%12]+t},vt=(e,t)=>(e%t+t)%t,mn=e=>{let{value:t,context:n}=e,r=t;if(typeof r=="object"&&!Array.isArray(r)&&(r=r.note||r.n||r.value,r===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(t)}`);if(typeof r=="number"&&n.type!=="frequency")r=at(e.value);else if(typeof r=="number"&&n.type==="frequency")r=e.value;else if(typeof r!="string"||!bt(r))throw new Error("not a note: "+JSON.stringify(r));return r},wn=e=>{let{value:t,context:n}=e;if(typeof t=="object")return t.freq?t.freq:he(t.note||t.n||t.value);if(typeof t=="number"&&n.type!=="frequency")t=at(e.value);else if(typeof t=="string"&&bt(t))t=at(ut(e.value));else if(typeof t!="number")throw new Error("not a note or frequency: "+t);return t},pe=(e,t)=>e.slice(t).concat(e.slice(0,t)),de=(...e)=>e.reduce((t,n)=>(...r)=>t(n(...r)),t=>t),yn=(...e)=>de(...e.reverse()),me=e=>e.filter(t=>t!=null),nt=e=>[].concat(...e),ct=e=>e,gn=(e,t)=>e,Ot=(e,t)=>Array.from({length:t-e+1},(n,r)=>r+e);function T(e,t,n=e.length){const r=function s(...o){if(o.length>=n)return e.apply(this,o);{const i=function(...u){return s.apply(this,o.concat(u))};return t&&t(i,o),i}};return t&&t(r,[]),r}function Mt(e){const t=Number(e);if(!isNaN(t))return t;if(bt(e))return ut(e);throw new Error(`cannot parse as numeral: "${e}"`)}function Et(e,t){return(...n)=>e(...n.map(t))}function D(e){return Et(e,Mt)}function we(e){const t=Number(e);if(!isNaN(t))return t;const n={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[e];if(typeof n<"u")return n;throw new Error(`cannot parse as fractional: "${e}"`)}const bn=e=>Et(e,we),Pt=function(e,t){return[t.slice(0,e),t.slice(e)]},zt=(e,t,n)=>t.map((r,s)=>e(r,n[s])),ye=(e,t,n)=>Math.min(Math.max(e,t),n),vn=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],_n=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],qn=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],An=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],kn=["I","Ro","Ha","Ni","Ho","He","To"],Cn=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Nn=(e,t="letters")=>{const r=(t==="solfeggio"?vn:t==="indian"?_n:t==="german"?qn:t==="byzantine"?An:t==="japanese"?kn:Cn)[e%12],s=Math.floor(e/12)-1;return r+s};function ge(e){const t=new TextEncoder().encode(e);return btoa(String.fromCharCode(...t))}function be(e){const t=new Uint8Array(atob(e).split("").map(r=>r.charCodeAt(0)));return new TextDecoder().decode(t)}function xn(e){return encodeURIComponent(ge(e))}function Sn(e){return be(decodeURIComponent(e))}function Tn(e,t,n){if(typeof t?.value=="number"){const s=Object.keys(e).filter(i=>typeof e[i]=="number"),o=Object.fromEntries(s.map(i=>[i,t.value]));t=Object.assign(t,o),delete t.value}const r=Object.keys(e).filter(s=>Object.keys(t).includes(s));return Object.assign({},e,t,Object.fromEntries(r.map(s=>[s,n(e[s],t[s])])))}T((e,t)=>e*t);T((e,t)=>t.map(e));function ve(e,t=60){let n=0,r=S(0),s=[""],o="";for(;s[0].length<t;){const i=e.queryArc(n,n+1),u=i.filter(m=>m.hasOnset()).map(m=>m.duration),f=an(...u),d=f.inverse();s=s.map(m=>m+"|"),o+="|";for(let m=0;m<d;m++){const[y,_]=[r,r.add(f)],w=i.filter(a=>a.whole.begin.lte(y)&&a.whole.end.gte(_)),c=w.length-s.length;c>0&&(s=s.concat(Array(c).fill(o))),s=s.map((a,l)=>{const h=w[l];if(h){const C=h.whole.begin.eq(y)?""+h.value:"-";return a+C}return a+"."}),o+=".",r=r.add(f)}n++}return s.join(`
`)}const jt="strudel.log";function R(e,t,n={}){console.log(`%c${e}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(jt,{detail:{message:e,type:t,data:n}}))}R.key=jt;let Nt;const Bn=e=>Nt=e;class g{constructor(t){this.query=t,this._Pattern=!0}withValue(t){return new g(n=>this.query(n).map(r=>r.withValue(t)))}fmap(t){return this.withValue(t)}appWhole(t,n){const r=this,s=function(o){const i=r.query(o),u=n.query(o),f=function(d,m){const y=d.part.intersection(m.part);if(y!=null)return new E(t(d.whole,m.whole),y,d.value(m.value),m.combineContext(d))};return nt(i.map(d=>me(u.map(m=>f(d,m)))))};return new g(s)}appBoth(t){const n=function(r,s){if(!(r==null||s==null))return r.intersection_e(s)};return this.appWhole(n,t)}appLeft(t){const n=this,r=function(s){const o=[];for(const i of n.query(s)){const u=t.query(s.setSpan(i.wholeOrPart()));for(const f of u){const d=i.whole,m=i.part.intersection(f.part);if(m){const y=i.value(f.value),_=f.combineContext(i),w=new E(d,m,y,_);o.push(w)}}}return o};return new g(r)}appRight(t){const n=this,r=function(s){const o=[];for(const i of t.query(s)){const u=n.query(s.setSpan(i.wholeOrPart()));for(const f of u){const d=i.whole,m=f.part.intersection(i.part);if(m){const y=f.value(i.value),_=i.combineContext(f),w=new E(d,m,y,_);o.push(w)}}}return o};return new g(r)}bindWhole(t,n){const r=this,s=function(o){const i=function(f,d){return new E(t(f.whole,d.whole),d.part,d.value,Object.assign({},f.context,d.context,{locations:(f.context.locations||[]).concat(d.context.locations||[])}))},u=function(f){return n(f.value).query(o.setSpan(f.part)).map(d=>i(f,d))};return nt(r.query(o).map(f=>u(f)))};return new g(s)}bind(t){const n=function(r,s){if(!(r==null||s==null))return r.intersection_e(s)};return this.bindWhole(n,t)}join(){return this.bind(ct)}outerBind(t){return this.bindWhole(n=>n,t)}outerJoin(){return this.outerBind(ct)}innerBind(t){return this.bindWhole((n,r)=>r,t)}innerJoin(){return this.innerBind(ct)}trigJoin(t=!1){const n=this;return new g(r=>n.discreteOnly().query(r).map(s=>s.value.late(t?s.whole.begin:s.whole.begin.cyclePos()).query(r).map(o=>new E(o.whole?o.whole.intersection(s.whole):void 0,o.part.intersection(s.part),o.value).setContext(s.combineContext(o))).filter(o=>o.part)).flat())}trigzeroJoin(){return this.trigJoin(!0)}squeezeJoin(){const t=this;function n(r){const s=t.discreteOnly().query(r);function o(u){const d=u.value._focusSpan(u.wholeOrPart()).query(r.setSpan(u.part));function m(y,_){let w;if(_.whole&&y.whole&&(w=_.whole.intersection(y.whole),!w))return;const c=_.part.intersection(y.part);if(!c)return;const a=_.combineContext(y);return new E(w,c,_.value,a)}return d.map(y=>m(u,y))}return nt(s.map(o)).filter(u=>u)}return new g(n)}squeezeBind(t){return this.fmap(t).squeezeJoin()}queryArc(t,n){try{return this.query(new rt(new M(t,n)))}catch(r){return R(`[query]: ${r.message}`,"error"),[]}}splitQueries(){const t=this,n=r=>nt(r.span.spanCycles.map(s=>t.query(r.setSpan(s))));return new g(n)}withQuerySpan(t){return new g(n=>this.query(n.withSpan(t)))}withQuerySpanMaybe(t){const n=this;return new g(r=>{const s=r.withSpan(t);return s.span?n.query(s):[]})}withQueryTime(t){return new g(n=>this.query(n.withSpan(r=>r.withTime(t))))}withHapSpan(t){return new g(n=>this.query(n).map(r=>r.withSpan(t)))}withHapTime(t){return this.withHapSpan(n=>n.withTime(t))}withHaps(t){return new g(n=>t(this.query(n)))}withHap(t){return this.withHaps(n=>n.map(t))}setContext(t){return this.withHap(n=>n.setContext(t))}withContext(t){return this.withHap(n=>n.setContext(t(n.context)))}stripContext(){return this.withHap(t=>t.setContext({}))}withLoc(t,n){const r={start:t,end:n};return this.withContext(s=>{const o=(s.locations||[]).concat([r]);return{...s,locations:o}})}filterHaps(t){return new g(n=>this.query(n).filter(t))}filterValues(t){return new g(n=>this.query(n).filter(r=>t(r.value)))}removeUndefineds(){return this.filterValues(t=>t!=null)}onsetsOnly(){return this.filterHaps(t=>t.hasOnset())}discreteOnly(){return this.filterHaps(t=>t.whole)}defragmentHaps(){return this.discreteOnly().withHaps(n=>{const r=[];for(var s=0;s<n.length;++s){for(var o=!0,i=n[s];o;){const d=JSON.stringify(n[s].value);for(var u=!1,f=s+1;f<n.length;f++){const m=n[f];if(i.whole.equals(m.whole)){if(i.part.begin.eq(m.part.end)){if(d===JSON.stringify(m.value)){i=new E(i.whole,new M(m.part.begin,i.part.end),i.value),n.splice(f,1),u=!0;break}}else if(m.part.begin.eq(i.part.end)&&d==JSON.stringify(m.value)){i=new E(i.whole,new M(i.part.begin,m.part.end),i.value),n.splice(f,1),u=!0;break}}}o=u}r.push(i)}return r})}firstCycle(t=!1){var n=this;return t||(n=n.stripContext()),n.query(new rt(new M(S(0),S(1))))}get firstCycleValues(){return this.firstCycle().map(t=>t.value)}get showFirstCycle(){return this.firstCycle().map(t=>`${t.value}: ${t.whole.begin.toFraction()} - ${t.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(t=>t.sort((n,r)=>n.part.begin.sub(r.part.begin).or(n.part.end.sub(r.part.end)).or(n.whole.begin.sub(r.whole.begin).or(n.whole.end.sub(r.whole.end)))))}asNumber(){return this.fmap(Mt)}_opIn(t,n){return this.fmap(n).appLeft(v(t))}_opOut(t,n){return this.fmap(n).appRight(v(t))}_opMix(t,n){return this.fmap(n).appBoth(v(t))}_opSqueeze(t,n){const r=v(t);return this.fmap(s=>r.fmap(o=>n(s)(o))).squeezeJoin()}_opSqueezeOut(t,n){const r=this;return v(t).fmap(o=>r.fmap(i=>n(i)(o))).squeezeJoin()}_opTrig(t,n){return v(t).fmap(s=>this.fmap(o=>n(o)(s))).trigJoin()}_opTrigzero(t,n){return v(t).fmap(s=>this.fmap(o=>n(o)(s))).trigzeroJoin()}layer(...t){return L(...t.map(n=>n(this)))}superimpose(...t){return this.stack(...t.map(n=>n(this)))}stack(...t){return L(this,...t)}sequence(...t){return K(this,...t)}seq(...t){return K(this,...t)}cat(...t){return $t(this,...t)}fastcat(...t){return tt(this,...t)}slowcat(...t){return Y(this,...t)}onTrigger(t,n=!0){return this.withHap(r=>r.setContext({...r.context,onTrigger:(...s)=>{r.context.onTrigger?.(...s),t(...s)},dominantTrigger:r.context.dominantTrigger||n}))}log(t=(r,s)=>`[hap] ${s.showWhole(!0)}`,n=(r,s)=>({hap:s})){return this.onTrigger((...r)=>{R(t(...r),void 0,n(...r))},!1)}logValues(t=ct){return this.log((n,r)=>t(r.value))}drawLine(){return console.log(ve(this)),this}}function On(e,t){let n=[];return t.forEach(r=>{const s=n.findIndex(([o])=>e(r,o));s===-1?n.push([r]):n[s].push(r)}),n}const Mn=(e,t)=>e.spanEquals(t);g.prototype.collect=function(){return this.withHaps(e=>On(Mn,e).map(t=>new E(t[0].whole,t[0].part,t,{})))};g.prototype.arpWith=function(e){return this.collect().fmap(t=>v(e(t))).innerJoin().withHap(t=>new E(t.whole,t.part,t.value.value,t.combineContext(t.value)))};g.prototype.arp=function(e){return this.arpWith(t=>e.fmap(n=>t[n%t.length]))};function En(e,t,n){function r(s){return s instanceof Object&&!(s instanceof Function)}return r(e)||r(t)?(r(e)||(e={value:e}),r(t)||(t={value:t}),Tn(e,t,n)):n(e,t)}(function(){const e={set:[(n,r)=>r],keep:[n=>n],keepif:[(n,r)=>r?n:void 0],add:[D((n,r)=>n+r)],sub:[D((n,r)=>n-r)],mul:[D((n,r)=>n*r)],div:[D((n,r)=>n/r)],mod:[D(vt)],pow:[D(Math.pow)],band:[D((n,r)=>n&r)],bor:[D((n,r)=>n|r)],bxor:[D((n,r)=>n^r)],blshift:[D((n,r)=>n<<r)],brshift:[D((n,r)=>n>>r)],lt:[(n,r)=>n<r],gt:[(n,r)=>n>r],lte:[(n,r)=>n<=r],gte:[(n,r)=>n>=r],eq:[(n,r)=>n==r],eqt:[(n,r)=>n===r],ne:[(n,r)=>n!=r],net:[(n,r)=>n!==r],and:[(n,r)=>n&&r],or:[(n,r)=>n||r],func:[(n,r)=>r(n)]},t=["In","Out","Mix","Squeeze","SqueezeOut","Trig","Trigzero"];for(const[n,[r,s]]of Object.entries(e)){g.prototype["_"+n]=function(o){return this.fmap(i=>r(i,o))},Object.defineProperty(g.prototype,n,{get:function(){const o=this,i=(...u)=>o[n].in(...u);for(const u of t)i[u.toLowerCase()]=function(...f){var d=o;f=K(f),s&&(d=s(d),f=s(f));var m;return n==="keepif"?(m=d["_op"+u](f,y=>_=>r(y,_)),m=m.removeUndefineds()):m=d["_op"+u](f,y=>_=>En(y,_,r)),m};return i.squeezein=i.squeeze,i}});for(const o of t)g.prototype[o.toLowerCase()]=function(...i){return this.set[o.toLowerCase()](i)}}g.prototype.struct=function(...n){return this.keepif.out(...n)},g.prototype.structAll=function(...n){return this.keep.out(...n)},g.prototype.mask=function(...n){return this.keepif.in(...n)},g.prototype.maskAll=function(...n){return this.keep.in(...n)},g.prototype.reset=function(...n){return this.keepif.trig(...n)},g.prototype.resetAll=function(...n){return this.keep.trig(...n)},g.prototype.restart=function(...n){return this.keepif.trigzero(...n)},g.prototype.restartAll=function(...n){return this.keep.trigzero(...n)}})();const _e=L,qe=L,Ae=Ht;g.prototype.factories={pure:Z,stack:L,slowcat:Y,fastcat:tt,cat:$t,timeCat:_t,sequence:K,seq:ke,polymeter:Ht,pm:Ae,polyrhythm:_e,pr:qe};const z=new g(()=>[]);function Z(e){function t(n){return n.span.spanCycles.map(r=>new E(S(r.begin).wholeCycle(),r,e))}return new g(t)}function Ft(e){return e instanceof g||e?._Pattern}function v(e){return Ft(e)?e:Nt&&typeof e=="string"?Nt(e):Z(e)}function L(...e){e=e.map(n=>Array.isArray(n)?K(...n):v(n));const t=n=>nt(e.map(r=>r.query(n)));return new g(t)}function Y(...e){e=e.map(n=>Array.isArray(n)?K(...n):v(n));const t=function(n){const r=n.span,s=vt(r.begin.sam(),e.length),o=e[s];if(!o)return[];const i=r.begin.floor().sub(r.begin.div(e.length).floor());return o.withHapTime(u=>u.add(i)).query(n.setSpan(r.withTime(u=>u.sub(i))))};return new g(t).splitQueries()}function Lt(...e){e=e.map(v);const t=function(n){const r=Math.floor(n.span.begin)%e.length;return e[r]?.query(n)||[]};return new g(t).splitQueries()}function $t(...e){return Y(...e)}function _t(...e){const t=e.map(s=>s[0]).reduce((s,o)=>s.add(o),S(0));let n=S(0);const r=[];for(const[s,o]of e){const i=n.add(s);r.push(v(o)._compress(n.div(t),i.div(t))),n=i}return L(...r)}function Pn(...e){const t=e.reduce((n,[r])=>n+r,0);return e=e.map(([n,r])=>[n,r.fast(n)]),_t(...e).slow(t)}function tt(...e){return Y(...e)._fast(e.length)}function K(...e){return tt(...e)}function ke(...e){return tt(...e)}function xt(e){return Array.isArray(e)?e.length==0?[z,0]:e.length==1?xt(e[0]):[tt(...e.map(t=>xt(t)[0])),e.length]:[v(e),1]}function Ce(e,...t){const n=t.map(s=>xt(s));if(n.length==0)return z;e==0&&(e=n[0][1]);const r=[];for(const s of n)s[1]!=0&&(e==s[1]?r.push(s[0]):r.push(s[0]._fast(S(e).div(S(s[1])))));return L(...r)}function Ht(...e){return Ce(0,...e)}const zn=T((e,t)=>v(t).mask(e)),jn=T((e,t)=>v(t).struct(e)),Fn=T((e,t)=>v(t).superimpose(...e)),Ln=T((e,t)=>v(t).set(e)),$n=T((e,t)=>v(t).keep(e)),Hn=T((e,t)=>v(t).keepif(e)),In=T((e,t)=>v(t).add(e)),Jn=T((e,t)=>v(t).sub(e)),Wn=T((e,t)=>v(t).mul(e)),Dn=T((e,t)=>v(t).div(e)),Rn=T((e,t)=>v(t).mod(e)),Vn=T((e,t)=>v(t).pow(e)),Gn=T((e,t)=>v(t).band(e)),Qn=T((e,t)=>v(t).bor(e)),Un=T((e,t)=>v(t).bxor(e)),Kn=T((e,t)=>v(t).blshift(e)),Zn=T((e,t)=>v(t).brshift(e)),Xn=T((e,t)=>v(t).lt(e)),Yn=T((e,t)=>v(t).gt(e)),tr=T((e,t)=>v(t).lte(e)),er=T((e,t)=>v(t).gte(e)),nr=T((e,t)=>v(t).eq(e)),rr=T((e,t)=>v(t).eqt(e)),sr=T((e,t)=>v(t).ne(e)),or=T((e,t)=>v(t).net(e)),ir=T((e,t)=>v(t).and(e)),cr=T((e,t)=>v(t).or(e)),ar=T((e,t)=>v(t).func(e));function p(e,t,n=!0){if(Array.isArray(e)){const o={};for(const i of e)o[i]=p(i,t,n);return o}const r=t.length;var s;return n?s=function(...o){o=o.map(v);const i=o[o.length-1];if(r===1)return t(i);const[u,...f]=o.slice(0,-1);let d=(...m)=>(Array(r-1).fill().map((y,_)=>m[_]??void 0),t(...m,i));return d=T(d,null,r-1),f.reduce((m,y)=>m.appLeft(y),u.fmap(d)).innerJoin()}:s=function(...o){return o=o.map(v),t(...o)},g.prototype[e]=function(...o){if(r===2&&o.length!==1)o=[K(...o)];else if(r!==o.length+1)throw new Error(`.${e}() expects ${r-1} inputs but got ${o.length}.`);return o=o.map(v),s(...o,this)},r>1&&(g.prototype["_"+e]=function(...o){return t(...o,this)}),T(s,null,r)}const ur=p("round",function(e){return e.asNumber().fmap(t=>Math.round(t))}),lr=p("floor",function(e){return e.asNumber().fmap(t=>Math.floor(t))}),fr=p("ceil",function(e){return e.asNumber().fmap(t=>Math.ceil(t))}),hr=p("toBipolar",function(e){return e.fmap(t=>t*2-1)}),pr=p("fromBipolar",function(e){return e.fmap(t=>(t+1)/2)}),dr=p("range",function(e,t,n){return n.mul(t-e).add(e)}),mr=p("rangex",function(e,t,n){return n._range(Math.log(e),Math.log(t)).fmap(Math.exp)}),wr=p("range2",function(e,t,n){return n.fromBipolar()._range(e,t)}),yr=p("ratio",e=>e.fmap(t=>Array.isArray(t)?t.slice(1).reduce((n,r)=>n/r,t[0]):t)),gr=p("compress",function(e,t,n){return e=S(e),t=S(t),e.gt(t)||e.gt(1)||t.gt(1)||e.lt(0)||t.lt(0)?z:n._fastGap(S(1).div(t.sub(e)))._late(e)}),{compressSpan:br,compressspan:vr}=p(["compressSpan","compressspan"],function(e,t){return t._compress(e.begin,e.end)}),{fastGap:_r,fastgap:qr}=p(["fastGap","fastgap"],function(e,t){const n=function(s){const o=s.begin.sam(),i=s.begin.sub(o).mul(e).min(1),u=s.end.sub(o).mul(e).min(1);if(!(i>=1))return new M(o.add(i),o.add(u))},r=function(s){const o=s.part.begin,i=s.part.end,u=o.sam(),f=o.sub(u).div(e).min(1),d=i.sub(u).div(e).min(1),m=new M(u.add(f),u.add(d)),y=s.whole?new M(m.begin.sub(o.sub(s.whole.begin).div(e)),m.end.add(s.whole.end.sub(i).div(e))):void 0;return new E(y,m,s.value,s.context)};return t.withQuerySpanMaybe(n).withHap(r).splitQueries()}),Ar=p("focus",function(e,t,n){return e=S(e),t=S(t),n._fast(S(1).div(t.sub(e))).late(e.cyclePos())}),{focusSpan:kr,focusspan:Cr}=p(["focusSpan","focusspan"],function(e,t){return t._focus(e.begin,e.end)}),Nr=p("ply",function(e,t){return t.fmap(n=>Z(n)._fast(e)).squeezeJoin()}),{fast:xr,density:Sr}=p(["fast","density"],function(e,t){return e===0?z:(e=S(e),t.withQueryTime(r=>r.mul(e)).withHapTime(r=>r.div(e)))}),Tr=p("hurry",function(e,t){return t._fast(e).mul(Z({speed:e}))}),{slow:Br,sparsity:Or}=p(["slow","sparsity"],function(e,t){return e===0?z:t._fast(S(1).div(e))}),Mr=p("inside",function(e,t,n){return t(n._slow(e))._fast(e)}),Er=p("outside",function(e,t,n){return t(n._fast(e))._slow(e)}),Pr=p("lastOf",function(e,t,n){const r=Array(e-1).fill(n);return r.push(t(n)),Lt(...r)}),{firstOf:zr,every:jr}=p(["firstOf","every"],function(e,t,n){const r=Array(e-1).fill(n);return r.unshift(t(n)),Lt(...r)}),Fr=p("apply",function(e,t){return e(t)}),Lr=p("cpm",function(e,t){return t._fast(e/60)}),$r=p("early",function(e,t){return e=S(e),t.withQueryTime(n=>n.add(e)).withHapTime(n=>n.sub(e))}),Hr=p("late",function(e,t){return e=S(e),t._early(S(0).sub(e))}),Ir=p("zoom",function(e,t,n){t=S(t),e=S(e);const r=t.sub(e);return n.withQuerySpan(s=>s.withCycle(o=>o.mul(r).add(e))).withHapSpan(s=>s.withCycle(o=>o.sub(e).div(r))).splitQueries()}),{zoomArc:Jr,zoomarc:Wr}=p(["zoomArc","zoomarc"],function(e,t){return t.zoom(e.begin,e.end)}),Dr=p("linger",function(e,t){return e==0?z:e<0?t._zoom(e.add(1),1)._slow(e):t._zoom(0,e)._slow(e)}),Rr=p("segment",function(e,t){return t.struct(Z(!0)._fast(e))}),{invert:Vr,inv:Gr}=p(["invert","inv"],function(e){return e.fmap(t=>!t)}),Qr=p("when",function(e,t,n){return e?t(n):n}),Ur=p("off",function(e,t,n){return L(n,t(n.late(e)))}),Kr=p("brak",function(e){return e.when(Y(!1,!0),t=>tt(t,z)._late(.25))}),Ne=p("rev",function(e){const t=function(n){const r=n.span,s=r.begin.sam(),o=r.begin.nextSam(),i=function(f){const d=f.withTime(y=>s.add(o.sub(y))),m=d.begin;return d.begin=d.end,d.end=m,d};return e.query(n.setSpan(i(r))).map(f=>f.withSpan(i))};return new g(t).splitQueries()}),Zr=p("pressBy",function(e,t){return t.fmap(n=>Z(n).compress(e,1)).squeezeJoin()}),Xr=p("press",function(e){return e._pressBy(.5)});g.prototype.hush=function(){return z};const Yr=p("palindrome",function(e){return e.lastOf(2,Ne)}),{juxBy:ts,juxby:es}=p(["juxBy","juxby"],function(e,t,n){e/=2;const r=function(i,u,f){return u in i?i[u]:f},s=n.withValue(i=>Object.assign({},i,{pan:r(i,"pan",.5)-e})),o=n.withValue(i=>Object.assign({},i,{pan:r(i,"pan",.5)+e}));return L(s,t(o))}),ns=p("jux",function(e,t){return t._juxBy(1,e,t)}),{echoWith:rs,echowith:ss,stutWith:os,stutwith:is}=p(["echoWith","echowith","stutWith","stutwith"],function(e,t,n,r){return L(...Ot(0,e-1).map(s=>n(r.late(S(t).mul(s)),s)))}),cs=p("echo",function(e,t,n,r){return r._echoWith(e,t,(s,o)=>s.velocity(Math.pow(n,o)))}),as=p("stut",function(e,t,n,r){return r._echoWith(e,n,(s,o)=>s.velocity(Math.pow(t,o)))}),It=function(e,t,n=!1){return e=S(e),Y(...Ot(0,e.sub(1)).map(r=>n?t.late(S(r).div(e)):t.early(S(r).div(e))))},us=p("iter",function(e,t){return It(e,t,!1)}),{iterBack:ls,iterback:fs}=p(["iterBack","iterback"],function(e,t){return It(e,t,!0)}),hs=function(e,t){return Y(...Array(e).fill(t))};p("repeatCycles",hs);const Jt=function(e,t,n,r=!1,s=!1){const o=Array(e-1).fill(!1);o.unshift(!0);const i=It(e,K(...o),!r);return s||(n=n.repeatCycles(e)),n.when(i,t)};p(["chunk","slowchunk","slowChunk"],function(e,t,n){return Jt(e,t,n,!1,!1)});const{chunkBack:ps,chunkback:ds}=p(["chunkBack","chunkback"],function(e,t,n){return Jt(e,t,n,!0)});p(["fastchunk","fastChunk"],function(e,t,n){return Jt(e,t,n,!1,!0)});const ms=p("bypass",function(e,t){return e=!!parseInt(e),e?z:t}),ws=p("ribbon",(e,t,n)=>n.early(e).restart(Z(1).slow(t))),ys=p("duration",function(e,t){return t.withHapSpan(n=>new M(n.begin,n.begin.add(e)))}),gs=p("hsla",(e,t,n,r,s)=>s.color(`hsla(${e}turn,${t*100}%,${n*100}%,${r})`)),bs=p("hsl",(e,t,n,r)=>r.color(`hsl(${e}turn,${t*100}%,${n*100}%)`)),{color:vs,colour:_s}=p(["color","colour"],function(e,t){return t.withContext(n=>({...n,color:e}))}),qs=p("velocity",function(e,t){return t.withContext(n=>({...n,velocity:(n.velocity||1)*e}))}),As=p("legato",function(e,t){return e=S(e),t.withHapSpan(n=>new M(n.begin,n.begin.add(n.end.sub(n.begin).mul(e))))}),ks=p("chop",function(e,t){const r=Array.from({length:e},(o,i)=>i).map(o=>({begin:o/e,end:(o+1)/e})),s=function(o){return K(r.map(i=>Object.assign({},o,i)))};return t.squeezeBind(s)}),Cs=p("striate",function(e,t){const r=Array.from({length:e},(o,i)=>i).map(o=>({begin:o/e,end:(o+1)/e})),s=Y(...r);return t.set(s)._fast(e)}),xe=function(e,t,n=1){return t.speed(1/e*n).unit("c").slow(e)},Se=p("slice",function(e,t,n){return e.innerBind(r=>t.outerBind(s=>n.outerBind(o=>{o=o instanceof Object?o:{s:o};const i=Array.isArray(r)?r[s]:s/r,u=Array.isArray(r)?r[s+1]:(s+1)/r;return Z({begin:i,end:u,_slices:r,...o})})))},!1),Ns=p("splice",function(e,t,n){return Se(e,t,n).withHap(function(s){return s.withValue(o=>({speed:1/o._slices/s.whole.duration*(o.speed||1),unit:"c",...o}))})},!1),{loopAt:xs,loopat:Ss}=p(["loopAt","loopat"],function(e,t){return xe(e,t,1)}),Ts=p("fit",e=>e.withHap(t=>t.withValue(n=>({...n,speed:1/t.whole.duration,unit:"c"})))),{loopAtCps:Bs,loopatcps:Os}=p(["loopAtCps","loopatcps"],function(e,t,n){return xe(e,n,t)}),Ms=e=>Z(1).withValue(()=>v(e())).innerJoin();let se=e=>e<.5?1:1-(e-.5)/.5,Te=(e,t,n)=>{t=v(t),e=v(e),n=v(n);let r=t.fmap(o=>({gain:se(o)})),s=t.fmap(o=>({gain:se(1-o)}));return L(e.mul(r),n.mul(s))};g.prototype.xfade=function(e,t){return Te(this,e,t)};const U={},Es=[[["s","n","gain"],"sound"],["source","src"],["n"],[["note","n"]],["accelerate"],["gain"],["postgain"],["amp"],["attack","att"],[["fmh","fmi"],"fmh"],[["fmi","fmh"],"fm"],["fmenv"],["fmattack"],["fmdecay"],["fmsustain"],["fmrelease"],["fmvelocity"],["bank"],["analyze"],["fft"],["decay"],["sustain","sus"],["release","rel"],["hold"],[["bandf","bandq"],"bpf","bp"],["bandq","bpq"],["begin"],["end"],["loop"],["loopBegin","loopb"],["loopEnd","loope"],["crush"],["coarse"],["channels","ch"],["phaserrate","phasr"],[["phaser","phaserdepth","phasercenter","phasersweep"],"ph"],["phasersweep","phs"],["phasercenter","phc"],["phaserdepth","phd","phasdp"],["channel"],["cut"],[["cutoff","resonance"],"ctf","lpf","lp"],["lpenv","lpe"],["hpenv","hpe"],["bpenv","bpe"],["lpattack","lpa"],["hpattack","hpa"],["bpattack","bpa"],["lpdecay","lpd"],["hpdecay","hpd"],["bpdecay","bpd"],["lpsustain","lps"],["hpsustain","hps"],["bpsustain","bps"],["lprelease","lpr"],["hprelease","hpr"],["bprelease","bpr"],["ftype"],["fanchor"],[["vib","vibmod"],"vibrato","v"],["noise"],[["vibmod","vib"],"vmod"],[["hcutoff","hresonance"],"hpf","hp"],["hresonance","hpq"],["resonance","lpq"],["djf"],[["delay","delaytime","delayfeedback"]],["delayfeedback","delayfb","dfb"],["delaytime","delayt","dt"],["lock"],["detune","det"],["dry"],["fadeTime","fadeOutTime"],["fadeInTime"],["freq"],["gate","gat"],["leslie"],["lrate"],["lsize"],["activeLabel"],[["label","activeLabel"]],["degree"],["mtranspose"],["ctranspose"],["harmonic"],["stepsPerOctave"],["octaveR"],["nudge"],["octave"],["orbit"],["overgain"],["overshape"],["pan"],["panspan"],["pansplay"],["panwidth"],["panorient"],["rate"],["slide"],["semitone"],["voice"],["chord"],["dictionary","dict"],["anchor"],["offset"],["octaves"],[["mode","anchor"]],[["room","size"]],["roomlp","rlp"],["roomdim","rdim"],["roomfade","rfade"],[["ir","i"],"iresponse"],["roomsize","size","sz","rsize"],["shape"],[["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]],["compressorKnee"],["compressorRatio"],["compressorAttack"],["compressorRelease"],["speed"],["unit"],["squiz"],["vowel"],["waveloss"],["density"],["dur"],["expression"],["sustainpedal"],["tremolodepth","tremdp"],["tremolorate","tremr"],["fshift"],["fshiftnote"],["fshiftphase"],["triode"],["krush"],["kcutoff"],["octer"],["octersub"],["octersubsub"],["ring"],["ringf"],["ringdf"],["distort"],["freeze"],["xsdelay"],["tsdelay"],["real"],["imag"],["enhance"],["partials"],["comb"],["smear"],["scram"],["binshift"],["hbrick"],["lbrick"],["midichan"],["control"],["ccn"],["ccv"],["polyTouch"],["midibend"],["miditouch"],["ctlNum"],["frameRate"],["frames"],["hours"],["midicmd"],["minutes"],["progNum"],["seconds"],["songPtr"],["uid"],["val"],["cps"],["clip"],["zrand"],["curve"],["slide"],["deltaSlide"],["pitchJump"],["pitchJumpTime"],["lfo","repeatTime"],["znoise"],["zmod"],["zcrush"],["zdelay"],["tremolo"],["zzfx"]];U.createParam=function(e){const t=Array.isArray(e)?e[0]:e;var n;Array.isArray(e)?n=o=>{if(Array.isArray(o)){const i={};return o.forEach((u,f)=>{f<e.length&&(i[e[f]]=u)}),i}else return{[t]:o}}:n=o=>({[t]:o});const r=(...o)=>K(...o).withValue(n),s=function(...o){return o.length?this.set(r(...o)):this.fmap(n)};return g.prototype[t]=s,r};Es.forEach(([e,...t])=>{const n=Array.isArray(e)?e[0]:e;U[n]=U.createParam(e),t.forEach(r=>{U[r]=U[n],g.prototype[r]=g.prototype[n]})});U.createParams=(...e)=>e.reduce((t,n)=>Object.assign(t,{[n]:U.createParam(n)}),{});U.adsr=p("adsr",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,r,s,o]=e;return t.set({attack:n,decay:r,sustain:s,release:o})});U.ds=p("ds",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,r]=e;return t.set({decay:n,sustain:r})});const Ps=function(e,t){const[n,r]=e,[s,o]=t,[i,u]=Pt(r,s);return[[r,n-r],[zt((f,d)=>f.concat(d),i,o),u]]},zs=function(e,t){const[n,r]=e,[s,o]=t,[i,u]=Pt(n,o);return[[n,r-n],[zt((d,m)=>d.concat(m),s,i),u]]},Be=function(e,t){const[n,r]=e;return Math.min(n,r)<=1?[e,t]:Be(...n>r?Ps(e,t):zs(e,t))},Oe=function(e,t){const n=t-e,r=Array(e).fill([1]),s=Array(n).fill([0]),o=Be([e,n],[r,s]);return nt(o[1][0]).concat(nt(o[1][1]))},Wt=function(e,t,n){const r=Oe(e,t);return n?pe(r,-n):r},js=p("euclid",function(e,t,n){return n.struct(Wt(e,t,0))}),{euclidrot:Fs,euclidRot:Ls}=p(["euclidrot","euclidRot"],function(e,t,n,r){return r.struct(Wt(e,t,n))}),Me=function(e,t,n,r){if(e<1)return z;const o=Wt(e,t,n).join("").split("1").slice(1).map(i=>[i.length+1,!0]);return r.struct(_t(...o))},$s=p(["euclidLegato"],function(e,t,n){return Me(e,t,0,n)}),Hs=p(["euclidLegatoRot"],function(e,t,n,r){return Me(e,t,n,r)});function Is(e){return new g(t=>[new E(void 0,t.span,e)])}const st=e=>{const t=n=>[new E(void 0,n.span,e(n.span.midpoint()))];return new g(t)},Dt=st(e=>1-e%1),Ee=Dt.toBipolar(),qt=st(e=>e%1),Pe=qt.toBipolar(),Rt=st(e=>Math.sin(Math.PI*2*e)),ze=Rt.fromBipolar(),Js=ze._early(S(1).div(4)),Ws=Rt._early(S(1).div(4)),je=st(e=>Math.floor(e*2%2)),Ds=je.toBipolar(),Rs=tt(Dt,qt),Vs=tt(Ee,Pe),Fe=st(ct),Gs=e=>{const t=e<<13^e,n=t>>17^t;return n<<5^n},Qs=e=>e-Math.trunc(e),Us=e=>Gs(Math.trunc(Qs(e/300)*536870912)),Ks=e=>e%536870912/536870912,St=e=>Math.abs(Ks(Us(e))),Zs=e=>qt.range(0,e).floor().segment(e),V=st(St),Xs=V.toBipolar(),Vt=e=>V.fmap(t=>t<e),Ys=e=>v(e).fmap(Vt).innerJoin(),to=Vt(.5),Le=e=>V.fmap(t=>Math.trunc(t*e)),eo=e=>v(e).fmap(Le).innerJoin(),no=(e,t)=>(t=t.map(v),t.length==0?z:e.fmap(n=>{const r=ye(Math.round(n),0,t.length-1);return t[r]}).innerJoin()),ro=(e,t)=>(t=t.map(v),t.length==0?z:e.fmap(n=>{const r=vt(Math.round(n),t.length);return t[r]}).squeezeJoin()),Gt=(e,t)=>(t=t.map(v),t.length==0?z:e.range(0,t.length).fmap(n=>{const r=Math.min(Math.max(Math.floor(n),0),t.length-1);return t[r]})),At=(e,t)=>Gt(e,t).outerJoin(),$e=(e,t)=>Gt(e,t).innerJoin(),so=(...e)=>At(V,e);g.prototype.choose=function(...e){return At(this,e)};g.prototype.choose2=function(...e){return At(this.fromBipolar(),e)};const He=(...e)=>$e(V.segment(1),e),oo=He,Ie=function(e,...t){const n=t.map(u=>v(u[0])),r=[];let s=0;for(const u of t)s+=u[1],r.push(s);const o=s,i=function(u){const f=u*o;return n[r.findIndex(d=>d>f,r)]};return e.fmap(i)},io=(...e)=>Ie(...e).outerJoin(),co=(...e)=>io(V,...e),ao=(...e)=>Ie(V,...e).innerJoin(),Je=e=>{const t=e.fmap(Math.floor),n=e.fmap(o=>Math.floor(o)+1),r=o=>6*o**5-15*o**4+10*o**3,s=o=>i=>u=>i+r(o)*(u-i);return e.sub(t).fmap(s).appBoth(t.fmap(St)).appBoth(n.fmap(St))},uo=Je(Fe.fmap(e=>Number(e))),lo=p("degradeByWith",(e,t,n)=>n.fmap(r=>s=>r).appLeft(e.filterValues(r=>r>t))),fo=p("degradeBy",function(e,t){return t._degradeByWith(V,e)}),ho=p("degrade",e=>e._degradeBy(.5)),po=p("undegradeBy",function(e,t){return t._degradeByWith(V.fmap(n=>1-n),e)}),mo=p("undegrade",e=>e._undegradeBy(.5)),wo=p("sometimesBy",function(e,t,n){return v(e).fmap(r=>L(n._degradeBy(r),t(n._undegradeBy(1-r)))).innerJoin()}),yo=p("sometimes",function(e,t){return t._sometimesBy(.5,e)}),go=p("someCyclesBy",function(e,t,n){return v(e).fmap(r=>L(n._degradeByWith(V._segment(1),r),t(n._degradeByWith(V.fmap(s=>1-s)._segment(1),1-r)))).innerJoin()}),bo=p("someCycles",function(e,t){return t._someCyclesBy(.5,e)}),vo=p("often",function(e,t){return t.sometimesBy(.75,e)}),_o=p("rarely",function(e,t){return t.sometimesBy(.25,e)}),qo=p("almostNever",function(e,t){return t.sometimesBy(.1,e)}),Ao=p("almostAlways",function(e,t){return t.sometimesBy(.9,e)}),ko=p("never",function(e,t){return t}),Co=p("always",function(e,t){return e(t)});let gt;try{gt=window?.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let oe=gt?.getVoices();function No(e,t,n){gt.cancel();const r=new SpeechSynthesisUtterance(e);r.lang=t,oe=gt.getVoices();const s=oe.filter(o=>o.lang.includes(t));typeof n=="number"?r.voice=s[n%s.length]:typeof n=="string"&&(r.voice=s.find(o=>o.name===o)),speechSynthesis.speak(r)}const xo=p("speak",function(e,t,n){return n.onTrigger((r,s)=>{No(s.value,e,t)})}),We=async(...e)=>{const t=await Promise.allSettled(e),n=t.filter(r=>r.status==="fulfilled").map(r=>r.value);t.forEach((r,s)=>{r.status==="rejected"&&console.warn(`evalScope: module with index ${s} could not be loaded:`,r.reason)}),n.forEach(r=>{Object.entries(r).forEach(([s,o])=>{globalThis[s]=o})})};function So(e,t={}){const{wrapExpression:n=!0,wrapAsync:r=!0}=t;n&&(e=`{${e}}`),r&&(e=`(async ()=>${e})()`);const s=`"use strict";return (${e})`;return Function(s)()}const De=async(e,t)=>{let n={};if(t){const o=t(e);e=o.output,n=o}return{mode:"javascript",pattern:await So(e,{wrapExpression:!!t}),meta:n}};function To(e,t,n=.05,r=.1,s=.1){let o=0,i=0,u=10**4,f=.01;const d=h=>n=h(n);s=s||r/2;const m=()=>{const h=e(),b=h+r+s;for(i===0&&(i=h+f);i<b;)i=Math.round(i*u)/u,i>=h&&t(i,n,o),i<h&&console.log("TOO LATE",i),i+=n,o++};let y;const _=()=>{w(),m(),y=setInterval(m,r*1e3)},w=()=>y!==void 0&&clearInterval(y);return{setDuration:d,start:_,stop:()=>{o=0,i=0,w()},pause:()=>w(),duration:n,interval:r,getPhase:()=>i,minLatency:f}}class Re{constructor({interval:t,onTrigger:n,onToggle:r,onError:s,getTime:o,latency:i=.1}){this.started=!1,this.cps=1,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=o,this.num_cycles_since_last_cps_change=0,this.onToggle=r,this.latency=i,this.clock=To(o,(f,d,m)=>{m===0&&(this.origin=f),this.num_ticks_since_cps_change===0&&(this.num_cycles_since_last_cps_change=this.lastEnd),this.num_ticks_since_cps_change++;try{const y=o(),_=this.lastEnd;this.lastBegin=_;const w=d*this.cps,c=this.num_cycles_since_last_cps_change+this.num_ticks_since_cps_change*w;this.lastEnd=c;const a=this.pattern.queryArc(_,c),l=f-y;this.lastTick=y+l,a.forEach(h=>{if(h.part.begin.equals(h.whole.begin)){const b=(h.whole.begin-_)/this.cps+l+i,C=h.duration/this.cps;n?.(h,b,C,this.cps)}})}catch(y){R(`[cyclist] error: ${y.message}`),s?.(y)}},t);let u=this;globalThis.__cyclist__=u}now(){const t=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+t*this.cps}setStarted(t){this.started=t,this.onToggle?.(t)}start(){if(this.num_ticks_since_cps_change=0,this.num_cycles_since_last_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");R("[cyclist] start"),this.clock.start(),this.setStarted(!0),globalThis.haps_from_outputs=null}pause(){R("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){R("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}setPattern(t,n=!1){this.pattern=t,n&&!this.started&&this.start()}setCps(t=1){this.cps!==t&&(this.cps=t,this.num_ticks_since_cps_change=0)}log(t,n,r){const s=r.filter(o=>o.hasOnset());console.log(`${t.toFixed(4)} - ${n.toFixed(4)} ${Array(s.length).fill("I").join("")}`)}}let Tt;function Qt(){if(!Tt)throw new Error("no time set! use setTime to define a time source");return Tt()}function Ve(e){Tt=e}function Bo({interval:e,defaultOutput:t,onSchedulerError:n,onEvalError:r,beforeEval:s,afterEval:o,getTime:i,transpiler:u,onToggle:f,editPattern:d,onUpdateState:m}){const y={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},_=A=>{Object.assign(y,A),y.isDirty=y.code!==y.activeCode,y.error=y.evalError||y.schedulerError,m?.(y)},w=new Re({interval:e,onTrigger:Ge({defaultOutput:t,getTime:i}),onError:n,getTime:i,onToggle:A=>{_({started:A}),f?.(A)}});let c={},a;const l=function(){return c={},a=void 0,z},h=(A,H=!0)=>{A=d?.(A)||A,w.setPattern(A,H)};Ve(()=>w.now());const b=async(A,H=!0,X=!0)=>{if(!A)throw new Error("no code to evaluate");try{_({code:A,pending:!0}),await s?.({code:A}),X&&l();let{pattern:O,meta:et}=await De(A,u);if(Object.keys(c).length&&(O=L(...Object.values(c))),a&&(O=a(O)),!Ft(O)){const ot=`got "${typeof evaluated}" instead of pattern`;throw new Error(ot+(typeof evaluated=="function"?", did you forget to call a function?":"."))}return R("[eval] code updated"),h(O,H),_({miniLocations:et?.miniLocations||[],widgets:et?.widgets||[],activeCode:A,pattern:O,evalError:void 0,schedulerError:void 0,pending:!1}),o?.({code:A,pattern:O,meta:et}),O}catch(O){R(`[eval] error: ${O.message}`,"error"),_({evalError:O,pending:!1}),r?.(O)}},C=()=>w.stop(),N=()=>w.start(),G=()=>w.pause(),I=()=>w.toggle(),j=A=>w.setCps(A),q=A=>w.setCps(A/60),k=p("loopAt",(A,H)=>H.loopAtCps(A,w.cps));g.prototype.p=function(A){return c[A]=this,this},g.prototype.q=function(A){return z};const x=function(A){return a=A,z};try{for(let A=1;A<10;++A)Object.defineProperty(g.prototype,`d${A}`,{get(){return this.p(A)}}),Object.defineProperty(g.prototype,`p${A}`,{get(){return this.p(A)}}),g.prototype[`q${A}`]=z}catch{}const B=p("fit",A=>A.withHap(H=>H.withValue(X=>({...X,speed:w.cps/H.whole.duration,unit:"c"}))));return We({loopAt:k,fit:B,all:x,hush:l,setCps:j,setcps:j,setCpm:q,setcpm:q}),{scheduler:w,evaluate:b,start:N,stop:C,pause:G,setCps:j,setPattern:h,setCode:A=>_({code:A}),toggle:I,state:y}}const Ge=({getTime:e,defaultOutput:t})=>async(n,r,s,o)=>{try{(!n.context.onTrigger||!n.context.dominantTrigger)&&await t(n,r,s,o),n.context.onTrigger&&await n.context.onTrigger(e()+r,n,e(),o)}catch(i){R(`[cyclist] error: ${i.message}`,"error")}},kt=(e="test-canvas")=>{let t=document.querySelector("#"+e);if(!t){t=document.createElement("canvas"),t.id=e,t.width=window.innerWidth*2,t.height=window.innerHeight*2,t.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",document.body.prepend(t);let r;window.addEventListener("resize",()=>{r&&clearTimeout(r),r=setTimeout(()=>{t.width=window.innerWidth*2,t.height=window.innerHeight*2},200)})}return t.getContext("2d")};g.prototype.draw=function(e,{from:t,to:n,onQuery:r}={}){if(typeof window>"u")return this;window.strudelAnimation&&cancelAnimationFrame(window.strudelAnimation);const s=kt();let o,i=[];const u=f=>{const d=Qt();if(t!==void 0&&n!==void 0){const m=Math.floor(d);if(o!==m){o=m;const y=m+t,_=m+n;setTimeout(()=>{i=this.query(new rt(new M(y,_))).filter(Boolean).filter(w=>w.part.begin.equals(w.whole.begin)),r?.(i)},0)}}e(s,i,d,f),window.strudelAnimation=requestAnimationFrame(u)};return requestAnimationFrame(u),this};const Oo=(e=!0)=>{const t=kt();e&&t.clearRect(0,0,t.canvas.width,t.canvas.width),window.strudelAnimation&&cancelAnimationFrame(window.strudelAnimation),window.strudelScheduler&&clearInterval(window.strudelScheduler)};g.prototype.onPaint=function(e){return this.context={onPaint:e},this};class Qe{constructor(t,n){this.onFrame=t,this.onError=n}start(){const t=this;let n=requestAnimationFrame(function r(s){try{t.onFrame(s)}catch(o){t.onError(o)}n=requestAnimationFrame(r)});t.cancel=()=>{cancelAnimationFrame(n)}}stop(){this.cancel&&this.cancel()}}class Mo{constructor(t,n){this.visibleHaps=[],this.lastFrame=null,this.drawTime=n,this.framer=new Qe(()=>{if(!this.scheduler){console.warn("Drawer: no scheduler");return}const r=Math.abs(this.drawTime[0]),s=this.drawTime[1],o=this.scheduler.now()+s;if(this.lastFrame===null){this.lastFrame=o;return}const i=this.scheduler.pattern.queryArc(Math.max(this.lastFrame,o-1/10),o);this.lastFrame=o,this.visibleHaps=(this.visibleHaps||[]).filter(f=>f.whole.end>=o-r-s).concat(i.filter(f=>f.hasOnset()));const u=o-s;t(this.visibleHaps,u,this)},r=>{console.warn("draw error",r)})}setDrawTime(t){this.drawTime=t}invalidate(t=this.scheduler,n){if(!t)return;n=n??t.now(),this.scheduler=t;let[r,s]=this.drawTime;const[o,i]=[Math.max(n,0),n+s+.1];this.visibleHaps=this.visibleHaps.filter(f=>f.whole.begin<n);const u=t.pattern.queryArc(o,i);this.visibleHaps=this.visibleHaps.concat(u)}start(t){this.scheduler=t,this.invalidate(),this.framer.start()}stop(){this.framer&&this.framer.stop()}}const{createParams:Eo}=U;let ie="#22222210";g.prototype.animate=function({callback:e,sync:t=!1,smear:n=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const r=kt(),{clientWidth:s,clientHeight:o}=r.canvas;let i=n===0?"99":Number((1-n)*100).toFixed(0);i=i.length===1?`0${i}`:i,ie=`#200010${i}`;const u=f=>{let d;f=Math.round(f),d=this.slow(1e3).queryArc(f,f),r.fillStyle=ie,r.fillRect(0,0,s,o),d.forEach(m=>{let{x:y,y:_,w,h:c,s:a,r:l,angle:h=0,fill:b="darkseagreen"}=m.value;if(w*=s,c*=o,l!==void 0&&h!==void 0){const N=h*2*Math.PI,[G,I]=[(s-w)/2,(o-c)/2];y=G+Math.cos(N)*l*G,_=I+Math.sin(N)*l*I}else y*=s-w,_*=o-c;const C={...m.value,x:y,y:_,w,h:c};r.fillStyle=b,a==="rect"?r.fillRect(y,_,w,c):a==="ellipse"&&(r.beginPath(),r.ellipse(y+w/2,_+c/2,w/2,c/2,0,0,2*Math.PI),r.fill()),e&&e(r,C,m)}),window.frame=requestAnimationFrame(u)};return window.frame=requestAnimationFrame(u),z};const{x:Ut,y:Po,w:zo,h:jo,angle:Fo,r:Lo,fill:$o,smear:Ho}=Eo("x","y","w","h","angle","r","fill","smear"),Io=p("rescale",function(e,t){return t.mul(Ut(e).w(e).y(e).h(e))}),Jo=p("moveXY",function(e,t,n){return n.add(Ut(e).y(t))}),Wo=p("zoomIn",function(e,t){const n=Z(1).sub(e).div(2);return t.rescale(e).move(n,n)}),dt=(e,t,n)=>e*(n-t)+t,ce=e=>{let{value:t}=e;typeof e.value!="object"&&(t={value:t});let{note:n,n:r,freq:s,s:o}=t;return s?Bt(s):(n=n??r,typeof n=="string"?ut(n):typeof n=="number"?n:o?"_"+o:t)};g.prototype.pianoroll=function(e={}){let{cycles:t=4,playhead:n=.5,overscan:r=1,hideNegative:s=!1}=e,o=-t*n,i=t*(1-n);return this.draw((u,f,d)=>{const m=y=>(!s||y.whole.begin>=0)&&y.whole.begin<=d+i&&y.endClipped>=d+o;globalThis.haps_from_outputs||(globalThis.haps_from_outputs=[]),globalThis.haps_from_outputs.length>0&&(f.push(...globalThis.haps_from_outputs),f=globalThis.haps_from_outputs.filter(m),globalThis.haps_from_outputs=f),Ct({...e,time:d,ctx:u,haps:f.filter(m)})},{from:o-r,to:i+r}),this};function Ct({time:e,haps:t,cycles:n=4,playhead:r=.5,flipTime:s=0,flipValues:o=0,hideNegative:i=!1,inactive:u="#7491D2",active:f="#FFCA28",background:d="transparent",smear:m=0,playheadColor:y="white",minMidi:_=10,maxMidi:w=90,autorange:c=0,timeframe:a,fold:l=0,vertical:h=0,labels:b=!1,fill:C=1,fillActive:N=!1,strokeActive:G=!0,stroke:I,hideInactive:j=0,colorizeInactive:q=1,fontFamily:k,ctx:x}={}){const B=x.canvas.width,W=x.canvas.height;let A=-n*r,H=n*(1-r);a&&(console.warn("timeframe is deprecated! use from/to instead"),A=0,H=a);const X=h?W:B,O=h?B:W;let et=h?[X,0]:[0,X];const ot=H-A,Zt=h?[0,O]:[O,0];let mt=w-_+1,it=O/mt,wt=[];s&&et.reverse(),o&&Zt.reverse();const{min:Ke,max:Ze,values:Xe}=t.reduce(({min:P,max:Q,values:lt},ft)=>{const J=ce(ft);return{min:J<P?J:P,max:J>Q?J:Q,values:lt.includes(J)?lt:[...lt,J]}},{min:1/0,max:-1/0,values:[]});c&&(_=Ke,w=Ze,mt=w-_+1),wt=Xe.sort((P,Q)=>String(P).localeCompare(String(Q))),it=l?O/wt.length:O/mt,x.fillStyle=d,x.globalAlpha=1,m||(x.clearRect(0,0,B,W),x.fillRect(0,0,B,W)),t.forEach(P=>{const Q=P.whole.begin<=e&&P.endClipped>e;let lt=I??(G&&Q),ft=!Q&&C||Q&&N;if(j&&!Q)return;let J=P.value?.color||P.context?.color;f=J||f,u=q&&J||u,J=Q?f:u,x.fillStyle=ft?J:"transparent",x.strokeStyle=J,x.globalAlpha=P.context.velocity??P.value?.gain??1;const Ye=(P.whole.begin-(s?H:A))/ot,Xt=dt(Ye,...et);let ht=dt(P.duration/ot,0,X);const Yt=ce(P),tn=l?wt.indexOf(Yt)/wt.length:(Number(Yt)-_)/mt,te=dt(tn,...Zt);let ee=0;const ne=dt(e/ot,...et);let pt;if(h?pt=[te+1-(o?it:0),X-ne+Xt+ee+1-(s?0:ht),it-2,ht-2]:pt=[Xt-ne+ee+1-(s?ht:0),te+1-(o?0:it),ht-2,it-2],lt&&x.strokeRect(...pt),ft&&x.fillRect(...pt),b){const en=P.value.note??P.value.s+(P.value.n?`:${P.value.n}`:""),{label:re,activeLabel:nn}=P.value,rn=(Q&&nn||re)??en;let sn=h?ht:it*.75;x.font=`${sn}px ${k||"monospace"}`,x.fillStyle=ft?"black":J,x.textBaseline="top",x.fillText(rn,...pt)}}),x.globalAlpha=1;const yt=dt(-A/ot,...et);return x.strokeStyle=y,x.beginPath(),h?(x.moveTo(0,yt),x.lineTo(O,yt)):(x.moveTo(yt,0),x.lineTo(yt,O)),x.stroke(),this}function Kt(e,t={}){let[n,r]=e;n=Math.abs(n);const s=r+n,o=n/s;return{fold:1,...t,cycles:s,playhead:o}}const Ue=(e={})=>(t,n,r,s,o={})=>Ct({ctx:t,time:n,haps:r,...Kt(s,{...o,...e})});g.prototype.punchcard=function(e){return this.onPaint(Ue(e))};g.prototype.wordfall=function(e){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...e})};function Do(e){const{drawTime:t,...n}=e;Ct({...Kt(t),...n})}function Ro(e,t,n,r){const s=(e-90)*Math.PI/180;return[n+Math.cos(s)*t,r+Math.sin(s)*t]}const ae=(e,t,n,r,s=0)=>Ro((e+s)*360,t*e,n,r);function ue(e){let{ctx:t,from:n=0,to:r=3,margin:s=50,cx:o=100,cy:i=100,rotate:u=0,thickness:f=s/2,color:d="#0000ff30",cap:m="round",stretch:y=1,fromOpacity:_=1,toOpacity:w=1}=e;n*=y,r*=y,u*=y,t.lineWidth=f,t.lineCap=m,t.strokeStyle=d,t.globalAlpha=_,t.beginPath();let[c,a]=ae(n,s,o,i,u);t.moveTo(c,a);const l=1/60;let h=n;for(;h<=r;){const[b,C]=ae(h,s,o,i,u);t.globalAlpha=(h-n)/(r-n)*w,t.lineTo(b,C),h+=l}t.stroke()}g.prototype.spiral=function(e={}){const{stretch:t=1,size:n=80,thickness:r=n/2,cap:s="butt",inset:o=3,playheadColor:i="#ffffff90",playheadLength:u=.02,playheadThickness:f=r,padding:d=0,steady:m=1,inactiveColor:y="#ffffff20",colorizeInactive:_=0,fade:w=!0}=e;function c({ctx:a,time:l,haps:h,drawTime:b}){const[C,N]=[a.canvas.width,a.canvas.height];a.clearRect(0,0,C*2,N*2);const[G,I]=[C/2,N/2],j={margin:n/t,cx:G,cy:I,stretch:t,cap:s,thickness:r},q={...j,thickness:f,from:o-u,to:o,color:i},[k]=b,x=m*l;h.forEach(B=>{const W=B.whole.begin<=l&&B.endClipped>l,A=B.whole.begin-l+o,H=B.endClipped-l+o-d,{color:X}=B.context,O=w?1-Math.abs((B.whole.begin-l)/k):1;ue({ctx:a,...j,from:A,to:H,rotate:x,color:_||W?X:y,fromOpacity:O,toOpacity:O})}),ue({ctx:a,...q,rotate:x})}return this.onPaint((a,l,h,b)=>c({ctx:a,time:l,haps:h,drawTime:b}))};function Vo(e){window.strudelAnimation&&cancelAnimationFrame(window.strudelAnimation);const t=n=>{e(n,Qt()),window.strudelAnimation=requestAnimationFrame(t)};requestAnimationFrame(t)}const Go=function(e,t={}){const n=document.getElementById("code"),r="background-image:url("+e+");background-size:contain;";n.style=r;const{className:s}=n,o=(f,d)=>{({style:()=>n.style=r+";"+d,className:()=>n.className=d+" "+s})[f]()},i=Object.entries(t).filter(([f,d])=>typeof d=="function");Object.entries(t).filter(([f,d])=>typeof d=="string").forEach(([f,d])=>o(f,d)),i.length!==0&&Vo((f,d)=>i.forEach(([m,y])=>{o(m,y(d))}))},Qo=()=>{const e=document.getElementById("code");e&&(e.style="")};R("🌀 @strudel.cycles/core loaded 🌀");globalThis._strudelLoaded&&console.warn(`@strudel.cycles/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel.cycles/core".`);globalThis._strudelLoaded=!0;const Xo=Object.freeze(Object.defineProperty({__proto__:null,Cyclist:Re,Drawer:Mo,Fraction:S,Framer:Qe,Hap:E,Pattern:g,State:rt,TimeSpan:M,__chooseWith:Gt,_brandBy:Vt,_irand:Le,_mod:vt,add:In,almostAlways:Ao,almostNever:qo,always:Co,and:ir,angle:Fo,apply:Fr,arrange:Pn,backgroundImage:Go,band:Gn,base64ToUnicode:be,bjork:Oe,blshift:Kn,bor:Qn,brak:Kr,brand:to,brandBy:Ys,brshift:Zn,bxor:Un,bypass:ms,cat:$t,ceil:fr,choose:so,chooseCycles:He,chooseInWith:$e,chooseWith:At,chop:ks,chunkBack:ps,chunkback:ds,clamp:ye,cleanupDraw:Oo,cleanupUi:Qo,code2hash:xn,color:vs,colour:_s,compose:yn,compress:gr,compressSpan:br,compressspan:vr,constant:gn,controls:U,cosine:Js,cosine2:Ws,cpm:Lr,curry:T,degrade:ho,degradeBy:fo,degradeByWith:lo,density:Sr,div:Dn,drawLine:ve,drawPianoroll:Do,duration:ys,early:$r,echo:cs,echoWith:rs,echowith:ss,eq:nr,eqt:rr,euclid:js,euclidLegato:$s,euclidLegatoRot:Hs,euclidRot:Ls,euclidrot:Fs,evalScope:We,evaluate:De,every:jr,fast:xr,fastGap:_r,fastcat:tt,fastgap:qr,fill:$o,firstOf:zr,fit:Ts,flatten:nt,floor:lr,focus:Ar,focusSpan:kr,focusspan:Cr,fractionalArgs:bn,freqToMidi:Bt,fromBipolar:pr,func:ar,getDrawContext:kt,getDrawOptions:Kt,getFreq:he,getFrequency:wn,getPlayableNoteValue:mn,getPunchcardPainter:Ue,getTime:Qt,getTrigger:Ge,gt:Yn,gte:er,h:jo,hash2code:Sn,hsl:bs,hsla:gs,hurry:Tr,id:ct,inside:Mr,inv:Gr,invert:Vr,irand:eo,isNote:bt,isNoteWithOctave:un,isPattern:Ft,isaw:Dt,isaw2:Ee,iter:us,iterBack:ls,iterback:fs,jux:ns,juxBy:ts,juxby:es,keep:$n,keepif:Hn,lastOf:Pr,late:Hr,legato:As,linger:Dr,listRange:Ot,logKey:jt,logger:R,loopAt:xs,loopAtCps:Bs,loopat:Ss,loopatcps:Os,lt:Xn,lte:tr,mapArgs:Et,mask:zn,midi2note:dn,midiToFreq:at,mod:Rn,moveXY:Jo,mul:Wn,ne:sr,net:or,never:ko,noteToMidi:ut,numeralArgs:D,off:Ur,often:vo,or:cr,outside:Er,palindrome:Yr,parseFractional:we,parseNumeral:Mt,perlin:uo,perlinWith:Je,pianoroll:Ct,pick:no,pipe:de,ply:Nr,pm:Ae,polymeter:Ht,polymeterSteps:Ce,polyrhythm:_e,pow:Vn,pr:qe,press:Xr,pressBy:Zr,pure:Z,r:Lo,rand:V,rand2:Xs,randcat:oo,range:dr,range2:wr,rangex:mr,rarely:_o,ratio:yr,ref:Ms,register:p,reify:v,removeUndefineds:me,repl:Bo,rescale:Io,rev:Ne,ribbon:ws,rotate:pe,round:ur,run:Zs,saw:qt,saw2:Pe,segment:Rr,seq:ke,sequence:K,set:Ln,setStringParser:Bn,setTime:Ve,signal:st,silence:z,sine:ze,sine2:Rt,slice:Se,slow:Br,slowcat:Y,slowcatPrime:Lt,smear:Ho,sol2note:Nn,someCycles:bo,someCyclesBy:go,sometimes:yo,sometimesBy:wo,sparsity:Or,speak:xo,splice:Ns,splitAt:Pt,square:je,square2:Ds,squeeze:ro,stack:L,steady:Is,striate:Cs,struct:jn,stut:as,stutWith:os,stutwith:is,sub:Jn,superimpose:Fn,time:Fe,timeCat:_t,toBipolar:hr,tokenizeNote:fe,tri:Rs,tri2:Vs,undegrade:mo,undegradeBy:po,unicodeToBase64:ge,valueToMidi:hn,velocity:qs,w:zo,wchoose:co,wchooseCycles:ao,when:Qr,x:Ut,xfade:Te,y:Po,zipWith:zt,zoom:Ir,zoomArc:Jr,zoomIn:Wo,zoomarc:Wr},Symbol.toStringTag,{value:"Module"}));let F=[],Uo=(e,t)=>{let n,r=[],s={lc:0,l:t||0,value:e,set(o){s.value=o,s.notify()},get(){return s.lc||s.listen(()=>{})(),s.value},notify(o){n=r;let i=!F.length;for(let u=0;u<n.length;u+=2)F.push(n[u],s.value,o,n[u+1]);if(i){for(let u=0;u<F.length;u+=4){let f=!1;for(let d=u+7;d<F.length;d+=4)if(F[d]<F[u+3]){f=!0;break}f?F.push(F[u],F[u+1],F[u+2],F[u+3]):F[u](F[u+1],F[u+2])}F.length=0}},listen(o,i){return r===n&&(r=r.slice()),s.lc=r.push(o,i||s.l)/2,()=>{r===n&&(r=r.slice());let u=r.indexOf(o);~u&&(r.splice(u,2),s.lc--,s.lc||s.off())}},subscribe(o,i){let u=s.listen(o,i);return o(s.value),u},off(){}};return s},Yo=(e={})=>{let t=Uo(e);return t.setKey=function(n,r){typeof r>"u"?n in t.value&&(t.value={...t.value},delete t.value[n],t.notify(n)):t.value[n]!==r&&(t.value={...t.value,[n]:r},t.notify(n))},t};export{Y as A,_t as B,Re as C,Mo as D,K as E,v as F,Bn as G,nt as H,tt as I,hn as J,We as K,U as L,Sn as M,xn as N,Ue as O,g as P,vt as _,p as a,wn as b,mn as c,Yo as d,Ge as e,Bt as f,kt as g,ye as h,Ft as i,un as j,bt as k,R as l,dn as m,ut as n,L as o,Mt as p,Z as q,Ms as r,Xo as s,Uo as t,Bo as u,Oo as v,z as w,S as x,$e as y,V as z};
//# sourceMappingURL=index.86034b57.js.map
