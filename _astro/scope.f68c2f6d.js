import{z as Ue,A as _e,C as et,B as tt,P as q,E as de,F as nt}from"./index.a2044bc2.js";if(typeof DelayNode<"u"){class e extends DelayNode{constructor(t,o,s,a){super(t),o=Math.abs(o),this.delayTime.value=s;const r=t.createGain();r.gain.value=Math.min(Math.abs(a),.995),this.feedback=r.gain;const c=t.createGain();return c.gain.value=o,this.delayGain=c,this.connect(r),this.connect(c),r.connect(this),this.connect=i=>c.connect(i),this}start(t){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,t+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(n,t,o){return new e(this,n,t,o)}}var le={};le.generateReverb=function(e,n){for(var t=e.audioContext||new AudioContext,o=t.sampleRate,s=e.numChannels||2,a=e.decayTime*1.5,r=Math.round(e.decayTime*o),c=Math.round(a*o),i=Math.round((e.fadeInTime||0)*o),d=Math.pow(1/1e3,1/r),l=t.createBuffer(s,c,o),u=0;u<s;u++){for(var g=l.getChannelData(u),h=0;h<c;h++)g[h]=st()*Math.pow(d,h);for(var h=0;h<i;h++)g[h]*=h/i}ot(l,e.lpFreqStart||0,e.lpFreqEnd||0,e.decayTime,n)};le.generateGraph=function(e,n,t,o,s){var a=document.createElement("canvas");a.width=n,a.height=t;var r=a.getContext("2d");r.fillStyle="#000",r.fillRect(0,0,a.width,a.height),r.fillStyle="#fff";for(var c=n/e.length,i=t/(s-o),d=0;d<e.length;d++)r.fillRect(d*c,t-(e[d]-o)*i,1,1);return a};var ot=function(e,n,t,o,s){if(n==0){s(e);return}var a=at(e),r=new OfflineAudioContext(e.numberOfChannels,a[0].length,e.sampleRate),c=r.createBufferSource();c.buffer=e;var i=r.createBiquadFilter();n=Math.min(n,e.sampleRate/2),t=Math.min(t,e.sampleRate/2),i.type="lowpass",i.Q.value=1e-4,i.frequency.setValueAtTime(n,0),i.frequency.linearRampToValueAtTime(t,o),c.connect(i),i.connect(r.destination),c.start(),r.oncomplete=function(d){s(d.renderedBuffer)},r.startRendering(),window.filterNode=i},at=function(e){for(var n=[],t=0;t<e.numberOfChannels;t++)n[t]=e.getChannelData(t);return n},st=function(){return Math.random()*2-1};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(e,n){const t=n.sampleRate*e,o=this.createBuffer(n.numberOfChannels,n.length,n.sampleRate);for(let s=0;s<n.numberOfChannels;s++){let a=n.getChannelData(s),r=o.getChannelData(s);for(let c=0;c<t;c++)r[c]=a[c]||0}return o},AudioContext.prototype.createReverb=function(e,n,t,o,s){const a=this.createConvolver();return a.generate=(r=2,c=.1,i=15e3,d=1e3,l)=>{a.duration=r,a.fade=c,a.lp=i,a.dim=d,a.ir=l,l?a.buffer=this.adjustLength(r,l):le.generateReverb({audioContext:this,numChannels:2,decayTime:r,fadeInTime:c,lpFreqStart:i,lpFreqEnd:d},u=>{a.buffer=u})},a.generate(e,n,t,o,s),a});var Xe={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]}};if(typeof GainNode<"u"){class e extends GainNode{constructor(t,o){if(super(t),!Xe[o])throw new Error("vowel: unknown vowel "+o);const{gains:s,qs:a,freqs:r}=Xe[o],c=t.createGain();for(let i=0;i<5;i++){const d=t.createGain();d.gain.value=s[i];const l=t.createBiquadFilter();l.type="bandpass",l.Q.value=a[i],l.frequency.value=r[i],this.connect(l),l.connect(d),d.connect(c)}return c.gain.value=8,this.connect=i=>c.connect(i),this}}AudioContext.prototype.createVowelFilter=function(n){return new e(this,n)}}const rt=e=>{if(typeof e!="string")return[];const[n,t="",o]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return n?[n,t,o?Number(o):void 0]:[]},ct={c:0,d:2,e:4,f:5,g:7,a:9,b:11},it={"#":1,b:-1,s:1,f:-1},Ze=(e,n=3)=>{const[t,o,s=n]=rt(e);if(!t)throw new Error('not a note: "'+e+'"');const a=ct[t.toLowerCase()],r=o?.split("").reduce((c,i)=>c+it[i],0)||0;return(Number(s)+1)*12+a+r},Ft=e=>Math.pow(2,(e-69)/12)*440,ce=(e,n,t)=>Math.min(Math.max(e,n),t),dt=e=>12*Math.log(e/440)/Math.LN2+69,lt=(e,n)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:t,note:o}=e;if(typeof t=="number")return dt(t);if(typeof o=="string")return Ze(o);if(typeof o=="number")return o;if(!n)throw new Error("valueToMidi: expected freq or note to be set");return n},gt="data:application/javascript;base64,Ly8gTElDRU5TRSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2My4wIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZGt0cjAvV2ViRGlydC9ibG9iL21haW4vTElDRU5TRQovLyBhbGwgdGhlIGNyZWRpdCBnb2VzIHRvIGRrdHIwJ3Mgd2ViZGlydDogaHR0cHM6Ly9naXRodWIuY29tL2RrdHIwL1dlYkRpcnQvYmxvYi81Y2UzZDY5ODM2MmM1NGQ2ZTFiNjhhY2M0N2ViMjk1NWFjNjJjNzkzL2Rpc3QvQXVkaW9Xb3JrbGV0cy5qcwovLyA8MwoKY2xhc3MgQ29hcnNlUHJvY2Vzc29yIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsKICBzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCkgewogICAgcmV0dXJuIFt7IG5hbWU6ICdjb2Fyc2UnLCBkZWZhdWx0VmFsdWU6IDEgfV07CiAgfQoKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLm5vdFN0YXJ0ZWQgPSB0cnVlOwogIH0KCiAgcHJvY2VzcyhpbnB1dHMsIG91dHB1dHMsIHBhcmFtZXRlcnMpIHsKICAgIGNvbnN0IGlucHV0ID0gaW5wdXRzWzBdOwogICAgY29uc3Qgb3V0cHV0ID0gb3V0cHV0c1swXTsKICAgIGNvbnN0IGNvYXJzZSA9IHBhcmFtZXRlcnMuY29hcnNlOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBvdXRwdXRbMF1bMF0gPSBpbnB1dFswXVswXTsKICAgICAgZm9yIChsZXQgbiA9IDE7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgIGZvciAobGV0IG8gPSAwOyBvIDwgb3V0cHV0Lmxlbmd0aDsgbysrKSB7CiAgICAgICAgICBvdXRwdXRbb11bbl0gPSBuICUgY29hcnNlID09IDAgPyBpbnB1dFswXVtuXSA6IG91dHB1dFtvXVtuIC0gMV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ2NvYXJzZS1wcm9jZXNzb3InLCBDb2Fyc2VQcm9jZXNzb3IpOwoKY2xhc3MgQ3J1c2hQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ2NydXNoJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBjcnVzaCA9IHBhcmFtZXRlcnMuY3J1c2g7CiAgICBjb25zdCBibG9ja1NpemUgPSAxMjg7CiAgICBjb25zdCBoYXNJbnB1dCA9ICEoaW5wdXRbMF0gPT09IHVuZGVmaW5lZCk7CiAgICBpZiAoaGFzSW5wdXQpIHsKICAgICAgdGhpcy5ub3RTdGFydGVkID0gZmFsc2U7CiAgICAgIGlmIChjcnVzaC5sZW5ndGggPT09IDEpIHsKICAgICAgICBjb25zdCB4ID0gTWF0aC5wb3coMiwgY3J1c2hbMF0gLSAxKTsKICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IE1hdGgucm91bmQoaW5wdXRbMF1bbl0gKiB4KSAvIHg7CiAgICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgICBvdXRwdXRbb11bbl0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgICAgbGV0IHggPSBNYXRoLnBvdygyLCBjcnVzaFtuXSAtIDEpOwogICAgICAgICAgY29uc3QgdmFsdWUgPSBNYXRoLnJvdW5kKGlucHV0WzBdW25dICogeCkgLyB4OwogICAgICAgICAgZm9yIChsZXQgbyA9IDA7IG8gPCBvdXRwdXQubGVuZ3RoOyBvKyspIHsKICAgICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQpyZWdpc3RlclByb2Nlc3NvcignY3J1c2gtcHJvY2Vzc29yJywgQ3J1c2hQcm9jZXNzb3IpOwoKY2xhc3MgU2hhcGVQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ3NoYXBlJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBzaGFwZTAgPSBwYXJhbWV0ZXJzLnNoYXBlWzBdOwogICAgY29uc3Qgc2hhcGUxID0gc2hhcGUwIDwgMSA/IHNoYXBlMCA6IDEuMCAtIDRlLTEwOwogICAgY29uc3Qgc2hhcGUgPSAoMi4wICogc2hhcGUxKSAvICgxLjAgLSBzaGFwZTEpOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSAoKDEgKyBzaGFwZSkgKiBpbnB1dFswXVtuXSkgLyAoMSArIHNoYXBlICogTWF0aC5hYnMoaW5wdXRbMF1bbl0pKTsKICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ3NoYXBlLXByb2Nlc3NvcicsIFNoYXBlUHJvY2Vzc29yKTsK";function ie(e){const n=A().createGain();return n.gain.value=e,n}const ut=(e,n,t,o,s,a)=>{const r=A().createGain();return r.gain.setValueAtTime(0,a),r.gain.linearRampToValueAtTime(s,a+e),r.gain.linearRampToValueAtTime(t*s,a+e+n),{node:r,stop:c=>{r.gain.setValueAtTime(t*s,c),r.gain.linearRampToValueAtTime(0,c+o)}}},xt=(e,n,t,o,s,a)=>{t=Math.max(.001,t),s=Math.max(.001,s);const r=A().createGain();return r.gain.setValueAtTime(1e-4,a),r.gain.exponentialRampToValueAtTime(s,a+e),r.gain.exponentialRampToValueAtTime(t*s,a+e+n),{node:r,stop:c=>{r.gain.exponentialRampToValueAtTime(1e-4,c+o)}}},Dt=(e,n,t,o,s,a,r)=>{const c=A().createGain();return c.gain.setValueAtTime(0,a),c.gain.linearRampToValueAtTime(s,a+e),c.gain.linearRampToValueAtTime(t*s,a+e+n),c.gain.setValueAtTime(t*s,r),c.gain.linearRampToValueAtTime(0,r+o),c},ft=(e,n,t,o,s,a,r,c,i)=>{const d=r-a,l=a+d,u=a+o*d;e.setValueAtTime(a,c),e.linearRampToValueAtTime(l,c+n),e.linearRampToValueAtTime(u,c+n+t),e.setValueAtTime(u,i),e.linearRampToValueAtTime(a,i+Math.max(s,.1))};function ht(e,n,t,o,s,a){const r={threshold:n??-3,ratio:t??10,knee:o??10,attack:s??.005,release:a??.05};return new DynamicsCompressorNode(e,r)}function te(e,n,t,o,s,a,r,c,i,d,l,u=.5){const g=e.createBiquadFilter();if(g.type=n,g.Q.value=o,g.frequency.value=t,!isNaN(i)&&i!==0){const h=i*u,y=ce(2**-h*t,0,2e4),I=ce(2**(i-h)*t,0,2e4);return ft(g.frequency,s,a,r,c,y,I,d,l),g}return g}let He=e=>e<.5?1:1-(e-.5)/.5;function Kt(e,n,t=0){const o=A();if(!t)return e;let s=o.createGain(),a=o.createGain();e.connect(s),n.connect(a),s.gain.value=He(t),a.gain.value=He(1-t);let r=o.createGain();return s.connect(r),a.connect(r),r}let We=e=>console.log(e);const N=(...e)=>We(...e),pt=e=>{We=e},ge={},ne={},Yt=e=>ge[e];function It(e,n){var t=n?1e3:1024;if(e<t)return e+" B";var o=n?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],s=-1;do e/=t,++s;while(e>=t);return e.toFixed(1)+" "+o[s]}const Ct=async(e,n,t,o,s,a,r)=>{let c=0;s!==void 0&&t!==void 0&&N("[sampler] hap has note and freq. ignoring note","warning");let i=lt({freq:s,note:t},36);c=i-36;const d=A();let l;if(Array.isArray(a))l=a[n%a.length];else{const y=C=>Ze(C)-i,I=Object.keys(a).filter(C=>!C.startsWith("_")).reduce((C,b,x)=>!C||Math.abs(y(b))<Math.abs(y(C))?b:C,null);c=-y(I),l=a[I][n%a[I].length]}r&&(l=await r(l));let u=await Se(l,d,e,n);o<0&&(u=mt(u));const g=d.createBufferSource();g.buffer=u;const h=1*Math.pow(2,c/12);return g.playbackRate.value=h,g},Se=(e,n,t,o=0)=>{const s=t?`sound "${t}:${o}"`:"sample";if(e=e.replace("#","%23"),!ne[e]){N(`[sampler] load ${s}..`,"load-sample",{url:e});const a=Date.now();ne[e]=fetch(e).then(r=>r.arrayBuffer()).then(async r=>{const c=Date.now()-a,i=It(r.byteLength);N(`[sampler] load ${s}... done! loaded ${i} in ${c}ms`,"loaded-sample",{url:e});const d=await n.decodeAudioData(r);return ge[e]=d,d})}return ne[e]};function mt(e){const n=A(),t=n.createBuffer(e.numberOfChannels,e.length,n.sampleRate);for(let o=0;o<e.numberOfChannels;o++)t.copyToChannel(e.getChannelData(o).slice().reverse(),o,o);return t}const kt=e=>ge[e],At=(e,n,t=e._base||"")=>Object.entries(e).forEach(([o,s])=>{if(typeof s=="string"&&(s=[s]),typeof s!="object")throw new Error("wrong sample map format for "+o);t=s._base||t;const a=r=>(t+r).replace("github:","https://raw.githubusercontent.com/");Array.isArray(s)?s=s.map(a):s=Object.fromEntries(Object.entries(s).map(([r,c])=>[r,(typeof c=="string"?[c]:c).map(a)])),n(o,s)});let Me={};function jt(e,n){Me[e]=n}function yt(e){const n=Object.entries(Me).find(([t])=>e.startsWith(t));if(n)return n[1]}const bt=async(e,n=e._base||"",t={})=>{if(typeof e=="string"){const a=yt(e);if(a)return a(e);if(e.startsWith("github:")){let[c,i]=e.split("github:");i=i.endsWith("/")?i.slice(0,-1):i,e=`https://raw.githubusercontent.com/${i}/strudel.json`.replace("//strudel.json","/strudel.json")}if(typeof fetch!="function")return;const r=e.split("/").slice(0,-1).join("/");return typeof fetch>"u"?void 0:fetch(e).then(c=>c.json()).then(c=>bt(c,n||c._base||r,t)).catch(c=>{throw console.error(c),new Error(`error loading "${e}"`)})}const{prebake:o,tag:s}=t;At(e,(a,r)=>Bt(a,(c,i,d)=>wt(c,i,d,r),{type:"sample",samples:r,baseUrl:n,prebake:o,tag:s}),n)},Ne=[];async function wt(e,n,t,o,s){let{s:a,freq:r,unit:c,nudge:i=0,cut:d,loop:l,clip:u=void 0,n:g=0,note:h,speed:y=1,loopBegin:I=0,begin:C=0,loopEnd:b=1,end:x=1}=n;if(y===0)return;l=a.startsWith("wt_")?1:n.loop;const D=A(),{attack:K=.001,decay:P=.001,sustain:$=1,release:Y=.001}=n,Z=e+i,p=await Ct(a,g,h,y,r,o,s);if(D.currentTime>e){N(`[sampler] still loading sound "${a}:${g}"`,"highlight");return}if(!p){N(`[sampler] could not load "${a}:${g}"`,"error");return}p.playbackRate.value=Math.abs(y)*p.playbackRate.value,c==="c"&&(p.playbackRate.value=p.playbackRate.value*p.buffer.duration*1);const W=C*p.buffer.duration;l&&(p.loop=!0,p.loopStart=I*p.buffer.duration-W,p.loopEnd=b*p.buffer.duration-W),p.start(Z,W);const{node:R,stop:U}=ut(K,P,$,Y,1,e);p.connect(R);const S=D.createGain();R.connect(S),p.onended=function(){p.disconnect(),R.disconnect(),S.disconnect(),t()};const k={node:S,bufferSource:p,stop:(v,j=u===void 0&&l===void 0)=>{let V=v;if(j){const O=p.buffer.duration/p.playbackRate.value;V=e+(x-C)*O}p.stop(V+Y),U(V)}};if(d!==void 0){const v=Ne[d];v&&(v.node.gain.setValueAtTime(1,Z),v.node.gain.linearRampToValueAtTime(0,Z+.01)),Ne[d]=k}return k}const ue=Ue();function Bt(e,n,t={}){ue.setKey(e,{onTrigger:n,data:t})}function oe(e){return ue.get()[e]}const Ot=()=>ue.set({});let ae;const A=()=>(ae||(ae=new AudioContext),ae);let z;const E=()=>{const e=A();return z||(z=e.createGain(),z.connect(e.destination)),z},Qt=()=>{E().gain.linearRampToValueAtTime(0,A().currentTime+.01),z=null};let J;function vt(){return J||(J=A().audioWorklet.addModule(gt),J)}function se(e,n,t){const o=new AudioWorkletNode(e,n);return Object.entries(t).forEach(([s,a])=>{o.parameters.get(s).value=a}),o}async function Gt(e={}){const{disableWorklets:n=!1}=e;typeof window<"u"&&(await A().resume(),n?console.log("disableWorklets: AudioWorklet effects coarse, crush and shape are skipped!"):await vt().catch(t=>{console.warn("could not load AudioWorklet effects coarse, crush and shape",t)}))}async function Jt(e){return new Promise(n=>{document.addEventListener("click",async function t(){await Gt(e),n(),document.removeEventListener("click",t)})})}let T={};function Tt(e,n,t,o){if(t=ce(t,0,.98),!T[e]){const a=A().createFeedbackDelay(1,n,t);a.start?.(o),a.connect(E()),T[e]=a}return T[e].delayTime.value!==n&&T[e].delayTime.setValueAtTime(n,o),T[e].feedback.value!==t&&T[e].feedback.setValueAtTime(t,o),T[e]}let B={},L=(e,n)=>e!==void 0&&e!==n;function Rt(e,n,t,o,s,a){if(!B[e]){const c=A().createReverb(n,t,o,s,a);c.connect(E()),B[e]=c}return(L(n,B[e].duration)||L(t,B[e].fade)||L(o,B[e].lp)||L(s,B[e].dim)||B[e].ir!==a)&&B[e].generate(n,t,o,s,a),B[e]}let w,F;function Vt(e=2048){if(!w){const n=A().createAnalyser();n.fftSize=e,w=n,F=new Float32Array(w.frequencyBinCount)}return w.fftSize!==e&&(w.fftSize=e,F=new Float32Array(w.frequencyBinCount)),w}function ze(e="time"){const n={time:()=>w?.getFloatTimeDomainData(F),frequency:()=>w?.getFloatFrequencyData(F)}[e];if(!n)throw new Error(`getAnalyzerData: ${e} not supported. use one of ${Object.keys(n).join(", ")}`);return n(),F}function re(e,n,t){const o=ie(t);return e.connect(o),o.connect(n),o}const fe=async(e,n,t)=>{const o=A();if(typeof e!="object")throw new Error(`expected hap.value to be an object, but got "${e}". Hint: append .note() or .s() to the end`,"error");e.duration=t;let s=o.currentTime+n,{s:a="triangle",bank:r,source:c,gain:i=.8,postgain:d=1,ftype:l="12db",fanchor:u=.5,cutoff:g,lpenv:h,lpattack:y=.01,lpdecay:I=.01,lpsustain:C=1,lprelease:b=.01,resonance:x=1,hpenv:D,hcutoff:K,hpattack:P=.01,hpdecay:$=.01,hpsustain:Y=1,hprelease:Z=.01,hresonance:p=1,bpenv:W,bandf:R,bpattack:U=.01,bpdecay:S=.01,bpsustain:he=1,bprelease:k=.01,bandq:v=1,coarse:j,crush:V,shape:O,pan:pe,vowel:Ie,delay:Ce=0,delayfeedback:me=.5,delaytime:Ae=.25,orbit:ye=1,room:be,roomfade:Ye,roomlp:ke,roomdim:je,roomsize:Oe,ir:_,i:we=0,velocity:Qe=1,analyze:Be,fft:Je=8,compressor:ve,compressorRatio:Le,compressorKnee:qe,compressorAttack:Ee,compressorRelease:Pe}=e;i*=Qe;let Ge=[];const $e=()=>{Ge.forEach(f=>f?.disconnect())};r&&a&&(a=`${r}_${a}`);let Q;if(c)Q=c(s,e,t);else if(oe(a)){const{onTrigger:f}=oe(a),G=await f(s,e,$e);G&&(Q=G.node,G.stop(s+t))}else throw new Error(`sound ${a} not found! Is it loaded?`);if(!Q)return;if(o.currentTime>s){N("[webaudio] skip hap: still loading",o.currentTime-s);return}const m=[];if(m.push(Q),m.push(ie(i)),g!==void 0){let f=()=>te(o,"lowpass",g,x,y,I,C,b,h,s,s+t,u);m.push(f()),l==="24db"&&m.push(f())}if(K!==void 0){let f=()=>te(o,"highpass",K,p,P,$,Y,Z,D,s,s+t,u);m.push(f()),l==="24db"&&m.push(f())}if(R!==void 0){let f=()=>te(o,"bandpass",R,v,U,S,he,k,W,s,s+t,u);m.push(f()),l==="24db"&&m.push(f())}if(Ie!==void 0){const f=o.createVowelFilter(Ie);m.push(f)}if(j!==void 0&&m.push(se(o,"coarse-processor",{coarse:j})),V!==void 0&&m.push(se(o,"crush-processor",{crush:V})),O!==void 0&&m.push(se(o,"shape-processor",{shape:O})),ve!==void 0&&m.push(ht(o,ve,Le,qe,Ee,Pe)),pe!==void 0){const f=o.createStereoPanner();f.pan.value=2*pe-1,m.push(f)}const M=ie(d);m.push(M),M.connect(E());let Te;if(Ce>0&&Ae>0&&me>0){const f=Tt(ye,Ae,me,s);Te=re(M,f,Ce)}let Re;if(be>0){let f;if(_!==void 0){let ee,X=oe(_);Array.isArray(X)?ee=X.data.samples[we%X.data.samples.length]:typeof X=="object"&&(ee=Object.values(X.data.samples).flat()[we%Object.values(X.data.samples).length]),f=await Se(ee,o,_,0)}const G=Rt(ye,Oe,Ye,ke,je,f);Re=re(M,G,be)}let Ve;if(Be){const f=Vt(2**(Je+5));Ve=re(M,f,Be)}m.slice(1).reduce((f,G)=>f.connect(G),m[0]),Ge=m.concat([Te,Re,Ve])},Lt=(e,n,t,o)=>fe(n,e-t,n.duration/o);let H;async function Xt(e,n){const t=`dsp-worklet-${Date.now()}`,o=`${n}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${t}', MyProcessor);
`,a=`data:text/javascript;base64,${btoa(o)}`;await e.audioWorklet.addModule(a);const r=new AudioWorkletNode(e,t);return{node:r,stop:()=>r.port.postMessage("stop")}}const Fe=()=>{H&&(H?.stop(),H?.node?.disconnect())};typeof window<"u"&&window.addEventListener("message",e=>{e.data==="strudel-stop"?Fe():e.data?.dough&&H?.node.port.postMessage(e.data)});const qt=async e=>{const n=A();Fe(),H=await Xt(n,e),H.node.connect(n.destination)};function Ht(e,n,t,o,s){window.postMessage({time:e,dough:n.value,currentTime:t,duration:o,cps:s})}const{Pattern:xe,logger:Nt}=_e;pt(Nt);const De=e=>(e.ensureObjectValue(),{...e.value,velocity:e.context.velocity}),Zt=(e,n,t,o)=>fe(De(n),e-t,n.duration/o),Wt=(e,n,t)=>fe(De(e),n,t);xe.prototype.webaudio=function(){return this.onTrigger(Zt)};function Et(e={}){e={getTime:()=>A().currentTime,defaultOutput:Wt,...e};const{defaultOutput:n,getTime:t}=e;return new et({...e,onTrigger:tt({defaultOutput:n,getTime:t})})}xe.prototype.dough=function(){return this.onTrigger(Ht,1)};function St(e,{align:n=!0,color:t="white",thickness:o=3,scale:s=.25,pos:a=.75,next:r=1,trigger:c=0}={}){const i=de(),d=ze("time");i.lineWidth=o,i.strokeStyle=t,i.beginPath();let l=i.canvas;const u=e.frequencyBinCount;let g=n?Array.from(d).findIndex((I,C,b)=>C&&b[C-1]>-c&&I<=-c):0;g=Math.max(g,0);const h=l.width*1/u;let y=0;for(let I=g;I<u;I++){const C=d[I]+1,b=(s*(C-1)+a)*l.height;I===0?i.moveTo(y,b):i.lineTo(y,b),y+=h}i.stroke()}function Mt(e,{color:n="white",scale:t=.25,pos:o=.75,lean:s=.5,min:a=-150,max:r=0}={}){const c=ze("frequency"),i=de(),d=i.canvas;i.fillStyle=n;const l=e.frequencyBinCount,u=d.width*1/l;let g=0;for(let h=0;h<l;h++){const I=nt((c[h]-a)/(r-a),0,1)*t,C=I*d.height,b=(o-I*s)*d.height;i.fillRect(g,b,Math.max(u,1),C),g+=u}}function Ke(e=0,n="0,0,0"){const t=de();e?(t.fillStyle=`rgba(${n},${1-e})`,t.fillRect(0,0,t.canvas.width,t.canvas.height)):t.clearRect(0,0,t.canvas.width,t.canvas.height)}q.prototype.fscope=function(e={}){return this.analyze(1).draw(()=>{Ke(e.smear),w&&Mt(w,e)})};q.prototype.tscope=function(e={}){return this.analyze(1).draw(()=>{Ke(e.smear),w&&St(w,e)})};q.prototype.scope=q.prototype.tscope;export{bt as A,wt as B,ie as C,ut as D,xt as E,Dt as F,ft as G,ht as H,te as I,Kt as J,N as K,pt as L,Xt as M,qt as N,Ht as O,Ze as P,Ft as Q,Wt as a,Et as b,Mt as c,St as d,Ot as e,A as f,oe as g,Jt as h,Gt as i,w as j,F as k,Vt as l,ze as m,fe as n,Lt as o,Qt as p,Yt as q,Bt as r,ue as s,Ct as t,Se as u,mt as v,Zt as w,kt as x,At as y,jt as z};
//# sourceMappingURL=scope.f68c2f6d.js.map
