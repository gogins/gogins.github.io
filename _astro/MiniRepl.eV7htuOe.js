import{j as e}from"./jsx-runtime.XGodtQ4D.js";import{r}from"./index.Nkt9jjly.js";import{q as J,n as K,x as Q,_ as X}from"./index.diuTzW_X.js";import{n as Z,o as ee,q as te,r as re}from"./useClient.2n2CwdCY.js";import{i as oe,w as ie,g as se}from"./scope.Uhlw_W3-.js";import{S as ne}from"./preload-helper.p054LDAL.js";import{C as le}from"./Claviature.ZM4Ov946.js";/* empty css                      */function u({type:i}){return i==="skip"?e.jsx("svg",{fillRule:"evenodd",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",height:"16",width:"10",viewBox:"0 0 320 512",children:e.jsx("path",{d:"M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96C0 83.6 7.2 72.3 18.4 67s24.5-3.6 34.1 4.4l192 160L256 241V96c0-17.7 14.3-32 32-32s32 14.3 32 32V416c0 17.7-14.3 32-32 32s-32-14.3-32-32V271l-11.5 9.6-192 160z"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:{refresh:e.jsx("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z",clipRule:"evenodd"}),play:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"}),pause:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"}),stop:e.jsx("path",{fillRule:"evenodd",d:"M2 10a8 8 0 1116 0 8 8 0 01-16 0zm5-2.25A.75.75 0 017.75 7h4.5a.75.75 0 01.75.75v4.5a.75.75 0 01-.75.75h-4.5a.75.75 0 01-.75-.75v-4.5z",clipRule:"evenodd"}),skip:e.jsx("path",{fillRule:"evenodd",d:"M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96C0 83.6 7.2 72.3 18.4 67s24.5-3.6 34.1 4.4l192 160L256 241V96c0-17.7 14.3-32 32-32s32 14.3 32 32V416c0 17.7-14.3 32-32 32s-32-14.3-32-32V271l-11.5 9.6-192 160z",clipRule:"evenodd"})}[i]})}let z,V,A;typeof window<"u"&&(z=Z(),V=ee(),A=oe());function ve({tune:i,tunes:n,hideHeader:T=!1,canvasHeight:I=100,onTrigger:x,punchcard:a,punchcardLabels:L=!0,claviature:h,claviatureLabels:B,maxHeight:v}){const b=n?n[0]:i,g=r.useMemo(()=>ae(),[]),j=r.useMemo(()=>`canvas-${g}`,[g]),O=!!a||!!h,P=!!a,w=a?[0,4]:[0,0],[q,D]=r.useState([]),E=r.useCallback(({code:t,shouldDraw:f})=>{const d=f?document.querySelector("#"+j)?.getContext("2d"):null;let N;f&&(N=(o,H,U,p)=>{p.length&&d?.clearRect(0,0,d.canvas.width*2,d.canvas.height*2),p?.forEach(m=>{m(d,H,o,w,{clear:!1})})});const c=new ne({id:g,defaultOutput:ie,getTime:()=>se().currentTime,transpiler:te,autodraw:!!f,root:R.current,initialCode:"// LOADING",pattern:J,drawTime:w,onDraw:N,editPattern:(o,H)=>(x&&(o=o.onTrigger(x,!1)),h&&c?.painters.push((U,p,m,de)=>{const Y=m.map(l=>l.value.note).filter(Boolean).map(l=>typeof l=="string"?K(l):l);D(Y)}),a&&c?.painters.push(Q({labels:!!L})),o),prebake:async()=>Promise.all([V,z,A]),onUpdateState:o=>{_({...o})}});c.setCode(t),s.current=c},[]),[W,_]=r.useState({}),{started:C,isDirty:$,error:k}=W,s=r.useRef(),R=r.useRef(),F=re(),[y,G]=r.useState(0),M=t=>{t=X(t,n.length),G(t),s.current?.setCode(n[t]),s.current?.evaluate()};return F?e.jsxs("div",{className:"overflow-hidden rounded-t-md bg-background border border-lineHighlight",children:[!T&&e.jsxs("div",{className:"flex justify-between bg-lineHighlight",children:[e.jsxs("div",{className:"flex",children:[e.jsx("button",{className:S("cursor-pointer w-16 flex items-center justify-center p-1 border-r border-lineHighlight text-foreground bg-lineHighlight hover:bg-background",C?"animate-pulse":""),onClick:()=>s.current?.toggle(),children:e.jsx(u,{type:C?"stop":"play"})}),e.jsx("button",{className:S("w-16 flex items-center justify-center p-1 text-foreground border-lineHighlight bg-lineHighlight",$?"text-foreground hover:bg-background cursor-pointer":"opacity-50 cursor-not-allowed"),onClick:()=>s.current?.evaluate(),children:e.jsx(u,{type:"refresh"})})]}),n&&e.jsxs("div",{className:"flex",children:[e.jsx("button",{className:"cursor-pointer w-16 flex items-center justify-center p-1 border-r border-lineHighlight text-foreground bg-lineHighlight hover:bg-background",onClick:()=>M(y-1),children:e.jsx("div",{className:"rotate-180",children:e.jsx(u,{type:"skip"})})}),e.jsx("button",{className:"cursor-pointer w-16 flex items-center justify-center p-1 border-r border-lineHighlight text-foreground bg-lineHighlight hover:bg-background",onClick:()=>M(y+1),children:e.jsx(u,{type:"skip"})})]})]}),e.jsxs("div",{className:"overflow-auto relative p-1",style:v?{maxHeight:`${v}px`}:{},children:[e.jsx("div",{ref:t=>{s.current||(R.current=t,E({code:b,shouldDraw:O}))}}),k&&e.jsx("div",{className:"text-right p-1 text-md text-red-200",children:k.message})]}),P&&e.jsx("canvas",{id:j,className:"w-full pointer-events-none border-t border-lineHighlight",height:I,ref:t=>{t&&t.width!==t.clientWidth&&(t.width=t.clientWidth)}}),h&&e.jsx(le,{options:{range:["C2","C6"],scaleY:.75,colorize:[{keys:q,color:"steelblue"}],labels:B||{}}})]}):e.jsx("pre",{children:b})}function S(...i){return i.filter(Boolean).join(" ")}function ae(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}export{ve as MiniRepl};
