import{j as f,h as w,d as m,f as v,o as y,a as E,b as k}from"./useKeydown.71409498.js";import{S as q,e as z,s as B,i as J,c as Q,m as R,l as U,g as X,n as Y,u as Z,k as _}from"./useKeydown.71409498.js";import{E as b,l as S,h as L,s as x,d as C,k as g,a as u}from"./settings.270953c1.js";import{D,r as M}from"./index.a2044bc2.js";import"./index.3d4af9ee.js";import"./jsx-runtime.7e7f555b.js";import"./client.014307a4.js";import"./doc.fa0d4fbe.js";import"./mini.03263755.js";import"./useFrame.84ba1694.js";function W({initialCode:d="",onChange:t,onEvaluate:a,onStop:o,theme:s=y,root:n}){let l=b.create({doc:d,extensions:[s,f(),S(),w,L(),x(C),g.of(m),v,u.updateListener.of(r=>t(r)),g.of([{key:"Ctrl-Enter",run:()=>a()},{key:"Ctrl-.",run:()=>o()}])]});return new u({state:l,parent:n})}class N{constructor(t){const{root:a,initialCode:o="",onDraw:s,drawTime:n=[-2,2],prebake:l,...r}=t;this.code=o,this.drawer=new D((e,i)=>{const c=e.filter(p=>i>=p.whole.begin&&i<=p.endClipped);this.highlight(c,i),s?.(e,i,c)},n);const h=l();h.then(async()=>{if(!s)return;const{scheduler:e,evaluate:i}=await this.repl;h.then(async()=>{await i(this.code,!1),this.drawer.invalidate(e),s?.(this.drawer.visibleHaps,0,[])})}),this.repl=M({...r,onToggle:async e=>{r?.onToggle?.(e);const{scheduler:i}=await this.repl;e?this.drawer.start(i):this.drawer.stop()},beforeEval:async()=>{await h},afterEval:e=>{r?.afterEval?.(e),this.drawer.invalidate()}}),this.editor=W({root:a,initialCode:o,onChange:e=>{this.code=e.state.doc.toString()},onEvaluate:()=>this.evaluate(),onStop:()=>this.stop()})}async evaluate(){const{evaluate:t}=await this.repl;this.flash(),await t(this.code)}async stop(){const{scheduler:t}=await this.repl;t.stop()}flash(t){E(this.editor,t)}highlight(t,a){k(this.editor.view,a,t)}}export{q as SliderWidget,N as StrudelMirror,E as flash,v as flashField,w as highlightExtension,k as highlightMiniLocations,W as initEditor,z as setFlash,B as setMiniLocations,J as setWidgets,Q as showMiniLocations,R as slider,U as sliderPlugin,X as sliderValues,Y as sliderWithID,Z as updateMiniLocations,_ as updateWidgets};
//# sourceMappingURL=index.539d1285.js.map
