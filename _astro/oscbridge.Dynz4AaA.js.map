{"version":3,"file":"oscbridge.Dynz4AaA.js","sources":["../../../packages/desktopbridge/oscbridge.mjs"],"sourcesContent":["import { parseNumeral, Pattern, getEventOffsetMs } from '@strudel/core';\nimport { Invoke } from './utils.mjs';\n\nPattern.prototype.osc = function () {\n  return this.onTrigger(async (time, hap, currentTime, cps = 1, targetTime) => {\n    hap.ensureObjectValue();\n    const cycle = hap.wholeOrPart().begin.valueOf();\n    const delta = hap.duration.valueOf();\n    const controls = Object.assign({}, { cps, cycle, delta }, hap.value);\n    // make sure n and note are numbers\n    controls.n && (controls.n = parseNumeral(controls.n));\n    controls.note && (controls.note = parseNumeral(controls.note));\n\n    const params = [];\n\n    const timestamp = Math.round(Date.now() + getEventOffsetMs(targetTime, currentTime));\n\n    Object.keys(controls).forEach((key) => {\n      const val = controls[key];\n      const value = typeof val === 'number' ? val.toString() : val;\n\n      if (value == null) {\n        return;\n      }\n      params.push({\n        name: key,\n        value,\n        valueisnumber: typeof val === 'number',\n      });\n    });\n\n    const messagesfromjs = [];\n    if (params.length) {\n      messagesfromjs.push({ target: '/dirt/play', timestamp, params });\n    }\n\n    if (messagesfromjs.length) {\n      setTimeout(() => {\n        Invoke('sendosc', { messagesfromjs });\n      });\n    }\n  });\n};\n"],"names":["Pattern","time","hap","currentTime","cps","targetTime","cycle","delta","controls","parseNumeral","params","timestamp","getEventOffsetMs","key","val","value","messagesfromjs","Invoke"],"mappings":"sSAGAA,EAAQ,UAAU,IAAM,UAAY,CAClC,OAAO,KAAK,UAAU,MAAOC,EAAMC,EAAKC,EAAaC,EAAM,EAAGC,IAAe,CAC3EH,EAAI,kBAAiB,EACrB,MAAMI,EAAQJ,EAAI,YAAa,EAAC,MAAM,QAAO,EACvCK,EAAQL,EAAI,SAAS,QAAO,EAC5BM,EAAW,OAAO,OAAO,GAAI,CAAE,IAAAJ,EAAK,MAAAE,EAAO,MAAAC,CAAK,EAAIL,EAAI,KAAK,EAEnEM,EAAS,IAAMA,EAAS,EAAIC,EAAaD,EAAS,CAAC,GACnDA,EAAS,OAASA,EAAS,KAAOC,EAAaD,EAAS,IAAI,GAE5D,MAAME,EAAS,CAAA,EAETC,EAAY,KAAK,MAAM,KAAK,IAAK,EAAGC,EAAiBP,EAAYF,CAAW,CAAC,EAEnF,OAAO,KAAKK,CAAQ,EAAE,QAASK,GAAQ,CACrC,MAAMC,EAAMN,EAASK,CAAG,EAClBE,EAAQ,OAAOD,GAAQ,SAAWA,EAAI,SAAU,EAAGA,EAErDC,GAAS,MAGbL,EAAO,KAAK,CACV,KAAMG,EACN,MAAAE,EACA,cAAe,OAAOD,GAAQ,QACtC,CAAO,CACP,CAAK,EAED,MAAME,EAAiB,CAAA,EACnBN,EAAO,QACTM,EAAe,KAAK,CAAE,OAAQ,aAAc,UAAAL,EAAW,OAAAD,CAAM,CAAE,EAG7DM,EAAe,QACjB,WAAW,IAAM,CACfC,EAAO,UAAW,CAAE,eAAAD,CAAc,CAAE,CAC5C,CAAO,CAEP,CAAG,CACH"}