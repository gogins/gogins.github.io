{"version":3,"file":"scope.efc95823.js","sources":["../../../packages/superdough/feedbackdelay.mjs","../../../packages/superdough/reverb.mjs","../../../packages/superdough/vowel.mjs","../../../packages/superdough/util.mjs","../../../packages/superdough/worklets.mjs?url","../../../packages/superdough/helpers.mjs","../../../packages/superdough/logger.mjs","../../../packages/superdough/superdough.mjs","../../../packages/superdough/dspworklet.mjs","../../../packages/webaudio/webaudio.mjs","../../../packages/webaudio/scope.mjs"],"sourcesContent":["if (typeof DelayNode !== 'undefined') {\n  class FeedbackDelayNode extends DelayNode {\n    constructor(ac, wet, time, feedback) {\n      super(ac);\n      wet = Math.abs(wet);\n      this.delayTime.value = time;\n\n      const feedbackGain = ac.createGain();\n      feedbackGain.gain.value = Math.min(Math.abs(feedback), 0.995);\n      this.feedback = feedbackGain.gain;\n\n      const delayGain = ac.createGain();\n      delayGain.gain.value = wet;\n      this.delayGain = delayGain;\n\n      this.connect(feedbackGain);\n      this.connect(delayGain);\n      feedbackGain.connect(this);\n\n      this.connect = (target) => delayGain.connect(target);\n      return this;\n    }\n    start(t) {\n      this.delayGain.gain.setValueAtTime(this.delayGain.gain.value, t + this.delayTime.value);\n    }\n  }\n\n  AudioContext.prototype.createFeedbackDelay = function (wet, time, feedback) {\n    return new FeedbackDelayNode(this, wet, time, feedback);\n  };\n}\n","if (typeof AudioContext !== 'undefined') {\n  AudioContext.prototype.impulseResponse = function (duration, channels = 1) {\n    const length = this.sampleRate * duration;\n    const impulse = this.createBuffer(channels, length, this.sampleRate);\n    const IR = impulse.getChannelData(0);\n    for (let i = 0; i < length; i++) IR[i] = (2 * Math.random() - 1) * Math.pow(1 - i / length, duration);\n    return impulse;\n  };\n\n  AudioContext.prototype.createReverb = function (duration) {\n    const convolver = this.createConvolver();\n    convolver.setDuration = (d) => {\n      convolver.buffer = this.impulseResponse(d);\n      convolver.duration = duration;\n      return convolver;\n    };\n    convolver.setDuration(duration);\n    return convolver;\n  };\n}\n\n// TODO: make the reverb more exciting\n// check out https://blog.gskinner.com/archives/2019/02/reverb-web-audio-api.html\n","// credits to webdirt: https://github.com/dktr0/WebDirt/blob/41342e81d6ad694a2310d491fef7b7e8b0929efe/js-src/Graph.js#L597\nexport var vowelFormant = {\n  a: { freqs: [660, 1120, 2750, 3000, 3350], gains: [1, 0.5012, 0.0708, 0.0631, 0.0126], qs: [80, 90, 120, 130, 140] },\n  e: { freqs: [440, 1800, 2700, 3000, 3300], gains: [1, 0.1995, 0.1259, 0.1, 0.1], qs: [70, 80, 100, 120, 120] },\n  i: { freqs: [270, 1850, 2900, 3350, 3590], gains: [1, 0.0631, 0.0631, 0.0158, 0.0158], qs: [40, 90, 100, 120, 120] },\n  o: { freqs: [430, 820, 2700, 3000, 3300], gains: [1, 0.3162, 0.0501, 0.0794, 0.01995], qs: [40, 80, 100, 120, 120] },\n  u: { freqs: [370, 630, 2750, 3000, 3400], gains: [1, 0.1, 0.0708, 0.0316, 0.01995], qs: [40, 60, 100, 120, 120] },\n};\nif (typeof GainNode !== 'undefined') {\n  class VowelNode extends GainNode {\n    constructor(ac, letter) {\n      super(ac);\n      if (!vowelFormant[letter]) {\n        throw new Error('vowel: unknown vowel ' + letter);\n      }\n      const { gains, qs, freqs } = vowelFormant[letter];\n      const makeupGain = ac.createGain();\n      for (let i = 0; i < 5; i++) {\n        const gain = ac.createGain();\n        gain.gain.value = gains[i];\n        const filter = ac.createBiquadFilter();\n        filter.type = 'bandpass';\n        filter.Q.value = qs[i];\n        filter.frequency.value = freqs[i];\n        this.connect(filter);\n        filter.connect(gain);\n        gain.connect(makeupGain);\n      }\n      makeupGain.gain.value = 8; // how much makeup gain to add?\n      this.connect = (target) => makeupGain.connect(target);\n      return this;\n    }\n  }\n\n  AudioContext.prototype.createVowelFilter = function (letter) {\n    return new VowelNode(this, letter);\n  };\n}\n","// currently duplicate with core util.mjs to skip dependency\n// TODO: add separate util module?\n\nexport const tokenizeNote = (note) => {\n  if (typeof note !== 'string') {\n    return [];\n  }\n  const [pc, acc = '', oct] = note.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1) || [];\n  if (!pc) {\n    return [];\n  }\n  return [pc, acc, oct ? Number(oct) : undefined];\n};\nconst chromas = { c: 0, d: 2, e: 4, f: 5, g: 7, a: 9, b: 11 };\nconst accs = { '#': 1, b: -1, s: 1, f: -1 };\n\nexport const noteToMidi = (note, defaultOctave = 3) => {\n  const [pc, acc, oct = defaultOctave] = tokenizeNote(note);\n  if (!pc) {\n    throw new Error('not a note: \"' + note + '\"');\n  }\n  const chroma = chromas[pc.toLowerCase()];\n  const offset = acc?.split('').reduce((o, char) => o + accs[char], 0) || 0;\n  return (Number(oct) + 1) * 12 + chroma + offset;\n};\nexport const midiToFreq = (n) => {\n  return Math.pow(2, (n - 69) / 12) * 440;\n};\nexport const clamp = (num, min, max) => Math.min(Math.max(num, min), max);\n\nexport const freqToMidi = (freq) => {\n  return (12 * Math.log(freq / 440)) / Math.LN2 + 69;\n};\n\nexport const valueToMidi = (value, fallbackValue) => {\n  if (typeof value !== 'object') {\n    throw new Error('valueToMidi: expected object value');\n  }\n  let { freq, note } = value;\n  if (typeof freq === 'number') {\n    return freqToMidi(freq);\n  }\n  if (typeof note === 'string') {\n    return noteToMidi(note);\n  }\n  if (typeof note === 'number') {\n    return note;\n  }\n  if (!fallbackValue) {\n    throw new Error('valueToMidi: expected freq or note to be set');\n  }\n  return fallbackValue;\n};\n","export default \"data:application/javascript;base64,Ly8gTElDRU5TRSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2My4wIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZGt0cjAvV2ViRGlydC9ibG9iL21haW4vTElDRU5TRQovLyBhbGwgdGhlIGNyZWRpdCBnb2VzIHRvIGRrdHIwJ3Mgd2ViZGlydDogaHR0cHM6Ly9naXRodWIuY29tL2RrdHIwL1dlYkRpcnQvYmxvYi81Y2UzZDY5ODM2MmM1NGQ2ZTFiNjhhY2M0N2ViMjk1NWFjNjJjNzkzL2Rpc3QvQXVkaW9Xb3JrbGV0cy5qcwovLyA8MwoKY2xhc3MgQ29hcnNlUHJvY2Vzc29yIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsKICBzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCkgewogICAgcmV0dXJuIFt7IG5hbWU6ICdjb2Fyc2UnLCBkZWZhdWx0VmFsdWU6IDEgfV07CiAgfQoKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLm5vdFN0YXJ0ZWQgPSB0cnVlOwogIH0KCiAgcHJvY2VzcyhpbnB1dHMsIG91dHB1dHMsIHBhcmFtZXRlcnMpIHsKICAgIGNvbnN0IGlucHV0ID0gaW5wdXRzWzBdOwogICAgY29uc3Qgb3V0cHV0ID0gb3V0cHV0c1swXTsKICAgIGNvbnN0IGNvYXJzZSA9IHBhcmFtZXRlcnMuY29hcnNlOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBvdXRwdXRbMF1bMF0gPSBpbnB1dFswXVswXTsKICAgICAgZm9yIChsZXQgbiA9IDE7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgIGZvciAobGV0IG8gPSAwOyBvIDwgb3V0cHV0Lmxlbmd0aDsgbysrKSB7CiAgICAgICAgICBvdXRwdXRbb11bbl0gPSBuICUgY29hcnNlID09IDAgPyBpbnB1dFswXVtuXSA6IG91dHB1dFtvXVtuIC0gMV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ2NvYXJzZS1wcm9jZXNzb3InLCBDb2Fyc2VQcm9jZXNzb3IpOwoKY2xhc3MgQ3J1c2hQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ2NydXNoJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBjcnVzaCA9IHBhcmFtZXRlcnMuY3J1c2g7CiAgICBjb25zdCBibG9ja1NpemUgPSAxMjg7CiAgICBjb25zdCBoYXNJbnB1dCA9ICEoaW5wdXRbMF0gPT09IHVuZGVmaW5lZCk7CiAgICBpZiAoaGFzSW5wdXQpIHsKICAgICAgdGhpcy5ub3RTdGFydGVkID0gZmFsc2U7CiAgICAgIGlmIChjcnVzaC5sZW5ndGggPT09IDEpIHsKICAgICAgICBjb25zdCB4ID0gTWF0aC5wb3coMiwgY3J1c2hbMF0gLSAxKTsKICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IE1hdGgucm91bmQoaW5wdXRbMF1bbl0gKiB4KSAvIHg7CiAgICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgICBvdXRwdXRbb11bbl0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgICAgbGV0IHggPSBNYXRoLnBvdygyLCBjcnVzaFtuXSAtIDEpOwogICAgICAgICAgY29uc3QgdmFsdWUgPSBNYXRoLnJvdW5kKGlucHV0WzBdW25dICogeCkgLyB4OwogICAgICAgICAgZm9yIChsZXQgbyA9IDA7IG8gPCBvdXRwdXQubGVuZ3RoOyBvKyspIHsKICAgICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQpyZWdpc3RlclByb2Nlc3NvcignY3J1c2gtcHJvY2Vzc29yJywgQ3J1c2hQcm9jZXNzb3IpOwoKY2xhc3MgU2hhcGVQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ3NoYXBlJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBzaGFwZTAgPSBwYXJhbWV0ZXJzLnNoYXBlWzBdOwogICAgY29uc3Qgc2hhcGUxID0gc2hhcGUwIDwgMSA/IHNoYXBlMCA6IDEuMCAtIDRlLTEwOwogICAgY29uc3Qgc2hhcGUgPSAoMi4wICogc2hhcGUxKSAvICgxLjAgLSBzaGFwZTEpOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSAoKDEgKyBzaGFwZSkgKiBpbnB1dFswXVtuXSkgLyAoMSArIHNoYXBlICogTWF0aC5hYnMoaW5wdXRbMF1bbl0pKTsKICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ3NoYXBlLXByb2Nlc3NvcicsIFNoYXBlUHJvY2Vzc29yKTsK\"","import { getAudioContext } from './superdough.mjs';\nimport { clamp } from './util.mjs';\n\nexport function gainNode(value) {\n  const node = getAudioContext().createGain();\n  node.gain.value = value;\n  return node;\n}\n\n// alternative to getADSR returning the gain node and a stop handle to trigger the release anytime in the future\nexport const getEnvelope = (attack, decay, sustain, release, velocity, begin) => {\n  const gainNode = getAudioContext().createGain();\n  gainNode.gain.setValueAtTime(0, begin);\n  gainNode.gain.linearRampToValueAtTime(velocity, begin + attack); // attack\n  gainNode.gain.linearRampToValueAtTime(sustain * velocity, begin + attack + decay); // sustain start\n  // sustain end\n  return {\n    node: gainNode,\n    stop: (t) => {\n      //if (typeof gainNode.gain.cancelAndHoldAtTime === 'function') {\n      // gainNode.gain.cancelAndHoldAtTime(t); // this seems to release instantly....\n      // see https://discord.com/channels/779427371270275082/937365093082079272/1086053607360712735\n      //} else {\n      // firefox: this will glitch when the sustain has not been reached yet at the time of release\n      gainNode.gain.setValueAtTime(sustain * velocity, t);\n      //}\n      gainNode.gain.linearRampToValueAtTime(0, t + release);\n    },\n  };\n};\n\nexport const getExpEnvelope = (attack, decay, sustain, release, velocity, begin) => {\n  sustain = Math.max(0.001, sustain);\n  velocity = Math.max(0.001, velocity);\n  const gainNode = getAudioContext().createGain();\n  gainNode.gain.setValueAtTime(0.0001, begin);\n  gainNode.gain.exponentialRampToValueAtTime(velocity, begin + attack);\n  gainNode.gain.exponentialRampToValueAtTime(sustain * velocity, begin + attack + decay);\n  return {\n    node: gainNode,\n    stop: (t) => {\n      // similar to getEnvelope, this will glitch if sustain level has not been reached\n      gainNode.gain.exponentialRampToValueAtTime(0.0001, t + release);\n    },\n  };\n};\n\nexport const getADSR = (attack, decay, sustain, release, velocity, begin, end) => {\n  const gainNode = getAudioContext().createGain();\n  gainNode.gain.setValueAtTime(0, begin);\n  gainNode.gain.linearRampToValueAtTime(velocity, begin + attack); // attack\n  gainNode.gain.linearRampToValueAtTime(sustain * velocity, begin + attack + decay); // sustain start\n  gainNode.gain.setValueAtTime(sustain * velocity, end); // sustain end\n  gainNode.gain.linearRampToValueAtTime(0, end + release); // release\n  // for some reason, using exponential ramping creates little cracklings\n  /* let t = begin;\n  gainNode.gain.setValueAtTime(0, t);\n  gainNode.gain.exponentialRampToValueAtTime(velocity, (t += attack));\n  const sustainGain = Math.max(sustain * velocity, 0.001);\n  gainNode.gain.exponentialRampToValueAtTime(sustainGain, (t += decay));\n  if (end - begin < attack + decay) {\n    gainNode.gain.cancelAndHoldAtTime(end);\n  } else {\n    gainNode.gain.setValueAtTime(sustainGain, end);\n  }\n  gainNode.gain.exponentialRampToValueAtTime(0.001, end + release); // release */\n  return gainNode;\n};\n\nexport const getParamADSR = (param, attack, decay, sustain, release, min, max, begin, end) => {\n  const range = max - min;\n  const peak = min + range;\n  const sustainLevel = min + sustain * range;\n  param.setValueAtTime(min, begin);\n  param.linearRampToValueAtTime(peak, begin + attack);\n  param.linearRampToValueAtTime(sustainLevel, begin + attack + decay);\n  param.setValueAtTime(sustainLevel, end);\n  param.linearRampToValueAtTime(min, end + Math.max(release, 0.1));\n};\n\nexport function createFilter(\n  context,\n  type,\n  frequency,\n  Q,\n  attack,\n  decay,\n  sustain,\n  release,\n  fenv,\n  start,\n  end,\n  fanchor = 0.5,\n) {\n  const filter = context.createBiquadFilter();\n  filter.type = type;\n  filter.Q.value = Q;\n  filter.frequency.value = frequency;\n\n  // Apply ADSR to filter frequency\n  if (!isNaN(fenv) && fenv !== 0) {\n    const offset = fenv * fanchor;\n\n    const min = clamp(2 ** -offset * frequency, 0, 20000);\n    const max = clamp(2 ** (fenv - offset) * frequency, 0, 20000);\n\n    // console.log('min', min, 'max', max);\n\n    getParamADSR(filter.frequency, attack, decay, sustain, release, min, max, start, end);\n    return filter;\n  }\n\n  return filter;\n}\n","let log = (msg) => console.log(msg);\n\nexport const logger = (...args) => log(...args);\n\nexport const setLogger = (fn) => {\n  log = fn;\n};\n","/*\nsuperdough.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/superdough/superdough.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport './feedbackdelay.mjs';\nimport './reverb.mjs';\nimport './vowel.mjs';\nimport { clamp } from './util.mjs';\nimport workletsUrl from './worklets.mjs?url';\nimport { createFilter, gainNode } from './helpers.mjs';\nimport { map } from 'nanostores';\nimport { logger } from './logger.mjs';\n\nexport const soundMap = map();\nexport function registerSound(key, onTrigger, data = {}) {\n  soundMap.setKey(key, { onTrigger, data });\n}\nexport function getSound(s) {\n  return soundMap.get()[s];\n}\nexport const resetLoadedSounds = () => soundMap.set({});\n\nlet audioContext;\nexport const getAudioContext = () => {\n  if (!audioContext) {\n    audioContext = new AudioContext();\n  }\n  return audioContext;\n};\n\nlet destination;\nconst getDestination = () => {\n  const ctx = getAudioContext();\n  if (!destination) {\n    destination = ctx.createGain();\n    destination.connect(ctx.destination);\n  }\n  return destination;\n};\n\nexport const panic = () => {\n  getDestination().gain.linearRampToValueAtTime(0, getAudioContext().currentTime + 0.01);\n  destination = null;\n};\n\nlet workletsLoading;\nfunction loadWorklets() {\n  if (workletsLoading) {\n    return workletsLoading;\n  }\n  workletsLoading = getAudioContext().audioWorklet.addModule(workletsUrl);\n  return workletsLoading;\n}\n\nfunction getWorklet(ac, processor, params) {\n  const node = new AudioWorkletNode(ac, processor);\n  Object.entries(params).forEach(([key, value]) => {\n    node.parameters.get(key).value = value;\n  });\n  return node;\n}\n\n// this function should be called on first user interaction (to avoid console warning)\nexport async function initAudio(options = {}) {\n  const { disableWorklets = false } = options;\n  if (typeof window !== 'undefined') {\n    await getAudioContext().resume();\n    if (!disableWorklets) {\n      await loadWorklets().catch((err) => {\n        console.warn('could not load AudioWorklet effects coarse, crush and shape', err);\n      });\n    } else {\n      console.log('disableWorklets: AudioWorklet effects coarse, crush and shape are skipped!');\n    }\n  }\n}\n\nexport async function initAudioOnFirstClick(options) {\n  return new Promise((resolve) => {\n    document.addEventListener('click', async function listener() {\n      await initAudio(options);\n      resolve();\n      document.removeEventListener('click', listener);\n    });\n  });\n}\n\nlet delays = {};\nconst maxfeedback = 0.98;\nfunction getDelay(orbit, delaytime, delayfeedback, t) {\n  if (delayfeedback > maxfeedback) {\n    //logger(`delayfeedback was clamped to ${maxfeedback} to save your ears`);\n  }\n  delayfeedback = clamp(delayfeedback, 0, 0.98);\n  if (!delays[orbit]) {\n    const ac = getAudioContext();\n    const dly = ac.createFeedbackDelay(1, delaytime, delayfeedback);\n    dly.start?.(t); // for some reason, this throws when audion extension is installed..\n    dly.connect(getDestination());\n    delays[orbit] = dly;\n  }\n  delays[orbit].delayTime.value !== delaytime && delays[orbit].delayTime.setValueAtTime(delaytime, t);\n  delays[orbit].feedback.value !== delayfeedback && delays[orbit].feedback.setValueAtTime(delayfeedback, t);\n  return delays[orbit];\n}\n\nlet reverbs = {};\nfunction getReverb(orbit, duration = 2) {\n  if (!reverbs[orbit]) {\n    const ac = getAudioContext();\n    const reverb = ac.createReverb(duration);\n    reverb.connect(getDestination());\n    reverbs[orbit] = reverb;\n  }\n  if (reverbs[orbit].duration !== duration) {\n    reverbs[orbit] = reverbs[orbit].setDuration(duration);\n    reverbs[orbit].duration = duration;\n  }\n  return reverbs[orbit];\n}\n\nexport let analyser, analyserData /* s = {} */;\nexport function getAnalyser(/* orbit,  */ fftSize = 2048) {\n  if (!analyser /*s [orbit] */) {\n    const analyserNode = getAudioContext().createAnalyser();\n    analyserNode.fftSize = fftSize;\n    // getDestination().connect(analyserNode);\n    analyser /* s[orbit] */ = analyserNode;\n    //analyserData = new Uint8Array(analyser.frequencyBinCount);\n    analyserData = new Float32Array(analyser.frequencyBinCount);\n  }\n  if (analyser /* s[orbit] */.fftSize !== fftSize) {\n    analyser /* s[orbit] */.fftSize = fftSize;\n    //analyserData = new Uint8Array(analyser.frequencyBinCount);\n    analyserData = new Float32Array(analyser.frequencyBinCount);\n  }\n  return analyser /* s[orbit] */;\n}\n\nexport function getAnalyzerData(type = 'time') {\n  const getter = {\n    time: () => analyser?.getFloatTimeDomainData(analyserData),\n    frequency: () => analyser?.getFloatFrequencyData(analyserData),\n  }[type];\n  if (!getter) {\n    throw new Error(`getAnalyzerData: ${type} not supported. use one of ${Object.keys(getter).join(', ')}`);\n  }\n  getter();\n  return analyserData;\n}\n\nfunction effectSend(input, effect, wet) {\n  const send = gainNode(wet);\n  input.connect(send);\n  send.connect(effect);\n  return send;\n}\n\nexport const superdough = async (value, deadline, hapDuration) => {\n  const ac = getAudioContext();\n  if (typeof value !== 'object') {\n    throw new Error(\n      `expected hap.value to be an object, but got \"${value}\". Hint: append .note() or .s() to the end`,\n      'error',\n    );\n  }\n\n  // duration is passed as value too..\n  value.duration = hapDuration;\n  // calculate absolute time\n  let t = ac.currentTime + deadline;\n  // destructure\n  let {\n    s = 'triangle',\n    bank,\n    source,\n    gain = 0.8,\n    // filters\n    ftype = '12db',\n    fanchor = 0.5,\n    // low pass\n    cutoff,\n    lpenv,\n    lpattack = 0.01,\n    lpdecay = 0.01,\n    lpsustain = 1,\n    lprelease = 0.01,\n    resonance = 1,\n    // high pass\n    hpenv,\n    hcutoff,\n    hpattack = 0.01,\n    hpdecay = 0.01,\n    hpsustain = 1,\n    hprelease = 0.01,\n    hresonance = 1,\n    // band pass\n    bpenv,\n    bandf,\n    bpattack = 0.01,\n    bpdecay = 0.01,\n    bpsustain = 1,\n    bprelease = 0.01,\n    bandq = 1,\n    //\n    coarse,\n    crush,\n    shape,\n    pan,\n    vowel,\n    delay = 0,\n    delayfeedback = 0.5,\n    delaytime = 0.25,\n    orbit = 1,\n    room,\n    size = 2,\n    velocity = 1,\n    analyze, // analyser wet\n    fft = 8, // fftSize 0 - 10\n  } = value;\n  gain *= velocity; // legacy fix for velocity\n  let toDisconnect = []; // audio nodes that will be disconnected when the source has ended\n  const onended = () => {\n    toDisconnect.forEach((n) => n?.disconnect());\n  };\n  if (bank && s) {\n    s = `${bank}_${s}`;\n  }\n  // get source AudioNode\n  let sourceNode;\n  if (source) {\n    sourceNode = source(t, value, hapDuration);\n  } else if (getSound(s)) {\n    const { onTrigger } = getSound(s);\n    const soundHandle = await onTrigger(t, value, onended);\n    if (soundHandle) {\n      sourceNode = soundHandle.node;\n      soundHandle.stop(t + hapDuration);\n    }\n  } else {\n    throw new Error(`sound ${s} not found! Is it loaded?`);\n  }\n  if (!sourceNode) {\n    // if onTrigger does not return anything, we will just silently skip\n    // this can be used for things like speed(0) in the sampler\n    return;\n  }\n  if (ac.currentTime > t) {\n    logger('[webaudio] skip hap: still loading', ac.currentTime - t);\n    return;\n  }\n  const chain = []; // audio nodes that will be connected to each other sequentially\n  chain.push(sourceNode);\n\n  // gain stage\n  chain.push(gainNode(gain));\n\n  if (cutoff !== undefined) {\n    let lp = () =>\n      createFilter(\n        ac,\n        'lowpass',\n        cutoff,\n        resonance,\n        lpattack,\n        lpdecay,\n        lpsustain,\n        lprelease,\n        lpenv,\n        t,\n        t + hapDuration,\n        fanchor,\n      );\n    chain.push(lp());\n    if (ftype === '24db') {\n      chain.push(lp());\n    }\n  }\n\n  if (hcutoff !== undefined) {\n    let hp = () =>\n      createFilter(\n        ac,\n        'highpass',\n        hcutoff,\n        hresonance,\n        hpattack,\n        hpdecay,\n        hpsustain,\n        hprelease,\n        hpenv,\n        t,\n        t + hapDuration,\n        fanchor,\n      );\n    chain.push(hp());\n    if (ftype === '24db') {\n      chain.push(hp());\n    }\n  }\n\n  if (bandf !== undefined) {\n    let bp = () =>\n      createFilter(\n        ac,\n        'bandpass',\n        bandf,\n        bandq,\n        bpattack,\n        bpdecay,\n        bpsustain,\n        bprelease,\n        bpenv,\n        t,\n        t + hapDuration,\n        fanchor,\n      );\n    chain.push(bp());\n    if (ftype === '24db') {\n      chain.push(bp());\n    }\n  }\n\n  if (vowel !== undefined) {\n    const vowelFilter = ac.createVowelFilter(vowel);\n    chain.push(vowelFilter);\n  }\n\n  // effects\n  coarse !== undefined && chain.push(getWorklet(ac, 'coarse-processor', { coarse }));\n  crush !== undefined && chain.push(getWorklet(ac, 'crush-processor', { crush }));\n  shape !== undefined && chain.push(getWorklet(ac, 'shape-processor', { shape }));\n\n  // panning\n  if (pan !== undefined) {\n    const panner = ac.createStereoPanner();\n    panner.pan.value = 2 * pan - 1;\n    chain.push(panner);\n  }\n\n  // last gain\n  const post = gainNode(1);\n  chain.push(post);\n  post.connect(getDestination());\n\n  // delay\n  let delaySend;\n  if (delay > 0 && delaytime > 0 && delayfeedback > 0) {\n    const delyNode = getDelay(orbit, delaytime, delayfeedback, t);\n    delaySend = effectSend(post, delyNode, delay);\n  }\n  // reverb\n  let reverbSend;\n  if (room > 0 && size > 0) {\n    const reverbNode = getReverb(orbit, size);\n    reverbSend = effectSend(post, reverbNode, room);\n  }\n\n  // analyser\n  let analyserSend;\n  if (analyze) {\n    const analyserNode = getAnalyser(/* orbit,  */ 2 ** (fft + 5));\n    analyserSend = effectSend(post, analyserNode, analyze);\n  }\n\n  // connect chain elements together\n  chain.slice(1).reduce((last, current) => last.connect(current), chain[0]);\n\n  // toDisconnect = all the node that should be disconnected in onended callback\n  // this is crucial for performance\n  toDisconnect = chain.concat([delaySend, reverbSend, analyserSend]);\n};\n\nexport const superdoughTrigger = (t, hap, ct, cps) => superdough(hap, t - ct, hap.duration / cps, cps);\n","import { getAudioContext } from './superdough.mjs';\n\nlet worklet;\nexport async function dspWorklet(ac, code) {\n  const name = `dsp-worklet-${Date.now()}`;\n  const workletCode = `${code}\nlet __q = []; // trigger queue\nclass MyProcessor extends AudioWorkletProcessor {\n  constructor() {\n    super();\n    this.t = 0;\n    this.stopped = false;\n    this.port.onmessage = (e) => {\n      if(e.data==='stop') {\n        this.stopped = true;\n      } else if(e.data?.dough) {\n        const deadline = e.data.time-currentTime;\n        __q.push(e.data)\n      } else {\n        msg?.(e.data)\n      }\n    };\n  }\n  process(inputs, outputs, parameters) {\n    const output = outputs[0];\n    if(__q.length) {\n      for(let i=0;i<__q.length;++i) {\n        const deadline = __q[i].time-currentTime;\n        if(deadline<=0) {\n          trigger(__q[i].dough)\n          __q.splice(i,1)\n        }\n      }\n    }\n    for (let i = 0; i < output[0].length; i++) {\n      const out = dsp(this.t / sampleRate);\n      output.forEach((channel) => {\n        channel[i] = out;\n      });\n      this.t++;\n    }\n  return !this.stopped;\n  }\n}\nregisterProcessor('${name}', MyProcessor);\n`;\n  const base64String = btoa(workletCode);\n  const dataURL = `data:text/javascript;base64,${base64String}`;\n  await ac.audioWorklet.addModule(dataURL);\n  const node = new AudioWorkletNode(ac, name);\n  const stop = () => node.port.postMessage('stop');\n  return { node, stop };\n}\nconst stop = () => {\n  if (worklet) {\n    worklet?.stop();\n    worklet?.node?.disconnect();\n  }\n};\n\nif (typeof window !== 'undefined') {\n  window.addEventListener('message', (e) => {\n    if (e.data === 'strudel-stop') {\n      stop();\n    } else if (e.data?.dough) {\n      worklet?.node.port.postMessage(e.data);\n    }\n  });\n}\n\nexport const dough = async (code) => {\n  const ac = getAudioContext();\n  stop();\n  worklet = await dspWorklet(ac, code);\n  worklet.node.connect(ac.destination);\n};\n\nexport function doughTrigger(t, hap, currentTime, duration, cps) {\n  window.postMessage({ time: t, dough: hap.value, currentTime, duration, cps });\n}\n","/*\nwebaudio.mjs - <short description TODO>\nCopyright (C) 2022 Strudel contributors - see <https://github.com/tidalcycles/strudel/blob/main/packages/webaudio/webaudio.mjs>\nThis program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details. You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport * as strudel from '@strudel.cycles/core';\nimport { superdough, getAudioContext, setLogger, doughTrigger } from 'superdough';\nconst { Pattern, logger } = strudel;\n\nsetLogger(logger);\n\nconst hap2value = (hap) => {\n  hap.ensureObjectValue();\n  return { ...hap.value, velocity: hap.context.velocity };\n};\n\n// TODO: bind logger\nexport const webaudioOutputTrigger = (t, hap, ct, cps) => superdough(hap2value(hap), t - ct, hap.duration / cps, cps);\nexport const webaudioOutput = (hap, deadline, hapDuration) => superdough(hap2value(hap), deadline, hapDuration);\n\nPattern.prototype.webaudio = function () {\n  return this.onTrigger(webaudioOutputTrigger);\n};\n\nexport function webaudioScheduler(options = {}) {\n  options = {\n    getTime: () => getAudioContext().currentTime,\n    defaultOutput: webaudioOutput,\n    ...options,\n  };\n  const { defaultOutput, getTime } = options;\n  return new strudel.Cyclist({\n    ...options,\n    onTrigger: strudel.getTrigger({ defaultOutput, getTime }),\n  });\n}\n\nPattern.prototype.dough = function () {\n  return this.onTrigger(doughTrigger, 1);\n};\n","import { Pattern, getDrawContext, clamp } from '@strudel.cycles/core';\nimport { analyser, getAnalyzerData } from 'superdough';\n\nexport function drawTimeScope(\n  analyser,\n  { align = true, color = 'white', thickness = 3, scale = 0.25, pos = 0.75, next = 1, trigger = 0 } = {},\n) {\n  const ctx = getDrawContext();\n  const dataArray = getAnalyzerData('time');\n\n  ctx.lineWidth = thickness;\n  ctx.strokeStyle = color;\n\n  ctx.beginPath();\n  let canvas = ctx.canvas;\n\n  const bufferSize = analyser.frequencyBinCount;\n  let triggerIndex = align\n    ? Array.from(dataArray).findIndex((v, i, arr) => i && arr[i - 1] > -trigger && v <= -trigger)\n    : 0;\n  triggerIndex = Math.max(triggerIndex, 0); // fallback to 0 when no trigger is found\n\n  const sliceWidth = (canvas.width * 1.0) / bufferSize;\n  let x = 0;\n\n  for (let i = triggerIndex; i < bufferSize; i++) {\n    const v = dataArray[i] + 1;\n    const y = (scale * (v - 1) + pos) * canvas.height;\n\n    if (i === 0) {\n      ctx.moveTo(x, y);\n    } else {\n      ctx.lineTo(x, y);\n    }\n    x += sliceWidth;\n  }\n  ctx.stroke();\n}\n\nexport function drawFrequencyScope(\n  analyser,\n  { color = 'white', scale = 0.25, pos = 0.75, lean = 0.5, min = -150, max = 0 } = {},\n) {\n  const dataArray = getAnalyzerData('frequency');\n  const ctx = getDrawContext();\n  const canvas = ctx.canvas;\n\n  ctx.fillStyle = color;\n  const bufferSize = analyser.frequencyBinCount;\n  const sliceWidth = (canvas.width * 1.0) / bufferSize;\n\n  let x = 0;\n  for (let i = 0; i < bufferSize; i++) {\n    const normalized = clamp((dataArray[i] - min) / (max - min), 0, 1);\n    const v = normalized * scale;\n    const h = v * canvas.height;\n    const y = (pos - v * lean) * canvas.height;\n\n    ctx.fillRect(x, y, Math.max(sliceWidth, 1), h);\n    x += sliceWidth;\n  }\n}\n\nfunction clearScreen(smear = 0, smearRGB = `0,0,0`) {\n  const ctx = getDrawContext();\n  if (!smear) {\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n  } else {\n    ctx.fillStyle = `rgba(${smearRGB},${1 - smear})`;\n    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n  }\n}\n\nPattern.prototype.fscope = function (config = {}) {\n  return this.analyze(1).draw(() => {\n    clearScreen(config.smear);\n    analyser && drawFrequencyScope(analyser, config);\n  });\n};\n\nPattern.prototype.tscope = function (config = {}) {\n  return this.analyze(1).draw(() => {\n    clearScreen(config.smear);\n    analyser && drawTimeScope(analyser, config);\n  });\n};\n\nPattern.prototype.scope = Pattern.prototype.tscope;\n"],"names":["FeedbackDelayNode","ac","wet","time","feedback","feedbackGain","delayGain","target","duration","channels","length","impulse","IR","i","convolver","d","vowelFormant","VowelNode","letter","gains","qs","freqs","makeupGain","gain","filter","tokenizeNote","note","pc","acc","oct","chromas","accs","noteToMidi","defaultOctave","chroma","offset","o","char","midiToFreq","n","clamp","num","min","max","freqToMidi","freq","valueToMidi","value","fallbackValue","workletsUrl","gainNode","node","getAudioContext","getEnvelope","attack","decay","sustain","release","velocity","begin","t","getExpEnvelope","getADSR","end","getParamADSR","param","range","peak","sustainLevel","createFilter","context","type","frequency","Q","fenv","start","fanchor","log","msg","logger","args","setLogger","fn","soundMap","map","registerSound","key","onTrigger","data","getSound","s","resetLoadedSounds","audioContext","destination","getDestination","ctx","panic","workletsLoading","loadWorklets","getWorklet","processor","params","initAudio","options","disableWorklets","err","initAudioOnFirstClick","resolve","listener","delays","getDelay","orbit","delaytime","delayfeedback","dly","reverbs","getReverb","reverb","analyser","analyserData","getAnalyser","fftSize","analyserNode","getAnalyzerData","getter","effectSend","input","effect","send","superdough","deadline","hapDuration","bank","source","ftype","cutoff","lpenv","lpattack","lpdecay","lpsustain","lprelease","resonance","hpenv","hcutoff","hpattack","hpdecay","hpsustain","hprelease","hresonance","bpenv","bandf","bpattack","bpdecay","bpsustain","bprelease","bandq","coarse","crush","shape","pan","vowel","delay","room","size","analyze","fft","toDisconnect","onended","sourceNode","soundHandle","chain","lp","hp","bp","vowelFilter","panner","post","delaySend","delyNode","reverbSend","reverbNode","analyserSend","last","current","superdoughTrigger","hap","ct","cps","worklet","dspWorklet","code","name","workletCode","dataURL","stop","dough","doughTrigger","currentTime","Pattern","strudel","hap2value","webaudioOutputTrigger","webaudioOutput","webaudioScheduler","defaultOutput","getTime","strudel.Cyclist","strudel.getTrigger","drawTimeScope","align","color","thickness","scale","pos","next","trigger","getDrawContext","dataArray","canvas","bufferSize","triggerIndex","v","arr","sliceWidth","x","drawFrequencyScope","lean","h","clearScreen","smear","smearRGB","config"],"mappings":"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"}