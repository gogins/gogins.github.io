import{d as ct,s as it,C as lt,e as dt,P as _,g as he,h as ut}from"./index.0c96e269.js";if(typeof DelayNode<"u"){class e extends DelayNode{constructor(t,a,s,o){super(t),a=Math.abs(a),this.delayTime.value=s;const c=t.createGain();c.gain.value=Math.min(Math.abs(o),.995),this.feedback=c.gain;const r=t.createGain();return r.gain.value=a,this.delayGain=r,this.connect(c),this.connect(r),c.connect(this),this.connect=i=>r.connect(i),this}start(t){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,t+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(n,t,a){return new e(this,n,t,a)}}var pe={};pe.generateReverb=function(e,n){for(var t=e.audioContext||new AudioContext,a=t.sampleRate,s=e.numChannels||2,o=e.decayTime*1.5,c=Math.round(e.decayTime*a),r=Math.round(o*a),i=Math.round((e.fadeInTime||0)*a),l=Math.pow(1/1e3,1/c),d=t.createBuffer(s,r,a),g=0;g<s;g++){for(var u=d.getChannelData(g),h=0;h<r;h++)u[h]=ht()*Math.pow(l,h);for(var h=0;h<i;h++)u[h]*=h/i}gt(d,e.lpFreqStart||0,e.lpFreqEnd||0,e.decayTime,n)};pe.generateGraph=function(e,n,t,a,s){var o=document.createElement("canvas");o.width=n,o.height=t;var c=o.getContext("2d");c.fillStyle="#000",c.fillRect(0,0,o.width,o.height),c.fillStyle="#fff";for(var r=n/e.length,i=t/(s-a),l=0;l<e.length;l++)c.fillRect(l*r,t-(e[l]-a)*i,1,1);return o};var gt=function(e,n,t,a,s){if(n==0){s(e);return}var o=ft(e),c=new OfflineAudioContext(e.numberOfChannels,o[0].length,e.sampleRate),r=c.createBufferSource();r.buffer=e;var i=c.createBiquadFilter();n=Math.min(n,e.sampleRate/2),t=Math.min(t,e.sampleRate/2),i.type="lowpass",i.Q.value=1e-4,i.frequency.setValueAtTime(n,0),i.frequency.linearRampToValueAtTime(t,a),r.connect(i),i.connect(c.destination),r.start(),c.oncomplete=function(l){s(l.renderedBuffer)},c.startRendering(),window.filterNode=i},ft=function(e){for(var n=[],t=0;t<e.numberOfChannels;t++)n[t]=e.getChannelData(t);return n},ht=function(){return Math.random()*2-1};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(e,n){const t=n.sampleRate*e,a=this.createBuffer(n.numberOfChannels,n.length,n.sampleRate);for(let s=0;s<n.numberOfChannels;s++){let o=n.getChannelData(s),c=a.getChannelData(s);for(let r=0;r<t;r++)c[r]=o[r]||0}return a},AudioContext.prototype.createReverb=function(e,n,t,a,s){const o=this.createConvolver();return o.generate=(c=2,r=.1,i=15e3,l=1e3,d)=>{o.duration=c,o.fade=r,o.lp=i,o.dim=l,o.ir=d,d?o.buffer=this.adjustLength(c,d):pe.generateReverb({audioContext:this,numChannels:2,decayTime:c,fadeInTime:r,lpFreqStart:i,lpFreqEnd:l},g=>{o.buffer=g})},o.generate(e,n,t,a,s),o});var Fe={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]}};if(typeof GainNode<"u"){class e extends GainNode{constructor(t,a){if(super(t),!Fe[a])throw new Error("vowel: unknown vowel "+a);const{gains:s,qs:o,freqs:c}=Fe[a],r=t.createGain();for(let i=0;i<5;i++){const l=t.createGain();l.gain.value=s[i];const d=t.createBiquadFilter();d.type="bandpass",d.Q.value=o[i],d.frequency.value=c[i],this.connect(d),d.connect(l),l.connect(r)}return r.gain.value=8,this.connect=i=>r.connect(i),this}}AudioContext.prototype.createVowelFilter=function(n){return new e(this,n)}}let De=e=>console.log(e);const N=(...e)=>De(...e),pt=e=>{De=e},Ct=e=>{if(typeof e!="string")return[];const[n,t="",a]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return n?[n,t,a?Number(a):void 0]:[]},It={c:0,d:2,e:4,f:5,g:7,a:9,b:11},mt={"#":1,b:-1,s:1,f:-1},Ke=(e,n=3)=>{const[t,a,s=n]=Ct(e);if(!t)throw new Error('not a note: "'+e+'"');const o=It[t.toLowerCase()],c=a?.split("").reduce((r,i)=>r+mt[i],0)||0;return(Number(s)+1)*12+o+c},Lt=e=>Math.pow(2,(e-69)/12)*440,$=(e,n,t)=>Math.min(Math.max(e,n),t),At=e=>12*Math.log(e/440)/Math.LN2+69,bt=(e,n)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:t,note:a}=e;if(typeof t=="number")return At(t);if(typeof a=="string")return Ke(a);if(typeof a=="number")return a;if(!n)throw new Error("valueToMidi: expected freq or note to be set");return n};function Ye(e,n){return isNaN(Number(e))?(N(`"${e}" is not a number, falling back to ${n}`,"warning"),n):e}const yt="data:application/javascript;base64,Ly8gTElDRU5TRSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2My4wIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZGt0cjAvV2ViRGlydC9ibG9iL21haW4vTElDRU5TRQovLyBhbGwgdGhlIGNyZWRpdCBnb2VzIHRvIGRrdHIwJ3Mgd2ViZGlydDogaHR0cHM6Ly9naXRodWIuY29tL2RrdHIwL1dlYkRpcnQvYmxvYi81Y2UzZDY5ODM2MmM1NGQ2ZTFiNjhhY2M0N2ViMjk1NWFjNjJjNzkzL2Rpc3QvQXVkaW9Xb3JrbGV0cy5qcwovLyA8MwoKY2xhc3MgQ29hcnNlUHJvY2Vzc29yIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsKICBzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCkgewogICAgcmV0dXJuIFt7IG5hbWU6ICdjb2Fyc2UnLCBkZWZhdWx0VmFsdWU6IDEgfV07CiAgfQoKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLm5vdFN0YXJ0ZWQgPSB0cnVlOwogIH0KCiAgcHJvY2VzcyhpbnB1dHMsIG91dHB1dHMsIHBhcmFtZXRlcnMpIHsKICAgIGNvbnN0IGlucHV0ID0gaW5wdXRzWzBdOwogICAgY29uc3Qgb3V0cHV0ID0gb3V0cHV0c1swXTsKICAgIGNvbnN0IGNvYXJzZSA9IHBhcmFtZXRlcnMuY29hcnNlOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBvdXRwdXRbMF1bMF0gPSBpbnB1dFswXVswXTsKICAgICAgZm9yIChsZXQgbiA9IDE7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgIGZvciAobGV0IG8gPSAwOyBvIDwgb3V0cHV0Lmxlbmd0aDsgbysrKSB7CiAgICAgICAgICBvdXRwdXRbb11bbl0gPSBuICUgY29hcnNlID09IDAgPyBpbnB1dFswXVtuXSA6IG91dHB1dFtvXVtuIC0gMV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ2NvYXJzZS1wcm9jZXNzb3InLCBDb2Fyc2VQcm9jZXNzb3IpOwoKY2xhc3MgQ3J1c2hQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ2NydXNoJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBjcnVzaCA9IHBhcmFtZXRlcnMuY3J1c2g7CiAgICBjb25zdCBibG9ja1NpemUgPSAxMjg7CiAgICBjb25zdCBoYXNJbnB1dCA9ICEoaW5wdXRbMF0gPT09IHVuZGVmaW5lZCk7CiAgICBpZiAoaGFzSW5wdXQpIHsKICAgICAgdGhpcy5ub3RTdGFydGVkID0gZmFsc2U7CiAgICAgIGlmIChjcnVzaC5sZW5ndGggPT09IDEpIHsKICAgICAgICBjb25zdCB4ID0gTWF0aC5wb3coMiwgY3J1c2hbMF0gLSAxKTsKICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IE1hdGgucm91bmQoaW5wdXRbMF1bbl0gKiB4KSAvIHg7CiAgICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgICBvdXRwdXRbb11bbl0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgICAgbGV0IHggPSBNYXRoLnBvdygyLCBjcnVzaFtuXSAtIDEpOwogICAgICAgICAgY29uc3QgdmFsdWUgPSBNYXRoLnJvdW5kKGlucHV0WzBdW25dICogeCkgLyB4OwogICAgICAgICAgZm9yIChsZXQgbyA9IDA7IG8gPCBvdXRwdXQubGVuZ3RoOyBvKyspIHsKICAgICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQpyZWdpc3RlclByb2Nlc3NvcignY3J1c2gtcHJvY2Vzc29yJywgQ3J1c2hQcm9jZXNzb3IpOwoKY2xhc3MgU2hhcGVQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ3NoYXBlJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBzaGFwZTAgPSBwYXJhbWV0ZXJzLnNoYXBlWzBdOwogICAgY29uc3Qgc2hhcGUxID0gc2hhcGUwIDwgMSA/IHNoYXBlMCA6IDEuMCAtIDRlLTEwOwogICAgY29uc3Qgc2hhcGUgPSAoMi4wICogc2hhcGUxKSAvICgxLjAgLSBzaGFwZTEpOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSAoKDEgKyBzaGFwZSkgKiBpbnB1dFswXVtuXSkgLyAoMSArIHNoYXBlICogTWF0aC5hYnMoaW5wdXRbMF1bbl0pKTsKICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ3NoYXBlLXByb2Nlc3NvcicsIFNoYXBlUHJvY2Vzc29yKTsK";function ke(e){const n=C().createGain();return n.gain.value=e,n}const wt=(e,n,t,a,s,o)=>{const c=C().createGain();let r=o;c.gain.setValueAtTime(0,o),r+=e,c.gain.linearRampToValueAtTime(s,r),r+=n;let i=t*s;return c.gain.linearRampToValueAtTime(i,r),{node:c,stop:l=>(r=Math.max(l,r),c.gain.setValueAtTime(i,r),r+=a,c.gain.linearRampToValueAtTime(0,r),r)}},Jt=(e,n,t,a,s,o)=>{t=Math.max(.001,t),s=Math.max(.001,s);const c=C().createGain();return c.gain.setValueAtTime(1e-4,o),c.gain.exponentialRampToValueAtTime(s,o+e),c.gain.exponentialRampToValueAtTime(t*s,o+e+n),{node:c,stop:r=>{c.gain.exponentialRampToValueAtTime(1e-4,r+a)}}},Et=(e,n,t,a,s,o,c)=>{const r=C().createGain();return r.gain.setValueAtTime(0,o),r.gain.linearRampToValueAtTime(s,o+e),r.gain.linearRampToValueAtTime(t*s,o+e+n),r.gain.setValueAtTime(t*s,c),r.gain.linearRampToValueAtTime(0,c+a),r},Bt=(e,n,t,a,s,o,c,r,i)=>{const l=c-o,d=o+l,g=o+a*l;e.setValueAtTime(o,r),e.linearRampToValueAtTime(d,r+n),e.linearRampToValueAtTime(g,r+n+t),e.setValueAtTime(g,i),e.linearRampToValueAtTime(o,i+Math.max(s,.1))};function vt(e,n,t,a,s,o){const c={threshold:n??-3,ratio:t??10,knee:a??10,attack:s??.005,release:o??.05};return new DynamicsCompressorNode(e,c)}function le(e,n,t,a,s,o,c,r,i,l,d,g=.5){const u=e.createBiquadFilter();if(u.type=n,u.Q.value=a,u.frequency.value=t,!isNaN(i)&&i!==0){const h=i*g,I=$(2**-h*t,0,2e4),b=$(2**(i-h)*t,0,2e4);return Bt(u.frequency,s,o,c,r,I,b,l,d),u}return u}let Me=e=>e<.5?1:1-(e-.5)/.5;function Pt(e,n,t=0){const a=C();if(!t)return e;let s=a.createGain(),o=a.createGain();e.connect(s),n.connect(o),s.gain.value=Me(t),o.gain.value=Me(1-t);let c=a.createGain();return s.connect(c),o.connect(c),c}const Ce={},de={},_t=e=>Ce[e];function Gt(e,n){var t=n?1e3:1024;if(e<t)return e+" B";var a=n?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],s=-1;do e/=t,++s;while(e>=t);return e.toFixed(1)+" "+a[s]}const Tt=async(e,n,t,a,s,o,c)=>{let r=0;s!==void 0&&t!==void 0&&N("[sampler] hap has note and freq. ignoring note","warning");let i=bt({freq:s,note:t},36);r=i-36;const l=C();let d;if(Array.isArray(o))n=Ye(n,0),d=o[n%o.length];else{const I=m=>Ke(m)-i,b=Object.keys(o).filter(m=>!m.startsWith("_")).reduce((m,v,k)=>!m||Math.abs(I(v))<Math.abs(I(m))?v:m,null);r=-I(b),d=o[b][n%o[b].length]}c&&(d=await c(d));let g=await je(d,l,e,n);a<0&&(g=Rt(g));const u=l.createBufferSource();u.buffer=g;const h=1*Math.pow(2,r/12);return u.playbackRate.value=h,u},je=(e,n,t,a=0)=>{const s=t?`sound "${t}:${a}"`:"sample";if(e=e.replace("#","%23"),!de[e]){N(`[sampler] load ${s}..`,"load-sample",{url:e});const o=Date.now();de[e]=fetch(e).then(c=>c.arrayBuffer()).then(async c=>{const r=Date.now()-o,i=Gt(c.byteLength);N(`[sampler] load ${s}... done! loaded ${i} in ${r}ms`,"loaded-sample",{url:e});const l=await n.decodeAudioData(c);return Ce[e]=l,l})}return de[e]};function Rt(e){const n=C(),t=n.createBuffer(e.numberOfChannels,e.length,n.sampleRate);for(let a=0;a<e.numberOfChannels;a++)t.copyToChannel(e.getChannelData(a).slice().reverse(),a,a);return t}const $t=e=>Ce[e],Vt=(e,n,t=e._base||"")=>Object.entries(e).forEach(([a,s])=>{if(typeof s=="string"&&(s=[s]),typeof s!="object")throw new Error("wrong sample map format for "+a);t=s._base||t;const o=c=>(t+c).replace("github:","https://raw.githubusercontent.com/");Array.isArray(s)?s=s.map(o):s=Object.fromEntries(Object.entries(s).map(([c,r])=>[c,(typeof r=="string"?[r]:r).map(o)])),n(a,s)});let Oe={};function Ut(e,n){Oe[e]=n}function Xt(e){const n=Object.entries(Oe).find(([t])=>e.startsWith(t));if(n)return n[1]}const Nt=async(e,n=e._base||"",t={})=>{if(typeof e=="string"){const o=Xt(e);if(o)return o(e);if(e.startsWith("bubo:")){const[r,i]=e.split(":");e=`github:Bubobubobubobubo/dough-${i}`}if(e.startsWith("github:")){let[r,i]=e.split("github:");i=i.endsWith("/")?i.slice(0,-1):i,i.split("/").length===2&&(i+="/main"),e=`https://raw.githubusercontent.com/${i}/strudel.json`.replace("//strudel.json","/strudel.json")}if(e.startsWith("shabda:")){let[r,i]=e.split("shabda:");e=`https://shabda.ndre.gr/${i}.json?strudel=1`}if(e.startsWith("shabda/speech")){let[r,i]=e.split("shabda/speech");i=i.startsWith("/")?i.substring(1):i;let[l,d]=i.split(":"),g="f",u="en-GB";l&&([u,g]=l.split("/")),e=`https://shabda.ndre.gr/speech/${d}.json?gender=${g}&language=${u}&strudel=1'`}if(typeof fetch!="function")return;const c=e.split("/").slice(0,-1).join("/");return typeof fetch>"u"?void 0:fetch(e).then(r=>r.json()).then(r=>Nt(r,n||r._base||c,t)).catch(r=>{throw console.error(r),new Error(`error loading "${e}"`)})}const{prebake:a,tag:s}=t;Vt(e,(o,c)=>Wt(o,(r,i,l)=>Ht(r,i,l,c),{type:"sample",samples:c,baseUrl:n,prebake:a,tag:s}),n)},ze=[];async function Ht(e,n,t,a,s){let{s:o,freq:c,unit:r,nudge:i=0,cut:l,loop:d,clip:g=void 0,n:u=0,note:h,speed:I=1,loopBegin:b=0,begin:m=0,loopEnd:v=1,end:k=1,vib:j,vibmod:U=.5}=n;if(I===0)return;d=o.startsWith("wt_")?1:n.loop;const S=C(),{attack:ee=.001,decay:te=.001,sustain:ne=1,release:ae=.001}=n,x=e+i,p=await Tt(o,u,h,I,c,a,s);let G;if(j>0){G=C().createOscillator(),G.frequency.value=j;const w=C().createGain();w.gain.value=U*100,G.connect(w),w.connect(p.detune),G.start(0)}if(S.currentTime>e){N(`[sampler] still loading sound "${o}:${u}"`,"highlight");return}if(!p){N(`[sampler] could not load "${o}:${u}"`,"error");return}p.playbackRate.value=Math.abs(I)*p.playbackRate.value,r==="c"&&(p.playbackRate.value=p.playbackRate.value*p.buffer.duration*1);const F=m*p.buffer.duration;d&&(p.loop=!0,p.loopStart=b*p.buffer.duration-F,p.loopEnd=v*p.buffer.duration-F),p.start(x,F);const{node:M,stop:oe}=wt(ee,te,ne,ae,1,e);p.connect(M);const z=S.createGain();M.connect(z),p.onended=function(){p.disconnect(),G?.stop(),M.disconnect(),z.disconnect(),t()};const T={node:z,bufferSource:p,stop:(w,O=g===void 0&&d===void 0)=>{let Q=w;if(O){const q=p.buffer.duration/p.playbackRate.value;Q=e+(k-m)*q}const se=oe(Q);p.stop(se)}};if(l!==void 0){const w=ze[l];w&&(w.node.gain.setValueAtTime(1,x),w.node.gain.linearRampToValueAtTime(0,x+.01)),ze[l]=T}return T}const Ie=ct();function Wt(e,n,t={}){Ie.setKey(e,{onTrigger:n,data:t})}function ue(e){return Ie.get()[e]}const en=()=>Ie.set({});let K;const C=()=>{if(!K){K=new AudioContext;const e=K.destination.maxChannelCount;K.destination.channelCount=e}return K};let J;function Zt(){return J||(J=C().audioWorklet.addModule(yt),J)}function ge(e,n,t){const a=new AudioWorkletNode(e,n);return Object.entries(t).forEach(([s,o])=>{a.parameters.get(s).value=o}),a}async function St(e={}){const{disableWorklets:n=!1}=e;typeof window<"u"&&(await C().resume(),n?console.log("disableWorklets: AudioWorklet effects coarse, crush and shape are skipped!"):await Zt().catch(t=>{console.warn("could not load AudioWorklet effects coarse, crush and shape",t)}))}async function tn(e){return new Promise(n=>{document.addEventListener("click",async function t(){await St(e),n(),document.removeEventListener("click",t)})})}let X={},E,W;const me=(e,n=[0,1])=>{const t=C();E==null&&(E=new ChannelMergerNode(t,{numberOfInputs:t.destination.channelCount}),W=new GainNode(t),E.connect(W),W.connect(t.destination));const a=new StereoPannerNode(t);e.connect(a);const s=new ChannelSplitterNode(t,{numberOfOutputs:a.channelCount});a.connect(s),n.forEach((o,c)=>{s.connect(E,c%a.channelCount,$(o,0,t.destination.channelCount-1))})},nn=()=>{W!=null&&(W.gain.linearRampToValueAtTime(0,C().currentTime+.01),W=null)};function xt(e,n,t,a){if(t=$(t,0,.98),!X[e]){const o=C().createFeedbackDelay(1,n,t);o.start?.(a),me(o,[0,1]),X[e]=o}return X[e].delayTime.value!==n&&X[e].delayTime.setValueAtTime(n,a),X[e].feedback.value!==t&&X[e].feedback.setValueAtTime(t,a),X[e]}const R={};function Ft(e,n,t=1,a=.5,s=1e3,o=2e3){const c=C(),r=c.createGain();r.gain.value=o,R[e]==null&&(R[e]=c.createOscillator(),R[e].frequency.value=t,R[e].type="sine",R[e].start()),R[e].connect(r),R[e].frequency.value!=t&&R[e].frequency.setValueAtTime(t,n);const i=2;let l=0;const d=[];for(let g=0;g<i;g++){const u=c.createBiquadFilter();u.type="notch",u.gain.value=1,u.frequency.value=s+l,u.Q.value=2-Math.min(Math.max(a*2,0),1.9),r.connect(u.detune),l+=282,g>0&&d[g-1].connect(u),d.push(u)}return d[d.length-1]}let B={},P=(e,n)=>e!==void 0&&e!==n;function Mt(e,n,t,a,s,o){if(!B[e]){const r=C().createReverb(n,t,a,s,o);me(r,[0,1]),B[e]=r}return(P(n,B[e].duration)||P(t,B[e].fade)||P(a,B[e].lp)||P(s,B[e].dim)||B[e].ir!==o)&&B[e].generate(n,t,a,s,o),B[e]}let y,Y;function zt(e=2048){if(!y){const n=C().createAnalyser();n.fftSize=e,y=n,Y=new Float32Array(y.frequencyBinCount)}return y.fftSize!==e&&(y.fftSize=e,Y=new Float32Array(y.frequencyBinCount)),y}function Qe(e="time"){const n={time:()=>y?.getFloatTimeDomainData(Y),frequency:()=>y?.getFloatFrequencyData(Y)}[e];if(!n)throw new Error(`getAnalyzerData: ${e} not supported. use one of ${Object.keys(n).join(", ")}`);return n(),Y}function fe(e,n,t){const a=ke(t);return e.connect(a),a.connect(n),a}const Ae=async(e,n,t)=>{const a=C();if(typeof e!="object")throw new Error(`expected hap.value to be an object, but got "${e}". Hint: append .note() or .s() to the end`,"error");e.duration=t;let s=a.currentTime+n,{s:o="triangle",bank:c,source:r,gain:i=.8,postgain:l=1,density:d=.03,ftype:g="12db",fanchor:u=.5,cutoff:h,lpenv:I,lpattack:b=.01,lpdecay:m=.01,lpsustain:v=1,lprelease:k=.01,resonance:j=1,hpenv:U,hcutoff:S,hpattack:ee=.01,hpdecay:te=.01,hpsustain:ne=1,hprelease:ae=.01,hresonance:x=1,bpenv:p,bandf:G,bpattack:F=.01,bpdecay:M=.01,bpsustain:oe=1,bprelease:z=.01,bandq:be=1,channels:T=[1,2],phaser:w,phaserdepth:O=.75,phasersweep:Q,phasercenter:se,coarse:q,crush:ye,shape:we,pan:Be,vowel:ve,delay:Ge=0,delayfeedback:Te=.5,delaytime:Re=.25,orbit:re=1,room:Ve,roomfade:Pe,roomlp:_e,roomdim:$e,roomsize:Ue,ir:ce,i:Xe=0,velocity:et=1,analyze:Ne,fft:tt=8,compressor:He,compressorRatio:nt,compressorKnee:at,compressorAttack:ot,compressorRelease:st}=e;i=Ye(i,1),T=(Array.isArray(T)?T:[T]).map(f=>f-1),i*=et;let We=[];const rt=()=>{We.forEach(f=>f?.disconnect())};c&&o&&(o=`${c}_${o}`);let L;if(r)L=r(s,e,t);else if(ue(o)){const{onTrigger:f}=ue(o),V=await f(s,e,rt);V&&(L=V.node,V.stop(s+t))}else throw new Error(`sound ${o} not found! Is it loaded?`);if(!L)return;if(a.currentTime>s){N("[webaudio] skip hap: still loading",a.currentTime-s);return}const A=[];if(A.push(L),A.push(ke(i)),h!==void 0){let f=()=>le(a,"lowpass",h,j,b,m,v,k,I,s,s+t,u);A.push(f()),g==="24db"&&A.push(f())}if(S!==void 0){let f=()=>le(a,"highpass",S,x,ee,te,ne,ae,U,s,s+t,u);A.push(f()),g==="24db"&&A.push(f())}if(G!==void 0){let f=()=>le(a,"bandpass",G,be,F,M,oe,z,p,s,s+t,u);A.push(f()),g==="24db"&&A.push(f())}if(ve!==void 0){const f=a.createVowelFilter(ve);A.push(f)}if(q!==void 0&&A.push(ge(a,"coarse-processor",{coarse:q})),ye!==void 0&&A.push(ge(a,"crush-processor",{crush:ye})),we!==void 0&&A.push(ge(a,"shape-processor",{shape:we})),He!==void 0&&A.push(vt(a,He,nt,at,ot,st)),Be!==void 0){const f=a.createStereoPanner();f.pan.value=2*Be-1,A.push(f)}if(w!==void 0&&O>0){const f=Ft(re,s,w,O,se,Q);A.push(f)}const D=new GainNode(a,{gain:l});A.push(D),me(D,T);let Ze;if(Ge>0&&Re>0&&Te>0){const f=xt(re,Re,Te,s);Ze=fe(D,f,Ge)}let Se;if(Ve>0){let f;if(ce!==void 0){let ie,H=ue(ce);Array.isArray(H)?ie=H.data.samples[Xe%H.data.samples.length]:typeof H=="object"&&(ie=Object.values(H.data.samples).flat()[Xe%Object.values(H.data.samples).length]),f=await je(ie,a,ce,0)}const V=Mt(re,Ue,Pe,_e,$e,f);Se=fe(D,V,Ve)}let xe;if(Ne){const f=zt(2**(tt+5));xe=fe(D,f,Ne)}A.slice(1).reduce((f,V)=>f.connect(V),A[0]),We=A.concat([Ze,Se,xe])},an=(e,n,t,a)=>Ae(n,e-t,n.duration/a);let Z;async function Dt(e,n){const t=`dsp-worklet-${Date.now()}`,a=`${n}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${t}', MyProcessor);
`,o=`data:text/javascript;base64,${btoa(a)}`;await e.audioWorklet.addModule(o);const c=new AudioWorkletNode(e,t);return{node:c,stop:()=>c.port.postMessage("stop")}}const qe=()=>{Z&&(Z?.stop(),Z?.node?.disconnect())};typeof window<"u"&&window.addEventListener("message",e=>{e.data==="strudel-stop"?qe():e.data?.dough&&Z?.node.port.postMessage(e.data)});const on=async e=>{const n=C();qe(),Z=await Dt(n,e),Z.node.connect(n.destination)};function Kt(e,n,t,a,s){window.postMessage({time:e,dough:n.value,currentTime:t,duration:a,cps:s})}const{Pattern:Le,logger:Yt}=it;pt(Yt);const Je=e=>(e.ensureObjectValue(),{...e.value,velocity:e.context.velocity}),kt=(e,n,t,a)=>{globalThis.haps_from_outputs&&globalThis.haps_from_outputs.push(n),Ae(Je(n),e-t,n.duration/a)},jt=(e,n,t)=>{globalThis.haps_from_outputs&&globalThis.haps_from_outputs.push(e),Ae(Je(e),n,t)};Le.prototype.webaudio=function(){return this.onTrigger(kt)};function sn(e={}){e={getTime:()=>C().currentTime,defaultOutput:jt,...e};const{defaultOutput:n,getTime:t}=e;return new lt({...e,onTrigger:dt({defaultOutput:n,getTime:t})})}Le.prototype.dough=function(){return this.onTrigger(Kt,1)};function Ot(e,{align:n=!0,color:t="white",thickness:a=3,scale:s=.25,pos:o=.75,trigger:c=0}={}){const r=he(),i=Qe("time");r.lineWidth=a,r.strokeStyle=t,r.beginPath();let l=r.canvas;const d=e.frequencyBinCount;let g=n?Array.from(i).findIndex((I,b,m)=>b&&m[b-1]>-c&&I<=-c):0;g=Math.max(g,0);const u=l.width*1/d;let h=0;for(let I=g;I<d;I++){const b=i[I]+1,m=(o-s*(b-1))*l.height;I===0?r.moveTo(h,m):r.lineTo(h,m),h+=u}r.stroke()}function Qt(e,{color:n="white",scale:t=.25,pos:a=.75,lean:s=.5,min:o=-150,max:c=0}={}){const r=Qe("frequency"),i=he(),l=i.canvas;i.fillStyle=n;const d=e.frequencyBinCount,g=l.width*1/d;let u=0;for(let h=0;h<d;h++){const b=ut((r[h]-o)/(c-o),0,1)*t,m=b*l.height,v=(a-b*s)*l.height;i.fillRect(u,v,Math.max(g,1),m),u+=g}}function Ee(e=0,n="0,0,0"){const t=he();e?(t.fillStyle=`rgba(${n},${1-e})`,t.fillRect(0,0,t.canvas.width,t.canvas.height)):t.clearRect(0,0,t.canvas.width,t.canvas.height)}_.prototype.fscope=function(e={}){return this.analyze(1).draw(()=>{Ee(e.smear),y&&Qt(y,e)})};_.prototype.tscope=function(e={}){return this.analyze(1).draw(()=>{Ee(e.smear),y&&Ot(y,e)})};_.prototype.scope=_.prototype.tscope;export{Ut as A,Nt as B,Ht as C,ke as D,wt as E,Jt as F,Et as G,Bt as H,vt as I,le as J,Pt as K,N as L,pt as M,Dt as N,on as O,Kt as P,Ke as Q,Lt as R,jt as a,sn as b,Qt as c,Ot as d,en as e,C as f,ue as g,tn as h,St as i,me as j,y as k,Y as l,zt as m,Qe as n,Ae as o,nn as p,an as q,Wt as r,Ie as s,_t as t,Tt as u,je as v,kt as w,Rt as x,$t as y,Vt as z};
//# sourceMappingURL=scope.019c43c0.js.map
