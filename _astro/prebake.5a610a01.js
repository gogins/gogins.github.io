import{_ as ee}from"./settings.270953c1.js";import{n as T,P as $,w as D}from"./index.a2044bc2.js";import{f as j,J as ae,r as L,C as ne,D as Z,P as H,E as te,Q as I,z as se,y as oe,B as re,u as ie,A as E}from"./scope.f68c2f6d.js";let A={};function ce(e){const a=j();if(A[e])return A[e];const t=2*a.sampleRate,n=a.createBuffer(1,t,a.sampleRate),s=n.getChannelData(0);let r=0,i,c,l,o,g,m,u;i=c=l=o=g=m=u=0;for(let d=0;d<t;d++)if(e==="white")s[d]=Math.random()*2-1;else if(e==="brown"){let w=Math.random()*2-1;s[d]=(r+.02*w)/1.02,r=s[d]}else if(e==="pink"){let w=Math.random()*2-1;i=.99886*i+w*.0555179,c=.99332*c+w*.0750759,l=.969*l+w*.153852,o=.8665*o+w*.3104856,g=.55*g+w*.5329522,m=-.7616*m-w*.016898,s[d]=i+c+l+o+g+m+u+w*.5362,s[d]*=.11,u=w*.115926}return A[e]=n,n}function W(e="white",a){const n=j().createBufferSource();return n.buffer=ce(e),n.loop=!0,n.start(a),{node:n,stop:s=>n.stop(s)}}function we(e,a,t){const n=W("pink",t);return{node:ae(e,n.node,a),stop:r=>n?.stop(r)}}const le=(e,a=1,t="sine")=>{const n=j(),s=n.createOscillator();s.type=t,s.frequency.value=e,s.start();const r=new GainNode(n,{gain:a});return s.connect(r),{node:r,stop:i=>s.stop(i)}},ue=(e,a,t,n="sine")=>{const r=e.frequency.value*a,i=r*t;return le(r,i,n)},U=["sine","square","triangle","sawtooth"],de=["pink","white","brown"];function pe(){[...U,...de].forEach(e=>{L(e,(a,t,n)=>{let{attack:s=.001,decay:r=.05,sustain:i=.6,release:c=.01}=t,l;U.includes(e)?l=ve(e,a,t):l=W(e,a);let{node:o,stop:g,triggerRelease:m}=l;const u=ne(.3),{node:d,stop:w}=Z(s,r,i,c,1,a);return o.onended=()=>{o.disconnect(),u.disconnect(),n()},{node:o.connect(u).connect(d),stop:z=>{w(z),m?.(z);let b=z+c;g(b)}}},{type:"synth",prebake:!0})})}function fe(e,a){const t=new Float32Array(e+1),n=new Float32Array(e+1),s=j(),r=s.createOscillator(),i={sawtooth:o=>1/o,square:o=>o%2===0?0:1/o,triangle:o=>o%2===0?0:1/(o*o)};if(!i[a])throw new Error(`unknown wave type ${a}`);t[0]=0,n[0]=0;let c=1;for(;c<=e;)t[c]=i[a](c),n[c]=0,c++;const l=s.createPeriodicWave(t,n);return r.setPeriodicWave(l),r}function ve(e,a,{n:t,note:n,freq:s,vib:r=0,vibmod:i=.5,noise:c=0,fmh:l=1,fmi:o,fmenv:g="lin",fmattack:m,fmdecay:u,fmsustain:d,fmrelease:w,fmvelocity:z,fmwave:b="sine"}){j();let f;!t||e==="sine"?(f=j().createOscillator(),f.type=e||"triangle"):f=fe(t,e),n=n||36,typeof n=="string"&&(n=H(n)),!s&&typeof n=="number"&&(s=I(n)),f.frequency.value=Number(s),f.start(a);let x,M;if(o){const{node:h,stop:B}=ue(f,l,o,b);[m,u,d,w,z].find(F=>F!==void 0)?(m=m??.001,u=u??.001,d=d??1,w=w??.001,z=z??1,M=Z(m,u,d,w,z,a),g==="exp"&&(M=te(m,u,d,w,z,a),M.node.maxValue=o*2,M.node.minValue=1e-5),h.connect(M.node),M.node.connect(f.frequency)):h.connect(f.frequency),x=B}let v;if(r>0){v=j().createOscillator(),v.frequency.value=r;const h=j().createGain();h.gain.value=i*100,v.connect(h),h.connect(f.detune),v.start(a)}let p;return c&&(p=we(f,c,a)),{node:p?.node||f,stop:h=>{v?.stop(h),p?.stop(h),x?.(h),f.stop(h)},triggerRelease:h=>{M?.stop(h)}}}function _e(e=1,a=.05,t=220,n=0,s=0,r=.1,i=0,c=1,l=0,o=0,g=0,m=0,u=0,d=0,w=0,z=0,b=0,f=1,x=0,M=0){let v=Math.PI*2,p=j().sampleRate,h=V=>V>0?1:-1,B=l*=500*v/p/p,F=t*=(1+a*2*Math.random()-a)*v/p,k=[],S=0,q=0,_=0,y=1,K=0,Y=0,P=0,N,O;for(n=n*p+9,x*=p,s*=p,r*=p,b*=p,o*=500*v/p**3,w*=v/p,g*=v/p,m*=p,u=u*p|0,O=n+x+s+r+b|0;_<O;k[_++]=P)++Y%(z*100|0)||(P=i?i>1?i>2?i>3?Math.sin((S%v)**3):Math.max(Math.min(Math.tan(S),1),-1):1-(2*S/v%2+2)%2:1-4*Math.abs(Math.round(S/v)-S/v):Math.sin(S),P=(u?1-M+M*Math.sin(v*_/u):1)*h(P)*Math.abs(P)**c*e*1*(_<n?_/n:_<n+x?1-(_-n)/x*(1-f):_<n+x+s?f:_<O-b?(O-_-b)/r*f:0),P=b?P/2+(b>_?0:(_<O-b?1:(O-_)/b)*k[_-b|0]/2):P),N=(t+=l+=o)*Math.cos(w*q++),S+=N-N*d*(1-(Math.sin(_)+1)*1e9%2),y&&++y>m&&(t+=g,F+=g,y=0),u&&!(++K%u)&&(t=F,l=B,y||=1);return k}const me=(e,a)=>{let{s:t,note:n=36,freq:s,zrand:r=0,attack:i=0,decay:c=0,sustain:l=.8,release:o=.1,curve:g=1,slide:m=0,deltaSlide:u=0,pitchJump:d=0,pitchJumpTime:w=0,lfo:z=0,znoise:b=0,zmod:f=0,zcrush:x=0,zdelay:M=0,tremolo:v=0,duration:p=.2,zzfx:h}=e;const B=Math.max(p-i-c,0);typeof n=="string"&&(n=H(n)),!s&&typeof n=="number"&&(s=I(n)),t=t.replace("z_","");const F=["sine","triangle","sawtooth","tan","noise"].indexOf(t)||0;g=t==="square"?0:g;const S=_e(...h||[.25,r,s,i,B,o,F,g,m,u,d,w,z,b,f,x,M,l,c,v]),q=j(),_=q.createBuffer(1,S.length,q.sampleRate);_.getChannelData(0).set(S);const y=j().createBufferSource();return y.buffer=_,y.start(a),{node:y}};function he(){["zzfx","z_sine","z_sawtooth","z_triangle","z_square","z_tan","z_noise"].forEach(e=>{L(e,(a,t,n)=>{const{node:s}=me({s:e,...t},a);return s.onended=()=>{s.disconnect(),n()},{node:s,stop:()=>{}}},{type:"synth",prebake:!0})})}const ge=T("C8"),be=(e,a)=>e*a+(1-a)/2;$.prototype.piano=function(){return this.clip(1).s("piano").release(.1).fmap(e=>{const a=D(e),t=be(Math.min(Math.round(a)/ge,1),.5);return{...e,pan:(e.pan||1)*t}})};let X;typeof window<"u"&&(X=window?.__TAURI__);const{BaseDirectory:ze,readDir:Me,readBinaryFile:je,writeTextFile:xe,readTextFile:Se,exists:ye}=X?.fs||{},R=ze?.Audio,J="~/music/";async function Pe(e){return ye(e+"/strudel.json",{dir:R})}async function Fe(e){const a=await Se(e+"/strudel.json",{dir:R}),t=JSON.parse(a);oe(t,(n,s)=>{L(n,(r,i,c)=>re(r,i,c,s,Ee(e)),{type:"sample",samples:s,fileSystem:!0,tag:"local"})})}async function Oe(e){const a=await Me(e,{dir:R,recursive:!0}),n={name:e.split("/").slice(-1)[0],children:a};let s={},r=0;G(n,(l,o)=>{["wav","mp3"].includes(l.name.split(".").slice(-1)[0])&&(s[o.name]=s[o.name]||[],r+=1,s[o.name].push(l.subpath.slice(1).concat([l.name]).join("/")))});const i=JSON.stringify(s,null,2),c=e+"/strudel.json";await xe(c,i,{dir:R}),console.log(`wrote strudel.json with ${r} samples to ${e}!`)}se(J,async e=>{const a=e.replace(J,"");return await Pe(a)||await Oe(a),Fe(a)});const G=(e,a)=>{if(Array.isArray(e?.children))for(const t of e.children)t.subpath=(e.subpath||[]).concat([e.name]),a(t,e),t.children&&G(t,a)},Ae=e=>["wav","mp3"].includes(e.split(".").slice(-1)[0]);function Be(e){const a=new Blob([e],{type:"audio/*"});return URL.createObjectURL(a)}const C={};async function Q(e){return C[e]||(C[e]=(async()=>{const a=await je(e,{dir:R});return Be(a)})()),C[e]}const Ee=e=>a=>Q(e.endsWith("/")?e+a:e+"/"+a);async function Le(e){const a=await Q(e),t=j(),n=t.createBufferSource();n.buffer=await ie(a,t),n.connect(t.destination),n.start(t.currentTime)}async function Ue(){await Promise.all([pe(),he(),ee(()=>import("./index.56cc1610.js"),["_astro/index.56cc1610.js","_astro/index.a2044bc2.js","_astro/index.3d4af9ee.js","_astro/scope.f68c2f6d.js"]).then(({registerSoundfonts:e})=>e()),E("./piano.json","./piano/",{prebake:!0}),E("./vcsl.json","github:sgossner/VCSL/master/",{prebake:!0}),E("./tidal-drum-machines.json","github:ritchse/tidal-drum-machines/main/machines/",{prebake:!0,tag:"drum-machines"}),E("./EmuSP12.json","./EmuSP12/",{prebake:!0,tag:"drum-machines"}),E({casio:["casio/high.wav","casio/low.wav","casio/noise.wav"],crow:["crow/000_crow.wav","crow/001_crow2.wav","crow/002_crow3.wav","crow/003_crow4.wav"],insect:["insect/000_everglades_conehead.wav","insect/001_robust_shieldback.wav","insect/002_seashore_meadow_katydid.wav"],wind:["wind/000_wind1.wav","wind/001_wind10.wav","wind/002_wind2.wav","wind/003_wind3.wav","wind/004_wind4.wav","wind/005_wind5.wav","wind/006_wind6.wav","wind/007_wind7.wav","wind/008_wind8.wav","wind/009_wind9.wav"],jazz:["jazz/000_BD.wav","jazz/001_CB.wav","jazz/002_FX.wav","jazz/003_HH.wav","jazz/004_OH.wav","jazz/005_P1.wav","jazz/006_P2.wav","jazz/007_SN.wav"],metal:["metal/000_0.wav","metal/001_1.wav","metal/002_2.wav","metal/003_3.wav","metal/004_4.wav","metal/005_5.wav","metal/006_6.wav","metal/007_7.wav","metal/008_8.wav","metal/009_9.wav"],east:["east/000_nipon_wood_block.wav","east/001_ohkawa_mute.wav","east/002_ohkawa_open.wav","east/003_shime_hi.wav","east/004_shime_hi_2.wav","east/005_shime_mute.wav","east/006_taiko_1.wav","east/007_taiko_2.wav","east/008_taiko_3.wav"],space:["space/000_0.wav","space/001_1.wav","space/002_11.wav","space/003_12.wav","space/004_13.wav","space/005_14.wav","space/006_15.wav","space/007_16.wav","space/008_17.wav","space/009_18.wav","space/010_2.wav","space/011_3.wav","space/012_4.wav","space/013_5.wav","space/014_6.wav","space/015_7.wav","space/016_8.wav","space/017_9.wav"],numbers:["numbers/0.wav","numbers/1.wav","numbers/2.wav","numbers/3.wav","numbers/4.wav","numbers/5.wav","numbers/6.wav","numbers/7.wav","numbers/8.wav"]},"github:tidalcycles/Dirt-Samples/master/")])}const Re=T("C8"),ke=(e,a)=>e*a+(1-a)/2;$.prototype.piano=function(){return this.fmap(e=>({...e,clip:e.clip??1})).s("piano").release(.1).fmap(e=>{const a=D(e),t=ke(Math.min(Math.round(a)/Re,1),.5);return{...e,pan:(e.pan||1)*t}})};export{me as a,he as b,Me as c,R as d,Ue as e,ve as g,Ae as i,Le as p,pe as r,fe as w};
//# sourceMappingURL=prebake.5a610a01.js.map
