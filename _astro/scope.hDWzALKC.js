import{J as gt,K as mt,L as yt,M as vt,P as U,e as wt,g as ge,N as bt}from"./index.DeKTR5mX.js";if(typeof DelayNode<"u"){class e extends DelayNode{constructor(n,o,s,a){super(n),o=Math.abs(o),this.delayTime.value=s;const i=n.createGain();i.gain.value=Math.min(Math.abs(a),.995),this.feedback=i.gain;const r=n.createGain();return r.gain.value=o,this.delayGain=r,this.connect(i),this.connect(r),i.connect(this),this.connect=c=>r.connect(c),this}start(n){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,n+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(t,n,o){return new e(this,t,n,o)}}var me={};me.generateReverb=function(e,t){for(var n=e.audioContext||new AudioContext,o=n.sampleRate,s=e.numChannels||2,a=e.decayTime*1.5,i=Math.round(e.decayTime*o),r=Math.round(a*o),c=Math.round((e.fadeInTime||0)*o),u=Math.pow(1/1e3,1/i),l=n.createBuffer(s,r,o),d=0;d<s;d++){for(var f=l.getChannelData(d),p=0;p<r;p++)f[p]=Ct()*Math.pow(u,p);for(var p=0;p<c;p++)f[p]*=p/c}Tt(l,e.lpFreqStart||0,e.lpFreqEnd||0,e.decayTime,t)};me.generateGraph=function(e,t,n,o,s){var a=document.createElement("canvas");a.width=t,a.height=n;var i=a.getContext("2d");i.fillStyle="#000",i.fillRect(0,0,a.width,a.height),i.fillStyle="#fff";for(var r=t/e.length,c=n/(s-o),u=0;u<e.length;u++)i.fillRect(u*r,n-(e[u]-o)*c,1,1);return a};var Tt=function(e,t,n,o,s){if(t==0){s(e);return}var a=qt(e),i=new OfflineAudioContext(e.numberOfChannels,a[0].length,e.sampleRate),r=i.createBufferSource();r.buffer=e;var c=i.createBiquadFilter();t=Math.min(t,e.sampleRate/2),n=Math.min(n,e.sampleRate/2),c.type="lowpass",c.Q.value=1e-4,c.frequency.setValueAtTime(t,0),c.frequency.linearRampToValueAtTime(n,o),r.connect(c),c.connect(i.destination),r.start(),i.oncomplete=function(u){s(u.renderedBuffer)},i.startRendering(),window.filterNode=c},qt=function(e){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);return t},Ct=function(){return Math.random()*2-1};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(e,t){const n=t.sampleRate*e,o=this.createBuffer(t.numberOfChannels,t.length,t.sampleRate);for(let s=0;s<t.numberOfChannels;s++){let a=t.getChannelData(s),i=o.getChannelData(s);for(let r=0;r<n;r++)i[r]=a[r]||0}return o},AudioContext.prototype.createReverb=function(e,t,n,o,s){const a=this.createConvolver();return a.generate=(i=2,r=.1,c=15e3,u=1e3,l)=>{a.duration=i,a.fade=r,a.lp=c,a.dim=u,a.ir=l,l?a.buffer=this.adjustLength(i,l):me.generateReverb({audioContext:this,numChannels:2,decayTime:i,fadeInTime:r,lpFreqStart:c,lpFreqEnd:u},d=>{a.buffer=d})},a.generate(e,t,n,o,s),a});var _e={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},ae:{freqs:[650,1515,2400,3e3,3350],gains:[1,.5,.1008,.0631,.0126],qs:[80,90,120,130,140]},aa:{freqs:[560,900,2570,3e3,3300],gains:[1,.5,.0708,.0631,.0126],qs:[80,90,120,130,140]},oe:{freqs:[500,1430,2300,3e3,3300],gains:[1,.2,.0708,.0316,.01995],qs:[40,60,100,120,120]},ue:{freqs:[250,1750,2150,3200,3300],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},y:{freqs:[400,1460,2400,3e3,3300],gains:[1,.2,.0708,.0316,.02995],qs:[40,60,100,120,120]},uh:{freqs:[600,1250,2100,3100,3500],gains:[1,.3,.0608,.0316,.01995],qs:[40,70,100,120,130]},un:{freqs:[500,1240,2280,3e3,3500],gains:[1,.1,.1708,.0216,.02995],qs:[40,60,100,120,120]},en:{freqs:[600,1480,2450,3200,3300],gains:[1,.15,.0708,.0316,.02995],qs:[40,60,100,120,120]},an:{freqs:[700,1050,2500,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},on:{freqs:[500,1080,2350,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},get æ(){return this.ae},get ø(){return this.oe},get ɑ(){return this.aa},get å(){return this.aa},get ö(){return this.oe},get ü(){return this.ue},get ı(){return this.y}};if(typeof GainNode<"u"){class e extends GainNode{constructor(n,o){if(super(n),!_e[o])throw new Error("vowel: unknown vowel "+o);const{gains:s,qs:a,freqs:i}=_e[o],r=n.createGain();for(let c=0;c<5;c++){const u=n.createGain();u.gain.value=s[c];const l=n.createBiquadFilter();l.type="bandpass",l.Q.value=a[c],l.frequency.value=i[c],this.connect(l),l.connect(u),u.connect(r)}return r.gain.value=8,this.connect=c=>r.connect(c),this}}AudioContext.prototype.createVowelFilter=function(t){return new e(this,t)}}let ze=e=>console.log(e);const N=(...e)=>ze(...e),At=e=>{ze=e},St=e=>{if(typeof e!="string")return[];const[t,n="",o]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return t?[t,n,o?Number(o):void 0]:[]},Bt={c:0,d:2,e:4,f:5,g:7,a:9,b:11},kt={"#":1,b:-1,s:1,f:-1},Ie=(e,t=3)=>{const[n,o,s=t]=St(e);if(!n)throw new Error('not a note: "'+e+'"');const a=Bt[n.toLowerCase()],i=o?.split("").reduce((r,c)=>r+kt[c],0)||0;return(Number(s)+1)*12+a+i},ln=e=>Math.pow(2,(e-69)/12)*440,ee=(e,t,n)=>Math.min(Math.max(e,t),n),xt=e=>12*Math.log(e/440)/Math.LN2+69,Rt=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:o}=e;if(typeof n=="number")return xt(n);if(typeof o=="string")return Ie(o);if(typeof o=="number")return o;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t};function R(e,t=0,n){return isNaN(Number(e))?(!n&&N(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const Gt=(e,t)=>(e%t+t)%t,je=(e,t)=>Gt(Math.round(R(e,0)),t),$t="/_astro/worklets.8cu9lfRY.mjs";function He(e){const t=b().createGain();return t.gain.value=e,t}const Pe=(e,t,n,o)=>o-n===0?0:(t-e)/(o-n),oe=(e,t,n,o,s,a,i,r,c,u="exponential")=>{t=R(t),n=R(n),o=R(o),s=R(s);const l=u==="exponential"?"exponentialRampToValueAtTime":"linearRampToValueAtTime";u==="exponential"&&(a=a===0?.001:a,i=i===0?.001:i);const d=i-a,f=i,p=a+o*d,g=c-r,y=v=>{let h;if(t>v){let q=Pe(a,f,0,t);h=v*q+(a>f?a:0)}else h=(v-t)*Pe(f,p,0,n)+f;return u==="exponential"&&(h=h||.001),h};e.setValueAtTime(a,r),t>g?e[l](y(g),c):t+n>g?(e[l](y(t),r+t),e[l](y(g),c)):(e[l](y(t),r+t),e[l](y(t+n),r+t+n),e.setValueAtTime(p,c)),e[l](a,c+s)};function Et(e,t,n,o,s,a){const i={threshold:t??-3,ratio:n??10,knee:o??10,attack:s??.005,release:a??.05};return new DynamicsCompressorNode(e,i)}const ae=(e,t="linear",n)=>{const[i,r,c,u]=e;if(i==null&&r==null&&c==null&&u==null)return n??[.001,.001,1,.01];const l=c??(i!=null&&r==null||i==null&&r==null?1:.001);return[Math.max(i??0,.001),Math.max(r??0,.001),Math.min(l,1),Math.max(u??0,.01)]};function fe(e,t,n,o,s,a,i,r,c,u,l,d){const f="exponential",[p,g,y,v]=ae([s,a,i,r],f,[.005,.14,0,.1]),h=e.createBiquadFilter();if(h.type=t,h.Q.value=o,h.frequency.value=n,(s??a??i??r??c)!==void 0){c=R(c,1,!0),d=R(d,0,!0);const S=Math.abs(c),A=S*d;let k=ee(2**-A*n,0,2e4),x=ee(2**(S-A)*n,0,2e4);return c<0&&([k,x]=[x,k]),oe(h.frequency,p,g,y,v,k,x,u,l,f),h}return h}let Ve=e=>e<.5?1:1-(e-.5)/.5;function un(e,t,n=0){const o=b();if(!n)return e;let s=o.createGain(),a=o.createGain();e.connect(s),t.connect(a),s.gain.value=Ve(n),a.gain.value=Ve(1-n);let i=o.createGain();return s.connect(i),a.connect(i),i}let Mt=["linear","exponential"];function Ot(e,t,n,o){if(!(t.pattack??t.pdecay??t.psustain??t.prelease??t.penv))return;const a=R(t.penv,1,!0),i=Mt[t.pcurve??0];let[r,c,u,l]=ae([t.pattack,t.pdecay,t.psustain,t.prelease],i,[.2,.001,1,.001]),d=t.panchor??u;const f=a*100,p=0-f*d,g=f-f*d;oe(e,r,c,u,l,p,g,n,o,i)}function Nt(e,t,n){const{vibmod:o=.5,vib:s}=t;let a;if(s>0){a=b().createOscillator(),a.frequency.value=s;const i=b().createGain();return i.gain.value=o*100,a.connect(i),i.connect(e),a.start(n),a}}function fn(e,t,n,o){const s=e.createConstantSource();s.start(n),s.stop(o),s.onended=()=>{t()}}const Dt=(e,t=1,n="sine")=>{const o=b(),s=o.createOscillator();s.type=n,s.frequency.value=e,s.start();const a=new GainNode(o,{gain:t});return s.connect(a),{node:a,stop:i=>s.stop(i)}},Wt=(e,t,n,o="sine")=>{const a=e.value*t,i=a*n;return Dt(a,i,o)};function dn(e,t,n){const{fmh:o=1,fmi:s,fmenv:a="exp",fmattack:i,fmdecay:r,fmsustain:c,fmrelease:u,fmvelocity:l,fmwave:d="sine",duration:f}=t;let p,g=()=>{};if(s){const v=b().createGain(),h=Wt(e,o,s,d);if(p=h.node,g=h.stop,![i,r,c,u,l].find(q=>q!==void 0))p.connect(e);else{const[q,S,A,k]=ae([i,r,c,u]),x=n+f;oe(v.gain,q,S,A,k,0,1,n,x,a==="exp"?"exponential":"linear"),p.connect(v),v.connect(e)}}return{stop:g}}const ye={},de={},hn=e=>ye[e];function Ft(e,t){var n=t?1e3:1024;if(e<n)return e+" B";var o=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],s=-1;do e/=n,++s;while(e>=n);return e.toFixed(1)+" "+o[s]}const _t=async(e,t,n,o,s,a,i)=>{let r=0;s!==void 0&&n!==void 0&&N("[sampler] hap has note and freq. ignoring note","warning");let c=Rt({freq:s,note:n},36);r=c-36;const u=b();let l,d=0;if(Array.isArray(a))d=je(t,a.length),l=a[d];else{const y=h=>Ie(h)-c,v=Object.keys(a).filter(h=>!h.startsWith("_")).reduce((h,q,S)=>!h||Math.abs(y(q))<Math.abs(y(h))?q:h,null);r=-y(v),d=je(t,a[v].length),l=a[v][d]}i&&(l=await i(l));let f=await Ke(l,u,e,d);o<0&&(f=jt(f));const p=u.createBufferSource();p.buffer=f;const g=1*Math.pow(2,r/12);return p.playbackRate.value=g,p},Ke=(e,t,n,o=0)=>{const s=n?`sound "${n}:${o}"`:"sample";if(e=e.replace("#","%23"),!de[e]){N(`[sampler] load ${s}..`,"load-sample",{url:e});const a=Date.now();de[e]=fetch(e).then(i=>i.arrayBuffer()).then(async i=>{const r=Date.now()-a,c=Ft(i.byteLength);N(`[sampler] load ${s}... done! loaded ${c} in ${r}ms`,"loaded-sample",{url:e});const u=await t.decodeAudioData(i);return ye[e]=u,u})}return de[e]};function jt(e){const t=b(),n=t.createBuffer(e.numberOfChannels,e.length,t.sampleRate);for(let o=0;o<e.numberOfChannels;o++)n.copyToChannel(e.getChannelData(o).slice().reverse(),o,o);return n}const pn=e=>ye[e];function Qe(e){if(e.startsWith("bubo:")){const[t,n]=e.split(":");e=`github:Bubobubobubobubo/dough-${n}`}return e}function Ye(e,t=""){if(!e.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[n,o]=e.split("github:");return o=o.endsWith("/")?o.slice(0,-1):o,o.split("/").length===2&&(o+="/main"),`https://raw.githubusercontent.com/${o}/${t}`}const Pt=(e,t,n=e._base||"")=>Object.entries(e).forEach(([o,s])=>{if(typeof s=="string"&&(s=[s]),typeof s!="object")throw new Error("wrong sample map format for "+o);n=s._base||n,n=Qe(n),n.startsWith("github:")&&(n=Ye(n,""));const a=i=>n+i;Array.isArray(s)?s=s.map(a):s=Object.fromEntries(Object.entries(s).map(([i,r])=>[i,(typeof r=="string"?[r]:r).map(a)])),t(o,s)});let Je={};function gn(e,t){Je[e]=t}function Vt(e){const t=Object.entries(Je).find(([n])=>e.startsWith(n));if(t)return t[1]}const Lt=async(e,t=e._base||"",n={})=>{if(typeof e=="string"){const a=Vt(e);if(a)return a(e);if(e=Qe(e),e.startsWith("github:")&&(e=Ye(e,"strudel.json")),e.startsWith("local:")&&(e="http://localhost:5432"),e.startsWith("shabda:")){let[r,c]=e.split("shabda:");e=`https://shabda.ndre.gr/${c}.json?strudel=1`}if(e.startsWith("shabda/speech")){let[r,c]=e.split("shabda/speech");c=c.startsWith("/")?c.substring(1):c;let[u,l]=c.split(":"),d="f",f="en-GB";u&&([f,d]=u.split("/")),e=`https://shabda.ndre.gr/speech/${l}.json?gender=${d}&language=${f}&strudel=1'`}if(typeof fetch!="function")return;const i=e.split("/").slice(0,-1).join("/");return typeof fetch>"u"?void 0:fetch(e).then(r=>r.json()).then(r=>Lt(r,t||r._base||i,n)).catch(r=>{throw console.error(r),new Error(`error loading "${e}"`)})}const{prebake:o,tag:s}=n;Pt(e,(a,i)=>It(a,(r,c,u)=>zt(r,c,u,i),{type:"sample",samples:i,baseUrl:t,prebake:o,tag:s}),t)},Le=[];async function zt(e,t,n,o,s){let{s:a,freq:i,unit:r,nudge:c=0,cut:u,loop:l,clip:d=void 0,n:f=0,note:p,speed:g=1,loopBegin:y=0,begin:v=0,loopEnd:h=1,end:q=1,duration:S}=t;if(g===0)return;l=a.startsWith("wt_")?1:t.loop;const A=b();let[k,x,se,K]=ae([t.attack,t.decay,t.sustain,t.release]);const j=e+c,w=await _t(a,f,p,g,i,o,s);let Q=Nt(w.detune,t,e);if(A.currentTime>e){N(`[sampler] still loading sound "${a}:${f}"`,"highlight");return}if(!w){N(`[sampler] could not load "${a}:${f}"`,"error");return}w.playbackRate.value=Math.abs(g)*w.playbackRate.value,r==="c"&&(w.playbackRate.value=w.playbackRate.value*w.buffer.duration*1);const P=v*w.buffer.duration;l&&(w.loop=!0,w.loopStart=y*w.buffer.duration-P,w.loopEnd=h*w.buffer.duration-P),w.start(j,P);const re=A.createGain(),V=w.connect(re);if(d==null&&l==null&&t.release==null){const G=w.buffer.duration/w.playbackRate.value;S=(q-v)*G}let L=e+S;oe(V.gain,k,x,se,K,0,1,e,L,"linear"),Ot(w.detune,t,e,L);const z=A.createGain();V.connect(z),w.onended=function(){w.disconnect(),Q?.stop(),V.disconnect(),z.disconnect(),n()};let M=L+K+.01;w.stop(M);const I={node:z,bufferSource:w,stop:(G,Te)=>{}};if(u!==void 0){const G=Le[u];G&&(G.node.gain.setValueAtTime(1,j),G.node.gain.linearRampToValueAtTime(0,j+.01)),Le[u]=I}return I}const ve=gt();function It(e,t,n={}){ve.setKey(e,{onTrigger:t,data:n})}function he(e){return ve.get()[e]}const mn=()=>ve.set({});let te;const Ht=()=>(te=new AudioContext,te),b=()=>te||Ht();let J;function Kt(){return J||(J=b().audioWorklet.addModule($t),J)}function X(e,t,n,o){const s=new AudioWorkletNode(e,t,o);return Object.entries(n).forEach(([a,i])=>{s.parameters.get(a).value=i}),s}async function Qt(e={}){const{disableWorklets:t=!1}=e;typeof window<"u"&&(await b().resume(),t?console.log("disableWorklets: AudioWorklet effects coarse, crush and shape are skipped!"):await Kt().catch(n=>{console.warn("could not load AudioWorklet effects coarse, crush and shape",n)}))}async function yn(e){return new Promise(t=>{document.addEventListener("click",async function n(){await Qt(e),t(),document.removeEventListener("click",n)})})}let E={},ne,W;function Yt(){const e=b(),t=e.destination.maxChannelCount;e.destination.channelCount=t,ne=new ChannelMergerNode(e,{numberOfInputs:e.destination.channelCount}),W=new GainNode(e),ne.connect(W),W.connect(e.destination)}const we=(e,t=[0,1])=>{const n=b();ne==null&&Yt();const o=new StereoPannerNode(n);e.connect(o);const s=new ChannelSplitterNode(n,{numberOfOutputs:o.channelCount});o.connect(s),t.forEach((a,i)=>{s.connect(ne,i%o.channelCount,ee(a,0,n.destination.channelCount-1))})},vn=()=>{W!=null&&(W.gain.linearRampToValueAtTime(0,b().currentTime+.01),W=null)};function Jt(e,t,n,o){if(n=ee(n,0,.98),!E[e]){const a=b().createFeedbackDelay(1,t,n);a.start?.(o),we(a,[0,1]),E[e]=a}return E[e].delayTime.value!==t&&E[e].delayTime.setValueAtTime(t,o),E[e].feedback.value!==n&&E[e].feedback.setValueAtTime(n,o),E[e]}const $={};function Xt(e,t,n=1,o=.5,s=1e3,a=2e3){const i=b(),r=i.createGain();r.gain.value=a,$[e]==null&&($[e]=i.createOscillator(),$[e].frequency.value=n,$[e].type="sine",$[e].start()),$[e].connect(r),$[e].frequency.value!=n&&$[e].frequency.setValueAtTime(n,t);const c=2;let u=0;const l=[];for(let d=0;d<c;d++){const f=i.createBiquadFilter();f.type="notch",f.gain.value=1,f.frequency.value=s+u,f.Q.value=2-Math.min(Math.max(o*2,0),1.9),r.connect(f.detune),u+=282,d>0&&l[d-1].connect(f),l.push(f)}return l[l.length-1]}let B={},Z=(e,t)=>e!==void 0&&e!==t;function Zt(e,t,n,o,s,a){if(!B[e]){const r=b().createReverb(t,n,o,s,a);we(r,[0,1]),B[e]=r}return(Z(t,B[e].duration)||Z(n,B[e].fade)||Z(o,B[e].lp)||Z(s,B[e].dim)||B[e].ir!==a)&&B[e].generate(t,n,o,s,a),B[e]}let C={},F={};function Ut(e,t=1024){if(!C[e]){const n=b().createAnalyser();n.fftSize=t,C[e]=n,F[e]=new Float32Array(C[e].frequencyBinCount)}return C[e].fftSize!==t&&(C[e].fftSize=t,F[e]=new Float32Array(C[e].frequencyBinCount)),C[e]}function Xe(e="time",t=1){const n={time:()=>C[t]?.getFloatTimeDomainData(F[t]),frequency:()=>C[t]?.getFloatFrequencyData(F[t])}[e];if(!n)throw new Error(`getAnalyzerData: ${e} not supported. use one of ${Object.keys(n).join(", ")}`);return n(),F[t]}function pe(e,t,n){const o=He(n);return e.connect(o),o.connect(t),o}function wn(){E={},B={},C={},F={}}const be=async(e,t,n)=>{const o=b();if(typeof e!="object")throw new Error(`expected hap.value to be an object, but got "${e}". Hint: append .note() or .s() to the end`,"error");e.duration=n,t=typeof t=="string"&&t.startsWith("=")?Number(t.slice(1)):o.currentTime+t;let{s="triangle",bank:a,source:i,gain:r=.8,postgain:c=1,density:u=.03,ftype:l="12db",fanchor:d=.5,cutoff:f,lpenv:p,lpattack:g,lpdecay:y,lpsustain:v,lprelease:h,resonance:q=1,hpenv:S,hcutoff:A,hpattack:k,hpdecay:x,hpsustain:se,hprelease:K,hresonance:j=1,bpenv:w,bandf:Q,bpattack:P,bpdecay:re,bpsustain:V,bprelease:L,bandq:z=1,channels:M=[1,2],phaser:ie,phaserdepth:I=.75,phasersweep:G,phasercenter:Te,coarse:qe,crush:Ce,shape:Ae,shapevol:nt=1,distort:Se,distortvol:ot=1,pan:Be,vowel:ke,delay:xe=0,delayfeedback:Re=.5,delaytime:Ge=.25,orbit:ce=1,room:$e,roomfade:at,roomlp:st,roomdim:rt,roomsize:it,ir:le,i:Ee=0,velocity:ct=1,analyze:Me,fft:lt=8,compressor:Oe,compressorRatio:ut,compressorKnee:ft,compressorAttack:dt,compressorRelease:ht}=e;r=R(r,1),M=(Array.isArray(M)?M:[M]).map(m=>m-1),r*=ct;let Ne=[];const pt=()=>{Ne.forEach(m=>m?.disconnect())};a&&s&&(s=`${a}_${s}`);let Y;if(i)Y=i(t,e,n);else if(he(s)){const{onTrigger:m}=he(s),O=await m(t,e,pt);O&&(Y=O.node,O.stop(t+n))}else throw new Error(`sound ${s} not found! Is it loaded?`);if(!Y)return;if(o.currentTime>t){N("[webaudio] skip hap: still loading",o.currentTime-t);return}const T=[];if(T.push(Y),T.push(He(r)),f!==void 0){let m=()=>fe(o,"lowpass",f,q,g,y,v,h,p,t,t+n,d);T.push(m()),l==="24db"&&T.push(m())}if(A!==void 0){let m=()=>fe(o,"highpass",A,j,k,x,se,K,S,t,t+n,d);T.push(m()),l==="24db"&&T.push(m())}if(Q!==void 0){let m=()=>fe(o,"bandpass",Q,z,P,re,V,L,w,t,t+n,d);T.push(m()),l==="24db"&&T.push(m())}if(ke!==void 0){const m=o.createVowelFilter(ke);T.push(m)}if(qe!==void 0&&T.push(X(o,"coarse-processor",{coarse:qe})),Ce!==void 0&&T.push(X(o,"crush-processor",{crush:Ce})),Ae!==void 0&&T.push(X(o,"shape-processor",{shape:Ae,postgain:nt})),Se!==void 0&&T.push(X(o,"distort-processor",{distort:Se,postgain:ot})),Oe!==void 0&&T.push(Et(o,Oe,ut,ft,dt,ht)),Be!==void 0){const m=o.createStereoPanner();m.pan.value=2*Be-1,T.push(m)}if(ie!==void 0&&I>0){const m=Xt(ce,t,ie,I,Te,G);T.push(m)}const H=new GainNode(o,{gain:c});T.push(H),we(H,M);let De;if(xe>0&&Ge>0&&Re>0){const m=Jt(ce,Ge,Re,t);De=pe(H,m,xe)}let We;if($e>0){let m;if(le!==void 0){let ue,D=he(le);Array.isArray(D)?ue=D.data.samples[Ee%D.data.samples.length]:typeof D=="object"&&(ue=Object.values(D.data.samples).flat()[Ee%Object.values(D.data.samples).length]),m=await Ke(ue,o,le,0)}const O=Zt(ce,it,at,st,rt,m);We=pe(H,O,$e)}let Fe;if(Me){const m=Ut(Me,2**(lt+5));Fe=pe(H,m,1)}T.slice(1).reduce((m,O)=>m.connect(O),T[0]),Ne=T.concat([De,We,Fe])},bn=(e,t,n,o)=>be(t,e-n,t.duration/o);let _;async function en(e,t){const n=`dsp-worklet-${Date.now()}`,o=`${t}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${n}', MyProcessor);
`,a=`data:text/javascript;base64,${btoa(o)}`;await e.audioWorklet.addModule(a);const i=new AudioWorkletNode(e,n);return{node:i,stop:()=>i.port.postMessage("stop")}}const Ze=()=>{_&&(_?.stop(),_?.node?.disconnect())};typeof window<"u"&&window.addEventListener("message",e=>{e.data==="strudel-stop"?Ze():e.data?.dough&&_?.node.port.postMessage(e.data)});const Tn=async e=>{const t=b();Ze(),_=await en(t,e),_.node.connect(t.destination)};function tn(e,t,n,o,s){window.postMessage({time:e,dough:t.value,currentTime:n,duration:o,cps:s})}const{Pattern:Ue,logger:nn}=mt;At(nn);const et=e=>(e.ensureObjectValue(),e.value),on=(e,t,n,o)=>be(et(t),e-n,t.duration/o),an=(e,t,n,o,s)=>be(et(e),s?`=${s}`:t,n);Ue.prototype.webaudio=function(){return this.onTrigger(on)};function qn(e={}){e={getTime:()=>b().currentTime,defaultOutput:an,...e};const{defaultOutput:t,getTime:n}=e;return new yt({...e,onTrigger:vt({defaultOutput:t,getTime:n})})}Ue.prototype.dough=function(){return this.onTrigger(tn,1)};function sn(e,{align:t=!0,color:n="white",thickness:o=3,scale:s=.25,pos:a=.75,trigger:i=0,ctx:r=ge(),id:c=1}={}){r.lineWidth=o,r.strokeStyle=n;let u=r.canvas;if(!e){r.beginPath();let y=a*u.height;r.moveTo(0,y),r.lineTo(u.width,y),r.stroke();return}const l=Xe("time",c);r.beginPath();const d=e.frequencyBinCount;let f=t?Array.from(l).findIndex((y,v,h)=>v&&h[v-1]>-i&&y<=-i):0;f=Math.max(f,0);const p=u.width*1/d;let g=0;for(let y=f;y<d;y++){const v=l[y]+1,h=(a-s*(v-1))*u.height;y===0?r.moveTo(g,h):r.lineTo(g,h),g+=p}r.stroke()}function rn(e,{color:t="white",scale:n=.25,pos:o=.75,lean:s=.5,min:a=-150,max:i=0,ctx:r=ge(),id:c=1}={}){if(!e){r.beginPath();let g=o*l.height;r.moveTo(0,g),r.lineTo(l.width,g),r.stroke();return}const u=Xe("frequency",c),l=r.canvas;r.fillStyle=t;const d=e.frequencyBinCount,f=l.width*1/d;let p=0;for(let g=0;g<d;g++){const v=bt((u[g]-a)/(i-a),0,1)*n,h=v*l.height,q=(o-v*s)*l.height;r.fillRect(p,q,Math.max(f,1),h),p+=f}}function tt(e=0,t="0,0,0",n=ge()){e?(n.fillStyle=`rgba(${t},${1-e})`,n.fillRect(0,0,n.canvas.width,n.canvas.height)):n.clearRect(0,0,n.canvas.width,n.canvas.height)}U.prototype.fscope=function(e={}){let t=e.id??1;return this.analyze(t).draw(()=>{tt(e.smear,"0,0,0",e.ctx),C[t]&&rn(C[t],e)},{id:t})};U.prototype.tscope=function(e={}){let t=e.id??1;return this.analyze(t).draw(n=>{e.color=n[0]?.value?.color||wt().foreground,e.color,tt(e.smear,"0,0,0",e.ctx),sn(C[t],e)},{id:t})};U.prototype.scope=U.prototype.tscope;export{Yt as A,on as B,qn as C,sn as D,rn as E,he as F,Qt as G,vn as H,C as I,F as J,Ut as K,Xe as L,be as M,bn as N,hn as O,_t as P,jt as Q,pn as R,Et as S,fe as T,N as U,At as V,en as W,Tn as X,tn as Y,ae as a,oe as b,Nt as c,Ot as d,we as e,wn as f,b as g,mn as h,yn as i,un as j,He as k,X as l,dn as m,fn as n,Ie as o,ee as p,ln as q,It as r,ve as s,gn as t,Ke as u,Pt as v,an as w,zt as x,Lt as y,Ht as z};
//# sourceMappingURL=scope.hDWzALKC.js.map
