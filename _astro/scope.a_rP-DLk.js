import{e as it,s as lt,C as dt,h as ut,P as E,g as he,j as gt}from"./index.BqApzMOV.js";if(typeof DelayNode<"u"){class e extends DelayNode{constructor(n,o,s,a){super(n),o=Math.abs(o),this.delayTime.value=s;const c=n.createGain();c.gain.value=Math.min(Math.abs(a),.995),this.feedback=c.gain;const r=n.createGain();return r.gain.value=o,this.delayGain=r,this.connect(c),this.connect(r),c.connect(this),this.connect=i=>r.connect(i),this}start(n){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,n+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(t,n,o){return new e(this,t,n,o)}}var pe={};pe.generateReverb=function(e,t){for(var n=e.audioContext||new AudioContext,o=n.sampleRate,s=e.numChannels||2,a=e.decayTime*1.5,c=Math.round(e.decayTime*o),r=Math.round(a*o),i=Math.round((e.fadeInTime||0)*o),l=Math.pow(1/1e3,1/c),d=n.createBuffer(s,r,o),u=0;u<s;u++){for(var g=d.getChannelData(u),h=0;h<r;h++)g[h]=pt()*Math.pow(l,h);for(var h=0;h<i;h++)g[h]*=h/i}ft(d,e.lpFreqStart||0,e.lpFreqEnd||0,e.decayTime,t)};pe.generateGraph=function(e,t,n,o,s){var a=document.createElement("canvas");a.width=t,a.height=n;var c=a.getContext("2d");c.fillStyle="#000",c.fillRect(0,0,a.width,a.height),c.fillStyle="#fff";for(var r=t/e.length,i=n/(s-o),l=0;l<e.length;l++)c.fillRect(l*r,n-(e[l]-o)*i,1,1);return a};var ft=function(e,t,n,o,s){if(t==0){s(e);return}var a=ht(e),c=new OfflineAudioContext(e.numberOfChannels,a[0].length,e.sampleRate),r=c.createBufferSource();r.buffer=e;var i=c.createBiquadFilter();t=Math.min(t,e.sampleRate/2),n=Math.min(n,e.sampleRate/2),i.type="lowpass",i.Q.value=1e-4,i.frequency.setValueAtTime(t,0),i.frequency.linearRampToValueAtTime(n,o),r.connect(i),i.connect(c.destination),r.start(),c.oncomplete=function(l){s(l.renderedBuffer)},c.startRendering(),window.filterNode=i},ht=function(e){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);return t},pt=function(){return Math.random()*2-1};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(e,t){const n=t.sampleRate*e,o=this.createBuffer(t.numberOfChannels,t.length,t.sampleRate);for(let s=0;s<t.numberOfChannels;s++){let a=t.getChannelData(s),c=o.getChannelData(s);for(let r=0;r<n;r++)c[r]=a[r]||0}return o},AudioContext.prototype.createReverb=function(e,t,n,o,s){const a=this.createConvolver();return a.generate=(c=2,r=.1,i=15e3,l=1e3,d)=>{a.duration=c,a.fade=r,a.lp=i,a.dim=l,a.ir=d,d?a.buffer=this.adjustLength(c,d):pe.generateReverb({audioContext:this,numChannels:2,decayTime:c,fadeInTime:r,lpFreqStart:i,lpFreqEnd:l},u=>{a.buffer=u})},a.generate(e,t,n,o,s),a});var Fe={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]}};if(typeof GainNode<"u"){class e extends GainNode{constructor(n,o){if(super(n),!Fe[o])throw new Error("vowel: unknown vowel "+o);const{gains:s,qs:a,freqs:c}=Fe[o],r=n.createGain();for(let i=0;i<5;i++){const l=n.createGain();l.gain.value=s[i];const d=n.createBiquadFilter();d.type="bandpass",d.Q.value=a[i],d.frequency.value=c[i],this.connect(d),d.connect(l),l.connect(r)}return r.gain.value=8,this.connect=i=>r.connect(i),this}}AudioContext.prototype.createVowelFilter=function(t){return new e(this,t)}}let Ke=e=>console.log(e);const N=(...e)=>Ke(...e),Ct=e=>{Ke=e},It=e=>{if(typeof e!="string")return[];const[t,n="",o]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return t?[t,n,o?Number(o):void 0]:[]},mt={c:0,d:2,e:4,f:5,g:7,a:9,b:11},At={"#":1,b:-1,s:1,f:-1},Ye=(e,t=3)=>{const[n,o,s=t]=It(e);if(!n)throw new Error('not a note: "'+e+'"');const a=mt[n.toLowerCase()],c=o?.split("").reduce((r,i)=>r+At[i],0)||0;return(Number(s)+1)*12+a+c},_t=e=>Math.pow(2,(e-69)/12)*440,P=(e,t,n)=>Math.min(Math.max(e,t),n),bt=e=>12*Math.log(e/440)/Math.LN2+69,yt=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:o}=e;if(typeof n=="number")return bt(n);if(typeof o=="string")return Ye(o);if(typeof o=="number")return o;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t};function ke(e,t){return isNaN(Number(e))?(N(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const wt=(e,t)=>(e%t+t)%t,Me=(e,t)=>wt(Math.round(ke(e,0)),t),Bt="data:application/javascript;base64,Ly8gTElDRU5TRSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2My4wIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZGt0cjAvV2ViRGlydC9ibG9iL21haW4vTElDRU5TRQovLyBhbGwgdGhlIGNyZWRpdCBnb2VzIHRvIGRrdHIwJ3Mgd2ViZGlydDogaHR0cHM6Ly9naXRodWIuY29tL2RrdHIwL1dlYkRpcnQvYmxvYi81Y2UzZDY5ODM2MmM1NGQ2ZTFiNjhhY2M0N2ViMjk1NWFjNjJjNzkzL2Rpc3QvQXVkaW9Xb3JrbGV0cy5qcwovLyA8MwoKY2xhc3MgQ29hcnNlUHJvY2Vzc29yIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsKICBzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCkgewogICAgcmV0dXJuIFt7IG5hbWU6ICdjb2Fyc2UnLCBkZWZhdWx0VmFsdWU6IDEgfV07CiAgfQoKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLm5vdFN0YXJ0ZWQgPSB0cnVlOwogIH0KCiAgcHJvY2VzcyhpbnB1dHMsIG91dHB1dHMsIHBhcmFtZXRlcnMpIHsKICAgIGNvbnN0IGlucHV0ID0gaW5wdXRzWzBdOwogICAgY29uc3Qgb3V0cHV0ID0gb3V0cHV0c1swXTsKICAgIGNvbnN0IGNvYXJzZSA9IHBhcmFtZXRlcnMuY29hcnNlOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBvdXRwdXRbMF1bMF0gPSBpbnB1dFswXVswXTsKICAgICAgZm9yIChsZXQgbiA9IDE7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgIGZvciAobGV0IG8gPSAwOyBvIDwgb3V0cHV0Lmxlbmd0aDsgbysrKSB7CiAgICAgICAgICBvdXRwdXRbb11bbl0gPSBuICUgY29hcnNlID09IDAgPyBpbnB1dFswXVtuXSA6IG91dHB1dFtvXVtuIC0gMV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ2NvYXJzZS1wcm9jZXNzb3InLCBDb2Fyc2VQcm9jZXNzb3IpOwoKY2xhc3MgQ3J1c2hQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ2NydXNoJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBjcnVzaCA9IHBhcmFtZXRlcnMuY3J1c2g7CiAgICBjb25zdCBibG9ja1NpemUgPSAxMjg7CiAgICBjb25zdCBoYXNJbnB1dCA9ICEoaW5wdXRbMF0gPT09IHVuZGVmaW5lZCk7CiAgICBpZiAoaGFzSW5wdXQpIHsKICAgICAgdGhpcy5ub3RTdGFydGVkID0gZmFsc2U7CiAgICAgIGlmIChjcnVzaC5sZW5ndGggPT09IDEpIHsKICAgICAgICBjb25zdCB4ID0gTWF0aC5wb3coMiwgY3J1c2hbMF0gLSAxKTsKICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IE1hdGgucm91bmQoaW5wdXRbMF1bbl0gKiB4KSAvIHg7CiAgICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgICBvdXRwdXRbb11bbl0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgICAgbGV0IHggPSBNYXRoLnBvdygyLCBjcnVzaFtuXSAtIDEpOwogICAgICAgICAgY29uc3QgdmFsdWUgPSBNYXRoLnJvdW5kKGlucHV0WzBdW25dICogeCkgLyB4OwogICAgICAgICAgZm9yIChsZXQgbyA9IDA7IG8gPCBvdXRwdXQubGVuZ3RoOyBvKyspIHsKICAgICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQpyZWdpc3RlclByb2Nlc3NvcignY3J1c2gtcHJvY2Vzc29yJywgQ3J1c2hQcm9jZXNzb3IpOwoKY2xhc3MgU2hhcGVQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ3NoYXBlJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBzaGFwZTAgPSBwYXJhbWV0ZXJzLnNoYXBlWzBdOwogICAgY29uc3Qgc2hhcGUxID0gc2hhcGUwIDwgMSA/IHNoYXBlMCA6IDEuMCAtIDRlLTEwOwogICAgY29uc3Qgc2hhcGUgPSAoMi4wICogc2hhcGUxKSAvICgxLjAgLSBzaGFwZTEpOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSAoKDEgKyBzaGFwZSkgKiBpbnB1dFswXVtuXSkgLyAoMSArIHNoYXBlICogTWF0aC5hYnMoaW5wdXRbMF1bbl0pKTsKICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ3NoYXBlLXByb2Nlc3NvcicsIFNoYXBlUHJvY2Vzc29yKTsK";function je(e){const t=C().createGain();return t.gain.value=e,t}const vt=(e,t,n,o,s,a)=>{const c=C().createGain();let r=a;c.gain.setValueAtTime(0,a),r+=e,c.gain.linearRampToValueAtTime(s,r),r+=t;let i=n*s;return c.gain.linearRampToValueAtTime(i,r),{node:c,stop:l=>(r=Math.max(l,r),c.gain.setValueAtTime(i,r),r+=o,c.gain.linearRampToValueAtTime(0,r),r)}},$t=(e,t,n,o,s,a)=>{n=Math.max(.001,n),s=Math.max(.001,s);const c=C().createGain();return c.gain.setValueAtTime(1e-4,a),c.gain.exponentialRampToValueAtTime(s,a+e),c.gain.exponentialRampToValueAtTime(n*s,a+e+t),{node:c,stop:r=>{c.gain.exponentialRampToValueAtTime(1e-4,r+o)}}},Ut=(e,t,n,o,s,a,c)=>{const r=C().createGain();return r.gain.setValueAtTime(0,a),r.gain.linearRampToValueAtTime(s,a+e),r.gain.linearRampToValueAtTime(n*s,a+e+t),r.gain.setValueAtTime(n*s,c),r.gain.linearRampToValueAtTime(0,c+o),r},Gt=(e,t,n,o,s,a,c,r,i)=>{const l=c-a,d=a+l,u=a+o*l;e.setValueAtTime(a,r),e.linearRampToValueAtTime(d,r+t),e.linearRampToValueAtTime(u,r+t+n),e.setValueAtTime(u,i),e.linearRampToValueAtTime(a,i+Math.max(s,.1))};function Tt(e,t,n,o,s,a){const c={threshold:t??-3,ratio:n??10,knee:o??10,attack:s??.005,release:a??.05};return new DynamicsCompressorNode(e,c)}function le(e,t,n,o,s,a,c,r,i,l,d,u=.5){const g=e.createBiquadFilter();if(g.type=t,g.Q.value=o,g.frequency.value=n,!isNaN(i)&&i!==0){const h=i*u,m=P(2**-h*n,0,2e4),A=P(2**(i-h)*n,0,2e4);return Gt(g.frequency,s,a,c,r,m,A,l,d),g}return g}let ze=e=>e<.5?1:1-(e-.5)/.5;function en(e,t,n=0){const o=C();if(!n)return e;let s=o.createGain(),a=o.createGain();e.connect(s),t.connect(a),s.gain.value=ze(n),a.gain.value=ze(1-n);let c=o.createGain();return s.connect(c),a.connect(c),c}const Ce={},de={},tn=e=>Ce[e];function Rt(e,t){var n=t?1e3:1024;if(e<n)return e+" B";var o=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],s=-1;do e/=n,++s;while(e>=n);return e.toFixed(1)+" "+o[s]}const Vt=async(e,t,n,o,s,a,c)=>{let r=0;s!==void 0&&n!==void 0&&N("[sampler] hap has note and freq. ignoring note","warning");let i=yt({freq:s,note:n},36);r=i-36;const l=C();let d,u=0;if(Array.isArray(a))u=Me(t,a.length),d=a[u];else{const A=y=>Ye(y)-i,b=Object.keys(a).filter(y=>!y.startsWith("_")).reduce((y,H,x)=>!y||Math.abs(A(H))<Math.abs(A(y))?H:y,null);r=-A(b),u=Me(t,a[b].length),d=a[b][u]}c&&(d=await c(d));let g=await Oe(d,l,e,u);o<0&&(g=Xt(g));const h=l.createBufferSource();h.buffer=g;const m=1*Math.pow(2,r/12);return h.playbackRate.value=m,h},Oe=(e,t,n,o=0)=>{const s=n?`sound "${n}:${o}"`:"sample";if(e=e.replace("#","%23"),!de[e]){N(`[sampler] load ${s}..`,"load-sample",{url:e});const a=Date.now();de[e]=fetch(e).then(c=>c.arrayBuffer()).then(async c=>{const r=Date.now()-a,i=Rt(c.byteLength);N(`[sampler] load ${s}... done! loaded ${i} in ${r}ms`,"loaded-sample",{url:e});const l=await t.decodeAudioData(c);return Ce[e]=l,l})}return de[e]};function Xt(e){const t=C(),n=t.createBuffer(e.numberOfChannels,e.length,t.sampleRate);for(let o=0;o<e.numberOfChannels;o++)n.copyToChannel(e.getChannelData(o).slice().reverse(),o,o);return n}const nn=e=>Ce[e],Nt=(e,t,n=e._base||"")=>Object.entries(e).forEach(([o,s])=>{if(typeof s=="string"&&(s=[s]),typeof s!="object")throw new Error("wrong sample map format for "+o);n=s._base||n;const a=c=>(n+c).replace("github:","https://raw.githubusercontent.com/");Array.isArray(s)?s=s.map(a):s=Object.fromEntries(Object.entries(s).map(([c,r])=>[c,(typeof r=="string"?[r]:r).map(a)])),t(o,s)});let Qe={};function on(e,t){Qe[e]=t}function Ht(e){const t=Object.entries(Qe).find(([n])=>e.startsWith(n));if(t)return t[1]}const St=async(e,t=e._base||"",n={})=>{if(typeof e=="string"){const a=Ht(e);if(a)return a(e);if(e.startsWith("bubo:")){const[r,i]=e.split(":");e=`github:Bubobubobubobubo/dough-${i}`}if(e.startsWith("github:")){let[r,i]=e.split("github:");i=i.endsWith("/")?i.slice(0,-1):i,i.split("/").length===2&&(i+="/main"),e=`https://raw.githubusercontent.com/${i}/strudel.json`.replace("//strudel.json","/strudel.json")}if(e.startsWith("shabda:")){let[r,i]=e.split("shabda:");e=`https://shabda.ndre.gr/${i}.json?strudel=1`}if(e.startsWith("shabda/speech")){let[r,i]=e.split("shabda/speech");i=i.startsWith("/")?i.substring(1):i;let[l,d]=i.split(":"),u="f",g="en-GB";l&&([g,u]=l.split("/")),e=`https://shabda.ndre.gr/speech/${d}.json?gender=${u}&language=${g}&strudel=1'`}if(typeof fetch!="function")return;const c=e.split("/").slice(0,-1).join("/");return typeof fetch>"u"?void 0:fetch(e).then(r=>r.json()).then(r=>St(r,t||r._base||c,n)).catch(r=>{throw console.error(r),new Error(`error loading "${e}"`)})}const{prebake:o,tag:s}=n;Nt(e,(a,c)=>Zt(a,(r,i,l)=>Wt(r,i,l,c),{type:"sample",samples:c,baseUrl:t,prebake:o,tag:s}),t)},De=[];async function Wt(e,t,n,o,s){let{s:a,freq:c,unit:r,nudge:i=0,cut:l,loop:d,clip:u=void 0,n:g=0,note:h,speed:m=1,loopBegin:A=0,begin:b=0,loopEnd:y=1,end:H=1,vib:x,vibmod:U=.5}=t;if(m===0)return;d=a.startsWith("wt_")?1:t.loop;const F=C(),{attack:ee=.001,decay:te=.001,sustain:ne=1,release:oe=.001}=t,M=e+i,p=await Vt(a,g,h,m,c,o,s);let G;if(x>0){G=C().createOscillator(),G.frequency.value=x;const B=C().createGain();B.gain.value=U*100,G.connect(B),B.connect(p.detune),G.start(0)}if(F.currentTime>e){N(`[sampler] still loading sound "${a}:${g}"`,"highlight");return}if(!p){N(`[sampler] could not load "${a}:${g}"`,"error");return}p.playbackRate.value=Math.abs(m)*p.playbackRate.value,r==="c"&&(p.playbackRate.value=p.playbackRate.value*p.buffer.duration*1);const z=b*p.buffer.duration;d&&(p.loop=!0,p.loopStart=A*p.buffer.duration-z,p.loopEnd=y*p.buffer.duration-z),p.start(M,z);const{node:D,stop:ae}=vt(ee,te,ne,oe,1,e);p.connect(D);const K=F.createGain();D.connect(K),p.onended=function(){p.disconnect(),G?.stop(),D.disconnect(),K.disconnect(),n()};const T={node:K,bufferSource:p,stop:(B,j=u===void 0&&d===void 0)=>{let O=B;if(j){const Q=p.buffer.duration/p.playbackRate.value;O=e+(H-b)*Q}const se=ae(O);p.stop(se)}};if(l!==void 0){const B=De[l];B&&(B.node.gain.setValueAtTime(1,M),B.node.gain.linearRampToValueAtTime(0,M+.01)),De[l]=T}return T}const Ie=it();function Zt(e,t,n={}){Ie.setKey(e,{onTrigger:t,data:n})}function ue(e){return Ie.get()[e]}const an=()=>Ie.set({});let _;const xt=()=>(_=new AudioContext,_),C=()=>_||xt();let L;function Ft(){return L||(L=C().audioWorklet.addModule(Bt),L)}function ge(e,t,n){const o=new AudioWorkletNode(e,t);return Object.entries(n).forEach(([s,a])=>{o.parameters.get(s).value=a}),o}async function Mt(e={}){const{disableWorklets:t=!1}=e;typeof window<"u"&&(await C().resume(),t?console.log("disableWorklets: AudioWorklet effects coarse, crush and shape are skipped!"):await Ft().catch(n=>{console.warn("could not load AudioWorklet effects coarse, crush and shape",n)}))}async function sn(e){return new Promise(t=>{document.addEventListener("click",async function n(){await Mt(e),t(),document.removeEventListener("click",n)})})}let X={},$,W;function zt(){const e=C(),t=e.destination.maxChannelCount;e.destination.channelCount=t,$=new ChannelMergerNode(e,{numberOfInputs:e.destination.channelCount}),W=new GainNode(e),$.connect(W),W.connect(e.destination)}const me=(e,t=[0,1])=>{const n=C();$==null&&zt();const o=new StereoPannerNode(n);e.connect(o);const s=new ChannelSplitterNode(n,{numberOfOutputs:o.channelCount});o.connect(s),t.forEach((a,c)=>{s.connect($,c%o.channelCount,P(a,0,n.destination.channelCount-1))})},rn=()=>{W!=null&&(W.gain.linearRampToValueAtTime(0,C().currentTime+.01),W=null)};function Dt(e,t,n,o){if(n=P(n,0,.98),!X[e]){const a=C().createFeedbackDelay(1,t,n);a.start?.(o),me(a,[0,1]),X[e]=a}return X[e].delayTime.value!==t&&X[e].delayTime.setValueAtTime(t,o),X[e].feedback.value!==n&&X[e].feedback.setValueAtTime(n,o),X[e]}const R={};function Kt(e,t,n=1,o=.5,s=1e3,a=2e3){const c=C(),r=c.createGain();r.gain.value=a,R[e]==null&&(R[e]=c.createOscillator(),R[e].frequency.value=n,R[e].type="sine",R[e].start()),R[e].connect(r),R[e].frequency.value!=n&&R[e].frequency.setValueAtTime(n,t);const i=2;let l=0;const d=[];for(let u=0;u<i;u++){const g=c.createBiquadFilter();g.type="notch",g.gain.value=1,g.frequency.value=s+l,g.Q.value=2-Math.min(Math.max(o*2,0),1.9),r.connect(g.detune),l+=282,u>0&&d[u-1].connect(g),d.push(g)}return d[d.length-1]}let v={},J=(e,t)=>e!==void 0&&e!==t;function Yt(e,t,n,o,s,a){if(!v[e]){const r=C().createReverb(t,n,o,s,a);me(r,[0,1]),v[e]=r}return(J(t,v[e].duration)||J(n,v[e].fade)||J(o,v[e].lp)||J(s,v[e].dim)||v[e].ir!==a)&&v[e].generate(t,n,o,s,a),v[e]}let w,k;function kt(e=2048){if(!w){const t=C().createAnalyser();t.fftSize=e,w=t,k=new Float32Array(w.frequencyBinCount)}return w.fftSize!==e&&(w.fftSize=e,k=new Float32Array(w.frequencyBinCount)),w}function qe(e="time"){const t={time:()=>w?.getFloatTimeDomainData(k),frequency:()=>w?.getFloatFrequencyData(k)}[e];if(!t)throw new Error(`getAnalyzerData: ${e} not supported. use one of ${Object.keys(t).join(", ")}`);return t(),k}function fe(e,t,n){const o=je(n);return e.connect(o),o.connect(t),o}const Ae=async(e,t,n)=>{const o=C();if(typeof e!="object")throw new Error(`expected hap.value to be an object, but got "${e}". Hint: append .note() or .s() to the end`,"error");e.duration=n;let s=o.currentTime+t,{s:a="triangle",bank:c,source:r,gain:i=.8,postgain:l=1,density:d=.03,ftype:u="12db",fanchor:g=.5,cutoff:h,lpenv:m,lpattack:A=.01,lpdecay:b=.01,lpsustain:y=1,lprelease:H=.01,resonance:x=1,hpenv:U,hcutoff:F,hpattack:ee=.01,hpdecay:te=.01,hpsustain:ne=1,hprelease:oe=.01,hresonance:M=1,bpenv:p,bandf:G,bpattack:z=.01,bpdecay:D=.01,bpsustain:ae=1,bprelease:K=.01,bandq:be=1,channels:T=[1,2],phaser:B,phaserdepth:j=.75,phasersweep:O,phasercenter:se,coarse:Q,crush:ye,shape:we,pan:Be,vowel:ve,delay:Ge=0,delayfeedback:Te=.5,delaytime:Re=.25,orbit:re=1,room:Ve,roomfade:_e,roomlp:$e,roomdim:Ue,roomsize:et,ir:ce,i:Xe=0,velocity:tt=1,analyze:Ne,fft:nt=8,compressor:He,compressorRatio:ot,compressorKnee:at,compressorAttack:st,compressorRelease:rt}=e;i=ke(i,1),T=(Array.isArray(T)?T:[T]).map(f=>f-1),i*=tt;let Se=[];const ct=()=>{Se.forEach(f=>f?.disconnect())};c&&a&&(a=`${c}_${a}`);let q;if(r)q=r(s,e,n);else if(ue(a)){const{onTrigger:f}=ue(a),V=await f(s,e,ct);V&&(q=V.node,V.stop(s+n))}else throw new Error(`sound ${a} not found! Is it loaded?`);if(!q)return;if(o.currentTime>s){N("[webaudio] skip hap: still loading",o.currentTime-s);return}const I=[];if(I.push(q),I.push(je(i)),h!==void 0){let f=()=>le(o,"lowpass",h,x,A,b,y,H,m,s,s+n,g);I.push(f()),u==="24db"&&I.push(f())}if(F!==void 0){let f=()=>le(o,"highpass",F,M,ee,te,ne,oe,U,s,s+n,g);I.push(f()),u==="24db"&&I.push(f())}if(G!==void 0){let f=()=>le(o,"bandpass",G,be,z,D,ae,K,p,s,s+n,g);I.push(f()),u==="24db"&&I.push(f())}if(ve!==void 0){const f=o.createVowelFilter(ve);I.push(f)}if(Q!==void 0&&I.push(ge(o,"coarse-processor",{coarse:Q})),ye!==void 0&&I.push(ge(o,"crush-processor",{crush:ye})),we!==void 0&&I.push(ge(o,"shape-processor",{shape:we})),He!==void 0&&I.push(Tt(o,He,ot,at,st,rt)),Be!==void 0){const f=o.createStereoPanner();f.pan.value=2*Be-1,I.push(f)}if(B!==void 0&&j>0){const f=Kt(re,s,B,j,se,O);I.push(f)}const Y=new GainNode(o,{gain:l});I.push(Y),me(Y,T);let We;if(Ge>0&&Re>0&&Te>0){const f=Dt(re,Re,Te,s);We=fe(Y,f,Ge)}let Ze;if(Ve>0){let f;if(ce!==void 0){let ie,S=ue(ce);Array.isArray(S)?ie=S.data.samples[Xe%S.data.samples.length]:typeof S=="object"&&(ie=Object.values(S.data.samples).flat()[Xe%Object.values(S.data.samples).length]),f=await Oe(ie,o,ce,0)}const V=Yt(re,et,_e,$e,Ue,f);Ze=fe(Y,V,Ve)}let xe;if(Ne){const f=kt(2**(nt+5));xe=fe(Y,f,Ne)}I.slice(1).reduce((f,V)=>f.connect(V),I[0]),Se=I.concat([We,Ze,xe])},cn=(e,t,n,o)=>Ae(t,e-n,t.duration/o);let Z;async function jt(e,t){const n=`dsp-worklet-${Date.now()}`,o=`${t}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${n}', MyProcessor);
`,a=`data:text/javascript;base64,${btoa(o)}`;await e.audioWorklet.addModule(a);const c=new AudioWorkletNode(e,n);return{node:c,stop:()=>c.port.postMessage("stop")}}const Le=()=>{Z&&(Z?.stop(),Z?.node?.disconnect())};typeof window<"u"&&window.addEventListener("message",e=>{e.data==="strudel-stop"?Le():e.data?.dough&&Z?.node.port.postMessage(e.data)});const ln=async e=>{const t=C();Le(),Z=await jt(t,e),Z.node.connect(t.destination)};function Ot(e,t,n,o,s){window.postMessage({time:e,dough:t.value,currentTime:n,duration:o,cps:s})}const{Pattern:Je,logger:Qt}=lt;Ct(Qt);const Ee=e=>(e.ensureObjectValue(),{...e.value,velocity:e.context.velocity}),qt=(e,t,n,o)=>{globalThis.haps_from_outputs&&globalThis.haps_from_outputs.push(t),Ae(Ee(t),e-n,t.duration/o)},Lt=(e,t,n)=>{globalThis.haps_from_outputs&&globalThis.haps_from_outputs.push(e),Ae(Ee(e),t,n)};Je.prototype.webaudio=function(){return this.onTrigger(qt)};function dn(e={}){e={getTime:()=>C().currentTime,defaultOutput:Lt,...e};const{defaultOutput:t,getTime:n}=e;return new dt({...e,onTrigger:ut({defaultOutput:t,getTime:n})})}Je.prototype.dough=function(){return this.onTrigger(Ot,1)};function Jt(e,{align:t=!0,color:n="white",thickness:o=3,scale:s=.25,pos:a=.75,trigger:c=0}={}){const r=he(),i=qe("time");r.lineWidth=o,r.strokeStyle=n,r.beginPath();let l=r.canvas;const d=e.frequencyBinCount;let u=t?Array.from(i).findIndex((m,A,b)=>A&&b[A-1]>-c&&m<=-c):0;u=Math.max(u,0);const g=l.width*1/d;let h=0;for(let m=u;m<d;m++){const A=i[m]+1,b=(a-s*(A-1))*l.height;m===0?r.moveTo(h,b):r.lineTo(h,b),h+=g}r.stroke()}function Et(e,{color:t="white",scale:n=.25,pos:o=.75,lean:s=.5,min:a=-150,max:c=0}={}){const r=qe("frequency"),i=he(),l=i.canvas;i.fillStyle=t;const d=e.frequencyBinCount,u=l.width*1/d;let g=0;for(let h=0;h<d;h++){const A=gt((r[h]-a)/(c-a),0,1)*n,b=A*l.height,y=(o-A*s)*l.height;i.fillRect(g,y,Math.max(u,1),b),g+=u}}function Pe(e=0,t="0,0,0"){const n=he();e?(n.fillStyle=`rgba(${t},${1-e})`,n.fillRect(0,0,n.canvas.width,n.canvas.height)):n.clearRect(0,0,n.canvas.width,n.canvas.height)}E.prototype.fscope=function(e={}){return this.analyze(1).draw(()=>{Pe(e.smear),w&&Et(w,e)})};E.prototype.tscope=function(e={}){return this.analyze(1).draw(()=>{Pe(e.smear),w&&Jt(w,e)})};E.prototype.scope=E.prototype.tscope;export{rn as A,w as B,k as C,kt as D,qe as E,Ae as F,cn as G,tn as H,Vt as I,Xt as J,nn as K,Ut as L,Gt as M,Tt as N,le as O,N as P,Ct as Q,jt as R,ln as S,Ot as T,vt as a,je as b,me as c,en as d,$t as e,on as f,C as g,St as h,sn as i,xt as j,zt as k,Oe as l,_t as m,Ye as n,Wt as o,Nt as p,qt as q,Zt as r,Ie as s,dn as t,Jt as u,Et as v,Lt as w,ue as x,an as y,Mt as z};
