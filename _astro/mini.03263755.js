import{s as Oe,b as Y,c as Ne,f as Be,d as jt,e as Te,g as kt,t as Pt,h as ze,j as X,k as St,o as Rt,q as Lt}from"./index.a2044bc2.js";function qt(a,c){function r(){this.constructor=a}r.prototype=c.prototype,a.prototype=new r}function O(a,c,r,h){var m=Error.call(this,a);return Object.setPrototypeOf&&Object.setPrototypeOf(m,O.prototype),m.expected=c,m.found=r,m.location=h,m.name="SyntaxError",m}qt(O,Error);function ee(a,c,r){return r=r||" ",a.length>c?a:(c-=a.length,r+=r.repeat(c),a+r.slice(0,c))}O.prototype.format=function(a){var c="Error: "+this.message;if(this.location){var r=null,h;for(h=0;h<a.length;h++)if(a[h].source===this.location.source){r=a[h].text.split(/\r\n|\n|\r/g);break}var m=this.location.start,d=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(m):m,A=this.location.source+":"+d.line+":"+d.column;if(r){var w=this.location.end,b=ee("",d.line.toString().length," "),p=r[m.line-1],g=m.line===w.line?w.column:p.length+1,_=g-m.column||1;c+=`
 --> `+A+`
`+b+` |
`+d.line+" | "+p+`
`+b+" | "+ee("",m.column-1," ")+ee("",_,"^")}else c+=`
 at `+A}return c};O.buildMessage=function(a,c){var r={literal:function(p){return'"'+m(p.text)+'"'},class:function(p){var g=p.parts.map(function(_){return Array.isArray(_)?d(_[0])+"-"+d(_[1]):d(_)});return"["+(p.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function h(p){return p.charCodeAt(0).toString(16).toUpperCase()}function m(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+h(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+h(g)})}function d(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+h(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+h(g)})}function A(p){return r[p.type](p)}function w(p){var g=p.map(A),_,C;if(g.sort(),g.length>0){for(_=1,C=1;_<g.length;_++)g[_-1]!==g[_]&&(g[C]=g[_],C++);g.length=C}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function b(p){return p?'"'+m(p)+'"':"end of input"}return"Expected "+w(a)+" but "+b(c)+" found."};function Dt(a,c){c=c!==void 0?c:{};var r={},h=c.grammarSource,m={start:ke},d=ke,A=".",w="-",b="+",p="0",g=",",_="|",C='"',j="'",T="#",z="^",Ge="_",re="[",se="]",Ue="{",Xe="}",He="%",Je="<",Ke=">",Qe="@",Ve="!",Ye="(",er=")",rr="/",sr="*",tr="?",nr=":",te="..",ne="struct",ae="target",ie="euclid",fe="slow",oe="rotL",ce="rotR",le="fast",ue="scale",pe="//",ge="cat",ar="$",ve="setcps",$e="setbpm",he="hush",ir=/^[1-9]/,fr=/^[eE]/,or=/^[0-9]/,me=/^[ \n\r\t]/,cr=/^[0-9a-zA-Z~]/,_e=/^[^\n]/,lr=Fe("number"),de=$(".",!1),ur=P([["1","9"]],!1,!1),pr=P(["e","E"],!1,!1),we=$("-",!1),gr=$("+",!1),vr=$("0",!1),$r=P([["0","9"]],!1,!1),hr=Fe("whitespace"),ye=P([" ",`
`,"\r","	"],!1,!1),mr=$(",",!1),_r=$("|",!1),dr=$('"',!1),wr=$("'",!1),yr=P([["0","9"],["a","z"],["A","Z"],"~"],!1,!1),Ar=$("#",!1),br=$("^",!1),Cr=$("_",!1),Ae=$("[",!1),be=$("]",!1),xr=$("{",!1),Er=$("}",!1),Fr=$("%",!1),jr=$("<",!1),kr=$(">",!1),Pr=$("@",!1),Sr=$("!",!1),Rr=$("(",!1),Lr=$(")",!1),qr=$("/",!1),Dr=$("*",!1),Ir=$("?",!1),Or=$(":",!1),Nr=$("..",!1),Br=$("struct",!1),Tr=$("target",!1),zr=$("euclid",!1),Mr=$("slow",!1),Wr=$("rotL",!1),Zr=$("rotR",!1),Gr=$("fast",!1),Ur=$("scale",!1),Xr=$("//",!1),Ce=P([`
`],!0,!1),Hr=$("cat",!1),Jr=$("$",!1),Kr=$("setcps",!1),Qr=$("setbpm",!1),Vr=$("hush",!1),Yr=function(){return parseFloat(Is())},es=function(e){return new xt(e.join(""))},rs=function(e){return e},ss=function(e,s){return e.arguments_.stepsPerCycle=s,e},ts=function(e){return e},ns=function(e){return e.arguments_.alignment="slowcat",e},as=function(e){return s=>s.options_.weight=e},is=function(e){return s=>s.options_.reps=e},fs=function(e,s,n){return i=>i.options_.ops.push({type_:"bjorklund",arguments_:{pulse:e,step:s,rotation:n}})},os=function(e){return s=>s.options_.ops.push({type_:"stretch",arguments_:{amount:e,type:"slow"}})},cs=function(e){return s=>s.options_.ops.push({type_:"stretch",arguments_:{amount:e,type:"fast"}})},ls=function(e){return s=>s.options_.ops.push({type_:"degradeBy",arguments_:{amount:e,seed:Ie++}})},us=function(e){return s=>s.options_.ops.push({type_:"tail",arguments_:{element:e}})},ps=function(e){return s=>s.options_.ops.push({type_:"range",arguments_:{element:e}})},gs=function(e,s){const n=new Ft(e,{ops:[],weight:1,reps:1});for(const i of s)i(n);return n},vs=function(e){return new U(e,"fastcat")},$s=function(e){return{alignment:"stack",list:e}},hs=function(e){return{alignment:"rand",list:e,seed:Ie++}},ms=function(e,s){return s&&s.list.length>0?new U([e,...s.list],s.alignment,s.seed):e},_s=function(e,s){return new U(s?[e,...s.list]:[e],"polymeter")},ds=function(e){return e},ws=function(e){return{name:"struct",args:{mini:e}}},ys=function(e){return{name:"target",args:{name:e}}},As=function(e,s,n){return{name:"bjorklund",args:{pulse:e,step:parseInt(s)}}},bs=function(e){return{name:"stretch",args:{amount:e}}},Cs=function(e){return{name:"shift",args:{amount:"-"+e}}},xs=function(e){return{name:"shift",args:{amount:e}}},Es=function(e){return{name:"stretch",args:{amount:"1/"+e}}},Fs=function(e){return{name:"scale",args:{scale:e.join("")}}},xe=function(e,s){return s},js=function(e,s){return s.unshift(e),new U(s,"slowcat")},ks=function(e){return e},Ps=function(e,s){return new Et(e.name,e.args,s)},Ss=function(e){return e},Rs=function(e){return e},Ls=function(e){return new V("setcps",{value:e})},qs=function(e){return new V("setcps",{value:e/120/2})},Ds=function(){return new V("hush")},t=0,v=0,M=[{line:1,column:1}],E=0,J=[],f=0,W;if("startRule"in c){if(!(c.startRule in m))throw new Error(`Can't start parsing from rule "`+c.startRule+'".');d=m[c.startRule]}function Is(){return a.substring(v,t)}function Ee(){return K(v,t)}function $(e,s){return{type:"literal",text:e,ignoreCase:s}}function P(e,s,n){return{type:"class",parts:e,inverted:s,ignoreCase:n}}function Os(){return{type:"end"}}function Fe(e){return{type:"other",description:e}}function je(e){var s=M[e],n;if(s)return s;for(n=e-1;!M[n];)n--;for(s=M[n],s={line:s.line,column:s.column};n<e;)a.charCodeAt(n)===10?(s.line++,s.column=1):s.column++,n++;return M[e]=s,s}function K(e,s,n){var i=je(e),l=je(s),y={source:h,start:{offset:e,line:i.line,column:i.column},end:{offset:s,line:l.line,column:l.column}};return n&&h&&typeof h.offset=="function"&&(y.start=h.offset(y.start),y.end=h.offset(y.end)),y}function o(e){t<E||(t>E&&(E=t,J=[]),J.push(e))}function Ns(e,s,n){return new O(O.buildMessage(e,s),e,s,n)}function ke(){var e;return e=Ct(),e}function F(){var e,s;return f++,e=t,Pe(),s=Z(),s!==r?(Ws(),Ms(),v=e,e=Yr()):(t=e,e=r),f--,e===r&&f===0&&o(lr),e}function Bs(){var e;return a.charCodeAt(t)===46?(e=A,t++):(e=r,f===0&&o(de)),e}function Ts(){var e;return ir.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(ur)),e}function zs(){var e;return fr.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(pr)),e}function Ms(){var e,s,n,i,l;if(e=t,s=zs(),s!==r){if(n=Pe(),n===r&&(n=Zs()),n===r&&(n=null),i=[],l=S(),l!==r)for(;l!==r;)i.push(l),l=S();else i=r;i!==r?(s=[s,n,i],e=s):(t=e,e=r)}else t=e,e=r;return e}function Ws(){var e,s,n,i;if(e=t,s=Bs(),s!==r){if(n=[],i=S(),i!==r)for(;i!==r;)n.push(i),i=S();else n=r;n!==r?(s=[s,n],e=s):(t=e,e=r)}else t=e,e=r;return e}function Z(){var e,s,n,i;if(e=Gs(),e===r)if(e=t,s=Ts(),s!==r){for(n=[],i=S();i!==r;)n.push(i),i=S();s=[s,n],e=s}else t=e,e=r;return e}function Pe(){var e;return a.charCodeAt(t)===45?(e=w,t++):(e=r,f===0&&o(we)),e}function Zs(){var e;return a.charCodeAt(t)===43?(e=b,t++):(e=r,f===0&&o(gr)),e}function Gs(){var e;return a.charCodeAt(t)===48?(e=p,t++):(e=r,f===0&&o(vr)),e}function S(){var e;return or.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o($r)),e}function u(){var e,s;for(f++,e=[],me.test(a.charAt(t))?(s=a.charAt(t),t++):(s=r,f===0&&o(ye));s!==r;)e.push(s),me.test(a.charAt(t))?(s=a.charAt(t),t++):(s=r,f===0&&o(ye));return f--,s=r,f===0&&o(hr),e}function R(){var e,s,n,i;return e=t,s=u(),a.charCodeAt(t)===44?(n=g,t++):(n=r,f===0&&o(mr)),n!==r?(i=u(),s=[s,n,i],e=s):(t=e,e=r),e}function Se(){var e,s,n,i;return e=t,s=u(),a.charCodeAt(t)===124?(n=_,t++):(n=r,f===0&&o(_r)),n!==r?(i=u(),s=[s,n,i],e=s):(t=e,e=r),e}function L(){var e;return a.charCodeAt(t)===34?(e=C,t++):(e=r,f===0&&o(dr)),e===r&&(a.charCodeAt(t)===39?(e=j,t++):(e=r,f===0&&o(wr))),e}function G(){var e;return cr.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(yr)),e===r&&(a.charCodeAt(t)===45?(e=w,t++):(e=r,f===0&&o(we)),e===r&&(a.charCodeAt(t)===35?(e=T,t++):(e=r,f===0&&o(Ar)),e===r&&(a.charCodeAt(t)===46?(e=A,t++):(e=r,f===0&&o(de)),e===r&&(a.charCodeAt(t)===94?(e=z,t++):(e=r,f===0&&o(br)),e===r&&(a.charCodeAt(t)===95?(e=Ge,t++):(e=r,f===0&&o(Cr))))))),e}function Re(){var e,s,n;if(e=t,u(),s=[],n=G(),n!==r)for(;n!==r;)s.push(n),n=G();else s=r;return s!==r?(n=u(),v=e,e=es(s)):(t=e,e=r),e}function Us(){var e,s,n,i;return e=t,u(),a.charCodeAt(t)===91?(s=re,t++):(s=r,f===0&&o(Ae)),s!==r?(u(),n=De(),n!==r?(u(),a.charCodeAt(t)===93?(i=se,t++):(i=r,f===0&&o(be)),i!==r?(u(),v=e,e=rs(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Xs(){var e,s,n,i,l;return e=t,u(),a.charCodeAt(t)===123?(s=Ue,t++):(s=r,f===0&&o(xr)),s!==r?(u(),n=at(),n!==r?(u(),a.charCodeAt(t)===125?(i=Xe,t++):(i=r,f===0&&o(Er)),i!==r?(l=Hs(),l===r&&(l=null),u(),v=e,e=ss(n,l)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Hs(){var e,s,n;return e=t,a.charCodeAt(t)===37?(s=He,t++):(s=r,f===0&&o(Fr)),s!==r?(n=q(),n!==r?(v=e,e=ts(n)):(t=e,e=r)):(t=e,e=r),e}function Js(){var e,s,n,i;return e=t,u(),a.charCodeAt(t)===60?(s=Je,t++):(s=r,f===0&&o(jr)),s!==r?(u(),n=k(),n!==r?(u(),a.charCodeAt(t)===62?(i=Ke,t++):(i=r,f===0&&o(kr)),i!==r?(u(),v=e,e=ns(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function q(){var e;return e=Re(),e===r&&(e=Us(),e===r&&(e=Xs(),e===r&&(e=Js()))),e}function Le(){var e;return e=Ks(),e===r&&(e=Vs(),e===r&&(e=Ys(),e===r&&(e=et(),e===r&&(e=Qs(),e===r&&(e=rt(),e===r&&(e=st(),e===r&&(e=tt()))))))),e}function Ks(){var e,s,n;return e=t,a.charCodeAt(t)===64?(s=Qe,t++):(s=r,f===0&&o(Pr)),s!==r?(n=F(),n!==r?(v=e,e=as(n)):(t=e,e=r)):(t=e,e=r),e}function Qs(){var e,s,n;return e=t,a.charCodeAt(t)===33?(s=Ve,t++):(s=r,f===0&&o(Sr)),s!==r?(n=F(),n!==r?(v=e,e=is(n)):(t=e,e=r)):(t=e,e=r),e}function Vs(){var e,s,n,i,l,y,x;return e=t,a.charCodeAt(t)===40?(s=Ye,t++):(s=r,f===0&&o(Rr)),s!==r?(u(),n=N(),n!==r?(u(),i=R(),i!==r?(u(),l=N(),l!==r?(u(),R(),u(),y=N(),y===r&&(y=null),u(),a.charCodeAt(t)===41?(x=er,t++):(x=r,f===0&&o(Lr)),x!==r?(v=e,e=fs(n,l,y)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Ys(){var e,s,n;return e=t,a.charCodeAt(t)===47?(s=rr,t++):(s=r,f===0&&o(qr)),s!==r?(n=q(),n!==r?(v=e,e=os(n)):(t=e,e=r)):(t=e,e=r),e}function et(){var e,s,n;return e=t,a.charCodeAt(t)===42?(s=sr,t++):(s=r,f===0&&o(Dr)),s!==r?(n=q(),n!==r?(v=e,e=cs(n)):(t=e,e=r)):(t=e,e=r),e}function rt(){var e,s,n;return e=t,a.charCodeAt(t)===63?(s=tr,t++):(s=r,f===0&&o(Ir)),s!==r?(n=F(),n===r&&(n=null),v=e,e=ls(n)):(t=e,e=r),e}function st(){var e,s,n;return e=t,a.charCodeAt(t)===58?(s=nr,t++):(s=r,f===0&&o(Or)),s!==r?(n=q(),n!==r?(v=e,e=us(n)):(t=e,e=r)):(t=e,e=r),e}function tt(){var e,s,n;return e=t,a.substr(t,2)===te?(s=te,t+=2):(s=r,f===0&&o(Nr)),s!==r?(n=q(),n!==r?(v=e,e=ps(n)):(t=e,e=r)):(t=e,e=r),e}function N(){var e,s,n,i;if(e=t,s=q(),s!==r){for(n=[],i=Le();i!==r;)n.push(i),i=Le();v=e,e=gs(s,n)}else t=e,e=r;return e}function k(){var e,s,n;if(e=t,s=[],n=N(),n!==r)for(;n!==r;)s.push(n),n=N();else s=r;return s!==r&&(v=e,s=vs(s)),e=s,e}function qe(){var e,s,n,i,l;if(e=t,s=[],n=t,i=R(),i!==r?(l=k(),l!==r?n=l:(t=n,n=r)):(t=n,n=r),n!==r)for(;n!==r;)s.push(n),n=t,i=R(),i!==r?(l=k(),l!==r?n=l:(t=n,n=r)):(t=n,n=r);else s=r;return s!==r&&(v=e,s=$s(s)),e=s,e}function nt(){var e,s,n,i,l;if(e=t,s=[],n=t,i=Se(),i!==r?(l=k(),l!==r?n=l:(t=n,n=r)):(t=n,n=r),n!==r)for(;n!==r;)s.push(n),n=t,i=Se(),i!==r?(l=k(),l!==r?n=l:(t=n,n=r)):(t=n,n=r);else s=r;return s!==r&&(v=e,s=hs(s)),e=s,e}function De(){var e,s,n;return e=t,s=k(),s!==r?(n=qe(),n===r&&(n=nt()),n===r&&(n=null),v=e,e=ms(s,n)):(t=e,e=r),e}function at(){var e,s,n;return e=t,s=k(),s!==r?(n=qe(),n===r&&(n=null),v=e,e=_s(s,n)):(t=e,e=r),e}function it(){var e,s,n,i;return e=t,u(),s=L(),s!==r?(u(),n=De(),n!==r?(u(),i=L(),i!==r?(v=e,e=ds(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function ft(){var e;return e=$t(),e===r&&(e=ut(),e===r&&(e=vt(),e===r&&(e=ct(),e===r&&(e=lt(),e===r&&(e=ot(),e===r&&(e=gt(),e===r&&(e=pt()))))))),e}function ot(){var e,s,n;return e=t,a.substr(t,6)===ne?(s=ne,t+=6):(s=r,f===0&&o(Br)),s!==r?(u(),n=D(),n!==r?(v=e,e=ws(n)):(t=e,e=r)):(t=e,e=r),e}function ct(){var e,s,n,i,l;return e=t,a.substr(t,6)===ae?(s=ae,t+=6):(s=r,f===0&&o(Tr)),s!==r?(u(),n=L(),n!==r?(i=Re(),i!==r?(l=L(),l!==r?(v=e,e=ys(i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function lt(){var e,s,n,i;return e=t,a.substr(t,6)===ie?(s=ie,t+=6):(s=r,f===0&&o(zr)),s!==r?(u(),n=Z(),n!==r?(u(),i=Z(),i!==r?(u(),Z(),v=e,e=As(n,i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function ut(){var e,s,n;return e=t,a.substr(t,4)===fe?(s=fe,t+=4):(s=r,f===0&&o(Mr)),s!==r?(u(),n=F(),n!==r?(v=e,e=bs(n)):(t=e,e=r)):(t=e,e=r),e}function pt(){var e,s,n;return e=t,a.substr(t,4)===oe?(s=oe,t+=4):(s=r,f===0&&o(Wr)),s!==r?(u(),n=F(),n!==r?(v=e,e=Cs(n)):(t=e,e=r)):(t=e,e=r),e}function gt(){var e,s,n;return e=t,a.substr(t,4)===ce?(s=ce,t+=4):(s=r,f===0&&o(Zr)),s!==r?(u(),n=F(),n!==r?(v=e,e=xs(n)):(t=e,e=r)):(t=e,e=r),e}function vt(){var e,s,n;return e=t,a.substr(t,4)===le?(s=le,t+=4):(s=r,f===0&&o(Gr)),s!==r?(u(),n=F(),n!==r?(v=e,e=Es(n)):(t=e,e=r)):(t=e,e=r),e}function $t(){var e,s,n,i,l;if(e=t,a.substr(t,5)===ue?(s=ue,t+=5):(s=r,f===0&&o(Ur)),s!==r)if(u(),n=L(),n!==r){if(i=[],l=G(),l!==r)for(;l!==r;)i.push(l),l=G();else i=r;i!==r?(l=L(),l!==r?(v=e,e=Fs(i)):(t=e,e=r)):(t=e,e=r)}else t=e,e=r;else t=e,e=r;return e}function Q(){var e,s,n,i;if(e=t,a.substr(t,2)===pe?(s=pe,t+=2):(s=r,f===0&&o(Xr)),s!==r){for(n=[],_e.test(a.charAt(t))?(i=a.charAt(t),t++):(i=r,f===0&&o(Ce));i!==r;)n.push(i),_e.test(a.charAt(t))?(i=a.charAt(t),t++):(i=r,f===0&&o(Ce));s=[s,n],e=s}else t=e,e=r;return e}function ht(){var e,s,n,i,l,y,x,I;if(e=t,a.substr(t,3)===ge?(s=ge,t+=3):(s=r,f===0&&o(Hr)),s!==r)if(u(),a.charCodeAt(t)===91?(n=re,t++):(n=r,f===0&&o(Ae)),n!==r)if(u(),i=D(),i!==r){for(l=[],y=t,x=R(),x!==r?(I=D(),I!==r?(v=y,y=xe(i,I)):(t=y,y=r)):(t=y,y=r);y!==r;)l.push(y),y=t,x=R(),x!==r?(I=D(),I!==r?(v=y,y=xe(i,I)):(t=y,y=r)):(t=y,y=r);y=u(),a.charCodeAt(t)===93?(x=se,t++):(x=r,f===0&&o(be)),x!==r?(v=e,e=js(i,l)):(t=e,e=r)}else t=e,e=r;else t=e,e=r;else t=e,e=r;return e}function mt(){var e;return e=ht(),e===r&&(e=it()),e}function D(){var e,s,n,i,l;if(e=t,s=mt(),s!==r){for(u(),n=[],i=Q();i!==r;)n.push(i),i=Q();v=e,e=ks(s)}else t=e,e=r;return e===r&&(e=t,s=ft(),s!==r?(u(),a.charCodeAt(t)===36?(n=ar,t++):(n=r,f===0&&o(Jr)),n!==r?(i=u(),l=D(),l!==r?(v=e,e=Ps(s,l)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)),e}function _t(){var e,s;return e=t,s=D(),s!==r&&(v=e,s=Ss(s)),e=s,e===r&&(e=Q()),e}function dt(){var e;return e=_t(),e}function wt(){var e,s;return e=t,u(),s=yt(),s===r&&(s=At(),s===r&&(s=bt())),s!==r?(u(),v=e,e=Rs(s)):(t=e,e=r),e}function yt(){var e,s,n;return e=t,a.substr(t,6)===ve?(s=ve,t+=6):(s=r,f===0&&o(Kr)),s!==r?(u(),n=F(),n!==r?(v=e,e=Ls(n)):(t=e,e=r)):(t=e,e=r),e}function At(){var e,s,n;return e=t,a.substr(t,6)===$e?(s=$e,t+=6):(s=r,f===0&&o(Qr)),s!==r?(u(),n=F(),n!==r?(v=e,e=qs(n)):(t=e,e=r)):(t=e,e=r),e}function bt(){var e,s;return e=t,a.substr(t,4)===he?(s=he,t+=4):(s=r,f===0&&o(Vr)),s!==r&&(v=e,s=Ds()),e=s,e}function Ct(){var e;return e=dt(),e===r&&(e=wt()),e}var xt=function(e){this.type_="atom",this.source_=e,this.location_=Ee()},U=function(e,s,n){this.type_="pattern",this.arguments_={alignment:s},n!==void 0&&(this.arguments_.seed=n),this.source_=e},Et=function(e,s,n){this.type_=e,this.arguments_=s,this.source_=n},Ft=function(e,s){this.type_="element",this.source_=e,this.options_=s,this.location_=Ee()},V=function(e,s){this.type_="command",this.name_=e,this.options_=s},Ie=0;if(W=d(),W!==r&&t===a.length)return W;throw W!==r&&t<a.length&&o(Os()),Ns(J,E<a.length?a.charAt(E):null,E<a.length?K(E,E+1):K(E,E))}const Me=3e-4,It=(a,c)=>(r,h)=>{const A=a.source_[h].options_?.ops;if(A)for(const w of A)switch(w.type_){case"stretch":{const b=["fast","slow"],{type:p,amount:g}=w.arguments_;if(!b.includes(p))throw new Error(`mini: stretch: type must be one of ${b.join("|")} but got ${p}`);r=X(r)[p](c(g));break}case"bjorklund":{w.arguments_.rotation?r=r.euclidRot(c(w.arguments_.pulse),c(w.arguments_.step),c(w.arguments_.rotation)):r=r.euclid(c(w.arguments_.pulse),c(w.arguments_.step));break}case"degradeBy":{r=X(r)._degradeByWith(Te.early(Me*w.arguments_.seed),w.arguments_.amount??.5);break}case"tail":{const b=c(w.arguments_.element);r=r.fmap(p=>g=>Array.isArray(p)?[...p,g]:[p,g]).appLeft(b);break}case"range":{const b=c(w.arguments_.element);r=X(r);const p=(_,C,j=1)=>Array.from({length:Math.abs(C-_)/j+1},(T,z)=>_<C?_+z*j:_-z*j);r=((_,C)=>_.squeezeBind(j=>C.bind(T=>Lt(...p(j,T)))))(r,b);break}default:console.warn(`operator "${w.type_}" not implemented`)}return r};function Ot(a){a.source_=St(a.source_.map(c=>{const{reps:r}=c.options_||{};return r?(delete c.options_.reps,Array(r).fill(c)):[c]}))}function B(a,c,r,h=0){r?.(a);const m=d=>B(d,c,r,h);switch(a.type_){case"pattern":{Ot(a);const d=a.source_.map(p=>m(p)).map(It(a,m)),A=a.arguments_.alignment;if(A==="stack")return Ne(...d);if(A==="polymeter"){const p=a.arguments_.stepsPerCycle?m(a.arguments_.stepsPerCycle).fmap(_=>Be(_)):Y(Be(d.length>0?d[0].__weight:1)),g=d.map(_=>_.fast(p.fmap(C=>C.div(_.__weight||1))));return Ne(...g)}if(A==="rand")return jt(Te.early(Me*a.arguments_.seed).segment(1),d);const w=a.source_.some(p=>!!p.options_?.weight);if(!w&&A==="slowcat")return kt(...d);if(w){const p=a.source_.reduce((_,C)=>_+(C.options_?.weight||1),0),g=Pt(...a.source_.map((_,C)=>[_.options_?.weight||1,d[C]]));return A==="slowcat"?g._slow(p):(g.__weight=p,g)}const b=ze(...d);return b.__weight=d.length,b}case"element":return m(a.source_);case"atom":{if(a.source_==="~")return Oe;if(!a.location_)return console.warn("no location for",a),a.source_;const d=isNaN(Number(a.source_))?a.source_:Number(a.source_);if(h===-1)return Y(d);const[A,w]=We(c,a,h);return Y(d).withLoc(A,w)}case"stretch":return m(a.source_).slow(m(a.arguments_.amount));default:return console.warn(`node type "${a.type_}" not implemented -> returning silence`),Oe}}const We=(a,c,r=0)=>{const{start:h,end:m}=c.location_,d=a?.split("").slice(h.offset,m.offset).join(""),[A=0,w=0]=d?d.split(c.source_).map(b=>b.split("").filter(p=>p===" ").length):[];return[h.offset+A+r,m.offset-w+r]},H=a=>Dt(a),Nt=a=>{const c=H(a);let r=[];return B(c,a,h=>{h.type_==="atom"&&r.push(h)},-1),r},Tt=(a,c=0)=>Nt(a).map(r=>We(a,r,c)),Ze=(...a)=>{const c=a.map(r=>{const h=`"${r}"`,m=H(h);return B(m,h)});return ze(...c)},zt=(a,c)=>{const r=`"${a}"`,h=H(r);return B(h,r,null,c)},Mt=a=>{const c=H(a);return B(c,a)};function Wt(a){return typeof a=="string"?Ze(a):X(a)}function Zt(){Rt(Ze)}export{Nt as a,Tt as b,Ze as c,zt as d,Wt as e,Zt as f,We as g,Mt as h,O as i,Dt as j,H as m,B as p};
//# sourceMappingURL=mini.03263755.js.map
