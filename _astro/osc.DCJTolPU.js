import{c as B,g as ee}from"./_commonjsHelpers.BosuxZz1.js";import{P as ne,p as et,f as re,n as oe,l as se,C as ie}from"./index.lg0qkVDO.js";var Ot={exports:{}};(function(b,C){(function(f,g){b.exports=g()})(B,function(){function f(n,t,e){return t=d(t),function(r,o){if(o&&(typeof o=="object"||typeof o=="function"))return o;if(o!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}(r)}(n,g()?Reflect.construct(t,e||[],d(n).constructor):t.apply(n,e))}function g(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(g=function(){return!!n})()}function c(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),e.push.apply(e,r)}return e}function a(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?c(Object(e),!0).forEach(function(r){U(n,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):c(Object(e)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(e,r))})}return n}function V(n){var t=function(e,r){if(typeof e!="object"||!e)return e;var o=e[Symbol.toPrimitive];if(o!==void 0){var s=o.call(e,r||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}(n,"string");return typeof t=="symbol"?t:t+""}function l(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function W(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,V(r.key),r)}}function h(n,t,e){return t&&W(n.prototype,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function U(n,t,e){return(t=V(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function v(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&G(n,t)}function d(n){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},d(n)}function G(n,t){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e},G(n,t)}function Et(n,t){for(;!Object.prototype.hasOwnProperty.call(n,t)&&(n=d(n))!==null;);return n}function w(){return w=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(n,t,e){var r=Et(n,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?n:e):o.value}},w.apply(this,arguments)}function m(n){return Number(n)===n&&n%1==0}function rt(n){return Number(n)===n}function y(n){return typeof n=="string"}function ot(n){return typeof n=="boolean"}function st(n){return n===1/0}function D(n){return Object.prototype.toString.call(n)==="[object Array]"}function $(n){return Object.prototype.toString.call(n)==="[object Object]"}function x(n){return typeof n=="function"}function it(n){return n instanceof Uint8Array}function Ct(n){return n instanceof Date}function A(n){return n===void 0}function at(n){return n===null}function _(n){return n+3&-4}function ut(n){return Object.prototype.hasOwnProperty.call(typeof B<"u"?B:window,n)}function Pt(n){return n.buffer?new DataView(n.buffer):n instanceof ArrayBuffer?new DataView(n):new DataView(new Uint8Array(n))}function ct(n){if(m(n))return"i";if(t=n,Number(t)===t&&t%1!=0)return"f";if(y(n))return"s";if(it(n))return"b";if(ot(n))return n?"T":"F";if(at(n))return"N";if(st(n))return"I";var t;throw new Error("OSC typeTag() found unknown value type")}function T(n){var t="";if(D(n))return"/".concat(n.join("/"));if(y(n))return(t=n).length>1&&t[t.length-1]==="/"&&(t=t.slice(0,t.length-1)),t.length>1&&t[0]!=="/"&&(t="/".concat(t)),t;throw new Error("OSC prepareAddress() needs addresses of type array or string")}function ft(n){if(!y(n))throw new Error("OSC prepareRegExPattern() needs strings");return n.replace(/\./g,"\\.").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\{/g,"(").replace(/\}/g,")").replace(/,/g,"|").replace(/\[!/g,"[^").replace(/\?/g,".").replace(/\*/g,".*")}var lt=h(function n(){l(this,n),this.data=[],this.byteLength=0},[{key:"add",value:function(n){if(ot(n)||st(n)||at(n))return this;var t=n.pack();return this.byteLength+=t.byteLength,this.data.push(t),this}},{key:"merge",value:function(){var n=new Uint8Array(this.byteLength),t=0;return this.data.forEach(function(e){n.set(e,t),t+=e.byteLength}),n}}]),P=h(function n(t){l(this,n),this.value=t,this.offset=0},[{key:"pack",value:function(n,t){if(!n||!t)throw new Error("OSC Atomic cant't be packed without given method or byteLength");var e=new Uint8Array(t),r=new DataView(e.buffer);if(A(this.value))throw new Error("OSC Atomic cant't be encoded with empty value");return r[n](this.offset,this.value,!1),e}},{key:"unpackWithMethod",value:function(n,t,e){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(!(n&&t&&e))throw new Error("OSC Atomic cant't be unpacked without given dataView, method or byteLength");if(!(n instanceof DataView))throw new Error("OSC Atomic expects an instance of type DataView");return this.value=n[t](r,!1),this.offset=r+e,this.offset}}]),F=function(n){function t(e){if(l(this,t),e&&!m(e))throw new Error("OSC AtomicInt32 constructor expects value of type number");return f(this,t,[e])}return v(t,n),h(t,[{key:"pack",value:function(){return w(d(t.prototype),"pack",this).call(this,"setInt32",4)}},{key:"unpack",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return w(d(t.prototype),"unpackWithMethod",this).call(this,e,"getInt32",4,r)}}])}(P),ht="utf-8";function At(n){if(ut("Buffer"))return Buffer.from(n).toString(ht);if(ut("TextDecoder"))return new TextDecoder(ht).decode(new Int8Array(n));for(var t="",e=0;e<n.length;e+=65537)t+=String.fromCharCode.apply(null,n.slice(e,e+65537));return t}var S=function(n){function t(e){if(l(this,t),e&&!y(e))throw new Error("OSC AtomicString constructor expects value of type string");return f(this,t,[e])}return v(t,n),h(t,[{key:"pack",value:function(){if(A(this.value))throw new Error("OSC AtomicString can not be encoded with empty value");for(var e="".concat(this.value,"\0"),r=_(e.length),o=new Uint8Array(r),s=0;s<e.length;s+=1)o[s]=e.charCodeAt(s);return o}},{key:"unpack",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!(e instanceof DataView))throw new Error("OSC AtomicString expects an instance of type DataView");for(var o,s=r,i=[];s<e.byteLength;s+=1){if((o=e.getUint8(s))===0){s+=1;break}i.push(o)}if(s===e.length)throw new Error("OSC AtomicString found a malformed OSC string");return this.offset=_(s),this.value=At(i),this.offset}}])}(P),pt=2208988800,dt=4294967296,J=h(function n(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(l(this,n),!m(t)||!m(e))throw new Error("OSC Timetag constructor expects values of type integer number");this.seconds=t,this.fractions=e},[{key:"timestamp",value:function(n){var t;if(typeof n=="number"){t=n/1e3;var e=Math.floor(t);return this.seconds=e+pt,this.fractions=Math.round(dt*(t-e)),n}return 1e3*((t=this.seconds-pt)+Math.round(this.fractions/dt))}}]),M=function(n){function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Date.now();l(this,t);var r=new J;return e instanceof J?r=e:m(e)?r.timestamp(e):Ct(e)&&r.timestamp(e.getTime()),f(this,t,[r])}return v(t,n),h(t,[{key:"pack",value:function(){if(A(this.value))throw new Error("OSC AtomicTimetag can not be encoded with empty value");var e=this.value,r=e.seconds,o=e.fractions,s=new Uint8Array(8),i=new DataView(s.buffer);return i.setInt32(0,r,!1),i.setInt32(4,o,!1),s}},{key:"unpack",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!(e instanceof DataView))throw new Error("OSC AtomicTimetag expects an instance of type DataView");var o=e.getUint32(r,!1),s=e.getUint32(r+4,!1);return this.value=new J(o,s),this.offset=r+8,this.offset}}])}(P),gt=function(n){function t(e){if(l(this,t),e&&!it(e))throw new Error("OSC AtomicBlob constructor expects value of type Uint8Array");return f(this,t,[e])}return v(t,n),h(t,[{key:"pack",value:function(){if(A(this.value))throw new Error("OSC AtomicBlob can not be encoded with empty value");var e=_(this.value.byteLength),r=new Uint8Array(e+4);return new DataView(r.buffer).setInt32(0,this.value.byteLength,!1),r.set(this.value,4),r}},{key:"unpack",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!(e instanceof DataView))throw new Error("OSC AtomicBlob expects an instance of type DataView");var o=e.getInt32(r,!1);return this.value=new Uint8Array(e.buffer,r+4,o),this.offset=_(r+4+o),this.offset}}])}(P),vt=function(n){function t(e){if(l(this,t),e&&!rt(e))throw new Error("OSC AtomicFloat32 constructor expects value of type float");return f(this,t,[e])}return v(t,n),h(t,[{key:"pack",value:function(){return w(d(t.prototype),"pack",this).call(this,"setFloat32",4)}},{key:"unpack",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return w(d(t.prototype),"unpackWithMethod",this).call(this,e,"getFloat32",4,r)}}])}(P),wt=function(n){function t(e){if(l(this,t),e&&!rt(e))throw new Error("OSC AtomicFloat64 constructor expects value of type float");return f(this,t,[e])}return v(t,n),h(t,[{key:"pack",value:function(){return w(d(t.prototype),"pack",this).call(this,"setFloat64",8)}},{key:"unpack",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return w(d(t.prototype),"unpackWithMethod",this).call(this,e,"getFloat64",8,r)}}])}(P),It=BigInt("9223372036854775807"),jt=BigInt("-9223372036854775808"),yt=function(n){function t(e){if(l(this,t),e&&typeof e!="bigint")throw new Error("OSC AtomicInt64 constructor expects value of type BigInt");if(e&&(e<jt||e>It))throw new Error("OSC AtomicInt64 value is out of bounds");var r;return e&&(r=BigInt.asIntN(64,e)),f(this,t,[r])}return v(t,n),h(t,[{key:"pack",value:function(){return w(d(t.prototype),"pack",this).call(this,"setBigInt64",8)}},{key:"unpack",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return w(d(t.prototype),"unpackWithMethod",this).call(this,e,"getBigInt64",8,r)}}])}(P),Dt=BigInt("18446744073709551615"),mt=function(n){function t(e){if(l(this,t),e&&typeof e!="bigint")throw new Error("OSC AtomicUInt64 constructor expects value of type BigInt");if(e&&(e<0||e>Dt))throw new Error("OSC AtomicUInt64 value is out of bounds");var r;return e&&(r=BigInt.asUintN(64,e)),f(this,t,[r])}return v(t,n),h(t,[{key:"pack",value:function(){return w(d(t.prototype),"pack",this).call(this,"setBigUint64",8)}},{key:"unpack",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return w(d(t.prototype),"unpackWithMethod",this).call(this,e,"getBigUint64",8,r)}}])}(P),Z=!0,q=!1,K=null,Q=1/0,X=h(function n(t,e){var r=this;if(l(this,n),this.offset=0,this.address="",this.types="",this.args=[],!A(t)){if(!y(t)&&!D(t))throw new Error("OSC Message constructor first argument (address) must be a string or array");this.address=T(t)}if(!A(e)){if(!D(e))throw new Error("OSC Message constructor second argument (args) must be an array");e.forEach(function(o){return r.add(o.type,o.value)})}},[{key:"add",value:function(n,t){if(A(n))throw new Error("OSC Message needs a valid OSC Atomic Data Type");n==="N"?this.args.push(K):n==="T"?this.args.push(Z):n==="F"?this.args.push(q):n==="I"?this.args.push(Q):this.args.push(t),this.types+=n}},{key:"pack",value:function(){var n=this;if(this.address.length===0||this.address[0]!=="/")throw new Error("OSC Message has an invalid address");var t=new lt;if(t.add(new S(this.address)),t.add(new S(",".concat(this.types))),this.args.length>0){var e;if(this.args.length>this.types.length)throw new Error("OSC Message argument and type tag mismatch");this.args.forEach(function(r,o){var s=n.types[o];if(s==="i")e=new F(r);else if(s==="h")e=new yt(r);else if(s==="t")e=new mt(r);else if(s==="f")e=new vt(r);else if(s==="d")e=new wt(r);else if(s==="s")e=new S(r);else if(s==="b")e=new gt(r);else if(s==="T")e=Z;else if(s==="F")e=q;else if(s==="N")e=K;else{if(s!=="I")throw new Error("OSC Message found unknown argument type");e=Q}t.add(e)})}return t.merge()}},{key:"unpack",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!(n instanceof DataView))throw new Error("OSC Message expects an instance of type DataView.");var e=new S;e.unpack(n,t);var r=new S;if(r.unpack(n,e.offset),e.value.length===0||e.value[0]!=="/")throw new Error("OSC Message found malformed or missing address string");if(r.value.length===0&&r.value[0]!==",")throw new Error("OSC Message found malformed or missing type string");for(var o,s,i=r.offset,u=[],p=1;p<r.value.length;p+=1){if(o=null,(s=r.value[p])==="i")o=new F;else if(s==="h")o=new yt;else if(s==="t")o=new mt;else if(s==="f")o=new vt;else if(s==="d")o=new wt;else if(s==="s")o=new S;else if(s==="b")o=new gt;else if(s==="T")u.push(Z);else if(s==="F")u.push(q);else if(s==="N")u.push(K);else{if(s!=="I")throw new Error("OSC Message found unsupported argument type");u.push(Q)}o&&(i=o.unpack(n,i),u.push(o.value))}return this.offset=i,this.address=e.value,this.types=r.value,this.args=u,this.offset}}]),O=function(n){function t(e){var r,o;l(this,t);for(var s=arguments.length,i=new Array(s>1?s-1:0),u=1;u<s;u++)i[u-1]=arguments[u];return i.length>0&&i[0]instanceof Array&&(o=i.shift()),r=f(this,t,[e,o]),i.length>0&&(r.types=i.map(function(p){return ct(p)}).join(""),r.args=i),r}return v(t,n),h(t,[{key:"add",value:function(e){w(d(t.prototype),"add",this).call(this,ct(e),e)}}])}(X),z="#bundle",I=function(){function n(){var t=this;l(this,n),this.offset=0,this.timetag=new M,this.bundleElements=[];for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];r.length>0&&(r[0]instanceof Date||m(r[0])?this.timetag=new M(r[0]):D(r[0])?(r[0].forEach(function(s){t.add(s)}),r.length>1&&(r[1]instanceof Date||m(r[1]))&&(this.timetag=new M(r[1]))):r.forEach(function(s){t.add(s)}))}return h(n,[{key:"timestamp",value:function(t){if(!m(t))throw new Error("OSC Bundle needs an integer for setting the timestamp");this.timetag=new M(t)}},{key:"add",value:function(t){if(!(t instanceof O||t instanceof n))throw new Error("OSC Bundle contains only Messages and Bundles");this.bundleElements.push(t)}},{key:"pack",value:function(){var t=new lt;return t.add(new S(z)),this.timetag||(this.timetag=new M),t.add(this.timetag),this.bundleElements.forEach(function(e){t.add(new F(e.pack().byteLength)),t.add(e)}),t.merge()}},{key:"unpack",value:function(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC Bundle expects an instance of type DataView");var r=new S;if(r.unpack(t,e),r.value!==z)throw new Error("OSC Bundle does not contain a valid #bundle head");var o=new M,s=o.unpack(t,r.offset);for(this.bundleElements=[];s<t.byteLength;){var i=new S,u=new F;s=u.unpack(t,s);var p=void 0;i.unpack(t,s),s=(p=i.value===z?new n:new O).unpack(t,s),this.bundleElements.push(p)}return this.offset=s,this.timetag=o,this.offset}}])}(),j=h(function n(t){if(l(this,n),t&&!(t instanceof O||t instanceof I))throw new Error("OSC Packet value has to be Message or Bundle");this.value=t,this.offset=0},[{key:"pack",value:function(){if(!this.value)throw new Error("OSC Packet can not be encoded with empty body");return this.value.pack()}},{key:"unpack",value:function(n){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!(n instanceof DataView))throw new Error("OSC Packet expects an instance of type DataView");if(n.byteLength%4!=0)throw new Error("OSC Packet byteLength has to be a multiple of four");var e,r=new S;return r.unpack(n,t),(e=r.value===z?new I:new O).unpack(n,t),this.offset=e.offset,this.value=e,this.offset}}]),xt={discardLateMessages:!1},Mt=h(function n(t){l(this,n),this.options=a(a({},xt),t),this.addressHandlers=[],this.eventHandlers={open:[],error:[],close:[]},this.uuid=0},[{key:"dispatch",value:function(n,t){var e=this;if(!(n instanceof j))throw new Error("OSC EventHander dispatch() accepts only arguments of type Packet");if(!n.value)throw new Error("OSC EventHander dispatch() can't read empty Packets");if(n.value instanceof I){var r=n.value;return r.bundleElements.forEach(function(s){if(s instanceof I){if(r.timetag.value.timestamp()<s.timetag.value.timestamp())throw new Error("OSC Bundle timestamp is older than the timestamp of enclosed Bundles");return e.dispatch(new j(s))}if(s instanceof O){var i=s;return e.notify(i.address,i,r.timetag.value.timestamp(),t)}throw new Error("OSC EventHander dispatch() can't dispatch unknown Packet value")})}if(n.value instanceof O){var o=n.value;return this.notify(o.address,o,0,t)}throw new Error("OSC EventHander dispatch() can't dispatch unknown Packet value")}},{key:"call",value:function(n,t,e){var r=!1;if(y(n)&&n in this.eventHandlers)return this.eventHandlers[n].forEach(function(i){i.callback(t,e),r=!0}),r;var o=Object.keys(this.addressHandlers),s=this.addressHandlers;return o.forEach(function(i){var u=!1,p=new RegExp(ft(T(n)),"g");if(p.test(i)&&i.length===p.lastIndex&&(u=!0),!u){var E=new RegExp(ft(T(i)),"g");E.test(n)&&n.length===E.lastIndex&&(u=!0)}u&&s[i].forEach(function(N){N.callback(t,e),r=!0})}),r}},{key:"notify",value:function(){for(var n=arguments.length,t=new Array(n),e=0;e<n;e++)t[e]=arguments[e];if(t.length===0)throw new Error("OSC EventHandler can not be called without any argument");try{if(t[0]instanceof j)return this.dispatch(t[0],t[1]);if(t[0]instanceof I||t[0]instanceof O)return this.dispatch(new j(t[0]),t[1]);if(!y(t[0])){var r=new j;return r.unpack(Pt(t[0])),this.dispatch(r,t[1])}var o=t[0],s=null;t.length>1&&(s=t[1]);var i=null;if(t.length>2)if(m(t[2]))i=t[2];else{if(!(t[2]instanceof Date))throw new Error("OSC EventHandler timestamp has to be a number or Date");i=t[2].getTime()}var u=null;if(t.length>=3&&(u=t[3]),i){var p=Date.now();if(p>i&&!this.options.discardLateMessages)return this.call(o,s,u);var E=this;return setTimeout(function(){E.call(o,s,u)},i-p),!0}return this.call(o,s,u)}catch(N){return this.notify("error",N),!1}}},{key:"on",value:function(n,t){if(!y(n)&&!D(n))throw new Error("OSC EventHandler accepts only strings or arrays for address patterns");if(!x(t))throw new Error("OSC EventHandler callback has to be a function");this.uuid+=1;var e={id:this.uuid,callback:t};if(y(n)&&n in this.eventHandlers)return this.eventHandlers[n].push(e),this.uuid;var r=T(n);return r in this.addressHandlers||(this.addressHandlers[r]=[]),this.addressHandlers[r].push(e),this.uuid}},{key:"off",value:function(n,t){if(!y(n)&&!D(n))throw new Error("OSC EventHandler accepts only strings or arrays for address patterns");if(!m(t))throw new Error("OSC EventHandler subscription id has to be a number");var e,r;return y(n)&&n in this.eventHandlers?(e=n,r=this.eventHandlers):(e=T(n),r=this.addressHandlers),e in r&&r[e].some(function(o,s){return o.id===t&&(r[e].splice(s,1),!0)})}}]),H=h(function n(){if(l(this,n),this.constructor===n)throw new Error("Plugin is an abstract class. Please create or use an implementation!")},[{key:"status",value:function(){throw new Error("Abstract method!")}},{key:"open",value:function(){throw new Error("Abstract method!")}},{key:"close",value:function(){throw new Error("Abstract method!")}},{key:"send",value:function(n){throw new Error("Abstract method!")}}]),Bt=0,Tt=1,Ht=2,Nt=3,Lt=function(n){function t(){throw l(this,t),f(this,t),new Error("DatagramPlugin can not be used in browser context")}return v(t,n),h(t,[{key:"registerNotify",value:function(e){this.notify=e}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a(a({},this.options.open),r),s=o.port,i=o.exclusive;this.socketStatus=Bt,this.socket.bind({address:o.host,port:s,exclusive:i},function(){e.socketStatus=Tt,e.notify("open")})}},{key:"close",value:function(){var e=this;this.socketStatus=Ht,this.socket.close(function(){e.socketStatus=Nt,e.notify("close")})}},{key:"send",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=a(a({},this.options.send),r),s=o.port,i=o.host;this.socket.send(Buffer.from(e),0,e.byteLength,s,i)}}])}(H),kt=typeof WebSocket<"u"?WebSocket:typeof MozWebSocket<"u"?MozWebSocket:typeof B<"u"?B.WebSocket||B.MozWebSocket:typeof window<"u"?window.WebSocket||window.MozWebSocket:typeof self<"u"?self.WebSocket||self.MozWebSocket:void 0,Y=void 0,Vt=0,Wt=1,Ut=2,_t=3,R={udpServer:{host:"localhost",port:41234,exclusive:!1},udpClient:{host:"localhost",port:41235},wsServer:{host:"localhost",port:8080},receiver:"ws"};function bt(n,t){return a(a(a(a({},R),n),t),{},{udpServer:a(a(a({},R.udpServer),n.udpServer),t.udpServer),udpClient:a(a(a({},R.udpClient),n.udpClient),t.udpClient),wsServer:a(a(a({},R.wsServer),n.wsServer),t.wsServer)})}var Ft=function(n){function t(){throw l(this,t),f(this,t),new Error("BridgePlugin can not be used in browser context")}return v(t,n),h(t,[{key:"registerNotify",value:function(e){this.notify=e}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=bt(this.options,r);this.socketStatus=Vt,this.socket.bind({address:o.udpServer.host,port:o.udpServer.port,exclusive:o.udpServer.exclusive},function(){var s={};o.wsServer.server?s.server=o.wsServer.server:s=o.wsServer,e.websocket=new Y(s),e.websocket.binaryType="arraybuffer",e.websocket.on("listening",function(){e.socketStatus=Wt,e.notify("open")}),e.websocket.on("error",function(i){e.notify("error",i)}),e.websocket.on("connection",function(i){i.on("message",function(u,p){e.send(u,{receiver:"udp"}),e.notify(new Uint8Array(u),p)})})})}},{key:"close",value:function(){var e=this;this.socketStatus=Ut,this.socket.close(function(){e.websocket.close(function(){e.socketStatus=_t,e.notify("close")})})}},{key:"send",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=bt(this.options,r),s=o.receiver;if(s==="udp"){var i=e instanceof Buffer?e:Buffer.from(e);this.socket.send(i,0,i.byteLength,o.udpClient.port,o.udpClient.host)}else{if(s!=="ws")throw new Error("BridgePlugin can not send message to unknown receiver");this.websocket.clients.forEach(function(u){u.send(e,{binary:!0})})}}}])}(H),zt=-1,Rt=0,Gt=1,$t=2,Jt=3,Zt={host:"localhost",port:8080,secure:!1,protocol:[]},St=function(n){function t(e){var r;if(l(this,t),r=f(this,t),!kt)throw new Error("WebsocketClientPlugin can't find a WebSocket class");return r.options=a(a({},Zt),e),r.socket=null,r.socketStatus=zt,r.notify=function(){},r}return v(t,n),h(t,[{key:"registerNotify",value:function(e){this.notify=e}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a(a({},this.options),r),s=o.port,i=o.host,u=o.secure,p=o.protocol;this.socket&&this.close();var E=u?"wss":"ws",N={address:i,family:E,port:s,size:0};this.socket=new kt("".concat(E,"://").concat(i,":").concat(s),p),this.socket.binaryType="arraybuffer",this.socketStatus=Rt,this.socket.onopen=function(){e.socketStatus=Gt,e.notify("open")},this.socket.onclose=function(){e.socketStatus=Jt,e.notify("close")},this.socket.onerror=function(tt){e.notify("error",tt)},this.socket.onmessage=function(tt){e.notify(tt.data,N)}}},{key:"close",value:function(){this.socketStatus=$t,this.socket.close()}},{key:"send",value:function(e){this.socket.send(e)}}])}(H),qt=0,Kt=1,Qt=2,Xt=3,Yt=function(n){function t(e){throw l(this,t),f(this,t),new Error("WebsocketServerPlugin can not be used in browser context")}return v(t,n),h(t,[{key:"registerNotify",value:function(e){this.notify=e}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=a(a({},this.options),r),s=o.port,i=o.host,u={address:i,family:"wsserver",port:s,size:0};this.socket&&this.close(),o.server?this.socket=new Y({server:o.server}):this.socket=new Y({host:i,port:s}),this.socket.binaryType="arraybuffer",this.socketStatus=qt,this.socket.on("listening",function(){e.socketStatus=Kt,e.notify("open")}),this.socket.on("error",function(p){e.notify("error",p)}),this.socket.on("connection",function(p){p.on("message",function(E){e.notify(new Uint8Array(E),u)})})}},{key:"close",value:function(){var e=this;this.socketStatus=Qt,this.socket.close(function(){e.socketStatus=Xt,e.notify("close")})}},{key:"send",value:function(e){this.socket.clients.forEach(function(r){r.send(e,{binary:!0})})}}])}(H),te={discardLateMessages:!1},k=h(function n(t){if(l(this,n),t&&!$(t))throw new Error("OSC options argument has to be an object.");this.options=a(a({},te),t),this.options.plugin||(this.options.plugin=new St),this.eventHandler=new Mt({discardLateMessages:this.options.discardLateMessages});var e=this.eventHandler;this.options.plugin&&this.options.plugin.registerNotify&&this.options.plugin.registerNotify(function(){return e.notify.apply(e,arguments)})},[{key:"on",value:function(n,t){if(!y(n)||!x(t))throw new Error("OSC on() needs event- or address string and callback function");return this.eventHandler.on(n,t)}},{key:"off",value:function(n,t){if(!y(n)||!m(t))throw new Error("OSC off() needs string and number (subscriptionId) to unsubscribe");return this.eventHandler.off(n,t)}},{key:"open",value:function(n){if(n&&!$(n))throw new Error("OSC open() options argument needs to be an object");if(!this.options.plugin||!x(this.options.plugin.open))throw new Error("OSC Plugin API #open is not implemented!");return this.options.plugin.open(n)}},{key:"status",value:function(){if(!this.options.plugin||!x(this.options.plugin.status))throw new Error("OSC Plugin API #status is not implemented!");return this.options.plugin.status()}},{key:"close",value:function(){if(!this.options.plugin||!x(this.options.plugin.close))throw new Error("OSC Plugin API #close is not implemented!");return this.options.plugin.close()}},{key:"send",value:function(n,t){if(!this.options.plugin||!x(this.options.plugin.send))throw new Error("OSC Plugin API #send is not implemented!");if(!(n instanceof X||n instanceof O||n instanceof I||n instanceof j))throw new Error("OSC send() needs Messages, Bundles or Packets");if(t&&!$(t))throw new Error("OSC send() options argument has to be an object");return this.options.plugin.send(n.pack(),t)}}]);return k.STATUS={IS_NOT_INITIALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3},k.Packet=j,k.Bundle=I,k.Message=O,k.TypedMessage=X,k.Plugin=H,k.DatagramPlugin=Lt,k.WebsocketClientPlugin=St,k.WebsocketServerPlugin=Yt,k.BridgePlugin=Ft,k})})(Ot);var ae=Ot.exports;const nt=ee(ae);let L;function ue(){return L||(L=new Promise((b,C)=>{const f=new nt;f.open(),f.on("open",()=>{const g=f.options?.plugin?.socket?.url;se(`[osc] connected${g?` to ${g}`:""}`),b(f)}),f.on("close",()=>{L=void 0,console.log("[osc] disconnected"),C("OSC connection closed")}),f.on("error",g=>C(g))}).catch(b=>{throw L=void 0,new Error("Could not connect to OSC server. Is it running?")})),L}function ce(b,C){b.ensureObjectValue();const f=b.wholeOrPart().begin.valueOf(),g=b.duration.valueOf(),c=Object.assign({},{cps:C,cycle:f,delta:g},b.value);c.n&&(c.n=et(c.n)),typeof c.note<"u"&&(re(c.note)?c.midinote=oe(c.note,c.octave||3):c.note=et(c.note)),c.bank&&(c.s=c.bank+c.s),c.roomsize&&(c.size=et(c.roomsize)),c.unit==="c"&&c.speed!=null&&(c.speed=c.speed/C);const a=c.channels;return a!=null&&(c.channels=JSON.stringify(a)),c}const fe=new ie({});async function le(b,C,f,g=1,c){const a=await ue(),V=ce(C,g),l=Object.entries(V).flat(),W=Math.round(fe.calculateTimestamp(f,c)*1e3),h=new nt.Message("/dirt/play",...l),U=new nt.Bundle([h],W);U.timestamp(W),a.send(U)}ne.prototype.osc=function(){return this.onTrigger(le)};export{le as oscTrigger,ce as parseControlsFromHap};
//# sourceMappingURL=osc.DCJTolPU.js.map
