import{P as z,g as ce,j as Ee,k as Ie,d as ee,o as Oe,q as Re,n as ze,e as Le,t as We}from"./index.lg0qkVDO.js";const x=(n="test-canvas",e)=>{let{contextType:t="2d",pixelated:o=!1,pixelRatio:i=window.devicePixelRatio}=e||{},r=document.querySelector("#"+n);if(!r){r=document.createElement("canvas"),r.id=n,r.width=window.innerWidth*i,r.height=window.innerHeight*i,r.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",o&&(r.style.imageRendering="pixelated"),document.body.prepend(r);let a;window.addEventListener("resize",()=>{a&&clearTimeout(a),a=setTimeout(()=>{r.width=window.innerWidth*i,r.height=window.innerHeight*i},200)})}return r.getContext(t)};let N={};function ge(n){N[n]!==void 0&&(cancelAnimationFrame(N[n]),delete N[n])}function _e(n){Object.keys(N).forEach(e=>(!n||e.startsWith(n))&&ge(e))}let R={};z.prototype.draw=function(n,e){if(typeof window>"u")return this;let{id:t=1,lookbehind:o=0,lookahead:i=0}=e,r=Math.max(ce(),0);ge(t),o=Math.abs(o),R[t]=(R[t]||[]).filter(p=>!p.isInFuture(r));let a=this.queryArc(r,r+i).filter(p=>p.hasOnset());R[t]=R[t].concat(a);let l;const s=()=>{const p=ce(),d=p+i;R[t]=R[t].filter(u=>u.isInNearPast(o,p));let h=Math.max(l||d,d-1/10);const g=this.queryArc(h,d).filter(u=>u.hasOnset());R[t]=R[t].concat(g),l=d,n(R[t],p,d,this),N[t]=requestAnimationFrame(s)};return N[t]=requestAnimationFrame(s),this};const Ge=(n=!0,e)=>{const t=x();n&&t.clearRect(0,0,t.canvas.width,t.canvas.height),_e(e)};z.prototype.onPaint=function(n){return this.withState(e=>{e.controls.painters||(e.controls.painters=[]),e.controls.painters.push(n)})};z.prototype.getPainters=function(){let n=[];return this.queryArc(0,0,{painters:n}),n};class $e{constructor(e,t){this.onFrame=e,this.onError=t}start(){const e=this;let t=requestAnimationFrame(function o(i){try{e.onFrame(i)}catch(r){e.onError(r)}t=requestAnimationFrame(o)});e.cancel=()=>{cancelAnimationFrame(t)}}stop(){this.cancel&&this.cancel()}}class Je{constructor(e,t){this.visibleHaps=[],this.lastFrame=null,this.drawTime=t,this.painters=[],this.framer=new $e(()=>{if(!this.scheduler){console.warn("Drawer: no scheduler");return}const o=Math.abs(this.drawTime[0]),i=this.drawTime[1],r=this.scheduler.now()+i;if(this.lastFrame===null){this.lastFrame=r;return}const a=this.scheduler.pattern.queryArc(Math.max(this.lastFrame,r-1/10),r);this.lastFrame=r,this.visibleHaps=(this.visibleHaps||[]).filter(s=>s.endClipped>=r-o-i).concat(a.filter(s=>s.hasOnset()));const l=r-i;e(this.visibleHaps,l,this,this.painters)},o=>{console.warn("draw error",o)})}setDrawTime(e){this.drawTime=e}invalidate(e=this.scheduler,t){if(!e)return;t=t??e.now(),this.scheduler=e;let[o,i]=this.drawTime;const[r,a]=[Math.max(t,0),t+i+.1];this.visibleHaps=this.visibleHaps.filter(s=>s.whole.begin<t),this.painters=[];const l=e.pattern.queryArc(r,a,{painters:this.painters});this.visibleHaps=this.visibleHaps.concat(l)}start(e){this.scheduler=e,this.invalidate(),this.framer.start()}stop(){this.framer&&this.framer.stop()}}function Ue(n){return typeof window>"u"?"#fff":getComputedStyle(document.documentElement).getPropertyValue(n)}let ye={background:"#222",foreground:"#75baff",caret:"#ffcc00",selection:"rgba(128, 203, 196, 0.5)",selectionMatch:"#036dd626",lineHighlight:"#00000050",gutterBackground:"transparent",gutterForeground:"#8a919966"};function $(){return ye}function Ve(n){ye=n}let he="#22222210";z.prototype.animate=function({callback:n,sync:e=!1,smear:t=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const o=x();let{clientWidth:i,clientHeight:r}=o.canvas;i*=window.devicePixelRatio,r*=window.devicePixelRatio;let a=t===0?"99":Number((1-t)*100).toFixed(0);a=a.length===1?`0${a}`:a,he=`#200010${a}`;const l=s=>{let p;s=Math.round(s),p=this.slow(1e3).queryArc(s,s),o.fillStyle=he,o.fillRect(0,0,i,r),p.forEach(d=>{let{x:h,y:g,w:u,h:v,s:y,r:P,angle:f=0,fill:C="darkseagreen"}=d.value;if(u*=i,v*=r,P!==void 0&&f!==void 0){const b=f*2*Math.PI,[w,A]=[(i-u)/2,(r-v)/2];h=w+Math.cos(b)*P*w,g=A+Math.sin(b)*P*A}else h*=i-u,g*=r-v;const F={...d.value,x:h,y:g,w:u,h:v};o.fillStyle=C,y==="rect"?o.fillRect(h,g,u,v):y==="ellipse"&&(o.beginPath(),o.ellipse(h+u/2,g+v/2,u/2,v/2,0,0,2*Math.PI),o.fill()),n&&n(o,F,d)}),window.frame=requestAnimationFrame(l)};return window.frame=requestAnimationFrame(l),Ee};const{x:we,y:Ze,w:xe,h:et,angle:tt,r:nt,fill:ot,smear:it}=Ie("x","y","w","h","angle","r","fill","smear"),rt=ee("rescale",function(n,e){return e.mul(we(n).w(n).y(n).h(n))}),at=ee("moveXY",function(n,e,t){return t.add(we(n).y(e))}),st=ee("zoomIn",function(n,e){const t=Oe(1).sub(n).div(2);return e.rescale(n).move(t,t)}),G=(n,e,t)=>n*(t-e)+e,ue=n=>{let{value:e}=n;typeof n.value!="object"&&(e={value:e});let{note:t,n:o,freq:i,s:r}=e;if(i)return Re(i);if(t=t??o,typeof t=="string")try{return ze(t)}catch{return 0}return typeof t=="number"?t:r?"_"+r:e};z.prototype.pianoroll=function(n={}){let{cycles:e=4,playhead:t=.5,overscan:o=0,hideNegative:i=!1,ctx:r=x(),id:a=1}=n,l=-e*t,s=e*(1-t);const p=(d,h)=>(!i||d.whole.begin>=0)&&d.isWithinTime(h+l,h+s);return this.draw((d,h)=>{te({...n,time:h,ctx:r,haps:d.filter(g=>p(g,h))})},{lookbehind:l-o,lookahead:s+o,id:a}),this};function te({time:n,haps:e,cycles:t=4,playhead:o=.5,flipTime:i=0,flipValues:r=0,hideNegative:a=!1,inactive:l=$().foreground,active:s=$().foreground,background:p="transparent",smear:d=0,playheadColor:h=$().foreground,minMidi:g=10,maxMidi:u=90,autorange:v=0,timeframe:y,fold:P=1,vertical:f=0,labels:C=!1,fill:F=1,fillActive:b=!1,strokeActive:w=!0,stroke:A,hideInactive:E=0,colorizeInactive:M=1,fontFamily:H,ctx:c,id:L}={}){const k=c.canvas.width,I=c.canvas.height;let W=-t*o,X=t*(1-o);L&&(e=e.filter(m=>m.hasTag(L))),y&&(console.warn("timeframe is deprecated! use from/to instead"),W=0,X=y);const D=f?I:k,O=f?k:I;let _=f?[D,0]:[0,D];const J=X-W,ne=f?[0,O]:[O,0];let U=u-g+1,j=O/U,V=[];i&&_.reverse(),r&&ne.reverse();const{min:be,max:Pe,values:Ae}=e.reduce(({min:m,max:S,values:Y},B)=>{const q=ue(B);return{min:q<m?q:m,max:q>S?q:S,values:Y.includes(q)?Y:[...Y,q]}},{min:1/0,max:-1/0,values:[]});v&&(g=be,u=Pe,U=u-g+1),V=Ae.sort((m,S)=>typeof m=="number"&&typeof S=="number"?m-S:typeof m=="number"?1:String(m).localeCompare(String(S))),j=P?O/V.length:O/U,c.fillStyle=p,c.globalAlpha=1,d||(c.clearRect(0,0,k,I),c.fillRect(0,0,k,I)),e.forEach(m=>{const S=m.whole.begin<=n&&m.endClipped>n;let Y=A??(w&&S),B=!S&&F||S&&b;if(E&&!S)return;let q=m.value?.color;s=q||s,l=M&&q||l,q=S?s:l,c.fillStyle=B?q:"transparent",c.strokeStyle=q;const{velocity:ke=1,gain:Te=1}=m.value||{};c.globalAlpha=ke*Te;const Fe=(m.whole.begin-(i?X:W))/J,oe=G(Fe,..._);let Q=G(m.duration/J,0,D);const ie=ue(m),Me=P?V.indexOf(ie)/V.length:(Number(ie)-g)/U,re=G(Me,...ne);let ae=0;const se=G(n/J,..._);let K;if(f?K=[re+1-(r?j:0),D-se+oe+ae+1-(i?0:Q),j-2,Q-2]:K=[oe-se+ae+1-(i?Q:0),re+1-(r?0:j),Q-2,j-2],Y&&c.strokeRect(...K),B&&c.fillRect(...K),C){const Se=m.value.note??m.value.s+(m.value.n?`:${m.value.n}`:""),{label:le,activeLabel:qe}=m.value,Ce=(S&&qe||le)??Se;let He=f?Q:j*.75;c.font=`${He}px ${H||"monospace"}`,c.fillStyle=B?"black":q,c.textBaseline="top",c.fillText(Ce,...K)}}),c.globalAlpha=1;const Z=G(-W/J,..._);return c.strokeStyle=h,c.beginPath(),f?(c.moveTo(0,Z),c.lineTo(O,Z)):(c.moveTo(Z,0),c.lineTo(Z,O)),c.stroke(),this}function ve(n,e={}){let[t,o]=n;t=Math.abs(t);const i=o+t,r=i!==0?t/i:0;return{fold:1,...e,cycles:i,playhead:r}}const De=(n={})=>(e,t,o,i)=>te({ctx:e,time:t,haps:o,...ve(i,n)});z.prototype.punchcard=function(n){return this.onPaint(De(n))};z.prototype.wordfall=function(n){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...n})};function lt(n){const{drawTime:e,...t}=n;te({...ve(e),...t})}function je(n,e,t,o){const i=(n-90)*Math.PI/180;return[t+Math.cos(i)*e,o+Math.sin(i)*e]}const fe=(n,e,t,o,i=0)=>je((n+i)*360,e*n,t,o);function de(n){let{ctx:e,from:t=0,to:o=3,margin:i=50,cx:r=100,cy:a=100,rotate:l=0,thickness:s=i/2,color:p=$().foreground,cap:d="round",stretch:h=1,fromOpacity:g=1,toOpacity:u=1}=n;t*=h,o*=h,l*=h,e.lineWidth=s,e.lineCap=d,e.strokeStyle=p,e.globalAlpha=g,e.beginPath();let[v,y]=fe(t,i,r,a,l);e.moveTo(v,y);const P=1/60;let f=t;for(;f<=o;){const[C,F]=fe(f,i,r,a,l);e.globalAlpha=(f-t)/(o-t)*u,e.lineTo(C,F),f+=P}e.stroke()}function Ne(n){let{stretch:e=1,size:t=80,thickness:o=t/2,cap:i="butt",inset:r=3,playheadColor:a="#ffffff",playheadLength:l=.02,playheadThickness:s=o,padding:p=0,steady:d=1,activeColor:h=$().foreground,inactiveColor:g=$().gutterForeground,colorizeInactive:u=0,fade:v=!0,ctx:y,time:P,haps:f,drawTime:C,id:F}=n;F&&(f=f.filter(k=>k.hasTag(F)));const[b,w]=[y.canvas.width,y.canvas.height];y.clearRect(0,0,b*2,w*2);const[A,E]=[b/2,w/2],M={margin:t/e,cx:A,cy:E,stretch:e,cap:i,thickness:o},H={...M,thickness:s,from:r-l,to:r,color:a},[c]=C,L=d*P;f.forEach(k=>{const I=k.whole.begin<=P&&k.endClipped>P,W=k.whole.begin-P+r,X=k.endClipped-P+r-p,D=k.value?.color||h,O=u||I?D:g,_=v?1-Math.abs((k.whole.begin-P)/c):1;de({ctx:y,...M,from:W,to:X,rotate:L,color:O,fromOpacity:_,toOpacity:_})}),de({ctx:y,...H,rotate:L})}z.prototype.spiral=function(n={}){return this.onPaint((e,t,o,i)=>Ne({ctx:e,time:t,haps:o,drawTime:i,...n}))};const Xe=We(36),me=(n,e,t,o)=>{o=o*Math.PI*2;const i=Math.sin(o)*t+n,r=Math.cos(o)*t+e;return[i,r]},pe=(n,e)=>.5-Math.log2(n/e)%1;function Ye({haps:n,ctx:e,id:t,hapcircles:o=1,circle:i=0,edo:r=12,root:a=Xe,thickness:l=3,hapRadius:s=6,mode:p="flake",margin:d=10}={}){const h=p==="polygon",g=p==="flake",u=e.canvas.width,v=e.canvas.height;e.clearRect(0,0,u,v);const y=$().foreground,f=Math.min(u,v)/2-l/2-s-d,C=u/2,F=v/2;t&&(n=n.filter(w=>w.hasTag(t))),e.strokeStyle=y,e.fillStyle=y,e.globalAlpha=1,e.lineWidth=l,i&&(e.beginPath(),e.arc(C,F,f,0,2*Math.PI),e.stroke()),r&&(Array.from({length:r},(w,A)=>{const E=pe(a*Math.pow(2,A/r),a),[M,H]=me(C,F,f,E);e.beginPath(),e.arc(M,H,s,0,2*Math.PI),e.fill()}),e.stroke());let b=[];e.lineWidth=s,n.forEach(w=>{let A;try{A=Le(w)}catch{return}const E=pe(A,a),[M,H]=me(C,F,f,E),c=w.value.color||y;e.strokeStyle=c,e.fillStyle=c;const{velocity:L=1,gain:k=1}=w.value||{},I=L*k;e.globalAlpha=I,b.push([M,H,E,c,I]),e.beginPath(),o&&(e.moveTo(M+s,H),e.arc(M,H,s,0,2*Math.PI),e.fill()),g&&(e.moveTo(C,F),e.lineTo(M,H)),e.stroke()}),e.strokeStyle=y,e.globalAlpha=1,h&&b.length&&(b=b.sort((w,A)=>w[2]-A[2]),e.beginPath(),e.moveTo(b[0][0],b[0][1]),b.forEach(([w,A,E,M,H])=>{e.strokeStyle=M,e.globalAlpha=H,e.lineTo(w,A)}),e.lineTo(b[0][0],b[0][1]),e.stroke())}z.prototype.pitchwheel=function(n={}){let{ctx:e=x(),id:t=1}=n;return this.tag(t).onPaint((o,i,r)=>Ye({...n,time:i,ctx:e,haps:r.filter(a=>a.isActive(i)),id:t}))};let T=[],Be=(n,e)=>{let t=[],o={get(){return o.lc||o.listen(()=>{})(),o.value},l:0,lc:0,listen(i,r){return o.lc=t.push(i,r||o.l)/2,()=>{let a=t.indexOf(i);~a&&(t.splice(a,2),--o.lc||o.off())}},notify(i){let r=!T.length;for(let a=0;a<t.length;a+=2)T.push(t[a],t[a+1],o.value,i);if(r){for(let a=0;a<T.length;a+=4){let l;for(let s=a+1;!l&&(s+=4)<T.length;)T[s]<T[a+1]&&(l=T.push(T[a],T[a+1],T[a+2],T[a+3]));l||T[a](T[a+2],T[a+3])}T.length=0}},off(){},set(i){o.value!==i&&(o.value=i,o.notify())},subscribe(i,r){let a=o.listen(i,r);return i(o.value),a},value:n};return o},ct=(n={})=>{let e=Be(n);return e.setKey=function(t,o){typeof o>"u"?t in e.value&&(e.value={...e.value},delete e.value[t],e.notify(t)):e.value[t]!==o&&(e.value={...e.value,[t]:o},e.notify(t))},e};export{Je as D,$e as F,tt as a,rt as b,Ge as c,Ue as d,$ as e,ot as f,x as g,et as h,Ve as i,ve as j,De as k,lt as l,at as m,Ye as n,ct as o,te as p,Be as q,nt as r,it as s,xe as w,we as x,Ze as y,st as z};
//# sourceMappingURL=index.DrQ6bw7J.js.map
