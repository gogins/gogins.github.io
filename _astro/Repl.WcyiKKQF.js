import{j as e}from"./jsx-runtime.XGodtQ4D.js";import{l as Z,g as le,q as pe,y as fe}from"./index.diuTzW_X.js";import{c as g,B as H,a as xe}from"./PatternsTab.P2Y9oIz_.js";import{g as T,v as ge,w as je,x as ve,y as be,z as we,A as re,B as oe,s as x,C as ye,D as Ce,E as G,F as ke,u as ie,G as Ne,r as Ee,H as q,o as Se,n as K,q as Re,I as Ae,J as Pe,j as L,K as _,L as Te,M as J,N as Ie,O as Y,P as Fe,R as De,Q as $e}from"./useClient.2n2CwdCY.js";import{s as Le,g as z,e as _e,i as Me,w as Be}from"./scope.Uhlw_W3-.js";import{j as Oe,t as Ze,S as He,d as Q}from"./preload-helper.p054LDAL.js";import{r,R as Ke}from"./index.Nkt9jjly.js";/* empty css                      */import{u as ce}from"./useEvent.SpCUZMIs.js";function ze({title:n,titleId:t,...s},l){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},s),n?r.createElement("title",{id:t},n):null,r.createElement("path",{fillRule:"evenodd",d:"M9.664 1.319a.75.75 0 0 1 .672 0 41.059 41.059 0 0 1 8.198 5.424.75.75 0 0 1-.254 1.285 31.372 31.372 0 0 0-7.86 3.83.75.75 0 0 1-.84 0 31.508 31.508 0 0 0-2.08-1.287V9.394c0-.244.116-.463.302-.592a35.504 35.504 0 0 1 3.305-2.033.75.75 0 0 0-.714-1.319 37 37 0 0 0-3.446 2.12A2.216 2.216 0 0 0 6 9.393v.38a31.293 31.293 0 0 0-4.28-1.746.75.75 0 0 1-.254-1.285 41.059 41.059 0 0 1 8.198-5.424ZM6 11.459a29.848 29.848 0 0 0-2.455-1.158 41.029 41.029 0 0 0-.39 3.114.75.75 0 0 0 .419.74c.528.256 1.046.53 1.554.82-.21.324-.455.63-.739.914a.75.75 0 1 0 1.06 1.06c.37-.369.69-.77.96-1.193a26.61 26.61 0 0 1 3.095 2.348.75.75 0 0 0 .992 0 26.547 26.547 0 0 1 5.93-3.95.75.75 0 0 0 .42-.739 41.053 41.053 0 0 0-.39-3.114 29.925 29.925 0 0 0-5.199 2.801 2.25 2.25 0 0 1-2.514 0c-.41-.275-.826-.541-1.25-.797a6.985 6.985 0 0 1-1.084 3.45 26.503 26.503 0 0 0-1.281-.78A5.487 5.487 0 0 0 6 12v-.54Z",clipRule:"evenodd"}))}const Ue=r.forwardRef(ze),Ve=Ue;function We({title:n,titleId:t,...s},l){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},s),n?r.createElement("title",{id:t},n):null,r.createElement("path",{fillRule:"evenodd",d:"M15.312 11.424a5.5 5.5 0 0 1-9.201 2.466l-.312-.311h2.433a.75.75 0 0 0 0-1.5H3.989a.75.75 0 0 0-.75.75v4.242a.75.75 0 0 0 1.5 0v-2.43l.31.31a7 7 0 0 0 11.712-3.138.75.75 0 0 0-1.449-.39Zm1.23-3.723a.75.75 0 0 0 .219-.53V2.929a.75.75 0 0 0-1.5 0V5.36l-.31-.31A7 7 0 0 0 3.239 8.188a.75.75 0 1 0 1.448.389A5.5 5.5 0 0 1 13.89 6.11l.311.31h-2.432a.75.75 0 0 0 0 1.5h4.243a.75.75 0 0 0 .53-.219Z",clipRule:"evenodd"}))}const Xe=r.forwardRef(We),Ge=Xe;function qe({title:n,titleId:t,...s},l){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},s),n?r.createElement("title",{id:t},n):null,r.createElement("path",{d:"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}),r.createElement("path",{d:"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}))}const Je=r.forwardRef(qe),Ye=Je;function Qe({title:n,titleId:t,...s},l){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},s),n?r.createElement("title",{id:t},n):null,r.createElement("path",{fillRule:"evenodd",d:"M2 10a8 8 0 1 1 16 0 8 8 0 0 1-16 0Zm6.39-2.908a.75.75 0 0 1 .766.027l3.5 2.25a.75.75 0 0 1 0 1.262l-3.5 2.25A.75.75 0 0 1 8 12.25v-4.5a.75.75 0 0 1 .39-.658Z",clipRule:"evenodd"}))}const et=r.forwardRef(Qe),de=et;function tt({title:n,titleId:t,...s},l){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},s),n?r.createElement("title",{id:t},n):null,r.createElement("path",{d:"M15.98 1.804a1 1 0 0 0-1.96 0l-.24 1.192a1 1 0 0 1-.784.785l-1.192.238a1 1 0 0 0 0 1.962l1.192.238a1 1 0 0 1 .785.785l.238 1.192a1 1 0 0 0 1.962 0l.238-1.192a1 1 0 0 1 .785-.785l1.192-.238a1 1 0 0 0 0-1.962l-1.192-.238a1 1 0 0 1-.785-.785l-.238-1.192ZM6.949 5.684a1 1 0 0 0-1.898 0l-.683 2.051a1 1 0 0 1-.633.633l-2.051.683a1 1 0 0 0 0 1.898l2.051.684a1 1 0 0 1 .633.632l.683 2.051a1 1 0 0 0 1.898 0l.683-2.051a1 1 0 0 1 .633-.633l2.051-.683a1 1 0 0 0 0-1.898l-2.051-.683a1 1 0 0 1-.633-.633L6.95 5.684ZM13.949 13.684a1 1 0 0 0-1.898 0l-.184.551a1 1 0 0 1-.632.633l-.551.183a1 1 0 0 0 0 1.898l.551.183a1 1 0 0 1 .633.633l.183.551a1 1 0 0 0 1.898 0l.184-.551a1 1 0 0 1 .632-.633l.551-.183a1 1 0 0 0 0-1.898l-.551-.184a1 1 0 0 1-.633-.632l-.183-.551Z"}))}const nt=r.forwardRef(tt),st=nt;function at({title:n,titleId:t,...s},l){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},s),n?r.createElement("title",{id:t},n):null,r.createElement("path",{fillRule:"evenodd",d:"M2 10a8 8 0 1 1 16 0 8 8 0 0 1-16 0Zm5-2.25A.75.75 0 0 1 7.75 7h4.5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-.75.75h-4.5a.75.75 0 0 1-.75-.75v-4.5Z",clipRule:"evenodd"}))}const lt=r.forwardRef(at),rt=lt,{BASE_URL:B}={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://strudel.cc/",ASSETS_PREFIX:void 0},ot=B.endsWith("/")?B.slice(0,-1):B;function it({context:n}){const{embedded:t,started:s,pending:l,isDirty:a,activeCode:i,handleTogglePlay:u,handleEvaluate:o,handleShuffle:h,handleShare:m}=n,d=typeof window<"u"&&(t||window.location!==window.parent.location),{isZen:j}=T();return e.jsxs("header",{id:"header",className:g("flex-none text-black  z-[100] text-lg select-none",!j&&!d&&"bg-lineHighlight",j?"h-12 w-8 fixed top-0 left-0":"sticky top-0 w-full py-1 justify-between",d?"flex":"md:flex"),children:[e.jsx("div",{className:"px-4 flex space-x-2 md:pt-0 select-none",children:e.jsxs("h1",{onClick:()=>{d&&window.open(window.location.href.replace("embed",""))},className:g(d?"text-l cursor-pointer":"text-xl","text-foreground font-bold flex space-x-2 items-center"),children:[e.jsx("div",{className:g("mt-[1px]",s&&"animate-spin","cursor-pointer"),onClick:()=>{d||ge(!j)},children:"🌀"}),!j&&e.jsxs("div",{className:g(s&&"animate-pulse"),children:[e.jsx("span",{className:"",children:"strudel"})," ",e.jsx("span",{className:"text-sm",children:"REPL"})]})]})}),!j&&e.jsxs("div",{className:"flex max-w-full overflow-auto text-foreground",children:[e.jsx("button",{onClick:u,title:s?"stop":"play",className:g(d?"px-2":"p-2","hover:opacity-50",!s&&"animate-pulse"),children:l?e.jsx(e.Fragment,{children:"loading..."}):e.jsxs("span",{className:g("flex items-center space-x-1",d?"":"w-16"),children:[s?e.jsx(rt,{className:"w-6 h-6"}):e.jsx(de,{className:"w-6 h-6"}),!d&&e.jsx("span",{children:s?"stop":"play"})]})}),e.jsxs("button",{onClick:o,title:"update",className:g("flex items-center space-x-1",d?"px-2":"p-2",!a||!i?"opacity-50":"hover:opacity-50"),children:[e.jsx(Ge,{className:"w-6 h-6"}),!d&&e.jsx("span",{children:"update"})]}),!d&&e.jsxs("button",{title:"shuffle",className:"hover:opacity-50 p-2 flex items-center space-x-1",onClick:h,children:[e.jsx(st,{className:"w-6 h-6"}),e.jsx("span",{children:" shuffle"})]}),!d&&e.jsxs("button",{title:"share",className:g("cursor-pointer hover:opacity-50 flex items-center space-x-1",d?"px-2":"p-2"),onClick:m,children:[e.jsx(Ye,{className:"w-6 h-6"}),e.jsx("span",{children:"share"})]}),!d&&e.jsxs("a",{title:"learn",href:`${ot}/workshop/getting-started/`,className:g("hover:opacity-50 flex items-center space-x-1",d?"px-2":"p-2"),children:[e.jsx(Ve,{className:"w-6 h-6"}),e.jsx("span",{children:"learn"})]})]})]})}function ct({active:n}){return e.jsx("div",{className:"overflow-hidden opacity-50 fixed top-0 left-0 w-full z-[1000]",children:e.jsx("div",{className:g("h-[2px] block w-full",n?"bg-foreground animate-train":"bg-transparent"),children:e.jsx("div",{})})})}function dt({title:n,titleId:t,...s},l){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},s),n?r.createElement("title",{id:t},n):null,r.createElement("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"}))}const ut=r.forwardRef(dt),ht=ut;function mt({log:n}){return e.jsxs("div",{id:"console-tab",className:"break-all px-4 dark:text-white text-stone-900 text-sm",children:[e.jsx("pre",{children:`███████╗████████╗██████╗ ██╗   ██╗██████╗ ███████╗██╗     
██╔════╝╚══██╔══╝██╔══██╗██║   ██║██╔══██╗██╔════╝██║     
███████╗   ██║   ██████╔╝██║   ██║██║  ██║█████╗  ██║     
╚════██║   ██║   ██╔══██╗██║   ██║██║  ██║██╔══╝  ██║     
███████║   ██║   ██║  ██║╚██████╔╝██████╔╝███████╗███████╗
╚══════╝   ╚═╝   ╚═╝  ╚═╝ ╚═════╝ ╚═════╝ ╚══════╝╚══════╝`}),n.map((t,s)=>{const l=pt(t.message);return e.jsxs("div",{className:g(t.type==="error"&&"text-red-500",t.type==="highlight"&&"underline"),children:[e.jsx("span",{dangerouslySetInnerHTML:{__html:l}}),t.count?` (${t.count})`:""]},t.id)})]})}function pt(n){var t,s,l,a;return s=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,t=n.replace(s,'<a class="underline" href="$1" target="_blank">$1</a>'),l=/(^|[^\/])(www\.[\S]+(\b|$))/gim,t=t.replace(l,'$1<a class="underline" href="http://$2" target="_blank">$2</a>'),a=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t=t.replace(a,'<a class="underline" href="mailto:$1">$1</a>'),t}function ft(){const[n,t]=r.useState([]);r.useEffect(()=>(je("",{dir:ve,recursive:!0}).then(o=>t([{name:"~/music",children:o}])).catch(o=>{console.log("error loadin files",o)}),()=>{}),[]);const s=r.useMemo(()=>n[n.length-1],[n]),l=r.useMemo(()=>n.slice(1).map(o=>o.name).join("/"),[n]),a=r.useMemo(()=>s?.children.filter(o=>!!o.children),[s]),i=r.useMemo(()=>s?.children.filter(o=>!o.children&&be(o.name)),[s]),u=o=>t(h=>h.concat([o]));return e.jsxs("div",{className:"px-4 flex flex-col h-full",children:[e.jsx("div",{className:"flex justify-between font-mono pb-1",children:e.jsxs("div",{children:[e.jsx("span",{children:"samples('"}),n?.map((o,h)=>h<n.length-1?e.jsxs(r.Fragment,{children:[e.jsx("span",{className:"cursor-pointer underline",onClick:()=>t(m=>m.slice(0,h+1)),children:o.name}),e.jsx("span",{children:"/"})]},h):e.jsx("span",{className:"cursor-pointer underline",children:o.name},h)),e.jsx("span",{children:"')"})]})}),e.jsxs("div",{className:"overflow-auto",children:[!a?.length&&!i?.length&&e.jsx("span",{className:"text-gray-500",children:"Nothing here"}),a?.map((o,h)=>e.jsx("div",{className:"cursor-pointer",onClick:()=>u(o),children:o.name},h)),i?.map((o,h)=>e.jsx("div",{className:"text-gray-500 cursor-pointer select-none",onClick:async()=>we(`${l}/${o.name}`),children:o.name},h))]})]})}const ee=Oe.docs.filter(({name:n,description:t})=>n&&!n.startsWith("_")&&!!t).sort((n,t)=>n.name.localeCompare(t.name)),xt=n=>{var t=document.createElement("div");return t.innerHTML=n,t.textContent||t.innerText||""};function gt(){return e.jsxs("div",{className:"flex h-full w-full pt-2 text-foreground overflow-hidden",children:[e.jsx("div",{className:"w-42 flex-none h-full overflow-y-auto overflow-x-hidden pr-4",children:ee.map((n,t)=>e.jsxs("a",{className:"cursor-pointer block hover:bg-lineHighlight py-1 px-4",onClick:()=>{const s=document.getElementById(`doc-${t}`);document.getElementById("reference-container").scrollTo(0,s.offsetTop)},children:[n.name," "]},t))}),e.jsx("div",{className:"break-normal w-full h-full overflow-auto pl-4 flex relative",id:"reference-container",children:e.jsxs("div",{className:"prose dark:prose-invert max-w-full pr-4",children:[e.jsx("h2",{children:"API Reference"}),e.jsx("p",{children:"This is the long list functions you can use! Remember that you don't need to remember all of those and that you can already make music with a small set of functions!"}),ee.map((n,t)=>e.jsxs("section",{children:[e.jsx("h3",{id:`doc-${t}`,children:n.name}),!!n.synonyms_text&&e.jsxs("p",{children:["Synonyms: ",e.jsx("code",{children:n.synonyms_text})]}),e.jsx("p",{dangerouslySetInnerHTML:{__html:n.description}}),e.jsx("ul",{children:n.params?.map(({name:s,type:l,description:a},i)=>e.jsxs("li",{children:[s," : ",l.names?.join(" | ")," ",a?e.jsxs(e.Fragment,{children:[" - ",xt(a)]}):""]},i))}),n.examples?.map((s,l)=>e.jsx("pre",{children:s},l))]},t))]})})]})}function jt({value:n,options:t,onChange:s,onClick:l,isDisabled:a}){return e.jsxs("select",{disabled:a,onClick:l,className:"p-2 bg-background rounded-md text-foreground",value:n??"",onChange:i=>s(i.target.value),children:[t.size==0&&e.jsx("option",{value:n,children:`${n??"select an option"}`}),Array.from(t.keys()).map(i=>e.jsx("option",{className:"bg-background",value:i,children:t.get(i)},i))]})}const vt=new Map;function bt({audioDeviceName:n,onChange:t,isDisabled:s}){const[l,a]=r.useState(vt),i=l.size>0,u=()=>{i||re().then(m=>{a(m)})},o=m=>{if(!i)return;const d=l.get(m);t(m),oe(d)},h=new Map;return Array.from(l.keys()).forEach(m=>{h.set(m,m)}),e.jsx(jt,{isDisabled:s,options:h,onClick:u,value:n,onChange:o})}function S({label:n,value:t,onChange:s}){return e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:t,onChange:s})," "+n]})}function te({value:n,options:t,onChange:s}){return e.jsx("select",{className:"p-2 bg-background rounded-md text-foreground",value:n,onChange:l=>s(l.target.value),children:Object.entries(t).map(([l,a])=>e.jsx("option",{className:"bg-background",value:l,children:a},l))})}function wt({value:n,onChange:t,step:s=1,...l}){return e.jsxs("div",{className:"flex space-x-2 gap-1",children:[e.jsx("input",{className:"p-2 grow",type:"range",value:n,step:s,onChange:a=>t(Number(a.target.value)),...l}),e.jsx("input",{type:"number",value:n,step:s,className:"w-16 bg-background rounded-md",onChange:a=>t(Number(a.target.value))})]})}function C({label:n,children:t}){return e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{children:n}),t]})}const yt=Object.fromEntries(Object.keys(Ze).map(n=>[n,n])),Ct={monospace:"monospace",BigBlueTerminal:"BigBlueTerminal",x3270:"x3270",PressStart:"PressStart2P",galactico:"galactico","we-come-in-peace":"we-come-in-peace",FiraCode:"FiraCode","FiraCode-SemiBold":"FiraCode SemiBold",teletext:"teletext",mode7:"mode7"};function kt({started:n}){const{theme:t,keybindings:s,isLineNumbersDisplayed:l,isPatternHighlightingEnabled:a,isActiveLineHighlighted:i,isAutoCompletionEnabled:u,isTooltipEnabled:o,isFlashEnabled:h,isLineWrappingEnabled:m,fontSize:d,fontFamily:j,panelPosition:p,audioDeviceName:w}=T();return e.jsxs("div",{className:"text-foreground p-4 space-y-4",children:[AudioContext.prototype.setSinkId!=null&&e.jsx(C,{label:"Audio Output Device",children:e.jsx(bt,{isDisabled:n,audioDeviceName:w,onChange:c=>x.setKey("audioDeviceName",c)})}),e.jsx(C,{label:"Theme",children:e.jsx(te,{options:yt,value:t,onChange:c=>x.setKey("theme",c)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(C,{label:"Font Family",children:e.jsx(te,{options:Ct,value:j,onChange:c=>x.setKey("fontFamily",c)})}),e.jsx(C,{label:"Font Size",children:e.jsx(wt,{value:d,onChange:c=>x.setKey("fontSize",c),min:10,max:40,step:2})})]}),e.jsx(C,{label:"Keybindings",children:e.jsx(H,{value:s,onChange:c=>x.setKey("keybindings",c),items:{codemirror:"Codemirror",vim:"Vim",emacs:"Emacs",vscode:"VSCode"}})}),e.jsx(C,{label:"Panel Position",children:e.jsx(H,{value:p,onChange:c=>x.setKey("panelPosition",c),items:{bottom:"Bottom",right:"Right"}})}),e.jsxs(C,{label:"Code Settings",children:[e.jsx(S,{label:"Display line numbers",onChange:c=>x.setKey("isLineNumbersDisplayed",c.target.checked),value:l}),e.jsx(S,{label:"Highlight active line",onChange:c=>x.setKey("isActiveLineHighlighted",c.target.checked),value:i}),e.jsx(S,{label:"Highlight events in code",onChange:c=>x.setKey("isPatternHighlightingEnabled",c.target.checked),value:a}),e.jsx(S,{label:"Enable auto-completion",onChange:c=>x.setKey("isAutoCompletionEnabled",c.target.checked),value:u}),e.jsx(S,{label:"Enable tooltips on Ctrl and hover",onChange:c=>x.setKey("isTooltipEnabled",c.target.checked),value:o}),e.jsx(S,{label:"Enable line wrapping",onChange:c=>x.setKey("isLineWrappingEnabled",c.target.checked),value:m}),e.jsx(S,{label:"Enable flashing on evaluation",onChange:c=>x.setKey("isFlashEnabled",c.target.checked),value:h})]}),e.jsx(C,{label:"Zen Mode",children:"Try clicking the logo in the top left!"}),e.jsx(C,{label:"Reset Settings",children:e.jsx("button",{className:"bg-background p-2 max-w-[300px] rounded-md hover:opacity-50",onClick:()=>{confirm("Sure?")&&x.set(ye)},children:"restore default settings"})})]})}function Nt({onComplete:n}){let t=Ke.createRef();const[s,l]=r.useState(!1),a=r.useCallback(async()=>{t.current.files?.length&&(l(!0),await Ce(G,t.current.files).then(()=>{ke(G,()=>{n(),l(!1)})}))});return e.jsxs("label",{style:{alignItems:"center"},className:"flex bg-background ml-2 pl-2 pr-2 max-w-[300px] rounded-md hover:opacity-50 whitespace-nowrap cursor-pointer",children:[e.jsx("input",{disabled:s,ref:t,id:"audio_file",style:{display:"none"},type:"file",directory:"",webkitdirectory:"",multiple:!0,accept:"audio/*",onChange:()=>{a()}}),s?"importing...":"import sounds"]})}const Et=n=>Array.isArray(n)?n.length:typeof n=="object"?Object.values(n).length:1;function St(){const n=ie(Le),{soundsFilter:t}=T(),s=r.useMemo(()=>{let a=Object.entries(n).filter(([i])=>!i.startsWith("_"));return n?t==="user"?a.filter(([i,{data:u}])=>!u.prebake):t==="drums"?a.filter(([i,{data:u}])=>u.type==="sample"&&u.tag==="drum-machines"):t==="samples"?a.filter(([i,{data:u}])=>u.type==="sample"&&u.tag!=="drum-machines"):t==="synths"?a.filter(([i,{data:u}])=>["synth","soundfont"].includes(u.type)):a:[]},[n,t]),l=r.useRef();return ce("mouseup",()=>{const a=l.current;l.current=void 0,a?.then(i=>{i?.stop(z().currentTime+.01)})}),e.jsxs("div",{id:"sounds-tab",className:"px-4 flex flex-col w-full h-full dark:text-white text-stone-900",children:[e.jsxs("div",{className:"pb-2 flex shrink-0 overflow-auto",children:[e.jsx(H,{value:t,onChange:a=>x.setKey("soundsFilter",a),items:{samples:"samples",drums:"drum-machines",synths:"Synths",user:"User"}}),e.jsx(Nt,{onComplete:()=>x.setKey("soundsFilter","user")})]}),e.jsxs("div",{className:"min-h-0 max-h-full grow overflow-auto font-mono text-sm break-normal",children:[s.map(([a,{data:i,onTrigger:u}])=>e.jsxs("span",{className:"cursor-pointer hover:opacity-50",onMouseDown:async()=>{const o=z(),h={note:["synth","soundfont"].includes(i.type)?"a3":void 0,s:a,clip:1,release:.5,sustain:1,duration:.5},m=o.currentTime+.05,d=()=>l.current?.node?.disconnect();l.current=Promise.resolve(u(m,h,d)),l.current.then(j=>{_e(j?.node)})},children:[" ",a,i?.type==="sample"?`(${Et(i.samples)})`:"",i?.type==="soundfont"?`(${i.fonts.length})`:""]},a)),s.length?"":"No custom sounds loaded in this pattern (yet)."]})]})}const{BASE_URL:O}={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://strudel.cc/",ASSETS_PREFIX:void 0},Rt=O.endsWith("/")?O.slice(0,-1):O;function At({context:n}){return e.jsxs("div",{className:"prose dark:prose-invert max-w-[600px] pt-2 font-sans pb-8 px-4",children:[e.jsxs("h3",{children:[e.jsx("span",{className:g("animate-spin inline-block select-none"),children:"🌀"})," welcome"]}),e.jsxs("p",{children:["You have found ",e.jsx("span",{className:"underline",children:"strudel"}),", a new live coding platform to write dynamic music pieces in the browser! It is free and open-source and made for beginners and experts alike. To get started:",e.jsx("br",{}),e.jsx("br",{}),e.jsx("span",{className:"underline",children:"1. hit play"})," - ",e.jsx("span",{className:"underline",children:"2. change something"})," -"," ",e.jsx("span",{className:"underline",children:"3. hit update"}),e.jsx("br",{}),"If you don't like what you hear, try ",e.jsx("span",{className:"underline",children:"shuffle"}),"!"]}),e.jsxs("p",{children:["To learn more about what this all means, check out the"," ",e.jsx("a",{href:`${Rt}/workshop/getting-started/`,target:"_blank",children:"interactive tutorial"}),". Also feel free to join the"," ",e.jsx("a",{href:"https://discord.com/invite/HGEdXmRkzT",target:"_blank",children:"tidalcycles discord channel"})," ","to ask any questions, give feedback or just say hello."]}),e.jsx("h3",{children:"about"}),e.jsxs("p",{children:["strudel is a JavaScript version of"," ",e.jsx("a",{href:"https://tidalcycles.org/",target:"_blank",children:"tidalcycles"}),", which is a popular live coding language for music, written in Haskell. You can find the source code at"," ",e.jsx("a",{href:"https://github.com/tidalcycles/strudel",target:"_blank",children:"github"}),". Please consider to"," ",e.jsx("a",{href:"https://opencollective.com/tidalcycles",target:"_blank",children:"support this project"})," ","to ensure ongoing development 💖"]})]})}const ne=typeof window<"u"?r.useLayoutEffect:r.useEffect,Pt=typeof window<"u"&&window.__TAURI__;function se({context:n}){const t=r.useRef(),[s,l]=r.useState([]),{activeFooter:a,isZen:i,panelPosition:u}=T();ne(()=>{t.current&&a==="console"&&(t.current.scrollTop=t.current?.scrollHeight)},[s,a]),ne(()=>{t.current&&(a==="console"?t.current.scrollTop=t.current?.scrollHeight:t.current.scrollTop=0)},[a]),Tt(r.useCallback(j=>{const{message:p,type:w,data:c}=j.detail;l(b=>{const A=b.length?b[b.length-1]:void 0,P=Ne(12);if(w==="loaded-sample"){const I=b.findIndex(({data:{url:V},type:W})=>W==="load-sample"&&V===c.url);b[I]={message:p,type:w,id:P,data:c}}else A&&A.message===p?b=b.slice(0,-1).concat([{message:p,type:w,count:(A.count??1)+1,id:P,data:c}]):b=b.concat([{message:p,type:w,id:P,data:c}]);return b.slice(-20)})},[]));const o=({children:j,name:p,label:w})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>q(p),className:g("h-8 px-2 text-foreground cursor-pointer hover:opacity-50 flex items-center space-x-1 border-b",a===p?"border-foreground":"border-transparent"),children:w||p}),a===p&&e.jsx(e.Fragment,{children:j})]}),h=Ee();if(i)return null;const m=a!=="";let d={right:g("max-w-full flex-grow-0 flex-none overflow-hidden",m?"w-[600px] h-full":"absolute right-0"),bottom:g("relative",m?"h-[360px] min-h-[360px]":"")};return h?e.jsxs("nav",{className:g("bg-lineHighlight z-[10] flex flex-col",d[u]),children:[e.jsxs("div",{className:"flex justify-between px-2",children:[e.jsxs("div",{className:g("flex select-none max-w-full overflow-auto",a&&"pb-2"),children:[e.jsx(o,{name:"intro",label:"welcome"}),e.jsx(o,{name:"patterns"}),e.jsx(o,{name:"sounds"}),e.jsx(o,{name:"console"}),e.jsx(o,{name:"reference"}),e.jsx(o,{name:"settings"}),Pt&&e.jsx(o,{name:"files"})]}),a!==""&&e.jsx("button",{onClick:()=>q(""),className:"text-foreground px-2","aria-label":"Close Panel",children:e.jsx(ht,{className:"w-5 h-5"})})]}),a!==""&&e.jsx("div",{className:"relative overflow-hidden",children:e.jsxs("div",{className:"text-white overflow-auto h-full max-w-full",ref:t,children:[a==="intro"&&e.jsx(At,{context:n}),a==="patterns"&&e.jsx(xe,{context:n}),a==="console"&&e.jsx(mt,{log:s}),a==="sounds"&&e.jsx(St,{}),a==="reference"&&e.jsx(gt,{}),a==="settings"&&e.jsx(kt,{started:n.started}),a==="files"&&e.jsx(ft,{})]})})]}):null}function Tt(n){ce(Z.key,n)}const{latestCode:ae}=x.get();let ue,he,M,U,me;typeof window<"u"&&(Me(),ue=Se(),he=K(),M=le(),U=()=>M.clearRect(0,0,M.canvas.height,M.canvas.width),me=window.location!==window.parent.location);function Kt({embedded:n=!1}){const t=n||me,{panelPosition:s,isZen:l}=T(),a=r.useCallback(()=>{const f=[-2,2],v=le(),D=(k,y,R,N)=>{N.length&&v.clearRect(0,0,v.canvas.width*2,v.canvas.height*2),N?.forEach(E=>{E(v,y,k,f,{clear:!1})})},$=new He({defaultOutput:Be,getTime:()=>z().currentTime,transpiler:Re,autodraw:!1,root:w.current,initialCode:"// LOADING",pattern:pe,drawTime:f,onDraw:D,prebake:async()=>Promise.all([ue,he]),onUpdateState:k=>{u({...k})},afterEval:k=>{const{code:y}=k;Ae(y),window.location.hash="#"+fe(y);const R=Pe(),N={...R,code:y};let E=N.id;if(R.collection!==L.collection){if(y!==R.code){const X=L.duplicate(N);E=X.id,_(X.data)}}else E=L.isValidID(E)?E:Te(),_(L.update(E,N).data);J(E)},bgFill:!1});Ie().then(async k=>{let y;if(k)$.setCode(k),y="I have loaded the code from the URL.";else if(ae)$.setCode(ae),y="Your last session has been loaded!";else{const{code:R,name:N}=await Y();$.setCode(R),y=`A random code snippet named "${N}" has been loaded!`}Z(`Welcome to Strudel! ${y} Press play or hit ctrl+enter to run it!`,"highlight")}),p.current=$},[]),[i,u]=r.useState({}),{started:o,isDirty:h,error:m,activeCode:d,pending:j}=i,p=r.useRef(),w=r.useRef(),c=ie(x,{keys:Object.keys(Q)});r.useEffect(()=>{let f={};Object.keys(Q).forEach(v=>{c.hasOwnProperty(v)&&(f[v]=c[v])}),p.current?.updateSettings(f)},[c]),r.useEffect(()=>{const{audioDeviceName:f}=c;f!==Fe&&re().then(v=>{const D=v.get(f);D!=null&&oe(D)})},[]);const b=async()=>{p.current?.toggle()},A=async()=>{U(),resetLoadedSounds(),p.current.repl.setCps(.5),await K()},P=async(f,v=!1)=>{_(f),p.current.setCode(f.code),v&&(await A(),I())},I=()=>{p.current.evaluate()},F={embedded:n,started:o,pending:j,isDirty:h,activeCode:d,handleTogglePlay:b,handleUpdate:P,handleShuffle:async()=>{const f=await Y(),v=f.code;Z(`[repl] ✨ loading random tune "${f.id}"`),J(f.id),_(f),U(),resetLoadedSounds(),await K(),p.current.setCode(v),p.current.repl.evaluate(v)},handleShare:async()=>$e(d),handleEvaluate:I};return e.jsx(De.Provider,{value:F,children:e.jsxs("div",{className:g("h-full flex flex-col relative"),children:[e.jsx(ct,{active:j}),e.jsx(it,{context:F}),t&&!o&&e.jsxs("button",{onClick:()=>b(),className:"text-white text-2xl fixed left-[50%] top-[50%] translate-x-[-50%] translate-y-[-50%] z-[1000] m-auto p-4 bg-black rounded-md flex items-center space-x-2",children:[e.jsx(de,{className:"w-6 h-6"}),e.jsx("span",{children:"play"})]}),e.jsxs("div",{className:"grow flex relative overflow-hidden",children:[e.jsx("section",{className:"text-gray-100 cursor-text pb-0 overflow-auto grow"+(l?" px-10":""),id:"code",ref:f=>{w.current=f,p.current||a()}}),s==="right"&&!t&&e.jsx(se,{context:F})]}),m&&e.jsx("div",{className:"text-red-500 p-4 bg-lineHighlight animate-pulse",children:m.message||"Unknown Error :-/"}),s==="bottom"&&!t&&e.jsx(se,{context:F})]})})}export{Kt as Repl};
