/**
 * @license Fraction.js v4.3.7 31/08/2023
 * https://www.xarg.org/2014/03/rational-numbers-in-javascript/
 *
 * Copyright (c) 2023, Robert Eisele (robert@raw.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/var dn=2e3,p={s:1,n:0,d:1};function K(e,t){if(isNaN(e=parseInt(e,10)))throw kt();return e*t}function S(e,t){if(t===0)throw jt();var n=Object.create(T.prototype);n.s=e<0?-1:1,e=e<0?-e:e;var r=lt(e,t);return n.n=e/r,n.d=t/r,n}function fe(e){for(var t={},n=e,r=2,s=4;s<=n;){for(;n%r===0;)n/=r,t[r]=(t[r]||0)+1;s+=1+2*r++}return n!==e?n>1&&(t[n]=(t[n]||0)+1):t[e]=(t[e]||0)+1,t}var H=function(e,t){var n=0,r=1,s=1,o=0,i=0,l=0,u=1,h=1,c=0,a=1,y=1,m=1,q=1e7,v;if(e!=null)if(t!==void 0){if(n=e,r=t,s=n*r,n%1!==0||r%1!==0)throw gn()}else switch(typeof e){case"object":{if("d"in e&&"n"in e)n=e.n,r=e.d,"s"in e&&(n*=e.s);else if(0 in e)n=e[0],1 in e&&(r=e[1]);else throw kt();s=n*r;break}case"number":{if(e<0&&(s=e,e=-e),e%1===0)n=e;else if(e>0){for(e>=1&&(h=Math.pow(10,Math.floor(1+Math.log(e)/Math.LN10)),e/=h);a<=q&&m<=q;)if(v=(c+y)/(a+m),e===v){a+m<=q?(n=c+y,r=a+m):m>a?(n=y,r=m):(n=c,r=a);break}else e>v?(c+=y,a+=m):(y+=c,m+=a),a>q?(n=y,r=m):(n=c,r=a);n*=h}else(isNaN(e)||isNaN(t))&&(r=n=NaN);break}case"string":{if(a=e.match(/\d+|./g),a===null)throw kt();if(a[c]==="-"?(s=-1,c++):a[c]==="+"&&c++,a.length===c+1?i=K(a[c++],s):a[c+1]==="."||a[c]==="."?(a[c]!=="."&&(o=K(a[c++],s)),c++,(c+1===a.length||a[c+1]==="("&&a[c+3]===")"||a[c+1]==="'"&&a[c+3]==="'")&&(i=K(a[c],s),u=Math.pow(10,a[c].length),c++),(a[c]==="("&&a[c+2]===")"||a[c]==="'"&&a[c+2]==="'")&&(l=K(a[c+1],s),h=Math.pow(10,a[c+1].length)-1,c+=3)):a[c+1]==="/"||a[c+1]===":"?(i=K(a[c],s),u=K(a[c+2],1),c+=3):a[c+3]==="/"&&a[c+1]===" "&&(o=K(a[c],s),i=K(a[c+2],s),u=K(a[c+4],1),c+=5),a.length<=c){r=u*h,s=n=l+r*o+h*i;break}}default:throw kt()}if(r===0)throw jt();p.s=s<0?-1:1,p.n=Math.abs(n),p.d=Math.abs(r)};function mn(e,t,n){for(var r=1;t>0;e=e*e%n,t>>=1)t&1&&(r=r*e%n);return r}function wn(e,t){for(;t%2===0;t/=2);for(;t%5===0;t/=5);if(t===1)return 0;for(var n=10%t,r=1;n!==1;r++)if(n=n*10%t,r>dn)return 0;return r}function yn(e,t,n){for(var r=1,s=mn(10,n,t),o=0;o<300;o++){if(r===s)return o;r=r*10%t,s=s*10%t}return 0}function lt(e,t){if(!e)return t;if(!t)return e;for(;;){if(e%=t,!e)return t;if(t%=e,!t)return e}}function T(e,t){if(H(e,t),this instanceof T)e=lt(p.d,p.n),this.s=p.s,this.n=p.n/e,this.d=p.d/e;else return S(p.s*p.n,p.d)}var jt=function(){return new Error("Division by Zero")},kt=function(){return new Error("Invalid argument")},gn=function(){return new Error("Parameters must be integer")};T.prototype={s:1,n:0,d:1,abs:function(){return S(this.n,this.d)},neg:function(){return S(-this.s*this.n,this.d)},add:function(e,t){return H(e,t),S(this.s*this.n*p.d+p.s*this.d*p.n,this.d*p.d)},sub:function(e,t){return H(e,t),S(this.s*this.n*p.d-p.s*this.d*p.n,this.d*p.d)},mul:function(e,t){return H(e,t),S(this.s*p.s*this.n*p.n,this.d*p.d)},div:function(e,t){return H(e,t),S(this.s*p.s*this.n*p.d,this.d*p.n)},clone:function(){return S(this.s*this.n,this.d)},mod:function(e,t){if(isNaN(this.n)||isNaN(this.d))return new T(NaN);if(e===void 0)return S(this.s*this.n%this.d,1);if(H(e,t),p.n===0&&this.d===0)throw jt();return S(this.s*(p.d*this.n)%(p.n*this.d),p.d*this.d)},gcd:function(e,t){return H(e,t),S(lt(p.n,this.n)*lt(p.d,this.d),p.d*this.d)},lcm:function(e,t){return H(e,t),p.n===0&&this.n===0?S(0,1):S(p.n*this.n,lt(p.n,this.n)*lt(p.d,this.d))},ceil:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new T(NaN):S(Math.ceil(e*this.s*this.n/this.d),e)},floor:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new T(NaN):S(Math.floor(e*this.s*this.n/this.d),e)},round:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new T(NaN):S(Math.round(e*this.s*this.n/this.d),e)},roundTo:function(e,t){return H(e,t),S(this.s*Math.round(this.n*p.d/(this.d*p.n))*p.n,p.d)},inverse:function(){return S(this.s*this.d,this.n)},pow:function(e,t){if(H(e,t),p.d===1)return p.s<0?S(Math.pow(this.s*this.d,p.n),Math.pow(this.n,p.n)):S(Math.pow(this.s*this.n,p.n),Math.pow(this.d,p.n));if(this.s<0)return null;var n=fe(this.n),r=fe(this.d),s=1,o=1;for(var i in n)if(i!=="1"){if(i==="0"){s=0;break}if(n[i]*=p.n,n[i]%p.d===0)n[i]/=p.d;else return null;s*=Math.pow(i,n[i])}for(var i in r)if(i!=="1"){if(r[i]*=p.n,r[i]%p.d===0)r[i]/=p.d;else return null;o*=Math.pow(i,r[i])}return p.s<0?S(o,s):S(s,o)},equals:function(e,t){return H(e,t),this.s*this.n*p.d===p.s*p.n*this.d},compare:function(e,t){H(e,t);var n=this.s*this.n*p.d-p.s*p.n*this.d;return(0<n)-(n<0)},simplify:function(e){if(isNaN(this.n)||isNaN(this.d))return this;e=e||.001;for(var t=this.abs(),n=t.toContinued(),r=1;r<n.length;r++){for(var s=S(n[r-1],1),o=r-2;o>=0;o--)s=s.inverse().add(n[o]);if(Math.abs(s.sub(t).valueOf())<e)return s.mul(this.s)}return this},divisible:function(e,t){return H(e,t),!(!(p.n*this.d)||this.n*p.d%(p.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(e){var t,n="",r=this.n,s=this.d;return this.s<0&&(n+="-"),s===1?n+=r:(e&&(t=Math.floor(r/s))>0&&(n+=t,n+=" ",r%=s),n+=r,n+="/",n+=s),n},toLatex:function(e){var t,n="",r=this.n,s=this.d;return this.s<0&&(n+="-"),s===1?n+=r:(e&&(t=Math.floor(r/s))>0&&(n+=t,r%=s),n+="\\frac{",n+=r,n+="}{",n+=s,n+="}"),n},toContinued:function(){var e,t=this.n,n=this.d,r=[];if(isNaN(t)||isNaN(n))return r;do r.push(Math.floor(t/n)),e=t%n,t=n,n=e;while(t!==1);return r},toString:function(e){var t=this.n,n=this.d;if(isNaN(t)||isNaN(n))return"NaN";e=e||15;var r=wn(t,n),s=yn(t,n,r),o=this.s<0?"-":"";if(o+=t/n|0,t%=n,t*=10,t&&(o+="."),r){for(var i=s;i--;)o+=t/n|0,t%=n,t*=10;o+="(";for(var i=r;i--;)o+=t/n|0,t%=n,t*=10;o+=")"}else for(var i=e;t&&i--;)o+=t/n|0,t%=n,t*=10;return o}};T.prototype.sam=function(){return this.floor()};T.prototype.nextSam=function(){return this.sam().add(1)};T.prototype.wholeCycle=function(){return new x(this.sam(),this.nextSam())};T.prototype.cyclePos=function(){return this.sub(this.sam())};T.prototype.lt=function(e){return this.compare(e)<0};T.prototype.gt=function(e){return this.compare(e)>0};T.prototype.lte=function(e){return this.compare(e)<=0};T.prototype.gte=function(e){return this.compare(e)>=0};T.prototype.eq=function(e){return this.compare(e)==0};T.prototype.max=function(e){return this.gt(e)?this:e};T.prototype.min=function(e){return this.lt(e)?this:e};T.prototype.show=function(){return this.s*this.n+"/"+this.d};T.prototype.or=function(e){return this.eq(0)?e:this};const _=e=>T(e),bn=(...e)=>e.reduce((t,n)=>t.gcd(n),_(1));_._original=T;class x{constructor(t,n){this.begin=_(t),this.end=_(n)}get spanCycles(){const t=[];var n=this.begin;const r=this.end,s=r.sam();if(n.equals(r))return[new x(n,r)];for(;r.gt(n);){if(n.sam().equals(s)){t.push(new x(n,this.end));break}const o=n.nextSam();t.push(new x(n,o)),n=o}return t}get duration(){return this.end.sub(this.begin)}cycleArc(){const t=this.begin.cyclePos(),n=t.add(this.duration);return new x(t,n)}withTime(t){return new x(t(this.begin),t(this.end))}withEnd(t){return new x(this.begin,t(this.end))}withCycle(t){const n=this.begin.sam(),r=n.add(t(this.begin.sub(n))),s=n.add(t(this.end.sub(n)));return new x(r,s)}intersection(t){const n=this.begin.max(t.begin),r=this.end.min(t.end);if(!n.gt(r)&&!(n.equals(r)&&(n.equals(this.end)&&this.begin.lt(this.end)||n.equals(t.end)&&t.begin.lt(t.end))))return new x(n,r)}intersection_e(t){const n=this.intersection(t);if(n==null)throw"TimeSpans do not intersect";return n}midpoint(){return this.begin.add(this.duration.div(_(2)))}equals(t){return this.begin.equals(t.begin)&&this.end.equals(t.end)}show(){return this.begin.show()+" → "+this.end.show()}}class M{constructor(t,n,r,s={},o=!1){this.whole=t,this.part=n,this.value=r,this.context=s,this.stateful=o,o&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){return this.whole.end.sub(this.whole.begin).mul(typeof this.value?.clip=="number"?this.value?.clip:1)}get endClipped(){return this.whole.begin.add(this.duration)}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(t){const n=this.whole?t(this.whole):void 0;return new M(n,t(this.part),this.value,this.context)}withValue(t){return new M(this.whole,this.part,t(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}resolveState(t){if(this.stateful&&this.hasOnset()){console.log("stateful");const n=this.value,[r,s]=n(t);return[r,new M(this.whole,this.part,s,this.context,!1)]}return[t,this]}spanEquals(t){return this.whole==null&&t.whole==null||this.whole.equals(t.whole)}equals(t){return this.spanEquals(t)&&this.part.equals(t.part)&&this.value===t.value}show(t=!1){const n=typeof this.value=="object"?t?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var r="";if(this.whole==null)r="~"+this.part.show;else{var s=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(r=this.whole.begin.show()+" ⇜ "),s||(r+="("),r+=this.part.show(),s||(r+=")"),this.whole.end.equals(this.part.end)||(r+=" ⇝ "+this.whole.end.show())}return"[ "+r+" | "+n+" ]"}showWhole(t=!1){return`${this.whole==null?"~":this.whole.show()}: ${typeof this.value=="object"?t?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value}`}combineContext(t){const n=this;return{...n.context,...t.context,locations:(n.context.locations||[]).concat(t.context.locations||[])}}setContext(t){return new M(this.whole,this.part,this.value,t)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class ot{constructor(t,n={}){this.span=t,this.controls=n}setSpan(t){return new ot(t,this.controls)}withSpan(t){return this.setSpan(t(this.span))}setControls(t){return new ot(this.span,t)}}const $t="strudel.log";function J(e,t,n={}){console.log(`%c${e}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent($t,{detail:{message:e,type:t,data:n}}))}J.key=$t;const vn=e=>/^[a-gA-G][#bs]*[0-9]$/.test(e),Ct=e=>/^[a-gA-G][#bsf]*[0-9]?$/.test(e),ge=e=>{if(typeof e!="string")return[];const[t,n="",r]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return t?[t,n,r?Number(r):void 0]:[]},_n={c:0,d:2,e:4,f:5,g:7,a:9,b:11},qn={"#":1,b:-1,s:1,f:-1},pt=(e,t=3)=>{const[n,r,s=t]=ge(e);if(!n)throw new Error('not a note: "'+e+'"');const o=_n[n.toLowerCase()],i=r?.split("").reduce((l,u)=>l+qn[u],0)||0;return(Number(s)+1)*12+o+i},ht=e=>Math.pow(2,(e-69)/12)*440,Ft=e=>12*Math.log(e/440)/Math.LN2+69,An=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:r}=e;if(typeof n=="number")return Ft(n);if(typeof r=="string")return pt(r);if(typeof r=="number")return r;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t},be=e=>ht(typeof e=="number"?e:pt(e)),kn=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Nn=e=>{const t=Math.floor(e/12)-1;return kn[e%12]+t},vt=(e,t)=>(e%t+t)%t;function ve(e,t){return isNaN(Number(e))?(J(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const Cn=(e,t)=>vt(Math.round(ve(e??0,0)),t),Sn=e=>{let{value:t,context:n}=e,r=t;if(typeof r=="object"&&!Array.isArray(r)&&(r=r.note||r.n||r.value,r===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(t)}`);if(typeof r=="number"&&n.type!=="frequency")r=ht(e.value);else if(typeof r=="number"&&n.type==="frequency")r=e.value;else if(typeof r!="string"||!Ct(r))throw new Error("not a note: "+JSON.stringify(r));return r},Tn=e=>{let{value:t,context:n}=e;if(typeof t=="object")return t.freq?t.freq:be(t.note||t.n||t.value);if(typeof t=="number"&&n.type!=="frequency")t=ht(e.value);else if(typeof t=="string"&&Ct(t))t=ht(pt(e.value));else if(typeof t!="number")throw new Error("not a note or frequency: "+t);return t},_e=(e,t)=>e.slice(t).concat(e.slice(0,t)),qe=(...e)=>e.reduce((t,n)=>(...r)=>t(n(...r)),t=>t),xn=(...e)=>qe(...e.reverse()),Ae=e=>e.filter(t=>t!=null),rt=e=>[].concat(...e),ft=e=>e,Mn=(e,t)=>e,Lt=(e,t)=>Array.from({length:t-e+1},(n,r)=>r+e);function A(e,t,n=e.length){const r=function s(...o){if(o.length>=n)return e.apply(this,o);{const i=function(...l){return s.apply(this,o.concat(l))};return t&&t(i,o),i}};return t&&t(r,[]),r}function Ht(e){const t=Number(e);if(!isNaN(t))return t;if(Ct(e))return pt(e);throw new Error(`cannot parse as numeral: "${e}"`)}function Jt(e,t){return(...n)=>e(...n.map(t))}function I(e){return Jt(e,Ht)}function ke(e){const t=Number(e);if(!isNaN(t))return t;const n={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[e];if(typeof n<"u")return n;throw new Error(`cannot parse as fractional: "${e}"`)}const Bn=e=>Jt(e,ke),It=function(e,t){return[t.slice(0,e),t.slice(e)]},Wt=(e,t,n)=>t.map((r,s)=>e(r,n[s])),Ne=(e,t,n)=>Math.min(Math.max(e,t),n),On=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],En=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],Pn=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],zn=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],jn=["I","Ro","Ha","Ni","Ho","He","To"],$n=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Fn=(e,t="letters")=>{const r=(t==="solfeggio"?On:t==="indian"?En:t==="german"?Pn:t==="byzantine"?zn:t==="japanese"?jn:$n)[e%12],s=Math.floor(e/12)-1;return r+s};function Ce(e){const t=new TextEncoder().encode(e);return btoa(String.fromCharCode(...t))}function Se(e){const t=new Uint8Array(atob(e).split("").map(r=>r.charCodeAt(0)));return new TextDecoder().decode(t)}function Ln(e){return encodeURIComponent(Ce(e))}function Hn(e){return Se(decodeURIComponent(e))}function Jn(e,t,n){if(typeof t?.value=="number"){const s=Object.keys(e).filter(i=>typeof e[i]=="number"),o=Object.fromEntries(s.map(i=>[i,t.value]));t=Object.assign(t,o),delete t.value}const r=Object.keys(e).filter(s=>Object.keys(t).includes(s));return Object.assign({},e,t,Object.fromEntries(r.map(s=>[s,n(e[s],t[s])])))}A((e,t)=>e*t);A((e,t)=>t.map(e));function Te(e,t=60){let n=0,r=_(0),s=[""],o="";for(;s[0].length<t;){const i=e.queryArc(n,n+1),l=i.filter(c=>c.hasOnset()).map(c=>c.duration),u=bn(...l),h=u.inverse();s=s.map(c=>c+"|"),o+="|";for(let c=0;c<h;c++){const[a,y]=[r,r.add(u)],m=i.filter(v=>v.whole.begin.lte(a)&&v.whole.end.gte(y)),q=m.length-s.length;q>0&&(s=s.concat(Array(q).fill(o))),s=s.map((v,N)=>{const b=m[N];if(b){const j=b.whole.begin.eq(a)?""+b.value:"-";return v+j}return v+"."}),o+=".",r=r.add(u)}n++}return s.join(`
`)}let Ot;const In=e=>Ot=e;class d{constructor(t){this.query=t,this._Pattern=!0}withValue(t){return new d(n=>this.query(n).map(r=>r.withValue(t)))}fmap(t){return this.withValue(t)}appWhole(t,n){const r=this,s=function(o){const i=r.query(o),l=n.query(o),u=function(h,c){const a=h.part.intersection(c.part);if(a!=null)return new M(t(h.whole,c.whole),a,h.value(c.value),c.combineContext(h))};return rt(i.map(h=>Ae(l.map(c=>u(h,c)))))};return new d(s)}appBoth(t){const n=function(r,s){if(!(r==null||s==null))return r.intersection_e(s)};return this.appWhole(n,t)}appLeft(t){const n=this,r=function(s){const o=[];for(const i of n.query(s)){const l=t.query(s.setSpan(i.wholeOrPart()));for(const u of l){const h=i.whole,c=i.part.intersection(u.part);if(c){const a=i.value(u.value),y=u.combineContext(i),m=new M(h,c,a,y);o.push(m)}}}return o};return new d(r)}appRight(t){const n=this,r=function(s){const o=[];for(const i of t.query(s)){const l=n.query(s.setSpan(i.wholeOrPart()));for(const u of l){const h=i.whole,c=u.part.intersection(i.part);if(c){const a=u.value(i.value),y=i.combineContext(u),m=new M(h,c,a,y);o.push(m)}}}return o};return new d(r)}bindWhole(t,n){const r=this,s=function(o){const i=function(u,h){return new M(t(u.whole,h.whole),h.part,h.value,Object.assign({},u.context,h.context,{locations:(u.context.locations||[]).concat(h.context.locations||[])}))},l=function(u){return n(u.value).query(o.setSpan(u.part)).map(h=>i(u,h))};return rt(r.query(o).map(u=>l(u)))};return new d(s)}bind(t){const n=function(r,s){if(!(r==null||s==null))return r.intersection_e(s)};return this.bindWhole(n,t)}join(){return this.bind(ft)}outerBind(t){return this.bindWhole(n=>n,t)}outerJoin(){return this.outerBind(ft)}innerBind(t){return this.bindWhole((n,r)=>r,t)}innerJoin(){return this.innerBind(ft)}trigJoin(t=!1){const n=this;return new d(r=>n.discreteOnly().query(r).map(s=>s.value.late(t?s.whole.begin:s.whole.begin.cyclePos()).query(r).map(o=>new M(o.whole?o.whole.intersection(s.whole):void 0,o.part.intersection(s.part),o.value).setContext(s.combineContext(o))).filter(o=>o.part)).flat())}trigzeroJoin(){return this.trigJoin(!0)}squeezeJoin(){const t=this;function n(r){const s=t.discreteOnly().query(r);function o(l){const h=l.value._focusSpan(l.wholeOrPart()).query(r.setSpan(l.part));function c(a,y){let m;if(y.whole&&a.whole&&(m=y.whole.intersection(a.whole),!m))return;const q=y.part.intersection(a.part);if(!q)return;const v=y.combineContext(a);return new M(m,q,y.value,v)}return h.map(a=>c(l,a))}return rt(s.map(o)).filter(l=>l)}return new d(n)}squeezeBind(t){return this.fmap(t).squeezeJoin()}queryArc(t,n){try{return this.query(new ot(new x(t,n)))}catch(r){return J(`[query]: ${r.message}`,"error"),[]}}splitQueries(){const t=this,n=r=>rt(r.span.spanCycles.map(s=>t.query(r.setSpan(s))));return new d(n)}withQuerySpan(t){return new d(n=>this.query(n.withSpan(t)))}withQuerySpanMaybe(t){const n=this;return new d(r=>{const s=r.withSpan(t);return s.span?n.query(s):[]})}withQueryTime(t){return new d(n=>this.query(n.withSpan(r=>r.withTime(t))))}withHapSpan(t){return new d(n=>this.query(n).map(r=>r.withSpan(t)))}withHapTime(t){return this.withHapSpan(n=>n.withTime(t))}withHaps(t){return new d(n=>t(this.query(n)))}withHap(t){return this.withHaps(n=>n.map(t))}setContext(t){return this.withHap(n=>n.setContext(t))}withContext(t){return this.withHap(n=>n.setContext(t(n.context)))}stripContext(){return this.withHap(t=>t.setContext({}))}withLoc(t,n){const r={start:t,end:n};return this.withContext(s=>{const o=(s.locations||[]).concat([r]);return{...s,locations:o}})}filterHaps(t){return new d(n=>this.query(n).filter(t))}filterValues(t){return new d(n=>this.query(n).filter(r=>t(r.value)))}removeUndefineds(){return this.filterValues(t=>t!=null)}onsetsOnly(){return this.filterHaps(t=>t.hasOnset())}discreteOnly(){return this.filterHaps(t=>t.whole)}defragmentHaps(){return this.discreteOnly().withHaps(n=>{const r=[];for(var s=0;s<n.length;++s){for(var o=!0,i=n[s];o;){const h=JSON.stringify(n[s].value);for(var l=!1,u=s+1;u<n.length;u++){const c=n[u];if(i.whole.equals(c.whole)){if(i.part.begin.eq(c.part.end)){if(h===JSON.stringify(c.value)){i=new M(i.whole,new x(c.part.begin,i.part.end),i.value),n.splice(u,1),l=!0;break}}else if(c.part.begin.eq(i.part.end)&&h==JSON.stringify(c.value)){i=new M(i.whole,new x(i.part.begin,c.part.end),i.value),n.splice(u,1),l=!0;break}}}o=l}r.push(i)}return r})}firstCycle(t=!1){var n=this;return t||(n=n.stripContext()),n.query(new ot(new x(_(0),_(1))))}get firstCycleValues(){return this.firstCycle().map(t=>t.value)}get showFirstCycle(){return this.firstCycle().map(t=>`${t.value}: ${t.whole.begin.toFraction()} - ${t.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(t=>t.sort((n,r)=>n.part.begin.sub(r.part.begin).or(n.part.end.sub(r.part.end)).or(n.whole.begin.sub(r.whole.begin).or(n.whole.end.sub(r.whole.end)))))}asNumber(){return this.fmap(Ht)}_opIn(t,n){return this.fmap(n).appLeft(w(t))}_opOut(t,n){return this.fmap(n).appRight(w(t))}_opMix(t,n){return this.fmap(n).appBoth(w(t))}_opSqueeze(t,n){const r=w(t);return this.fmap(s=>r.fmap(o=>n(s)(o))).squeezeJoin()}_opSqueezeOut(t,n){const r=this;return w(t).fmap(o=>r.fmap(i=>n(i)(o))).squeezeJoin()}_opTrig(t,n){return w(t).fmap(s=>this.fmap(o=>n(o)(s))).trigJoin()}_opTrigzero(t,n){return w(t).fmap(s=>this.fmap(o=>n(o)(s))).trigzeroJoin()}layer(...t){return z(...t.map(n=>n(this)))}superimpose(...t){return this.stack(...t.map(n=>n(this)))}stack(...t){return z(this,...t)}sequence(...t){return V(this,...t)}seq(...t){return V(this,...t)}cat(...t){return Vt(this,...t)}fastcat(...t){return X(this,...t)}slowcat(...t){return Z(this,...t)}onTrigger(t,n=!0){return this.withHap(r=>r.setContext({...r.context,onTrigger:(...s)=>{r.context.onTrigger?.(...s),t(...s)},dominantTrigger:r.context.dominantTrigger||n}))}log(t=(r,s)=>`[hap] ${s.showWhole(!0)}`,n=(r,s)=>({hap:s})){return this.onTrigger((...r)=>{J(t(...r),void 0,n(...r))},!1)}logValues(t=ft){return this.log((n,r)=>t(r.value))}drawLine(){return console.log(Te(this)),this}}function Wn(e,t){let n=[];return t.forEach(r=>{const s=n.findIndex(([o])=>e(r,o));s===-1?n.push([r]):n[s].push(r)}),n}const Rn=(e,t)=>e.spanEquals(t);d.prototype.collect=function(){return this.withHaps(e=>Wn(Rn,e).map(t=>new M(t[0].whole,t[0].part,t,{})))};d.prototype.arpWith=function(e){return this.collect().fmap(t=>w(e(t))).innerJoin().withHap(t=>new M(t.whole,t.part,t.value.value,t.combineContext(t.value)))};d.prototype.arp=function(e){return this.arpWith(t=>e.fmap(n=>t[n%t.length]))};function Dn(e,t,n){function r(s){return s instanceof Object&&!(s instanceof Function)}return r(e)||r(t)?(r(e)||(e={value:e}),r(t)||(t={value:t}),Jn(e,t,n)):n(e,t)}(function(){const e={set:[(n,r)=>r],keep:[n=>n],keepif:[(n,r)=>r?n:void 0],add:[I((n,r)=>n+r)],sub:[I((n,r)=>n-r)],mul:[I((n,r)=>n*r)],div:[I((n,r)=>n/r)],mod:[I(vt)],pow:[I(Math.pow)],band:[I((n,r)=>n&r)],bor:[I((n,r)=>n|r)],bxor:[I((n,r)=>n^r)],blshift:[I((n,r)=>n<<r)],brshift:[I((n,r)=>n>>r)],lt:[(n,r)=>n<r],gt:[(n,r)=>n>r],lte:[(n,r)=>n<=r],gte:[(n,r)=>n>=r],eq:[(n,r)=>n==r],eqt:[(n,r)=>n===r],ne:[(n,r)=>n!=r],net:[(n,r)=>n!==r],and:[(n,r)=>n&&r],or:[(n,r)=>n||r],func:[(n,r)=>r(n)]},t=["In","Out","Mix","Squeeze","SqueezeOut","Trig","Trigzero"];for(const[n,[r,s]]of Object.entries(e)){d.prototype["_"+n]=function(o){return this.fmap(i=>r(i,o))},Object.defineProperty(d.prototype,n,{get:function(){const o=this,i=(...l)=>o[n].in(...l);for(const l of t)i[l.toLowerCase()]=function(...u){var h=o;u=V(u),s&&(h=s(h),u=s(u));var c;return n==="keepif"?(c=h["_op"+l](u,a=>y=>r(a,y)),c=c.removeUndefineds()):c=h["_op"+l](u,a=>y=>Dn(a,y,r)),c};return i.squeezein=i.squeeze,i}});for(const o of t)d.prototype[o.toLowerCase()]=function(...i){return this.set[o.toLowerCase()](i)}}d.prototype.struct=function(...n){return this.keepif.out(...n)},d.prototype.structAll=function(...n){return this.keep.out(...n)},d.prototype.mask=function(...n){return this.keepif.in(...n)},d.prototype.maskAll=function(...n){return this.keep.in(...n)},d.prototype.reset=function(...n){return this.keepif.trig(...n)},d.prototype.resetAll=function(...n){return this.keep.trig(...n)},d.prototype.restart=function(...n){return this.keepif.trigzero(...n)},d.prototype.restartAll=function(...n){return this.keep.trigzero(...n)}})();const xe=z,Me=z,Be=Gt;d.prototype.factories={pure:G,stack:z,slowcat:Z,fastcat:X,cat:Vt,timeCat:St,sequence:V,seq:Oe,polymeter:Gt,pm:Be,polyrhythm:xe,pr:Me};const O=new d(()=>[]);function G(e){function t(n){return n.span.spanCycles.map(r=>new M(_(r.begin).wholeCycle(),r,e))}return new d(t)}function Rt(e){return e instanceof d||e?._Pattern}function w(e){return Rt(e)?e:Ot&&typeof e=="string"?Ot(e):G(e)}function z(...e){e=e.map(n=>Array.isArray(n)?V(...n):w(n));const t=n=>rt(e.map(r=>r.query(n)));return new d(t)}function Z(...e){e=e.map(n=>Array.isArray(n)?V(...n):w(n));const t=function(n){const r=n.span,s=vt(r.begin.sam(),e.length),o=e[s];if(!o)return[];const i=r.begin.floor().sub(r.begin.div(e.length).floor());return o.withHapTime(l=>l.add(i)).query(n.setSpan(r.withTime(l=>l.sub(i))))};return new d(t).splitQueries()}function Dt(...e){e=e.map(w);const t=function(n){const r=Math.floor(n.span.begin)%e.length;return e[r]?.query(n)||[]};return new d(t).splitQueries()}function Vt(...e){return Z(...e)}function St(...e){const t=e.map(s=>s[0]).reduce((s,o)=>s.add(o),_(0));let n=_(0);const r=[];for(const[s,o]of e){const i=n.add(s);r.push(w(o)._compress(n.div(t),i.div(t))),n=i}return z(...r)}function Vn(...e){const t=e.reduce((n,[r])=>n+r,0);return e=e.map(([n,r])=>[n,r.fast(n)]),St(...e).slow(t)}function X(...e){return Z(...e)._fast(e.length)}function V(...e){return X(...e)}function Oe(...e){return X(...e)}function Et(e){return Array.isArray(e)?e.length==0?[O,0]:e.length==1?Et(e[0]):[X(...e.map(t=>Et(t)[0])),e.length]:[w(e),1]}function Ee(e,...t){const n=t.map(s=>Et(s));if(n.length==0)return O;e==0&&(e=n[0][1]);const r=[];for(const s of n)s[1]!=0&&(e==s[1]?r.push(s[0]):r.push(s[0]._fast(_(e).div(_(s[1])))));return z(...r)}function Gt(...e){return Ee(0,...e)}const Gn=A((e,t)=>w(t).mask(e)),Qn=A((e,t)=>w(t).struct(e)),Un=A((e,t)=>w(t).superimpose(...e)),Kn=A((e,t)=>w(t).set(e)),Zn=A((e,t)=>w(t).keep(e)),Xn=A((e,t)=>w(t).keepif(e)),Yn=A((e,t)=>w(t).add(e)),tr=A((e,t)=>w(t).sub(e)),er=A((e,t)=>w(t).mul(e)),nr=A((e,t)=>w(t).div(e)),rr=A((e,t)=>w(t).mod(e)),sr=A((e,t)=>w(t).pow(e)),or=A((e,t)=>w(t).band(e)),ir=A((e,t)=>w(t).bor(e)),cr=A((e,t)=>w(t).bxor(e)),ar=A((e,t)=>w(t).blshift(e)),ur=A((e,t)=>w(t).brshift(e)),lr=A((e,t)=>w(t).lt(e)),fr=A((e,t)=>w(t).gt(e)),hr=A((e,t)=>w(t).lte(e)),pr=A((e,t)=>w(t).gte(e)),dr=A((e,t)=>w(t).eq(e)),mr=A((e,t)=>w(t).eqt(e)),wr=A((e,t)=>w(t).ne(e)),yr=A((e,t)=>w(t).net(e)),gr=A((e,t)=>w(t).and(e)),br=A((e,t)=>w(t).or(e)),vr=A((e,t)=>w(t).func(e));function f(e,t,n=!0){if(Array.isArray(e)){const o={};for(const i of e)o[i]=f(i,t,n);return o}const r=t.length;var s;return n?s=function(...o){o=o.map(w);const i=o[o.length-1];if(r===1)return t(i);const[l,...u]=o.slice(0,-1);let h=(...c)=>(Array(r-1).fill().map((a,y)=>c[y]??void 0),t(...c,i));return h=A(h,null,r-1),u.reduce((c,a)=>c.appLeft(a),l.fmap(h)).innerJoin()}:s=function(...o){return o=o.map(w),t(...o)},d.prototype[e]=function(...o){if(r===2&&o.length!==1)o=[V(...o)];else if(r!==o.length+1)throw new Error(`.${e}() expects ${r-1} inputs but got ${o.length}.`);return o=o.map(w),s(...o,this)},r>1&&(d.prototype["_"+e]=function(...o){return t(...o,this)}),A(s,null,r)}const _r=f("round",function(e){return e.asNumber().fmap(t=>Math.round(t))}),qr=f("floor",function(e){return e.asNumber().fmap(t=>Math.floor(t))}),Ar=f("ceil",function(e){return e.asNumber().fmap(t=>Math.ceil(t))}),kr=f("toBipolar",function(e){return e.fmap(t=>t*2-1)}),Nr=f("fromBipolar",function(e){return e.fmap(t=>(t+1)/2)}),Cr=f("range",function(e,t,n){return n.mul(t-e).add(e)}),Sr=f("rangex",function(e,t,n){return n._range(Math.log(e),Math.log(t)).fmap(Math.exp)}),Tr=f("range2",function(e,t,n){return n.fromBipolar()._range(e,t)}),xr=f("ratio",e=>e.fmap(t=>Array.isArray(t)?t.slice(1).reduce((n,r)=>n/r,t[0]):t)),Mr=f("compress",function(e,t,n){return e=_(e),t=_(t),e.gt(t)||e.gt(1)||t.gt(1)||e.lt(0)||t.lt(0)?O:n._fastGap(_(1).div(t.sub(e)))._late(e)}),{compressSpan:Br,compressspan:Or}=f(["compressSpan","compressspan"],function(e,t){return t._compress(e.begin,e.end)}),{fastGap:Er,fastgap:Pr}=f(["fastGap","fastgap"],function(e,t){const n=function(s){const o=s.begin.sam(),i=s.begin.sub(o).mul(e).min(1),l=s.end.sub(o).mul(e).min(1);if(!(i>=1))return new x(o.add(i),o.add(l))},r=function(s){const o=s.part.begin,i=s.part.end,l=o.sam(),u=o.sub(l).div(e).min(1),h=i.sub(l).div(e).min(1),c=new x(l.add(u),l.add(h)),a=s.whole?new x(c.begin.sub(o.sub(s.whole.begin).div(e)),c.end.add(s.whole.end.sub(i).div(e))):void 0;return new M(a,c,s.value,s.context)};return t.withQuerySpanMaybe(n).withHap(r).splitQueries()}),zr=f("focus",function(e,t,n){return e=_(e),t=_(t),n._fast(_(1).div(t.sub(e))).late(e.cyclePos())}),{focusSpan:jr,focusspan:$r}=f(["focusSpan","focusspan"],function(e,t){return t._focus(e.begin,e.end)}),Fr=f("ply",function(e,t){return t.fmap(n=>G(n)._fast(e)).squeezeJoin()}),{fast:Lr,density:Hr}=f(["fast","density"],function(e,t){return e===0?O:(e=_(e),t.withQueryTime(r=>r.mul(e)).withHapTime(r=>r.div(e)))}),Jr=f("hurry",function(e,t){return t._fast(e).mul(G({speed:e}))}),{slow:Ir,sparsity:Wr}=f(["slow","sparsity"],function(e,t){return e===0?O:t._fast(_(1).div(e))}),Rr=f("inside",function(e,t,n){return t(n._slow(e))._fast(e)}),Dr=f("outside",function(e,t,n){return t(n._fast(e))._slow(e)}),Vr=f("lastOf",function(e,t,n){const r=Array(e-1).fill(n);return r.push(t(n)),Dt(...r)}),{firstOf:Gr,every:Qr}=f(["firstOf","every"],function(e,t,n){const r=Array(e-1).fill(n);return r.unshift(t(n)),Dt(...r)}),Ur=f("apply",function(e,t){return e(t)}),Kr=f("cpm",function(e,t){return t._fast(e/60)}),Zr=f("early",function(e,t){return e=_(e),t.withQueryTime(n=>n.add(e)).withHapTime(n=>n.sub(e))}),Xr=f("late",function(e,t){return e=_(e),t._early(_(0).sub(e))}),Yr=f("zoom",function(e,t,n){t=_(t),e=_(e);const r=t.sub(e);return n.withQuerySpan(s=>s.withCycle(o=>o.mul(r).add(e))).withHapSpan(s=>s.withCycle(o=>o.sub(e).div(r))).splitQueries()}),{zoomArc:ts,zoomarc:es}=f(["zoomArc","zoomarc"],function(e,t){return t.zoom(e.begin,e.end)}),ns=f("linger",function(e,t){return e==0?O:e<0?t._zoom(e.add(1),1)._slow(e):t._zoom(0,e)._slow(e)}),rs=f("segment",function(e,t){return t.struct(G(!0)._fast(e))}),{invert:ss,inv:os}=f(["invert","inv"],function(e){return e.fmap(t=>!t)}),is=f("when",function(e,t,n){return e?t(n):n}),cs=f("off",function(e,t,n){return z(n,t(n.late(e)))}),as=f("brak",function(e){return e.when(Z(!1,!0),t=>X(t,O)._late(.25))}),Pe=f("rev",function(e){const t=function(n){const r=n.span,s=r.begin.sam(),o=r.begin.nextSam(),i=function(u){const h=u.withTime(a=>s.add(o.sub(a))),c=h.begin;return h.begin=h.end,h.end=c,h};return e.query(n.setSpan(i(r))).map(u=>u.withSpan(i))};return new d(t).splitQueries()}),us=f("pressBy",function(e,t){return t.fmap(n=>G(n).compress(e,1)).squeezeJoin()}),ls=f("press",function(e){return e._pressBy(.5)});d.prototype.hush=function(){return O};const fs=f("palindrome",function(e){return e.lastOf(2,Pe)}),{juxBy:hs,juxby:ps}=f(["juxBy","juxby"],function(e,t,n){e/=2;const r=function(i,l,u){return l in i?i[l]:u},s=n.withValue(i=>Object.assign({},i,{pan:r(i,"pan",.5)-e})),o=n.withValue(i=>Object.assign({},i,{pan:r(i,"pan",.5)+e}));return z(s,t(o))}),ds=f("jux",function(e,t){return t._juxBy(1,e,t)}),{echoWith:ms,echowith:ws,stutWith:ys,stutwith:gs}=f(["echoWith","echowith","stutWith","stutwith"],function(e,t,n,r){return z(...Lt(0,e-1).map(s=>n(r.late(_(t).mul(s)),s)))}),bs=f("echo",function(e,t,n,r){return r._echoWith(e,t,(s,o)=>s.velocity(Math.pow(n,o)))}),vs=f("stut",function(e,t,n,r){return r._echoWith(e,n,(s,o)=>s.velocity(Math.pow(t,o)))}),Qt=function(e,t,n=!1){return e=_(e),Z(...Lt(0,e.sub(1)).map(r=>n?t.late(_(r).div(e)):t.early(_(r).div(e))))},_s=f("iter",function(e,t){return Qt(e,t,!1)}),{iterBack:qs,iterback:As}=f(["iterBack","iterback"],function(e,t){return Qt(e,t,!0)}),ks=function(e,t){return Z(...Array(e).fill(t))};f("repeatCycles",ks);const Ut=function(e,t,n,r=!1,s=!1){const o=Array(e-1).fill(!1);o.unshift(!0);const i=Qt(e,V(...o),!r);return s||(n=n.repeatCycles(e)),n.when(i,t)};f(["chunk","slowchunk","slowChunk"],function(e,t,n){return Ut(e,t,n,!1,!1)});const{chunkBack:Ns,chunkback:Cs}=f(["chunkBack","chunkback"],function(e,t,n){return Ut(e,t,n,!0)});f(["fastchunk","fastChunk"],function(e,t,n){return Ut(e,t,n,!1,!0)});const Ss=f("bypass",function(e,t){return e=!!parseInt(e),e?O:t}),Ts=f("ribbon",(e,t,n)=>n.early(e).restart(G(1).slow(t))),xs=f("duration",function(e,t){return t.withHapSpan(n=>new x(n.begin,n.begin.add(e)))}),Ms=f("hsla",(e,t,n,r,s)=>s.color(`hsla(${e}turn,${t*100}%,${n*100}%,${r})`)),Bs=f("hsl",(e,t,n,r)=>r.color(`hsl(${e}turn,${t*100}%,${n*100}%)`)),{color:Os,colour:Es}=f(["color","colour"],function(e,t){return t.withContext(n=>({...n,color:e}))}),Ps=f("velocity",function(e,t){return t.withContext(n=>({...n,velocity:(n.velocity||1)*e}))}),zs=f("legato",function(e,t){return e=_(e),t.withHapSpan(n=>new x(n.begin,n.begin.add(n.end.sub(n.begin).mul(e))))}),js=f("chop",function(e,t){const r=Array.from({length:e},(o,i)=>i).map(o=>({begin:o/e,end:(o+1)/e})),s=function(o){return V(r.map(i=>Object.assign({},o,i)))};return t.squeezeBind(s)}),$s=f("striate",function(e,t){const r=Array.from({length:e},(o,i)=>i).map(o=>({begin:o/e,end:(o+1)/e})),s=Z(...r);return t.set(s)._fast(e)}),ze=function(e,t,n=1){return t.speed(1/e*n).unit("c").slow(e)},je=f("slice",function(e,t,n){return e.innerBind(r=>t.outerBind(s=>n.outerBind(o=>{o=o instanceof Object?o:{s:o};const i=Array.isArray(r)?r[s]:s/r,l=Array.isArray(r)?r[s+1]:(s+1)/r;return G({begin:i,end:l,_slices:r,...o})})))},!1),Fs=f("splice",function(e,t,n){return je(e,t,n).withHap(function(s){return s.withValue(o=>({speed:1/o._slices/s.whole.duration*(o.speed||1),unit:"c",...o}))})},!1),{loopAt:Ls,loopat:Hs}=f(["loopAt","loopat"],function(e,t){return ze(e,t,1)}),Js=f("fit",e=>e.withHap(t=>t.withValue(n=>({...n,speed:1/t.whole.duration,unit:"c"})))),{loopAtCps:Is,loopatcps:Ws}=f(["loopAtCps","loopatcps"],function(e,t,n){return ze(e,n,t)}),Rs=e=>G(1).withValue(()=>w(e())).innerJoin();let he=e=>e<.5?1:1-(e-.5)/.5,$e=(e,t,n)=>{t=w(t),e=w(e),n=w(n);let r=t.fmap(o=>({gain:he(o)})),s=t.fmap(o=>({gain:he(1-o)}));return z(e.mul(r),n.mul(s))};d.prototype.xfade=function(e,t){return $e(this,e,t)};const D={},Ds=[[["s","n","gain"],"sound"],["source","src"],["n"],[["note","n"]],["accelerate"],["gain"],["postgain"],["amp"],["attack","att"],[["fmh","fmi"],"fmh"],[["fmi","fmh"],"fm"],["fmenv"],["fmattack"],["fmdecay"],["fmsustain"],["fmrelease"],["fmvelocity"],["bank"],["analyze"],["fft"],["decay"],["sustain","sus"],["release","rel"],["hold"],[["bandf","bandq"],"bpf","bp"],["bandq","bpq"],["begin"],["end"],["loop"],["loopBegin","loopb"],["loopEnd","loope"],["crush"],["coarse"],["channels","ch"],["phaserrate","phasr"],[["phaser","phaserdepth","phasercenter","phasersweep"],"ph"],["phasersweep","phs"],["phasercenter","phc"],["phaserdepth","phd","phasdp"],["channel"],["cut"],[["cutoff","resonance"],"ctf","lpf","lp"],["lpenv","lpe"],["hpenv","hpe"],["bpenv","bpe"],["lpattack","lpa"],["hpattack","hpa"],["bpattack","bpa"],["lpdecay","lpd"],["hpdecay","hpd"],["bpdecay","bpd"],["lpsustain","lps"],["hpsustain","hps"],["bpsustain","bps"],["lprelease","lpr"],["hprelease","hpr"],["bprelease","bpr"],["ftype"],["fanchor"],[["vib","vibmod"],"vibrato","v"],["noise"],[["vibmod","vib"],"vmod"],[["hcutoff","hresonance"],"hpf","hp"],["hresonance","hpq"],["resonance","lpq"],["djf"],[["delay","delaytime","delayfeedback"]],["delayfeedback","delayfb","dfb"],["delaytime","delayt","dt"],["lock"],["detune","det"],["dry"],["fadeTime","fadeOutTime"],["fadeInTime"],["freq"],["gate","gat"],["leslie"],["lrate"],["lsize"],["activeLabel"],[["label","activeLabel"]],["degree"],["mtranspose"],["ctranspose"],["harmonic"],["stepsPerOctave"],["octaveR"],["nudge"],["octave"],["orbit"],["overgain"],["overshape"],["pan"],["panspan"],["pansplay"],["panwidth"],["panorient"],["rate"],["slide"],["semitone"],["voice"],["chord"],["dictionary","dict"],["anchor"],["offset"],["octaves"],[["mode","anchor"]],[["room","size"]],["roomlp","rlp"],["roomdim","rdim"],["roomfade","rfade"],[["ir","i"],"iresponse"],["roomsize","size","sz","rsize"],["shape"],[["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]],["compressorKnee"],["compressorRatio"],["compressorAttack"],["compressorRelease"],["speed"],["unit"],["squiz"],["vowel"],["waveloss"],["density"],["dur"],["expression"],["sustainpedal"],["tremolodepth","tremdp"],["tremolorate","tremr"],["fshift"],["fshiftnote"],["fshiftphase"],["triode"],["krush"],["kcutoff"],["octer"],["octersub"],["octersubsub"],["ring"],["ringf"],["ringdf"],["distort"],["freeze"],["xsdelay"],["tsdelay"],["real"],["imag"],["enhance"],["partials"],["comb"],["smear"],["scram"],["binshift"],["hbrick"],["lbrick"],["midichan"],["control"],["ccn"],["ccv"],["polyTouch"],["midibend"],["miditouch"],["ctlNum"],["frameRate"],["frames"],["hours"],["midicmd"],["minutes"],["progNum"],["seconds"],["songPtr"],["uid"],["val"],["cps"],["clip"],["zrand"],["curve"],["slide"],["deltaSlide"],["pitchJump"],["pitchJumpTime"],["lfo","repeatTime"],["znoise"],["zmod"],["zcrush"],["zdelay"],["tremolo"],["zzfx"]];D.createParam=function(e){const t=Array.isArray(e)?e[0]:e;var n;Array.isArray(e)?n=o=>{if(Array.isArray(o)){const i={};return o.forEach((l,u)=>{u<e.length&&(i[e[u]]=l)}),i}else return{[t]:o}}:n=o=>({[t]:o});const r=(...o)=>V(...o).withValue(n),s=function(...o){return o.length?this.set(r(...o)):this.fmap(n)};return d.prototype[t]=s,r};Ds.forEach(([e,...t])=>{const n=Array.isArray(e)?e[0]:e;D[n]=D.createParam(e),t.forEach(r=>{D[r]=D[n],d.prototype[r]=d.prototype[n]})});D.createParams=(...e)=>e.reduce((t,n)=>Object.assign(t,{[n]:D.createParam(n)}),{});D.adsr=f("adsr",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,r,s,o]=e;return t.set({attack:n,decay:r,sustain:s,release:o})});D.ds=f("ds",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,r]=e;return t.set({decay:n,sustain:r})});const Vs=function(e,t){const[n,r]=e,[s,o]=t,[i,l]=It(r,s);return[[r,n-r],[Wt((u,h)=>u.concat(h),i,o),l]]},Gs=function(e,t){const[n,r]=e,[s,o]=t,[i,l]=It(n,o);return[[n,r-n],[Wt((h,c)=>h.concat(c),s,i),l]]},Fe=function(e,t){const[n,r]=e;return Math.min(n,r)<=1?[e,t]:Fe(...n>r?Vs(e,t):Gs(e,t))},Le=function(e,t){const n=t-e,r=Array(e).fill([1]),s=Array(n).fill([0]),o=Fe([e,n],[r,s]);return rt(o[1][0]).concat(rt(o[1][1]))},Kt=function(e,t,n){const r=Le(e,t);return n?_e(r,-n):r},Qs=f("euclid",function(e,t,n){return n.struct(Kt(e,t,0))}),{euclidrot:Us,euclidRot:Ks}=f(["euclidrot","euclidRot"],function(e,t,n,r){return r.struct(Kt(e,t,n))}),He=function(e,t,n,r){if(e<1)return O;const o=Kt(e,t,n).join("").split("1").slice(1).map(i=>[i.length+1,!0]);return r.struct(St(...o))},Zs=f(["euclidLegato"],function(e,t,n){return He(e,t,0,n)}),Xs=f(["euclidLegatoRot"],function(e,t,n,r){return He(e,t,n,r)});function Ys(e){return new d(t=>[new M(void 0,t.span,e)])}const it=e=>{const t=n=>[new M(void 0,n.span,e(n.span.midpoint()))];return new d(t)},Zt=it(e=>1-e%1),Je=Zt.toBipolar(),Tt=it(e=>e%1),Ie=Tt.toBipolar(),Xt=it(e=>Math.sin(Math.PI*2*e)),We=Xt.fromBipolar(),to=We._early(_(1).div(4)),eo=Xt._early(_(1).div(4)),Re=it(e=>Math.floor(e*2%2)),no=Re.toBipolar(),ro=X(Zt,Tt),so=X(Je,Ie),De=it(ft),oo=e=>{const t=e<<13^e,n=t>>17^t;return n<<5^n},io=e=>e-Math.trunc(e),co=e=>oo(Math.trunc(io(e/300)*536870912)),ao=e=>e%536870912/536870912,Pt=e=>Math.abs(ao(co(e))),uo=e=>Tt.range(0,e).floor().segment(e),W=it(Pt),lo=W.toBipolar(),Yt=e=>W.fmap(t=>t<e),fo=e=>w(e).fmap(Yt).innerJoin(),ho=Yt(.5),Ve=e=>W.fmap(t=>Math.trunc(t*e)),po=e=>w(e).fmap(Ve).innerJoin(),mo=(e,t)=>(t=t.map(w),t.length==0?O:e.fmap(n=>{const r=Ne(Math.round(n),0,t.length-1);return t[r]}).innerJoin()),wo=(e,t)=>(t=t.map(w),t.length==0?O:e.fmap(n=>{const r=vt(Math.round(n),t.length);return t[r]}).squeezeJoin()),te=(e,t)=>(t=t.map(w),t.length==0?O:e.range(0,t.length).fmap(n=>{const r=Math.min(Math.max(Math.floor(n),0),t.length-1);return t[r]})),xt=(e,t)=>te(e,t).outerJoin(),Ge=(e,t)=>te(e,t).innerJoin(),yo=(...e)=>xt(W,e);d.prototype.choose=function(...e){return xt(this,e)};d.prototype.choose2=function(...e){return xt(this.fromBipolar(),e)};const Qe=(...e)=>Ge(W.segment(1),e),go=Qe,Ue=function(e,...t){const n=t.map(l=>w(l[0])),r=[];let s=0;for(const l of t)s+=l[1],r.push(s);const o=s,i=function(l){const u=l*o;return n[r.findIndex(h=>h>u,r)]};return e.fmap(i)},bo=(...e)=>Ue(...e).outerJoin(),vo=(...e)=>bo(W,...e),_o=(...e)=>Ue(W,...e).innerJoin(),Ke=e=>{const t=e.fmap(Math.floor),n=e.fmap(o=>Math.floor(o)+1),r=o=>6*o**5-15*o**4+10*o**3,s=o=>i=>l=>i+r(o)*(l-i);return e.sub(t).fmap(s).appBoth(t.fmap(Pt)).appBoth(n.fmap(Pt))},qo=Ke(De.fmap(e=>Number(e))),Ao=f("degradeByWith",(e,t,n)=>n.fmap(r=>s=>r).appLeft(e.filterValues(r=>r>t))),ko=f("degradeBy",function(e,t){return t._degradeByWith(W,e)}),No=f("degrade",e=>e._degradeBy(.5)),Co=f("undegradeBy",function(e,t){return t._degradeByWith(W.fmap(n=>1-n),e)}),So=f("undegrade",e=>e._undegradeBy(.5)),To=f("sometimesBy",function(e,t,n){return w(e).fmap(r=>z(n._degradeBy(r),t(n._undegradeBy(1-r)))).innerJoin()}),xo=f("sometimes",function(e,t){return t._sometimesBy(.5,e)}),Mo=f("someCyclesBy",function(e,t,n){return w(e).fmap(r=>z(n._degradeByWith(W._segment(1),r),t(n._degradeByWith(W.fmap(s=>1-s)._segment(1),1-r)))).innerJoin()}),Bo=f("someCycles",function(e,t){return t._someCyclesBy(.5,e)}),Oo=f("often",function(e,t){return t.sometimesBy(.75,e)}),Eo=f("rarely",function(e,t){return t.sometimesBy(.25,e)}),Po=f("almostNever",function(e,t){return t.sometimesBy(.1,e)}),zo=f("almostAlways",function(e,t){return t.sometimesBy(.9,e)}),jo=f("never",function(e,t){return t}),$o=f("always",function(e,t){return e(t)});let Nt;try{Nt=window?.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let pe=Nt?.getVoices();function Fo(e,t,n){Nt.cancel();const r=new SpeechSynthesisUtterance(e);r.lang=t,pe=Nt.getVoices();const s=pe.filter(o=>o.lang.includes(t));typeof n=="number"?r.voice=s[n%s.length]:typeof n=="string"&&(r.voice=s.find(o=>o.name===o)),speechSynthesis.speak(r)}const Lo=f("speak",function(e,t,n){return n.onTrigger((r,s)=>{Fo(s.value,e,t)})}),Ze=async(...e)=>{const t=await Promise.allSettled(e),n=t.filter(r=>r.status==="fulfilled").map(r=>r.value);t.forEach((r,s)=>{r.status==="rejected"&&console.warn(`evalScope: module with index ${s} could not be loaded:`,r.reason)}),n.forEach(r=>{Object.entries(r).forEach(([s,o])=>{globalThis[s]=o})})};function Ho(e,t={}){const{wrapExpression:n=!0,wrapAsync:r=!0}=t;n&&(e=`{${e}}`),r&&(e=`(async ()=>${e})()`);const s=`"use strict";return (${e})`;return Function(s)()}const Xe=async(e,t)=>{let n={};if(t){const o=t(e);e=o.output,n=o}return{mode:"javascript",pattern:await Ho(e,{wrapExpression:!!t}),meta:n}};function Jo(e,t,n=.05,r=.1,s=.1){let o=0,i=0,l=10**4,u=.01;const h=b=>n=b(n);s=s||r/2;const c=()=>{const b=e(),E=b+r+s;for(i===0&&(i=b+u);i<E;)i=Math.round(i*l)/l,i>=b&&t(i,n,o),i<b&&console.log("TOO LATE",i),i+=n,o++};let a;const y=()=>{m(),c(),a=setInterval(c,r*1e3)},m=()=>a!==void 0&&clearInterval(a);return{setDuration:h,start:y,stop:()=>{o=0,i=0,m()},pause:()=>m(),duration:n,interval:r,getPhase:()=>i,minLatency:u}}class Ye{constructor({interval:t,onTrigger:n,onToggle:r,onError:s,getTime:o,latency:i=.1}){this.started=!1,this.cps=1,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=o,this.num_cycles_since_last_cps_change=0,this.onToggle=r,this.latency=i,this.clock=Jo(o,(u,h,c)=>{c===0&&(this.origin=u),this.num_ticks_since_cps_change===0&&(this.num_cycles_since_last_cps_change=this.lastEnd),this.num_ticks_since_cps_change++;try{const a=o(),y=this.lastEnd;this.lastBegin=y;const m=h*this.cps,q=this.num_cycles_since_last_cps_change+this.num_ticks_since_cps_change*m;this.lastEnd=q;const v=this.pattern.queryArc(y,q),N=u-a;this.lastTick=a+N,v.forEach(b=>{if(b.part.begin.equals(b.whole.begin)){const E=(b.whole.begin-y)/this.cps+N+i,j=b.duration/this.cps;n?.(b,E,j,this.cps)}})}catch(a){J(`[cyclist] error: ${a.message}`),s?.(a)}},t);let l=this;globalThis.__cyclist__=l}now(){const t=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+t*this.cps}setStarted(t){this.started=t,this.onToggle?.(t)}start(){if(this.num_ticks_since_cps_change=0,this.num_cycles_since_last_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");J("[cyclist] start"),this.clock.start(),this.setStarted(!0),globalThis.haps_from_outputs=null}pause(){J("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){J("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}setPattern(t,n=!1){this.pattern=t,n&&!this.started&&this.start()}setCps(t=1){this.cps!==t&&(this.cps=t,this.num_ticks_since_cps_change=0)}log(t,n,r){const s=r.filter(o=>o.hasOnset());console.log(`${t.toFixed(4)} - ${n.toFixed(4)} ${Array(s.length).fill("I").join("")}`)}}let zt;function ee(){if(!zt)throw new Error("no time set! use setTime to define a time source");return zt()}function tn(e){zt=e}function Io({interval:e,defaultOutput:t,onSchedulerError:n,onEvalError:r,beforeEval:s,afterEval:o,getTime:i,transpiler:l,onToggle:u,editPattern:h,onUpdateState:c}){const a={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},y=g=>{Object.assign(a,g),a.isDirty=a.code!==a.activeCode,a.error=a.evalError||a.schedulerError,c?.(a)},m=new Ye({interval:e,onTrigger:en({defaultOutput:t,getTime:i}),onError:n,getTime:i,onToggle:g=>{y({started:g}),u?.(g)}});let q={},v;const N=function(){return q={},v=void 0,O},b=(g,$=!0)=>{g=h?.(g)||g,m.setPattern(g,$)};tn(()=>m.now());const E=async(g,$=!0,Q=!0)=>{if(!g)throw new Error("no code to evaluate");try{y({code:g,pending:!0}),await s?.({code:g}),Q&&N();let{pattern:C,meta:nt}=await Xe(g,l);if(Object.keys(q).length&&(C=z(...Object.values(q))),v&&(C=v(C)),!Rt(C)){const at=`got "${typeof evaluated}" instead of pattern`;throw new Error(at+(typeof evaluated=="function"?", did you forget to call a function?":"."))}return J("[eval] code updated"),b(C,$),y({miniLocations:nt?.miniLocations||[],widgets:nt?.widgets||[],activeCode:g,pattern:C,evalError:void 0,schedulerError:void 0,pending:!1}),o?.({code:g,pattern:C,meta:nt}),C}catch(C){J(`[eval] error: ${C.message}`,"error"),y({evalError:C,pending:!1}),r?.(C)}},j=()=>m.stop(),U=()=>m.start(),Y=()=>m.pause(),tt=()=>m.toggle(),et=g=>m.setCps(g),ct=g=>m.setCps(g/60),dt=f("loopAt",(g,$)=>$.loopAtCps(g,m.cps));d.prototype.p=function(g){return q[g]=this,this},d.prototype.q=function(g){return O};const k=function(g){return v=g,O};try{for(let g=1;g<10;++g)Object.defineProperty(d.prototype,`d${g}`,{get(){return this.p(g)}}),Object.defineProperty(d.prototype,`p${g}`,{get(){return this.p(g)}}),d.prototype[`q${g}`]=O}catch{}const F=f("fit",g=>g.withHap($=>$.withValue(Q=>({...Q,speed:m.cps/$.whole.duration,unit:"c"}))));return Ze({loopAt:dt,fit:F,all:k,hush:N,setCps:et,setcps:et,setCpm:ct,setcpm:ct}),{scheduler:m,evaluate:E,start:U,stop:j,pause:Y,setCps:et,setPattern:b,setCode:g=>y({code:g}),toggle:tt,state:a}}const en=({getTime:e,defaultOutput:t})=>async(n,r,s,o)=>{try{(!n.context.onTrigger||!n.context.dominantTrigger)&&await t(n,r,s,o),n.context.onTrigger&&await n.context.onTrigger(e()+r,n,e(),o)}catch(i){J(`[cyclist] error: ${i.message}`,"error")}},Mt=(e="test-canvas")=>{let t=document.querySelector("#"+e);if(!t){t=document.createElement("canvas"),t.id=e,t.width=window.innerWidth*2,t.height=window.innerHeight*2,t.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",document.body.prepend(t);let r;window.addEventListener("resize",()=>{r&&clearTimeout(r),r=setTimeout(()=>{t.width=window.innerWidth*2,t.height=window.innerHeight*2},200)})}return t.getContext("2d")};d.prototype.draw=function(e,{from:t,to:n,onQuery:r}={}){if(typeof window>"u")return this;window.strudelAnimation&&cancelAnimationFrame(window.strudelAnimation);const s=Mt();let o,i=[];const l=u=>{const h=ee();if(t!==void 0&&n!==void 0){const c=Math.floor(h);if(o!==c){o=c;const a=c+t,y=c+n;setTimeout(()=>{i=this.query(new ot(new x(a,y))).filter(Boolean).filter(m=>m.part.begin.equals(m.whole.begin)),r?.(i)},0)}}e(s,i,h,u),window.strudelAnimation=requestAnimationFrame(l)};return requestAnimationFrame(l),this};const Wo=(e=!0)=>{const t=Mt();e&&t.clearRect(0,0,t.canvas.width,t.canvas.width),window.strudelAnimation&&cancelAnimationFrame(window.strudelAnimation),window.strudelScheduler&&clearInterval(window.strudelScheduler)};d.prototype.onPaint=function(e){return this.context={onPaint:e},this};class nn{constructor(t,n){this.onFrame=t,this.onError=n}start(){const t=this;let n=requestAnimationFrame(function r(s){try{t.onFrame(s)}catch(o){t.onError(o)}n=requestAnimationFrame(r)});t.cancel=()=>{cancelAnimationFrame(n)}}stop(){this.cancel&&this.cancel()}}class Ro{constructor(t,n){this.visibleHaps=[],this.lastFrame=null,this.drawTime=n,this.framer=new nn(()=>{if(!this.scheduler){console.warn("Drawer: no scheduler");return}const r=Math.abs(this.drawTime[0]),s=this.drawTime[1],o=this.scheduler.now()+s;if(this.lastFrame===null){this.lastFrame=o;return}const i=this.scheduler.pattern.queryArc(Math.max(this.lastFrame,o-1/10),o);this.lastFrame=o,this.visibleHaps=(this.visibleHaps||[]).filter(u=>u.whole.end>=o-r-s).concat(i.filter(u=>u.hasOnset()));const l=o-s;t(this.visibleHaps,l,this)},r=>{console.warn("draw error",r)})}setDrawTime(t){this.drawTime=t}invalidate(t=this.scheduler,n){if(!t)return;n=n??t.now(),this.scheduler=t;let[r,s]=this.drawTime;const[o,i]=[Math.max(n,0),n+s+.1];this.visibleHaps=this.visibleHaps.filter(u=>u.whole.begin<n);const l=t.pattern.queryArc(o,i);this.visibleHaps=this.visibleHaps.concat(l)}start(t){this.scheduler=t,this.invalidate(),this.framer.start()}stop(){this.framer&&this.framer.stop()}}const{createParams:Do}=D;let de="#22222210";d.prototype.animate=function({callback:e,sync:t=!1,smear:n=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const r=Mt(),{clientWidth:s,clientHeight:o}=r.canvas;let i=n===0?"99":Number((1-n)*100).toFixed(0);i=i.length===1?`0${i}`:i,de=`#200010${i}`;const l=u=>{let h;u=Math.round(u),h=this.slow(1e3).queryArc(u,u),r.fillStyle=de,r.fillRect(0,0,s,o),h.forEach(c=>{let{x:a,y,w:m,h:q,s:v,r:N,angle:b=0,fill:E="darkseagreen"}=c.value;if(m*=s,q*=o,N!==void 0&&b!==void 0){const U=b*2*Math.PI,[Y,tt]=[(s-m)/2,(o-q)/2];a=Y+Math.cos(U)*N*Y,y=tt+Math.sin(U)*N*tt}else a*=s-m,y*=o-q;const j={...c.value,x:a,y,w:m,h:q};r.fillStyle=E,v==="rect"?r.fillRect(a,y,m,q):v==="ellipse"&&(r.beginPath(),r.ellipse(a+m/2,y+q/2,m/2,q/2,0,0,2*Math.PI),r.fill()),e&&e(r,j,c)}),window.frame=requestAnimationFrame(l)};return window.frame=requestAnimationFrame(l),O};const{x:ne,y:Vo,w:Go,h:Qo,angle:Uo,r:Ko,fill:Zo,smear:Xo}=Do("x","y","w","h","angle","r","fill","smear"),Yo=f("rescale",function(e,t){return t.mul(ne(e).w(e).y(e).h(e))}),ti=f("moveXY",function(e,t,n){return n.add(ne(e).y(t))}),ei=f("zoomIn",function(e,t){const n=G(1).sub(e).div(2);return t.rescale(e).move(n,n)}),bt=(e,t,n)=>e*(n-t)+t,me=e=>{let{value:t}=e;typeof e.value!="object"&&(t={value:t});let{note:n,n:r,freq:s,s:o}=t;return s?Ft(s):(n=n??r,typeof n=="string"?pt(n):typeof n=="number"?n:o?"_"+o:t)};d.prototype.pianoroll=function(e={}){let{cycles:t=4,playhead:n=.5,overscan:r=1,hideNegative:s=!1}=e,o=-t*n,i=t*(1-n);return this.draw((l,u,h)=>{const c=a=>(!s||a.whole.begin>=0)&&a.whole.begin<=h+i&&a.endClipped>=h+o;globalThis.haps_from_outputs||(globalThis.haps_from_outputs=[]),globalThis.haps_from_outputs.length>0&&(u.push(...globalThis.haps_from_outputs),u=globalThis.haps_from_outputs.filter(c),globalThis.haps_from_outputs=u),Bt({...e,time:h,ctx:l,haps:u.filter(c)})},{from:o-r,to:i+r}),this};function Bt({time:e,haps:t,cycles:n=4,playhead:r=.5,flipTime:s=0,flipValues:o=0,hideNegative:i=!1,inactive:l="#7491D2",active:u="#FFCA28",background:h="transparent",smear:c=0,playheadColor:a="white",minMidi:y=10,maxMidi:m=90,autorange:q=0,timeframe:v,fold:N=0,vertical:b=0,labels:E=!1,fill:j=1,fillActive:U=!1,strokeActive:Y=!0,stroke:tt,hideInactive:et=0,colorizeInactive:ct=1,fontFamily:dt,ctx:k}={}){const F=k.canvas.width,st=k.canvas.height;let g=-n*r,$=n*(1-r);v&&(console.warn("timeframe is deprecated! use from/to instead"),g=0,$=v);const Q=b?st:F,C=b?F:st;let nt=b?[Q,0]:[0,Q];const at=$-g,se=b?[0,C]:[C,0];let _t=m-y+1,ut=C/_t,qt=[];s&&nt.reverse(),o&&se.reverse();const{min:sn,max:on,values:cn}=t.reduce(({min:B,max:R,values:mt},wt)=>{const L=me(wt);return{min:L<B?L:B,max:L>R?L:R,values:mt.includes(L)?mt:[...mt,L]}},{min:1/0,max:-1/0,values:[]});q&&(y=sn,m=on,_t=m-y+1),qt=cn.sort((B,R)=>String(B).localeCompare(String(R))),ut=N?C/qt.length:C/_t,k.fillStyle=h,k.globalAlpha=1,c||(k.clearRect(0,0,F,st),k.fillRect(0,0,F,st)),t.forEach(B=>{const R=B.whole.begin<=e&&B.endClipped>e;let mt=tt??(Y&&R),wt=!R&&j||R&&U;if(et&&!R)return;let L=B.value?.color||B.context?.color;u=L||u,l=ct&&L||l,L=R?u:l,k.fillStyle=wt?L:"transparent",k.strokeStyle=L,k.globalAlpha=B.context.velocity??B.value?.gain??1;const an=(B.whole.begin-(s?$:g))/at,oe=bt(an,...nt);let yt=bt(B.duration/at,0,Q);const ie=me(B),un=N?qt.indexOf(ie)/qt.length:(Number(ie)-y)/_t,ce=bt(un,...se);let ae=0;const ue=bt(e/at,...nt);let gt;if(b?gt=[ce+1-(o?ut:0),Q-ue+oe+ae+1-(s?0:yt),ut-2,yt-2]:gt=[oe-ue+ae+1-(s?yt:0),ce+1-(o?0:ut),yt-2,ut-2],mt&&k.strokeRect(...gt),wt&&k.fillRect(...gt),E){const ln=B.value.note??B.value.s+(B.value.n?`:${B.value.n}`:""),{label:le,activeLabel:fn}=B.value,hn=(R&&fn||le)??ln;let pn=b?yt:ut*.75;k.font=`${pn}px ${dt||"monospace"}`,k.fillStyle=wt?"black":L,k.textBaseline="top",k.fillText(hn,...gt)}}),k.globalAlpha=1;const At=bt(-g/at,...nt);return k.strokeStyle=a,k.beginPath(),b?(k.moveTo(0,At),k.lineTo(C,At)):(k.moveTo(At,0),k.lineTo(At,C)),k.stroke(),this}function re(e,t={}){let[n,r]=e;n=Math.abs(n);const s=r+n,o=n/s;return{fold:1,...t,cycles:s,playhead:o}}const rn=(e={})=>(t,n,r,s,o={})=>Bt({ctx:t,time:n,haps:r,...re(s,{...o,...e})});d.prototype.punchcard=function(e){return this.onPaint(rn(e))};d.prototype.wordfall=function(e){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...e})};function ni(e){const{drawTime:t,...n}=e;Bt({...re(t),...n})}function ri(e,t,n,r){const s=(e-90)*Math.PI/180;return[n+Math.cos(s)*t,r+Math.sin(s)*t]}const we=(e,t,n,r,s=0)=>ri((e+s)*360,t*e,n,r);function ye(e){let{ctx:t,from:n=0,to:r=3,margin:s=50,cx:o=100,cy:i=100,rotate:l=0,thickness:u=s/2,color:h="#0000ff30",cap:c="round",stretch:a=1,fromOpacity:y=1,toOpacity:m=1}=e;n*=a,r*=a,l*=a,t.lineWidth=u,t.lineCap=c,t.strokeStyle=h,t.globalAlpha=y,t.beginPath();let[q,v]=we(n,s,o,i,l);t.moveTo(q,v);const N=1/60;let b=n;for(;b<=r;){const[E,j]=we(b,s,o,i,l);t.globalAlpha=(b-n)/(r-n)*m,t.lineTo(E,j),b+=N}t.stroke()}d.prototype.spiral=function(e={}){const{stretch:t=1,size:n=80,thickness:r=n/2,cap:s="butt",inset:o=3,playheadColor:i="#ffffff90",playheadLength:l=.02,playheadThickness:u=r,padding:h=0,steady:c=1,inactiveColor:a="#ffffff20",colorizeInactive:y=0,fade:m=!0}=e;function q({ctx:v,time:N,haps:b,drawTime:E}){const[j,U]=[v.canvas.width,v.canvas.height];v.clearRect(0,0,j*2,U*2);const[Y,tt]=[j/2,U/2],et={margin:n/t,cx:Y,cy:tt,stretch:t,cap:s,thickness:r},ct={...et,thickness:u,from:o-l,to:o,color:i},[dt]=E,k=c*N;b.forEach(F=>{const st=F.whole.begin<=N&&F.endClipped>N,g=F.whole.begin-N+o,$=F.endClipped-N+o-h,{color:Q}=F.context,C=m?1-Math.abs((F.whole.begin-N)/dt):1;ye({ctx:v,...et,from:g,to:$,rotate:k,color:y||st?Q:a,fromOpacity:C,toOpacity:C})}),ye({ctx:v,...ct,rotate:k})}return this.onPaint((v,N,b,E)=>q({ctx:v,time:N,haps:b,drawTime:E}))};function si(e){window.strudelAnimation&&cancelAnimationFrame(window.strudelAnimation);const t=n=>{e(n,ee()),window.strudelAnimation=requestAnimationFrame(t)};requestAnimationFrame(t)}const oi=function(e,t={}){const n=document.getElementById("code"),r="background-image:url("+e+");background-size:contain;";n.style=r;const{className:s}=n,o=(u,h)=>{({style:()=>n.style=r+";"+h,className:()=>n.className=h+" "+s})[u]()},i=Object.entries(t).filter(([u,h])=>typeof h=="function");Object.entries(t).filter(([u,h])=>typeof h=="string").forEach(([u,h])=>o(u,h)),i.length!==0&&si((u,h)=>i.forEach(([c,a])=>{o(c,a(h))}))},ii=()=>{const e=document.getElementById("code");e&&(e.style="")};J("🌀 @strudel.cycles/core loaded 🌀");globalThis._strudelLoaded&&console.warn(`@strudel.cycles/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel.cycles/core".`);globalThis._strudelLoaded=!0;const ui=Object.freeze(Object.defineProperty({__proto__:null,Cyclist:Ye,Drawer:Ro,Fraction:_,Framer:nn,Hap:M,Pattern:d,State:ot,TimeSpan:x,__chooseWith:te,_brandBy:Yt,_irand:Ve,_mod:vt,add:Yn,almostAlways:zo,almostNever:Po,always:$o,and:gr,angle:Uo,apply:Ur,arrange:Vn,backgroundImage:oi,band:or,base64ToUnicode:Se,bjork:Le,blshift:ar,bor:ir,brak:as,brand:ho,brandBy:fo,brshift:ur,bxor:cr,bypass:Ss,cat:Vt,ceil:Ar,choose:yo,chooseCycles:Qe,chooseInWith:Ge,chooseWith:xt,chop:js,chunkBack:Ns,chunkback:Cs,clamp:Ne,cleanupDraw:Wo,cleanupUi:ii,code2hash:Ln,color:Os,colour:Es,compose:xn,compress:Mr,compressSpan:Br,compressspan:Or,constant:Mn,controls:D,cosine:to,cosine2:eo,cpm:Kr,curry:A,degrade:No,degradeBy:ko,degradeByWith:Ao,density:Hr,div:nr,drawLine:Te,drawPianoroll:ni,duration:xs,early:Zr,echo:bs,echoWith:ms,echowith:ws,eq:dr,eqt:mr,euclid:Qs,euclidLegato:Zs,euclidLegatoRot:Xs,euclidRot:Ks,euclidrot:Us,evalScope:Ze,evaluate:Xe,every:Qr,fast:Lr,fastGap:Er,fastcat:X,fastgap:Pr,fill:Zo,firstOf:Gr,fit:Js,flatten:rt,floor:qr,focus:zr,focusSpan:jr,focusspan:$r,fractionalArgs:Bn,freqToMidi:Ft,fromBipolar:Nr,func:vr,getDrawContext:Mt,getDrawOptions:re,getFreq:be,getFrequency:Tn,getPlayableNoteValue:Sn,getPunchcardPainter:rn,getSoundIndex:Cn,getTime:ee,getTrigger:en,gt:fr,gte:pr,h:Qo,hash2code:Hn,hsl:Bs,hsla:Ms,hurry:Jr,id:ft,inside:Rr,inv:os,invert:ss,irand:po,isNote:Ct,isNoteWithOctave:vn,isPattern:Rt,isaw:Zt,isaw2:Je,iter:_s,iterBack:qs,iterback:As,jux:ds,juxBy:hs,juxby:ps,keep:Zn,keepif:Xn,lastOf:Vr,late:Xr,legato:zs,linger:ns,listRange:Lt,logKey:$t,logger:J,loopAt:Ls,loopAtCps:Is,loopat:Hs,loopatcps:Ws,lt:lr,lte:hr,mapArgs:Jt,mask:Gn,midi2note:Nn,midiToFreq:ht,mod:rr,moveXY:ti,mul:er,nanFallback:ve,ne:wr,net:yr,never:jo,noteToMidi:pt,numeralArgs:I,off:cs,often:Oo,or:br,outside:Dr,palindrome:fs,parseFractional:ke,parseNumeral:Ht,perlin:qo,perlinWith:Ke,pianoroll:Bt,pick:mo,pipe:qe,ply:Fr,pm:Be,polymeter:Gt,polymeterSteps:Ee,polyrhythm:xe,pow:sr,pr:Me,press:ls,pressBy:us,pure:G,r:Ko,rand:W,rand2:lo,randcat:go,range:Cr,range2:Tr,rangex:Sr,rarely:Eo,ratio:xr,ref:Rs,register:f,reify:w,removeUndefineds:Ae,repl:Io,rescale:Yo,rev:Pe,ribbon:Ts,rotate:_e,round:_r,run:uo,saw:Tt,saw2:Ie,segment:rs,seq:Oe,sequence:V,set:Kn,setStringParser:In,setTime:tn,signal:it,silence:O,sine:We,sine2:Xt,slice:je,slow:Ir,slowcat:Z,slowcatPrime:Dt,smear:Xo,sol2note:Fn,someCycles:Bo,someCyclesBy:Mo,sometimes:xo,sometimesBy:To,sparsity:Wr,speak:Lo,splice:Fs,splitAt:It,square:Re,square2:no,squeeze:wo,stack:z,steady:Ys,striate:$s,struct:Qn,stut:vs,stutWith:ys,stutwith:gs,sub:tr,superimpose:Un,time:De,timeCat:St,toBipolar:kr,tokenizeNote:ge,tri:ro,tri2:so,undegrade:So,undegradeBy:Co,unicodeToBase64:Ce,valueToMidi:An,velocity:Ps,w:Go,wchoose:vo,wchooseCycles:_o,when:is,x:ne,xfade:$e,y:Vo,zipWith:Wt,zoom:Yr,zoomArc:ts,zoomIn:ei,zoomarc:es},Symbol.toStringTag,{value:"Module"}));let P=[],ci=(e,t)=>{let n=[],r={get(){return r.lc||r.listen(()=>{})(),r.value},l:t||0,lc:0,listen(s,o){return r.lc=n.push(s,o||r.l)/2,()=>{let i=n.indexOf(s);~i&&(n.splice(i,2),--r.lc||r.off())}},notify(s){let o=!P.length;for(let i=0;i<n.length;i+=2)P.push(n[i],n[i+1],r.value,s);if(o){for(let i=0;i<P.length;i+=4){let l;for(let u=i+1;!l&&(u+=4)<P.length;)P[u]<P[i+1]&&(l=P.push(P[i],P[i+1],P[i+2],P[i+3]));l||P[i](P[i+2],P[i+3])}P.length=0}},off(){},set(s){r.value!==s&&(r.value=s,r.notify())},subscribe(s,o){let i=r.listen(s,o);return s(r.value),i},value:e};return r},li=(e={})=>{let t=ci(e);return t.setKey=function(n,r){typeof r>"u"?n in t.value&&(t.value={...t.value},delete t.value[n],t.notify(n)):t.value[n]!==r&&(t.value={...t.value,[n]:r},t.notify(n))},t};export{Ge as A,W as B,Ye as C,Ro as D,Z as E,St as F,V as G,w as H,In as I,rt as J,X as K,An as L,Ze as M,D as N,Hn as O,d as P,vt as _,f as a,Tn as b,Cn as c,Sn as d,li as e,Ft as f,Mt as g,en as h,Rt as i,Ne as j,Ct as k,J as l,Nn as m,pt as n,G as o,Ht as p,O as q,Rs as r,ui as s,z as t,ci as u,Io as v,Wo as w,rn as x,Ln as y,_ as z};
