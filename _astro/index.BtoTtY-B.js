/**
 * @license Fraction.js v4.3.7 31/08/2023
 * https://www.xarg.org/2014/03/rational-numbers-in-javascript/
 *
 * Copyright (c) 2023, Robert Eisele (robert@raw.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/var ea=2e3,g={s:1,n:0,d:1};function ft(e,t){if(isNaN(e=parseInt(e,10)))throw $t();return e*t}function z(e,t){if(t===0)throw Zt();var n=Object.create(N.prototype);n.s=e<0?-1:1,e=e<0?-e:e;var s=_t(e,t);return n.n=e/s,n.d=t/s,n}function Ne(e){for(var t={},n=e,s=2,r=4;r<=n;){for(;n%s===0;)n/=s,t[s]=(t[s]||0)+1;r+=1+2*s++}return n!==e?n>1&&(t[n]=(t[n]||0)+1):t[e]=(t[e]||0)+1,t}var U=function(e,t){var n=0,s=1,r=1,o=0,i=0,a=0,u=1,h=1,l=0,f=1,w=1,m=1,v=1e7,_;if(e!=null)if(t!==void 0){if(n=e,s=t,r=n*s,n%1!==0||s%1!==0)throw oa()}else switch(typeof e){case"object":{if("d"in e&&"n"in e)n=e.n,s=e.d,"s"in e&&(n*=e.s);else if(0 in e)n=e[0],1 in e&&(s=e[1]);else throw $t();r=n*s;break}case"number":{if(e<0&&(r=e,e=-e),e%1===0)n=e;else if(e>0){for(e>=1&&(h=Math.pow(10,Math.floor(1+Math.log(e)/Math.LN10)),e/=h);f<=v&&m<=v;)if(_=(l+w)/(f+m),e===_){f+m<=v?(n=l+w,s=f+m):m>f?(n=w,s=m):(n=l,s=f);break}else e>_?(l+=w,f+=m):(w+=l,m+=f),f>v?(n=w,s=m):(n=l,s=f);n*=h}else(isNaN(e)||isNaN(t))&&(s=n=NaN);break}case"string":{if(f=e.match(/\d+|./g),f===null)throw $t();if(f[l]==="-"?(r=-1,l++):f[l]==="+"&&l++,f.length===l+1?i=ft(f[l++],r):f[l+1]==="."||f[l]==="."?(f[l]!=="."&&(o=ft(f[l++],r)),l++,(l+1===f.length||f[l+1]==="("&&f[l+3]===")"||f[l+1]==="'"&&f[l+3]==="'")&&(i=ft(f[l],r),u=Math.pow(10,f[l].length),l++),(f[l]==="("&&f[l+2]===")"||f[l]==="'"&&f[l+2]==="'")&&(a=ft(f[l+1],r),h=Math.pow(10,f[l+1].length)-1,l+=3)):f[l+1]==="/"||f[l+1]===":"?(i=ft(f[l],r),u=ft(f[l+2],1),l+=3):f[l+3]==="/"&&f[l+1]===" "&&(o=ft(f[l],r),i=ft(f[l+2],r),u=ft(f[l+4],1),l+=5),f.length<=l){s=u*h,r=n=a+s*o+h*i;break}}default:throw $t()}if(s===0)throw Zt();g.s=r<0?-1:1,g.n=Math.abs(n),g.d=Math.abs(s)};function na(e,t,n){for(var s=1;t>0;e=e*e%n,t>>=1)t&1&&(s=s*e%n);return s}function sa(e,t){for(;t%2===0;t/=2);for(;t%5===0;t/=5);if(t===1)return 0;for(var n=10%t,s=1;n!==1;s++)if(n=n*10%t,s>ea)return 0;return s}function ra(e,t,n){for(var s=1,r=na(10,n,t),o=0;o<300;o++){if(s===r)return o;s=s*10%t,r=r*10%t}return 0}function _t(e,t){if(!e)return t;if(!t)return e;for(;;){if(e%=t,!e)return t;if(t%=e,!t)return e}}function N(e,t){if(U(e,t),this instanceof N)e=_t(g.d,g.n),this.s=g.s,this.n=g.n/e,this.d=g.d/e;else return z(g.s*g.n,g.d)}var Zt=function(){return new Error("Division by Zero")},$t=function(){return new Error("Invalid argument")},oa=function(){return new Error("Parameters must be integer")};N.prototype={s:1,n:0,d:1,abs:function(){return z(this.n,this.d)},neg:function(){return z(-this.s*this.n,this.d)},add:function(e,t){return U(e,t),z(this.s*this.n*g.d+g.s*this.d*g.n,this.d*g.d)},sub:function(e,t){return U(e,t),z(this.s*this.n*g.d-g.s*this.d*g.n,this.d*g.d)},mul:function(e,t){return U(e,t),z(this.s*g.s*this.n*g.n,this.d*g.d)},div:function(e,t){return U(e,t),z(this.s*g.s*this.n*g.d,this.d*g.n)},clone:function(){return z(this.s*this.n,this.d)},mod:function(e,t){if(isNaN(this.n)||isNaN(this.d))return new N(NaN);if(e===void 0)return z(this.s*this.n%this.d,1);if(U(e,t),g.n===0&&this.d===0)throw Zt();return z(this.s*(g.d*this.n)%(g.n*this.d),g.d*this.d)},gcd:function(e,t){return U(e,t),z(_t(g.n,this.n)*_t(g.d,this.d),g.d*this.d)},lcm:function(e,t){return U(e,t),g.n===0&&this.n===0?z(0,1):z(g.n*this.n,_t(g.n,this.n)*_t(g.d,this.d))},ceil:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new N(NaN):z(Math.ceil(e*this.s*this.n/this.d),e)},floor:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new N(NaN):z(Math.floor(e*this.s*this.n/this.d),e)},round:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new N(NaN):z(Math.round(e*this.s*this.n/this.d),e)},roundTo:function(e,t){return U(e,t),z(this.s*Math.round(this.n*g.d/(this.d*g.n))*g.n,g.d)},inverse:function(){return z(this.s*this.d,this.n)},pow:function(e,t){if(U(e,t),g.d===1)return g.s<0?z(Math.pow(this.s*this.d,g.n),Math.pow(this.n,g.n)):z(Math.pow(this.s*this.n,g.n),Math.pow(this.d,g.n));if(this.s<0)return null;var n=Ne(this.n),s=Ne(this.d),r=1,o=1;for(var i in n)if(i!=="1"){if(i==="0"){r=0;break}if(n[i]*=g.n,n[i]%g.d===0)n[i]/=g.d;else return null;r*=Math.pow(i,n[i])}for(var i in s)if(i!=="1"){if(s[i]*=g.n,s[i]%g.d===0)s[i]/=g.d;else return null;o*=Math.pow(i,s[i])}return g.s<0?z(o,r):z(r,o)},equals:function(e,t){return U(e,t),this.s*this.n*g.d===g.s*g.n*this.d},compare:function(e,t){U(e,t);var n=this.s*this.n*g.d-g.s*g.n*this.d;return(0<n)-(n<0)},simplify:function(e){if(isNaN(this.n)||isNaN(this.d))return this;e=e||.001;for(var t=this.abs(),n=t.toContinued(),s=1;s<n.length;s++){for(var r=z(n[s-1],1),o=s-2;o>=0;o--)r=r.inverse().add(n[o]);if(Math.abs(r.sub(t).valueOf())<e)return r.mul(this.s)}return this},divisible:function(e,t){return U(e,t),!(!(g.n*this.d)||this.n*g.d%(g.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(e){var t,n="",s=this.n,r=this.d;return this.s<0&&(n+="-"),r===1?n+=s:(e&&(t=Math.floor(s/r))>0&&(n+=t,n+=" ",s%=r),n+=s,n+="/",n+=r),n},toLatex:function(e){var t,n="",s=this.n,r=this.d;return this.s<0&&(n+="-"),r===1?n+=s:(e&&(t=Math.floor(s/r))>0&&(n+=t,s%=r),n+="\\frac{",n+=s,n+="}{",n+=r,n+="}"),n},toContinued:function(){var e,t=this.n,n=this.d,s=[];if(isNaN(t)||isNaN(n))return s;do s.push(Math.floor(t/n)),e=t%n,t=n,n=e;while(t!==1);return s},toString:function(e){var t=this.n,n=this.d;if(isNaN(t)||isNaN(n))return"NaN";e=e||15;var s=sa(t,n),r=ra(t,n,s),o=this.s<0?"-":"";if(o+=t/n|0,t%=n,t*=10,t&&(o+="."),s){for(var i=r;i--;)o+=t/n|0,t%=n,t*=10;o+="(";for(var i=s;i--;)o+=t/n|0,t%=n,t*=10;o+=")"}else for(var i=e;t&&i--;)o+=t/n|0,t%=n,t*=10;return o}};const te="strudel.log";let ia=1e3,Oe,Be;function W(e,t,n={}){let s=performance.now();Oe===e&&s-Be<ia||(Oe=e,Be=s,console.log(`%c${e}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(te,{detail:{message:e,type:t,data:n}})))}W.key=te;const ca=e=>/^[a-gA-G][#bs]*[0-9]$/.test(e),Rt=e=>/^[a-gA-G][#bsf]*[0-9]?$/.test(e),Je=e=>{if(typeof e!="string")return[];const[t,n="",s]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return t?[t,n,s?Number(s):void 0]:[]},aa={c:0,d:2,e:4,f:5,g:7,a:9,b:11},ua={"#":1,b:-1,s:1,f:-1},Tt=(e,t=3)=>{const[n,s,r=t]=Je(e);if(!n)throw new Error('not a note: "'+e+'"');const o=aa[n.toLowerCase()],i=s?.split("").reduce((a,u)=>a+ua[u],0)||0;return(Number(r)+1)*12+o+i},gt=e=>Math.pow(2,(e-69)/12)*440,ee=e=>12*Math.log(e/440)/Math.LN2+69,la=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:s}=e;if(typeof n=="number")return ee(n);if(typeof s=="string")return Tt(s);if(typeof s=="number")return s;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t},fa=(e,t)=>(e-t)*1e3,Le=e=>gt(typeof e=="number"?e:Tt(e)),ha=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],da=e=>{const t=Math.floor(e/12)-1;return ha[e%12]+t},zt=(e,t)=>(e%t+t)%t;function We(e,t=0){return isNaN(Number(e))?(W(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const pa=(e,t)=>zt(Math.round(We(e??0,0)),t),ma=e=>{let{value:t,context:n}=e,s=t;if(typeof s=="object"&&!Array.isArray(s)&&(s=s.note||s.n||s.value,s===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(t)}`);if(typeof s=="number"&&n.type!=="frequency")s=gt(e.value);else if(typeof s=="number"&&n.type==="frequency")s=e.value;else if(typeof s!="string"||!Rt(s))throw new Error("not a note: "+JSON.stringify(s));return s},Ie=e=>{let{value:t,context:n}=e;if(typeof t=="object")return t.freq?t.freq:Le(t.note||t.n||t.value);if(typeof t=="number"&&n.type!=="frequency")t=gt(e.value);else if(typeof t=="string"&&Rt(t))t=gt(Tt(e.value));else if(typeof t!="number")throw new Error("not a note or frequency: "+t);return t},He=(e,t)=>e.slice(t).concat(e.slice(0,t)),De=(...e)=>e.reduce((t,n)=>(...s)=>t(n(...s)),t=>t),ya=(...e)=>De(...e.reverse()),Ct=e=>e.filter(t=>t!=null),dt=e=>[].concat(...e),kt=e=>e,ga=(e,t)=>e,ne=(e,t)=>Array.from({length:t-e+1},(n,s)=>s+e);function T(e,t,n=e.length){const s=function r(...o){if(o.length>=n)return e.apply(this,o);{const i=function(...a){return r.apply(this,o.concat(a))};return t&&t(i,o),i}};return t&&t(s,[]),s}function se(e){const t=Number(e);if(!isNaN(t))return t;if(Rt(e))return Tt(e);throw new Error(`cannot parse as numeral: "${e}"`)}function re(e,t){return(...n)=>e(...n.map(t))}function X(e){return re(e,se)}function Ve(e){const t=Number(e);if(!isNaN(t))return t;const n={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[e];if(typeof n<"u")return n;throw new Error(`cannot parse as fractional: "${e}"`)}const wa=e=>re(e,Ve),oe=function(e,t){return[t.slice(0,e),t.slice(e)]},ie=(e,t,n)=>t.map((s,r)=>e(s,n[r])),Qe=function(e){const t=[];for(let n=0;n<e.length-1;++n)t.push([e[n],e[n+1]]);return t},Ge=(e,t,n)=>Math.min(Math.max(e,t),n),ba=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],va=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],_a=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],ka=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],qa=["I","Ro","Ha","Ni","Ho","He","To"],Aa=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Ta=(e,t="letters")=>{const s=(t==="solfeggio"?ba:t==="indian"?va:t==="german"?_a:t==="byzantine"?ka:t==="japanese"?qa:Aa)[e%12],r=Math.floor(e/12)-1;return s+r};function Ca(e){var t={};return e.filter(function(n){return t.hasOwn(n)?!1:t[n]=!0})}function Sa(e){return e.sort().filter(function(t,n,s){return!n||t!=s[n-1]})}function Ue(e){return e.sort((t,n)=>t.compare(n)).filter(function(t,n,s){return!n||t.ne(s[n-1])})}function Ke(e){const t=new TextEncoder().encode(e);return btoa(String.fromCharCode(...t))}function Xe(e){const t=new Uint8Array(atob(e).split("").map(s=>s.charCodeAt(0)));return new TextDecoder().decode(t)}function Ma(e){return encodeURIComponent(Ke(e))}function Na(e){return Xe(decodeURIComponent(e))}function Ye(e,t){return Array.isArray(e)?e.map(t):Object.fromEntries(Object.entries(e).map(([n,s],r)=>[n,t(s,n,r)]))}N.prototype.sam=function(){return this.floor()};N.prototype.nextSam=function(){return this.sam().add(1)};N.prototype.wholeCycle=function(){return new F(this.sam(),this.nextSam())};N.prototype.cyclePos=function(){return this.sub(this.sam())};N.prototype.lt=function(e){return this.compare(e)<0};N.prototype.gt=function(e){return this.compare(e)>0};N.prototype.lte=function(e){return this.compare(e)<=0};N.prototype.gte=function(e){return this.compare(e)>=0};N.prototype.eq=function(e){return this.compare(e)==0};N.prototype.ne=function(e){return this.compare(e)!=0};N.prototype.max=function(e){return this.gt(e)?this:e};N.prototype.maximum=function(...e){return e=e.map(t=>new N(t)),e.reduce((t,n)=>n.max(t),this)};N.prototype.min=function(e){return this.lt(e)?this:e};N.prototype.mulmaybe=function(e){return e!==void 0?this.mul(e):void 0};N.prototype.divmaybe=function(e){return e!==void 0?this.div(e):void 0};N.prototype.addmaybe=function(e){return e!==void 0?this.add(e):void 0};N.prototype.submaybe=function(e){return e!==void 0?this.sub(e):void 0};N.prototype.show=function(){return this.s*this.n+"/"+this.d};N.prototype.or=function(e){return this.eq(0)?e:this};const y=e=>N(e),Oa=(...e)=>{if(e=Ct(e),e.length!==0)return e.reduce((t,n)=>t.gcd(n),y(1))},Et=(...e)=>{if(e=Ct(e),e.length!==0)return e.reduce((t,n)=>t===void 0||n===void 0?void 0:t.lcm(n),y(1))};y._original=N;class F{constructor(t,n){this.begin=y(t),this.end=y(n)}get spanCycles(){const t=[];var n=this.begin;const s=this.end,r=s.sam();if(n.equals(s))return[new F(n,s)];for(;s.gt(n);){if(n.sam().equals(r)){t.push(new F(n,this.end));break}const o=n.nextSam();t.push(new F(n,o)),n=o}return t}get duration(){return this.end.sub(this.begin)}cycleArc(){const t=this.begin.cyclePos(),n=t.add(this.duration);return new F(t,n)}withTime(t){return new F(t(this.begin),t(this.end))}withEnd(t){return new F(this.begin,t(this.end))}withCycle(t){const n=this.begin.sam(),s=n.add(t(this.begin.sub(n))),r=n.add(t(this.end.sub(n)));return new F(s,r)}intersection(t){const n=this.begin.max(t.begin),s=this.end.min(t.end);if(!n.gt(s)&&!(n.equals(s)&&(n.equals(this.end)&&this.begin.lt(this.end)||n.equals(t.end)&&t.begin.lt(t.end))))return new F(n,s)}intersection_e(t){const n=this.intersection(t);if(n==null)throw"TimeSpans do not intersect";return n}midpoint(){return this.begin.add(this.duration.div(y(2)))}equals(t){return this.begin.equals(t.begin)&&this.end.equals(t.end)}show(){return this.begin.show()+" → "+this.end.show()}}class j{constructor(t,n,s,r={},o=!1){this.whole=t,this.part=n,this.value=s,this.context=r,this.stateful=o,o&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){let t;return typeof this.value?.duration=="number"?t=y(this.value.duration):t=this.whole.end.sub(this.whole.begin),typeof this.value?.clip=="number"?t.mul(this.value.clip):t}get endClipped(){return this.whole.begin.add(this.duration)}isActive(t){return this.whole.begin<=t&&this.endClipped>=t}isInPast(t){return t>this.endClipped}isInNearPast(t,n){return n-t<=this.endClipped}isInFuture(t){return t<this.whole.begin}isInNearFuture(t,n){return n<this.whole.begin&&n>this.whole.begin-t}isWithinTime(t,n){return this.whole.begin<=n&&this.endClipped>=t}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(t){const n=this.whole?t(this.whole):void 0;return new j(n,t(this.part),this.value,this.context)}withValue(t){return new j(this.whole,this.part,t(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}hasTag(t){return this.context.tags?.includes(t)}resolveState(t){if(this.stateful&&this.hasOnset()){console.log("stateful");const n=this.value,[s,r]=n(t);return[s,new j(this.whole,this.part,r,this.context,!1)]}return[t,this]}spanEquals(t){return this.whole==null&&t.whole==null||this.whole.equals(t.whole)}equals(t){return this.spanEquals(t)&&this.part.equals(t.part)&&this.value===t.value}show(t=!1){const n=typeof this.value=="object"?t?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var s="";if(this.whole==null)s="~"+this.part.show;else{var r=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(s=this.whole.begin.show()+" ⇜ "),r||(s+="("),s+=this.part.show(),r||(s+=")"),this.whole.end.equals(this.part.end)||(s+=" ⇝ "+this.whole.end.show())}return"[ "+s+" | "+n+" ]"}showWhole(t=!1){return`${this.whole==null?"~":this.whole.show()}: ${typeof this.value=="object"?t?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value}`}combineContext(t){const n=this;return{...n.context,...t.context,locations:(n.context.locations||[]).concat(t.context.locations||[])}}setContext(t){return new j(this.whole,this.part,this.value,t)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class At{constructor(t,n={}){this.span=t,this.controls=n}setSpan(t){return new At(t,this.controls)}withSpan(t){return this.setSpan(t(this.span))}setControls(t){return new At(this.span,t)}}function Ba(e,t,n){if(t?.value!==void 0&&Object.keys(t).length===1)return W("[warn]: Can't do arithmetic on control pattern."),e;const s=Object.keys(e).filter(r=>Object.keys(t).includes(r));return Object.assign({},e,t,Object.fromEntries(s.map(r=>[r,n(e[r],t[r])])))}T((e,t)=>e*t);T((e,t)=>t.map(e));function Ze(e,t=60){let n=0,s=y(0),r=[""],o="";for(;r[0].length<t;){const i=e.queryArc(n,n+1),a=i.filter(l=>l.hasOnset()).map(l=>l.duration),u=Oa(...a),h=u.inverse();r=r.map(l=>l+"|"),o+="|";for(let l=0;l<h;l++){const[f,w]=[s,s.add(u)],m=i.filter(_=>_.whole.begin.lte(f)&&_.whole.end.gte(w)),v=m.length-r.length;v>0&&(r=r.concat(Array(v).fill(o))),r=r.map((_,A)=>{const k=m[A];if(k){const E=k.whole.begin.eq(f)?""+k.value:"-";return _+E}return _+"."}),o+=".",s=s.add(u)}n++}return r.join(`
`)}let Dt,et=!0;const Pa=function(e){et=!!e},za=e=>Dt=e;class p{constructor(t,n=void 0){this.query=t,this._Pattern=!0,this.tactus=n}get tactus(){return this.__tactus}set tactus(t){this.__tactus=t===void 0?void 0:y(t)}setTactus(t){return this.tactus=t,this}withTactus(t){return et?new p(this.query,this.tactus===void 0?void 0:t(this.tactus)):this}get hasTactus(){return this.tactus!==void 0}withValue(t){const n=new p(s=>this.query(s).map(r=>r.withValue(t)));return n.tactus=this.tactus,n}withState(t){return this.withHaps((n,s)=>(t(s),n))}fmap(t){return this.withValue(t)}appWhole(t,n){const s=this,r=function(o){const i=s.query(o),a=n.query(o),u=function(h,l){const f=h.part.intersection(l.part);if(f!=null)return new j(t(h.whole,l.whole),f,h.value(l.value),l.combineContext(h))};return dt(i.map(h=>Ct(a.map(l=>u(h,l)))))};return new p(r)}appBoth(t){const n=this,s=function(o,i){if(!(o==null||i==null))return o.intersection_e(i)},r=n.appWhole(s,t);return et&&(r.tactus=Et(t.tactus,n.tactus)),r}appLeft(t){const n=this,s=function(o){const i=[];for(const a of n.query(o)){const u=t.query(o.setSpan(a.wholeOrPart()));for(const h of u){const l=a.whole,f=a.part.intersection(h.part);if(f){const w=a.value(h.value),m=h.combineContext(a),v=new j(l,f,w,m);i.push(v)}}}return i},r=new p(s);return r.tactus=this.tactus,r}appRight(t){const n=this,s=function(o){const i=[];for(const a of t.query(o)){const u=n.query(o.setSpan(a.wholeOrPart()));for(const h of u){const l=a.whole,f=h.part.intersection(a.part);if(f){const w=h.value(a.value),m=a.combineContext(h),v=new j(l,f,w,m);i.push(v)}}}return i},r=new p(s);return r.tactus=t.tactus,r}bindWhole(t,n){const s=this,r=function(o){const i=function(u,h){return new j(t(u.whole,h.whole),h.part,h.value,Object.assign({},u.context,h.context,{locations:(u.context.locations||[]).concat(h.context.locations||[])}))},a=function(u){return n(u.value).query(o.setSpan(u.part)).map(h=>i(u,h))};return dt(s.query(o).map(u=>a(u)))};return new p(r)}bind(t){const n=function(s,r){if(!(s==null||r==null))return s.intersection_e(r)};return this.bindWhole(n,t)}join(){return this.bind(kt)}outerBind(t){return this.bindWhole(n=>n,t).setTactus(this.tactus)}outerJoin(){return this.outerBind(kt)}innerBind(t){return this.bindWhole((n,s)=>s,t)}innerJoin(){return this.innerBind(kt)}resetJoin(t=!1){const n=this;return new p(s=>n.discreteOnly().query(s).map(r=>r.value.late(t?r.whole.begin:r.whole.begin.cyclePos()).query(s).map(o=>new j(o.whole?o.whole.intersection(r.whole):void 0,o.part.intersection(r.part),o.value).setContext(r.combineContext(o))).filter(o=>o.part)).flat())}restartJoin(){return this.resetJoin(!0)}squeezeJoin(){const t=this;function n(s){const r=t.discreteOnly().query(s);function o(a){const h=a.value._focusSpan(a.wholeOrPart()).query(s.setSpan(a.part));function l(f,w){let m;if(w.whole&&f.whole&&(m=w.whole.intersection(f.whole),!m))return;const v=w.part.intersection(f.part);if(!v)return;const _=w.combineContext(f);return new j(m,v,w.value,_)}return h.map(f=>l(a,f))}return dt(r.map(o)).filter(a=>a)}return new p(n)}squeezeBind(t){return this.fmap(t).squeezeJoin()}queryArc(t,n,s={}){try{return this.query(new At(new F(t,n),s))}catch(r){return W(`[query]: ${r.message}`,"error"),[]}}splitQueries(){const t=this,n=s=>dt(s.span.spanCycles.map(r=>t.query(s.setSpan(r))));return new p(n)}withQuerySpan(t){return new p(n=>this.query(n.withSpan(t)))}withQuerySpanMaybe(t){const n=this;return new p(s=>{const r=s.withSpan(t);return r.span?n.query(r):[]})}withQueryTime(t){return new p(n=>this.query(n.withSpan(s=>s.withTime(t))))}withHapSpan(t){return new p(n=>this.query(n).map(s=>s.withSpan(t)))}withHapTime(t){return this.withHapSpan(n=>n.withTime(t))}withHaps(t){const n=new p(s=>t(this.query(s),s));return n.tactus=this.tactus,n}withHap(t){return this.withHaps(n=>n.map(t))}setContext(t){return this.withHap(n=>n.setContext(t))}withContext(t){const n=this.withHap(s=>s.setContext(t(s.context)));return this.__pure!==void 0&&(n.__pure=this.__pure,n.__pure_loc=this.__pure_loc),n}stripContext(){return this.withHap(t=>t.setContext({}))}withLoc(t,n){const s={start:t,end:n},r=this.withContext(o=>{const i=(o.locations||[]).concat([s]);return{...o,locations:i}});return this.__pure&&(r.__pure=this.__pure,r.__pure_loc=s),r}filterHaps(t){return new p(n=>this.query(n).filter(t))}filterValues(t){return new p(n=>this.query(n).filter(s=>t(s.value))).setTactus(this.tactus)}removeUndefineds(){return this.filterValues(t=>t!=null)}onsetsOnly(){return this.filterHaps(t=>t.hasOnset())}discreteOnly(){return this.filterHaps(t=>t.whole)}defragmentHaps(){return this.discreteOnly().withHaps(n=>{const s=[];for(var r=0;r<n.length;++r){for(var o=!0,i=n[r];o;){const h=JSON.stringify(n[r].value);for(var a=!1,u=r+1;u<n.length;u++){const l=n[u];if(i.whole.equals(l.whole)){if(i.part.begin.eq(l.part.end)){if(h===JSON.stringify(l.value)){i=new j(i.whole,new F(l.part.begin,i.part.end),i.value),n.splice(u,1),a=!0;break}}else if(l.part.begin.eq(i.part.end)&&h==JSON.stringify(l.value)){i=new j(i.whole,new F(i.part.begin,l.part.end),i.value),n.splice(u,1),a=!0;break}}}o=a}s.push(i)}return s})}firstCycle(t=!1){var n=this;return t||(n=n.stripContext()),n.query(new At(new F(y(0),y(1))))}get firstCycleValues(){return this.firstCycle().map(t=>t.value)}get showFirstCycle(){return this.firstCycle().map(t=>`${t.value}: ${t.whole.begin.toFraction()} - ${t.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(t=>t.sort((n,s)=>n.part.begin.sub(s.part.begin).or(n.part.end.sub(s.part.end)).or(n.whole.begin.sub(s.whole.begin).or(n.whole.end.sub(s.whole.end)))))}asNumber(){return this.fmap(se)}_opIn(t,n){return this.fmap(n).appLeft(b(t))}_opOut(t,n){return this.fmap(n).appRight(b(t))}_opMix(t,n){return this.fmap(n).appBoth(b(t))}_opSqueeze(t,n){const s=b(t);return this.fmap(r=>s.fmap(o=>n(r)(o))).squeezeJoin()}_opSqueezeOut(t,n){const s=this;return b(t).fmap(o=>s.fmap(i=>n(i)(o))).squeezeJoin()}_opReset(t,n){return b(t).fmap(r=>this.fmap(o=>n(o)(r))).resetJoin()}_opRestart(t,n){return b(t).fmap(r=>this.fmap(o=>n(o)(r))).restartJoin()}layer(...t){return L(...t.map(n=>n(this)))}superimpose(...t){return this.stack(...t.map(n=>n(this)))}stack(...t){return L(this,...t)}sequence(...t){return ot(this,...t)}seq(...t){return ot(this,...t)}cat(...t){return sn(this,...t)}fastcat(...t){return ct(this,...t)}slowcat(...t){return wt(this,...t)}onTrigger(t,n=!0){return this.withHap(s=>s.setContext({...s.context,onTrigger:(...r)=>{s.context.onTrigger?.(...r),t(...r)},dominantTrigger:s.context.dominantTrigger||n}))}log(t=(s,r)=>`[hap] ${r.showWhole(!0)}`,n=(s,r)=>({hap:r})){return this.onTrigger((...s)=>{W(t(...s),void 0,n(...s))},!1)}logValues(t=kt){return this.log((n,s)=>t(s.value))}drawLine(){return console.log(Ze(this)),this}}function Ea(e,t){let n=[];return t.forEach(s=>{const r=n.findIndex(([o])=>e(s,o));r===-1?n.push([s]):n[r].push(s)}),n}const xa=(e,t)=>e.spanEquals(t);p.prototype.collect=function(){return this.withHaps(e=>Ea(xa,e).map(t=>new j(t[0].whole,t[0].part,t,{})))};p.prototype.arpWith=function(e){return this.collect().fmap(t=>b(e(t))).innerJoin().withHap(t=>new j(t.whole,t.part,t.value.value,t.combineContext(t.value)))};p.prototype.arp=function(e){return this.arpWith(t=>e.fmap(n=>t[n%t.length]))};function jt(e){return!Array.isArray(e)&&typeof e=="object"}function ja(e,t,n){return jt(e)||jt(t)?(jt(e)||(e={value:e}),jt(t)||(t={value:t}),Ba(e,t,n)):n(e,t)}(function(){const e={set:[(n,s)=>s],keep:[n=>n],keepif:[(n,s)=>s?n:void 0],add:[X((n,s)=>n+s)],sub:[X((n,s)=>n-s)],mul:[X((n,s)=>n*s)],div:[X((n,s)=>n/s)],mod:[X(zt)],pow:[X(Math.pow)],band:[X((n,s)=>n&s)],bor:[X((n,s)=>n|s)],bxor:[X((n,s)=>n^s)],blshift:[X((n,s)=>n<<s)],brshift:[X((n,s)=>n>>s)],lt:[(n,s)=>n<s],gt:[(n,s)=>n>s],lte:[(n,s)=>n<=s],gte:[(n,s)=>n>=s],eq:[(n,s)=>n==s],eqt:[(n,s)=>n===s],ne:[(n,s)=>n!=s],net:[(n,s)=>n!==s],and:[(n,s)=>n&&s],or:[(n,s)=>n||s],func:[(n,s)=>s(n)]},t=["In","Out","Mix","Squeeze","SqueezeOut","Reset","Restart"];for(const[n,[s,r]]of Object.entries(e)){p.prototype["_"+n]=function(o){return this.fmap(i=>s(i,o))},Object.defineProperty(p.prototype,n,{get:function(){const o=this,i=(...a)=>o[n].in(...a);for(const a of t)i[a.toLowerCase()]=function(...u){var h=o;u=ot(u),r&&(h=r(h),u=r(u));var l;return n==="keepif"?(l=h["_op"+a](u,f=>w=>s(f,w)),l=l.removeUndefineds()):l=h["_op"+a](u,f=>w=>ja(f,w,s)),l};return i.squeezein=i.squeeze,i}});for(const o of t)p.prototype[o.toLowerCase()]=function(...i){return this.set[o.toLowerCase()](i)}}p.prototype.struct=function(...n){return this.keepif.out(...n)},p.prototype.structAll=function(...n){return this.keep.out(...n)},p.prototype.mask=function(...n){return this.keepif.in(...n)},p.prototype.maskAll=function(...n){return this.keep.in(...n)},p.prototype.reset=function(...n){return this.keepif.reset(...n)},p.prototype.resetAll=function(...n){return this.keep.reset(...n)},p.prototype.restart=function(...n){return this.keepif.restart(...n)},p.prototype.restartAll=function(...n){return this.keep.restart(...n)}})();const $a=L,Fa=L,Ra=de,St=e=>new p(()=>[],e),P=St(1),Y=St(0);function it(e){function t(s){return s.span.spanCycles.map(r=>new j(y(r.begin).wholeCycle(),r,e))}const n=new p(t,1);return n.__pure=e,n}function ce(e){return e instanceof p||e?._Pattern}function b(e){return ce(e)?e:Dt&&typeof e=="string"?Dt(e):it(e)}function L(...e){e=e.map(s=>Array.isArray(s)?ot(...s):b(s));const t=s=>dt(e.map(r=>r.query(s))),n=new p(t);return et&&(n.tactus=Et(...e.map(s=>s.tactus))),n}function ae(e,t){if(t=t.map(o=>Array.isArray(o)?ot(...o):b(o)),t.length===0)return P;if(t.length===1)return t[0];const[n,...s]=t.map(o=>o.tactus),r=et?n.maximum(...s):void 0;return L(...e(r,t))}function tn(...e){return ae((t,n)=>n.map(s=>s.tactus.eq(t)?s:Z(s,St(t.sub(s.tactus)))),e)}function en(...e){return ae((t,n)=>n.map(s=>s.tactus.eq(t)?s:Z(St(t.sub(s.tactus)),s)),e)}function nn(...e){return ae((t,n)=>n.map(s=>{if(s.tactus.eq(t))return s;const r=St(t.sub(s.tactus).div(2));return Z(r,s,r)}),e)}function Ja(e,...t){const[n,...s]=t.map(i=>i.tactus),r=n.maximum(...s),o={centre:nn,left:tn,right:en,expand:L,repeat:(...i)=>ln(r,...i)};return e.inhabit(o).fmap(i=>i(...t)).innerJoin().setTactus(r)}function wt(...e){if(e=e.map(s=>Array.isArray(s)?ct(...s):b(s)),e.length==1)return e[0];const t=function(s){const r=s.span,o=zt(r.begin.sam(),e.length),i=e[o];if(!i)return[];const a=r.begin.floor().sub(r.begin.div(e.length).floor());return i.withHapTime(u=>u.add(a)).query(s.setSpan(r.withTime(u=>u.sub(a))))},n=et?Et(...e.map(s=>s.tactus)):void 0;return new p(t).splitQueries().setTactus(n)}function ue(...e){e=e.map(b);const t=function(n){const s=Math.floor(n.span.begin)%e.length;return e[s]?.query(n)||[]};return new p(t).splitQueries()}function sn(...e){return wt(...e)}function La(...e){const t=e.reduce((n,[s])=>n+s,0);return e=e.map(([n,s])=>[n,s.fast(n)]),Z(...e).slow(t)}function ct(...e){let t=wt(...e);return e.length>1&&(t=t._fast(e.length),t.tactus=e.length),t}function ot(...e){return ct(...e)}function rn(...e){return ct(...e)}function Vt(e){return Array.isArray(e)?e.length==0?[P,0]:e.length==1?Vt(e[0]):[ct(...e.map(t=>Vt(t)[0])),e.length]:[b(e),1]}const Wa=T((e,t)=>b(t).mask(e)),Ia=T((e,t)=>b(t).struct(e)),Ha=T((e,t)=>b(t).superimpose(...e)),Da=T((e,t)=>b(t).set(e)),Va=T((e,t)=>b(t).keep(e)),Qa=T((e,t)=>b(t).keepif(e)),Ga=T((e,t)=>b(t).add(e)),Ua=T((e,t)=>b(t).sub(e)),Ka=T((e,t)=>b(t).mul(e)),Xa=T((e,t)=>b(t).div(e)),Ya=T((e,t)=>b(t).mod(e)),Za=T((e,t)=>b(t).pow(e)),tu=T((e,t)=>b(t).band(e)),eu=T((e,t)=>b(t).bor(e)),nu=T((e,t)=>b(t).bxor(e)),su=T((e,t)=>b(t).blshift(e)),ru=T((e,t)=>b(t).brshift(e)),ou=T((e,t)=>b(t).lt(e)),iu=T((e,t)=>b(t).gt(e)),cu=T((e,t)=>b(t).lte(e)),au=T((e,t)=>b(t).gte(e)),uu=T((e,t)=>b(t).eq(e)),lu=T((e,t)=>b(t).eqt(e)),fu=T((e,t)=>b(t).ne(e)),hu=T((e,t)=>b(t).net(e)),du=T((e,t)=>b(t).and(e)),pu=T((e,t)=>b(t).or(e)),mu=T((e,t)=>b(t).func(e));function d(e,t,n=!0,s=!1,r=o=>o.innerJoin()){if(Array.isArray(e)){const a={};for(const u of e)a[u]=d(u,t,n);return a}const o=t.length;var i;return n?i=function(...a){a=a.map(b);const u=a[a.length-1];let h;if(o===1)h=t(u);else{const l=a.slice(0,-1);if(l.every(f=>f.__pure!=null)){const f=l.map(m=>m.__pure),w=l.filter(m=>m.__pure_loc).map(m=>m.__pure_loc);h=t(...f,u),h=h.withContext(m=>{const v=(m.locations||[]).concat(w);return{...m,locations:v}})}else{const[f,...w]=l;let m=(...v)=>t(...v,u);m=T(m,null,o-1),h=r(w.reduce((v,_)=>v.appLeft(_),f.fmap(m)))}}return s&&(h.tactus=u.tactus),h}:i=function(...a){a=a.map(b);const u=t(...a);return s&&(u.tactus=a[a.length-1].tactus),u},p.prototype[e]=function(...a){if(o===2&&a.length!==1)a=[ot(...a)];else if(o!==a.length+1)throw new Error(`.${e}() expects ${o-1} inputs but got ${a.length}.`);return a=a.map(b),i(...a,this)},o>1&&(p.prototype["_"+e]=function(...a){return t(...a,this)}),T(i,null,o)}function Jt(e,t,n=!0,s=!1,r=o=>o.stepJoin()){return d(e,t,n,s,r)}const yu=d("round",function(e){return e.asNumber().fmap(t=>Math.round(t))}),gu=d("floor",function(e){return e.asNumber().fmap(t=>Math.floor(t))}),wu=d("ceil",function(e){return e.asNumber().fmap(t=>Math.ceil(t))}),bu=d("toBipolar",function(e){return e.fmap(t=>t*2-1)}),vu=d("fromBipolar",function(e){return e.fmap(t=>(t+1)/2)}),_u=d("range",function(e,t,n){return n.mul(t-e).add(e)}),ku=d("rangex",function(e,t,n){return n._range(Math.log(e),Math.log(t)).fmap(Math.exp)}),qu=d("range2",function(e,t,n){return n.fromBipolar()._range(e,t)}),Au=d("ratio",e=>e.fmap(t=>Array.isArray(t)?t.slice(1).reduce((n,s)=>n/s,t[0]):t)),Tu=d("compress",function(e,t,n){return e=y(e),t=y(t),e.gt(t)||e.gt(1)||t.gt(1)||e.lt(0)||t.lt(0)?P:n._fastGap(y(1).div(t.sub(e)))._late(e)}),{compressSpan:Cu,compressspan:Su}=d(["compressSpan","compressspan"],function(e,t){return t._compress(e.begin,e.end)}),{fastGap:Mu,fastgap:Nu}=d(["fastGap","fastgap"],function(e,t){const n=function(r){const o=r.begin.sam(),i=r.begin.sub(o).mul(e).min(1),a=r.end.sub(o).mul(e).min(1);if(!(i>=1))return new F(o.add(i),o.add(a))},s=function(r){const o=r.part.begin,i=r.part.end,a=o.sam(),u=o.sub(a).div(e).min(1),h=i.sub(a).div(e).min(1),l=new F(a.add(u),a.add(h)),f=r.whole?new F(l.begin.sub(o.sub(r.whole.begin).div(e)),l.end.add(r.whole.end.sub(i).div(e))):void 0;return new j(f,l,r.value,r.context)};return t.withQuerySpanMaybe(n).withHap(s).splitQueries()}),Ou=d("focus",function(e,t,n){return e=y(e),t=y(t),n._fast(y(1).div(t.sub(e))).late(e.cyclePos())}),{focusSpan:Bu,focusspan:Pu}=d(["focusSpan","focusspan"],function(e,t){return t._focus(e.begin,e.end)}),zu=d("ply",function(e,t){const n=t.fmap(s=>it(s)._fast(e)).squeezeJoin();return et&&(n.tactus=y(e).mulmaybe(t.tactus)),n}),{fast:Eu,density:kh}=d(["fast","density"],function(e,t){return e===0?P:(e=y(e),t.withQueryTime(s=>s.mul(e)).withHapTime(s=>s.div(e)).setTactus(t.tactus))},!0,!0),xu=d("hurry",function(e,t){return t._fast(e).mul(it({speed:e}))}),{slow:ju,sparsity:$u}=d(["slow","sparsity"],function(e,t){return e===0?P:t._fast(y(1).div(e))}),Fu=d("inside",function(e,t,n){return t(n._slow(e))._fast(e)}),Ru=d("outside",function(e,t,n){return t(n._fast(e))._slow(e)}),Ju=d("lastOf",function(e,t,n){const s=Array(e-1).fill(n);return s.push(t(n)),ue(...s)}),{firstOf:Lu,every:Wu}=d(["firstOf","every"],function(e,t,n){const s=Array(e-1).fill(n);return s.unshift(t(n)),ue(...s)}),Iu=d("apply",function(e,t){return e(t)}),Hu=d("cpm",function(e,t){return t._fast(e/60/1)}),Du=d("early",function(e,t){return e=y(e),t.withQueryTime(n=>n.add(e)).withHapTime(n=>n.sub(e))},!0,!0),on=d("late",function(e,t){return e=y(e),t._early(y(0).sub(e))},!0,!0),Vu=d("zoom",function(e,t,n){if(t=y(t),e=y(e),e.gte(t))return Y;const s=t.sub(e),r=et?n.tactus.mulmaybe(s):void 0;return n.withQuerySpan(o=>o.withCycle(i=>i.mul(s).add(e))).withHapSpan(o=>o.withCycle(i=>i.sub(e).div(s))).splitQueries().setTactus(r)}),{zoomArc:Qu,zoomarc:Gu}=d(["zoomArc","zoomarc"],function(e,t){return t.zoom(e.begin,e.end)}),Uu=d("linger",function(e,t){return e==0?P:e<0?t._zoom(e.add(1),1)._slow(e):t._zoom(0,e)._slow(e)},!0,!0),Ku=d("segment",function(e,t){return t.struct(it(!0)._fast(e)).setTactus(e)}),Xu=d("swingBy",(e,t,n)=>n.inside(t,on(rn(0,e/2)))),Yu=d("swing",(e,t)=>t.swingBy(1/3,e)),{invert:Zu,inv:tl}=d(["invert","inv"],function(e){return e.fmap(t=>!t)},!0,!0),el=d("when",function(e,t,n){return e?t(n):n}),nl=d("off",function(e,t,n){return L(n,t(n.late(e)))}),sl=d("brak",function(e){return e.when(wt(!1,!0),t=>ct(t,P)._late(.25))}),cn=d("rev",function(e){const t=function(n){const s=n.span,r=s.begin.sam(),o=s.begin.nextSam(),i=function(u){const h=u.withTime(f=>r.add(o.sub(f))),l=h.begin;return h.begin=h.end,h.end=l,h};return e.query(n.setSpan(i(s))).map(u=>u.withSpan(i))};return new p(t).splitQueries()},!1,!0),rl=d("pressBy",function(e,t){return t.fmap(n=>it(n).compress(e,1)).squeezeJoin()}),ol=d("press",function(e){return e._pressBy(.5)});p.prototype.hush=function(){return P};const il=d("palindrome",function(e){return e.lastOf(2,cn)},!0,!0),{juxBy:cl,juxby:al}=d(["juxBy","juxby"],function(e,t,n){e/=2;const s=function(i,a,u){return a in i?i[a]:u},r=n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)-e})),o=t(n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)+e})));return L(r,o).setTactus(et?Et(r.tactus,o.tactus):void 0)}),ul=d("jux",function(e,t){return t._juxBy(1,e,t)}),{echoWith:ll,echowith:fl,stutWith:hl,stutwith:dl}=d(["echoWith","echowith","stutWith","stutwith"],function(e,t,n,s){return L(...ne(0,e-1).map(r=>n(s.late(y(t).mul(r)),r)))}),pl=d("echo",function(e,t,n,s){return s._echoWith(e,t,(r,o)=>r.gain(Math.pow(n,o)))}),ml=d("stut",function(e,t,n,s){return s._echoWith(e,n,(r,o)=>r.gain(Math.pow(t,o)))}),le=function(e,t,n=!1){return e=y(e),wt(...ne(0,e.sub(1)).map(s=>n?t.late(y(s).div(e)):t.early(y(s).div(e))))},yl=d("iter",function(e,t){return le(e,t,!1)},!0,!0),{iterBack:gl,iterback:wl}=d(["iterBack","iterback"],function(e,t){return le(e,t,!0)},!0,!0),{repeatCycles:bl}=d("repeatCycles",function(e,t){return new p(function(n){const s=n.span.begin.sam(),r=s.div(e).sam(),o=s.sub(r);return n=n.withSpan(i=>i.withTime(a=>a.sub(o))),t.query(n).map(i=>i.withSpan(a=>a.withTime(u=>u.add(o))))}).splitQueries()},!0,!0),fe=function(e,t,n,s=!1,r=!1){const o=Array(e-1).fill(!1);o.unshift(!0);const i=le(e,ot(...o),!s);return r||(n=n.repeatCycles(e)),n.when(i,t)},{chunk:vl,slowchunk:_l,slowChunk:kl}=d(["chunk","slowchunk","slowChunk"],function(e,t,n){return fe(e,t,n,!1,!1)}),{chunkBack:ql,chunkback:Al}=d(["chunkBack","chunkback"],function(e,t,n){return fe(e,t,n,!0)}),{fastchunk:Tl,fastChunk:Cl}=d(["fastchunk","fastChunk"],function(e,t,n){return fe(e,t,n,!1,!0)}),Sl=d("bypass",function(e,t){return e=!!parseInt(e),e?P:t},!0,!0),Ml=d("ribbon",(e,t,n)=>n.early(e).restart(it(1).slow(t))),Nl=d("hsla",(e,t,n,s,r)=>r.color(`hsla(${e}turn,${t*100}%,${n*100}%,${s})`)),Ol=d("hsl",(e,t,n,s)=>s.color(`hsl(${e}turn,${t*100}%,${n*100}%)`));p.prototype.tag=function(e){return this.withContext(t=>({...t,tags:(t.tags||[]).concat([e])}))};p.prototype.stepJoin=function(){const e=this,t=Z(...Qt(Gt(e.queryArc(0,1)))).tactus,n=function(s){const o=e.early(s.span.begin.sam()).query(s.setSpan(new F(y(0),y(1))));return Z(...Qt(Gt(o))).query(s)};return new p(n,t)};function Qt(e){const t=e.filter((o,i)=>i.hasTactus).reduce((o,i)=>o.add(i),y(0)),n=Ct(e.map((o,i)=>i.tactus)).reduce((o,i)=>o.add(i),y(0)),s=t.eq(0)?void 0:n.div(t);function r(o,i){return i.tactus===void 0?[o.mulmaybe(s),i]:[i.tactus,i]}return e.map(o=>r(...o))}function Gt(e){const t=dt(e.map(r=>[r.part.begin,r.part.end])),n=Ue([y(0),y(1),...t]);return Qe(n).map(r=>[r[1].sub(r[0]),L(...an(new F(...r),e).map(o=>o.value.withHap(i=>i.setContext(i.combineContext(o)))))])}function an(e,t){return Ct(t.map(n=>un(e,n)))}function un(e,t){const n=e.intersection(t.part);if(n!=null)return new j(t.whole,n,t.value,t.context)}const Bl=d("steps",function(e,t){return t.tactus===void 0?t:t.tactus.eq(y(0))?Y:t.fast(y(e).div(t.tactus))});function he(e,...t){const n=t.map(r=>Vt(r));if(n.length==0)return P;e==0&&(e=n[0][1]);const s=[];for(const r of n)r[1]!=0&&(e==r[1]?s.push(r[0]):s.push(r[0]._fast(y(e).div(y(r[1])))));return L(...s)}function ln(e,...t){return t.length==0?P:Array.isArray(t[0])?he(e,...t):de(...t).steps(e)}function de(...e){if(Array.isArray(e[0]))return he(0,...e);if(e=e.filter(o=>o.hasTactus),e.length==0)return P;const t=e[0].tactus;if(t.eq(y(0)))return Y;const[n,...s]=e,r=L(n,...s.map(o=>o._slow(o.tactus.div(t))));return r.tactus=t,r}function Z(...e){if(e.length===0)return Y;const t=i=>Array.isArray(i)?i:[i.tactus,i];if(e=e.map(t),e.find(i=>i[0]===void 0)){const i=e.map(u=>u[0]).filter(u=>u!==void 0);if(i.length===0)return ct(...e.map(u=>u[1]));if(i.length===e.length)return Y;const a=i.reduce((u,h)=>u.add(h),y(0)).div(i.length);for(let u of e)u[0]===void 0&&(u[0]=a)}if(e.length==1){const i=b(e[0][1]);return i.tactus=e[0][0],i}const n=e.map(i=>i[0]).reduce((i,a)=>i.add(a),y(0));let s=y(0);const r=[];for(const[i,a]of e){if(y(i).eq(0))continue;const u=s.add(i);r.push(b(a)._compress(s.div(n),u.div(n))),s=u}const o=L(...r);return o.tactus=n,o}const Pl=Z,fn=Z;function zl(...e){e=e.map(r=>Array.isArray(r)?r.map(b):[b(r)]);const t=Et(...e.map(r=>y(r.length)));let n=[];for(let r=0;r<t;++r)n.push(...e.map(o=>o.length==0?P:o[r%o.length]));n=n.filter(r=>r.hasTactus&&r.tactus>0);const s=n.reduce((r,o)=>r.add(o.tactus),y(0));return n=Z(...n),n.tactus=s,n}const El=Jt("s_add",function(e,t){if(!t.hasTactus||t.tactus.lte(0)||(e=y(e),e.eq(0)))return Y;const n=e<0;n&&(e=e.abs());const s=e.div(t.tactus);return s.lte(0)?Y:s.gte(1)?t:n?t.zoom(y(1).sub(s),1):t.zoom(0,s)}),xl=Jt("s_sub",function(e,t){return t.hasTactus?(e=y(e),e.lt(0)?t.s_add(y(0).sub(t.tactus.add(e))):t.s_add(t.tactus.sub(e))):Y}),jl=Jt("s_expand",function(e,t){return t.withTactus(n=>n.mul(y(e)))}),$l=Jt("s_contract",function(e,t){return t.withTactus(n=>n.div(y(e)))});p.prototype.s_taperlist=function(e,t){const n=this;if(!n.hasTactus)return[n];if(t=t-1,t===0)return[n];const s=[],r=e>0;e=y(Math.abs(e));const o=n.tactus.sub(e.mul(y(t))).max(y(0));for(let i=0;i<t;++i)s.push(n.zoom(0,o.add(e.mul(y(i))).div(n.tactus)));return s.push(n),r&&s.reverse(),s};const Fl=(e,t,n)=>n.s_taperlist(e,t),Rl=d("s_taper",function(e,t,n){if(!n.hasTactus)return Y;const s=n.s_taperlist(e,t),r=Z(...s);return r.tactus=s.reduce((o,i)=>o.add(i.tactus),y(0)),r},!0,!1,e=>e.stepJoin());p.prototype.s_tour=function(...e){return Z(...[].concat(...e.map((t,n)=>[...e.slice(0,e.length-n),this,...e.slice(e.length-n)]),this,...e))};const Jl=function(e,...t){return e.s_tour(...t)},Ll=d("chop",function(e,t){const s=Array.from({length:e},(o,i)=>i).map(o=>({begin:o/e,end:(o+1)/e})),r=function(o){return ot(s.map(i=>Object.assign({},o,i)))};return t.squeezeBind(r).setTactus(et?y(e).mulmaybe(t.tactus):void 0)}),Wl=d("striate",function(e,t){const s=Array.from({length:e},(o,i)=>i).map(o=>({begin:o/e,end:(o+1)/e})),r=wt(...s);return t.set(r)._fast(e).setTactus(et?y(e).mulmaybe(t.tactus):void 0)}),hn=function(e,t,n=.5){return t.speed(1/e*n).unit("c").slow(e)},dn=d("slice",function(e,t,n){return e.innerBind(s=>t.outerBind(r=>n.outerBind(o=>{o=o instanceof Object?o:{s:o};const i=Array.isArray(s)?s[r]:r/s,a=Array.isArray(s)?s[r+1]:(r+1)/s;return it({begin:i,end:a,_slices:s,...o})}))).setTactus(t.tactus)},!1),Il=d("splice",function(e,t,n){const s=dn(e,t,n);return new p(r=>{const o=r.controls._cps||1;return s.query(r).map(a=>a.withValue(u=>({speed:o/u._slices/a.whole.duration*(u.speed||1),unit:"c",...u})))}).setTactus(t.tactus)},!1),{loopAt:Hl,loopat:Dl}=d(["loopAt","loopat"],function(e,t){return new p(n=>hn(e,t,n.controls._cps).query(n))}),Vl=d("fit",e=>e.withHaps((t,n)=>t.map(s=>s.withValue(r=>({...r,speed:(n.controls._cps||1)/s.whole.duration,unit:"c"}))))),{loopAtCps:Ql,loopatcps:Gl}=d(["loopAtCps","loopatcps"],function(e,t,n){return hn(e,n,t)}),Ul=e=>it(1).withValue(()=>b(e())).innerJoin();let Pe=e=>e<.5?1:1-(e-.5)/.5,pn=(e,t,n)=>{t=b(t),e=b(e),n=b(n);let s=t.fmap(o=>({gain:Pe(o)})),r=t.fmap(o=>({gain:Pe(1-o)}));return L(e.mul(s),n.mul(r))};p.prototype.xfade=function(e,t){return pn(this,e,t)};function Lt(e){let t=Array.isArray(e);e=t?e:[e];const n=e[0],s=i=>{let a;if(typeof i=="object"&&i.value!==void 0&&(a={...i},i=i.value,delete a.value),t&&Array.isArray(i)){const u=a||{};return i.forEach((h,l)=>{l<e.length&&(u[e[l]]=h)}),u}else return a?(a[n]=i,a):{[n]:i}},r=(...i)=>ot(...i).withValue(s),o=function(...i){return i.length?this.set(r(...i)):this.fmap(s)};return p.prototype[n]=o,r}function c(e,...t){const n=Array.isArray(e)?e[0]:e;let s={};return s[n]=Lt(e),t.forEach(r=>{s[r]=s[n],p.prototype[r]=p.prototype[n]}),s}const{s:mn,sound:yn}=c(["s","n","gain"],"sound"),{source:gn,src:wn}=c("source","src"),{n:bn}=c("n"),{note:vn}=c(["note","n"]),{accelerate:_n}=c("accelerate"),{velocity:kn}=c("velocity"),{gain:qn}=c("gain"),{postgain:An}=c("postgain"),{amp:Tn}=c("amp"),{attack:Cn,att:Sn}=c("attack","att"),{fmh:Mn}=c(["fmh","fmi"],"fmh"),{fmi:Nn,fm:On}=c(["fmi","fmh"],"fm"),{fmenv:Bn}=c("fmenv"),{fmattack:Pn}=c("fmattack"),{fmdecay:zn}=c("fmdecay"),{fmsustain:En}=c("fmsustain"),{fmrelease:xn}=c("fmrelease"),{fmvelocity:jn}=c("fmvelocity"),{bank:$n}=c("bank"),{analyze:Fn}=c("analyze"),{fft:Rn}=c("fft"),{decay:Jn,dec:Ln}=c("decay","dec"),{sustain:Wn,sus:In}=c("sustain","sus"),{release:Hn,rel:Dn}=c("release","rel"),{hold:Vn}=c("hold"),{bandf:Qn,bpf:Gn,bp:Un}=c(["bandf","bandq","bpenv"],"bpf","bp"),{bandq:Kn,bpq:Xn}=c("bandq","bpq"),{begin:Yn}=c("begin"),{end:Zn}=c("end"),{loop:ts}=c("loop"),{loopBegin:es,loopb:ns}=c("loopBegin","loopb"),{loopEnd:ss,loope:rs}=c("loopEnd","loope"),{crush:os}=c("crush"),{coarse:is}=c("coarse"),{drive:cs}=c("drive"),{channels:as,ch:us}=c("channels","ch"),{phaserrate:ls,phasr:fs}=c("phaserrate","phasr"),{phaser:hs,ph:ds}=c(["phaser","phaserdepth","phasercenter","phasersweep"],"ph"),{phasersweep:ps,phs:ms}=c("phasersweep","phs"),{phasercenter:ys,phc:gs}=c("phasercenter","phc"),{phaserdepth:ws,phd:bs,phasdp:vs}=c("phaserdepth","phd","phasdp"),{channel:_s}=c("channel"),{cut:ks}=c("cut"),{cutoff:qs,ctf:As,lpf:Ts,lp:Cs}=c(["cutoff","resonance","lpenv"],"ctf","lpf","lp"),{lpenv:Ss,lpe:Ms}=c("lpenv","lpe"),{hpenv:Ns,hpe:Os}=c("hpenv","hpe"),{bpenv:Bs,bpe:Ps}=c("bpenv","bpe"),{lpattack:zs,lpa:Es}=c("lpattack","lpa"),{hpattack:xs,hpa:js}=c("hpattack","hpa"),{bpattack:$s,bpa:Fs}=c("bpattack","bpa"),{lpdecay:Rs,lpd:Js}=c("lpdecay","lpd"),{hpdecay:Ls,hpd:Ws}=c("hpdecay","hpd"),{bpdecay:Is,bpd:Hs}=c("bpdecay","bpd"),{lpsustain:Ds,lps:Vs}=c("lpsustain","lps"),{hpsustain:Qs,hps:Gs}=c("hpsustain","hps"),{bpsustain:Us,bps:Ks}=c("bpsustain","bps"),{lprelease:Xs,lpr:Ys}=c("lprelease","lpr"),{hprelease:Zs,hpr:tr}=c("hprelease","hpr"),{bprelease:er,bpr:nr}=c("bprelease","bpr"),{ftype:sr}=c("ftype"),{fanchor:rr}=c("fanchor"),{vib:or,vibrato:ir,v:cr}=c(["vib","vibmod"],"vibrato","v"),{noise:ar}=c("noise"),{vibmod:ur,vmod:lr}=c(["vibmod","vib"],"vmod"),{hcutoff:fr,hpf:hr,hp:dr}=c(["hcutoff","hresonance","hpenv"],"hpf","hp"),{hresonance:pr,hpq:mr}=c("hresonance","hpq"),{resonance:yr,lpq:gr}=c("resonance","lpq"),{djf:wr}=c("djf"),{delay:br}=c(["delay","delaytime","delayfeedback"]),{delayfeedback:vr,delayfb:_r,dfb:kr}=c("delayfeedback","delayfb","dfb"),{delaytime:qr,delayt:Ar,dt:Tr}=c("delaytime","delayt","dt"),{lock:Cr}=c("lock"),{detune:Sr,det:Mr}=c("detune","det"),{unison:Nr}=c("unison"),{spread:Or}=c("spread"),{dry:Br}=c("dry"),{fadeTime:Pr,fadeOutTime:zr}=c("fadeTime","fadeOutTime"),{fadeInTime:Er}=c("fadeInTime"),{freq:xr}=c("freq"),{pattack:jr,patt:$r}=c("pattack","patt"),{pdecay:Fr,pdec:Rr}=c("pdecay","pdec"),{psustain:Jr,psus:Lr}=c("psustain","psus"),{prelease:Wr,prel:Ir}=c("prelease","prel"),{penv:Hr}=c("penv"),{pcurve:Dr}=c("pcurve"),{panchor:Vr}=c("panchor"),{gate:Qr,gat:Gr}=c("gate","gat"),{leslie:Ur}=c("leslie"),{lrate:Kr}=c("lrate"),{lsize:Xr}=c("lsize"),{activeLabel:Yr}=c("activeLabel"),{label:Zr}=c(["label","activeLabel"]),{degree:to}=c("degree"),{mtranspose:eo}=c("mtranspose"),{ctranspose:no}=c("ctranspose"),{harmonic:so}=c("harmonic"),{stepsPerOctave:ro}=c("stepsPerOctave"),{octaveR:oo}=c("octaveR"),{nudge:io}=c("nudge"),{octave:co}=c("octave"),{orbit:ao}=c("orbit"),{overgain:uo}=c("overgain"),{overshape:lo}=c("overshape"),{pan:fo}=c("pan"),{panspan:ho}=c("panspan"),{pansplay:po}=c("pansplay"),{panwidth:mo}=c("panwidth"),{panorient:yo}=c("panorient"),{rate:go}=c("rate"),{slide:wo}=c("slide"),{semitone:bo}=c("semitone"),{voice:vo}=c("voice"),{chord:_o}=c("chord"),{dictionary:ko,dict:qo}=c("dictionary","dict"),{anchor:Ao}=c("anchor"),{offset:To}=c("offset"),{octaves:Co}=c("octaves"),{mode:So}=c(["mode","anchor"]),{room:Mo}=c(["room","size"]),{roomlp:No,rlp:Oo}=c("roomlp","rlp"),{roomdim:Bo,rdim:Po}=c("roomdim","rdim"),{roomfade:zo,rfade:Eo}=c("roomfade","rfade"),{ir:xo,iresponse:jo}=c(["ir","i"],"iresponse"),{roomsize:$o,size:Fo,sz:Ro,rsize:Jo}=c("roomsize","size","sz","rsize"),{shape:Lo}=c(["shape","shapevol"]),{distort:Wo,dist:Io}=c(["distort","distortvol"],"dist"),{compressor:Ho}=c(["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]),{compressorKnee:Do}=c("compressorKnee"),{compressorRatio:Vo}=c("compressorRatio"),{compressorAttack:Qo}=c("compressorAttack"),{compressorRelease:Go}=c("compressorRelease"),{speed:Uo}=c("speed"),{unit:Ko}=c("unit"),{squiz:Xo}=c("squiz"),{vowel:Yo}=c("vowel"),{waveloss:Zo}=c("waveloss"),{density:Kl}=c("density"),{expression:ti}=c("expression"),{sustainpedal:ei}=c("sustainpedal"),{tremolodepth:ni,tremdp:si}=c("tremolodepth","tremdp"),{tremolorate:ri,tremr:oi}=c("tremolorate","tremr"),{fshift:ii}=c("fshift"),{fshiftnote:ci}=c("fshiftnote"),{fshiftphase:ai}=c("fshiftphase"),{triode:ui}=c("triode"),{krush:li}=c("krush"),{kcutoff:fi}=c("kcutoff"),{octer:hi}=c("octer"),{octersub:di}=c("octersub"),{octersubsub:pi}=c("octersubsub"),{ring:mi}=c("ring"),{ringf:yi}=c("ringf"),{ringdf:gi}=c("ringdf"),{freeze:wi}=c("freeze"),{xsdelay:bi}=c("xsdelay"),{tsdelay:vi}=c("tsdelay"),{real:_i}=c("real"),{imag:ki}=c("imag"),{enhance:qi}=c("enhance"),{partials:Ai}=c("partials"),{comb:Ti}=c("comb"),{smear:Ci}=c("smear"),{scram:Si}=c("scram"),{binshift:Mi}=c("binshift"),{hbrick:Ni}=c("hbrick"),{lbrick:Oi}=c("lbrick"),{midichan:Bi}=c("midichan"),{control:Pi}=c("control"),{ccn:zi}=c("ccn"),{ccv:Ei}=c("ccv"),{polyTouch:xi}=c("polyTouch"),{midibend:ji}=c("midibend"),{miditouch:$i}=c("miditouch"),{ctlNum:Fi}=c("ctlNum"),{frameRate:Ri}=c("frameRate"),{frames:Ji}=c("frames"),{hours:Li}=c("hours"),{midicmd:Wi}=c("midicmd"),{minutes:Ii}=c("minutes"),{progNum:Hi}=c("progNum"),{seconds:Di}=c("seconds"),{songPtr:Vi}=c("songPtr"),{uid:Qi}=c("uid"),{val:Gi}=c("val"),{cps:Ui}=c("cps"),{clip:Ki,legato:Xi}=c("clip","legato"),{duration:Yi,dur:Zi}=c("duration","dur"),{zrand:tc}=c("zrand"),{curve:ec}=c("curve"),{deltaSlide:nc}=c("deltaSlide"),{pitchJump:sc}=c("pitchJump"),{pitchJumpTime:rc}=c("pitchJumpTime"),{lfo:oc,repeatTime:ic}=c("lfo","repeatTime"),{znoise:cc}=c("znoise"),{zmod:ac}=c("zmod"),{zcrush:uc}=c("zcrush"),{zdelay:lc}=c("zdelay"),{tremolo:fc}=c("tremolo"),{zzfx:hc}=c("zzfx"),{color:dc,colour:pc}=c(["color","colour"]);let pe=(...e)=>e.reduce((t,n)=>Object.assign(t,{[n]:Lt(n)}),{});const mc=d("adsr",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s,r,o]=e;return t.set({attack:n,decay:s,sustain:r,release:o})}),yc=d("ad",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=n]=e;return t.attack(n).decay(s)}),gc=d("ds",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=0]=e;return t.set({decay:n,sustain:s})}),wc=d("ar",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=n]=e;return t.set({attack:n,release:s})}),Xl=Object.freeze(Object.defineProperty({__proto__:null,accelerate:_n,activeLabel:Yr,ad:yc,adsr:mc,amp:Tn,analyze:Fn,anchor:Ao,ar:wc,att:Sn,attack:Cn,bandf:Qn,bandq:Kn,bank:$n,begin:Yn,binshift:Mi,bp:Un,bpa:Fs,bpattack:$s,bpd:Hs,bpdecay:Is,bpe:Ps,bpenv:Bs,bpf:Gn,bpq:Xn,bpr:nr,bprelease:er,bps:Ks,bpsustain:Us,ccn:zi,ccv:Ei,ch:us,channel:_s,channels:as,chord:_o,clip:Ki,coarse:is,color:dc,colour:pc,comb:Ti,compressor:Ho,compressorAttack:Qo,compressorKnee:Do,compressorRatio:Vo,compressorRelease:Go,control:Pi,cps:Ui,createParam:Lt,createParams:pe,crush:os,ctf:As,ctlNum:Fi,ctranspose:no,curve:ec,cut:ks,cutoff:qs,dec:Ln,decay:Jn,degree:to,delay:br,delayfb:_r,delayfeedback:vr,delayt:Ar,delaytime:qr,deltaSlide:nc,density:Kl,det:Mr,detune:Sr,dfb:kr,dict:qo,dictionary:ko,dist:Io,distort:Wo,djf:wr,drive:cs,dry:Br,ds:gc,dt:Tr,dur:Zi,duration:Yi,end:Zn,enhance:qi,expression:ti,fadeInTime:Er,fadeOutTime:zr,fadeTime:Pr,fanchor:rr,fft:Rn,fm:On,fmattack:Pn,fmdecay:zn,fmenv:Bn,fmh:Mn,fmi:Nn,fmrelease:xn,fmsustain:En,fmvelocity:jn,frameRate:Ri,frames:Ji,freeze:wi,freq:xr,fshift:ii,fshiftnote:ci,fshiftphase:ai,ftype:sr,gain:qn,gat:Gr,gate:Qr,harmonic:so,hbrick:Ni,hcutoff:fr,hold:Vn,hours:Li,hp:dr,hpa:js,hpattack:xs,hpd:Ws,hpdecay:Ls,hpe:Os,hpenv:Ns,hpf:hr,hpq:mr,hpr:tr,hprelease:Zs,hps:Gs,hpsustain:Qs,hresonance:pr,imag:ki,ir:xo,iresponse:jo,kcutoff:fi,krush:li,label:Zr,lbrick:Oi,legato:Xi,leslie:Ur,lfo:oc,lock:Cr,loop:ts,loopBegin:es,loopEnd:ss,loopb:ns,loope:rs,lp:Cs,lpa:Es,lpattack:zs,lpd:Js,lpdecay:Rs,lpe:Ms,lpenv:Ss,lpf:Ts,lpq:gr,lpr:Ys,lprelease:Xs,lps:Vs,lpsustain:Ds,lrate:Kr,lsize:Xr,midibend:ji,midichan:Bi,midicmd:Wi,miditouch:$i,minutes:Ii,mode:So,mtranspose:eo,n:bn,noise:ar,note:vn,nudge:io,octave:co,octaveR:oo,octaves:Co,octer:hi,octersub:di,octersubsub:pi,offset:To,orbit:ao,overgain:uo,overshape:lo,pan:fo,panchor:Vr,panorient:yo,panspan:ho,pansplay:po,panwidth:mo,partials:Ai,patt:$r,pattack:jr,pcurve:Dr,pdec:Rr,pdecay:Fr,penv:Hr,ph:ds,phasdp:vs,phaser:hs,phasercenter:ys,phaserdepth:ws,phaserrate:ls,phasersweep:ps,phasr:fs,phc:gs,phd:bs,phs:ms,pitchJump:sc,pitchJumpTime:rc,polyTouch:xi,postgain:An,prel:Ir,prelease:Wr,progNum:Hi,psus:Lr,psustain:Jr,rate:go,rdim:Po,real:_i,registerControl:c,rel:Dn,release:Hn,repeatTime:ic,resonance:yr,rfade:Eo,ring:mi,ringdf:gi,ringf:yi,rlp:Oo,room:Mo,roomdim:Bo,roomfade:zo,roomlp:No,roomsize:$o,rsize:Jo,s:mn,scram:Si,seconds:Di,semitone:bo,shape:Lo,size:Fo,slide:wo,smear:Ci,songPtr:Vi,sound:yn,source:gn,speed:Uo,spread:Or,squiz:Xo,src:wn,stepsPerOctave:ro,sus:In,sustain:Wn,sustainpedal:ei,sz:Ro,tremdp:si,tremolo:fc,tremolodepth:ni,tremolorate:ri,tremr:oi,triode:ui,tsdelay:vi,uid:Qi,unison:Nr,unit:Ko,v:cr,val:Gi,velocity:kn,vib:or,vibmod:ur,vibrato:ir,vmod:lr,voice:vo,vowel:Yo,waveloss:Zo,xsdelay:bi,zcrush:uc,zdelay:lc,zmod:ac,znoise:cc,zrand:tc,zzfx:hc},Symbol.toStringTag,{value:"Module"})),Yl=function(e,t){const[n,s]=e,[r,o]=t,[i,a]=oe(s,r);return[[s,n-s],[ie((u,h)=>u.concat(h),i,o),a]]},Zl=function(e,t){const[n,s]=e,[r,o]=t,[i,a]=oe(n,o);return[[n,s-n],[ie((h,l)=>h.concat(l),r,i),a]]},bc=function(e,t){const[n,s]=e;return Math.min(n,s)<=1?[e,t]:bc(...n>s?Yl(e,t):Zl(e,t))},vc=function(e,t){const n=e<0;e=Math.abs(e);const s=t-e,r=Array(e).fill([1]),o=Array(s).fill([0]),i=bc([e,s],[r,o]),a=dt(i[1][0]).concat(dt(i[1][1]));return n?a.map(u=>u===0?1:0):a},me=function(e,t,n){const s=vc(e,t);return n?He(s,-n):s},tf=d("euclid",function(e,t,n){return n.struct(me(e,t,0))}),{euclidrot:ef,euclidRot:nf}=d(["euclidrot","euclidRot"],function(e,t,n,s){return s.struct(me(e,t,n))}),_c=function(e,t,n,s){if(e<1)return P;const o=me(e,t,n).join("").split("1").slice(1).map(i=>[i.length+1,!0]);return s.struct(fn(...o))},sf=d(["euclidLegato"],function(e,t,n){return _c(e,t,0,n)}),rf=d(["euclidLegatoRot"],function(e,t,n,s){return _c(e,t,n,s)});function kc(e,t,n=.05,s=.1,r=.1,o=globalThis.setInterval,i=globalThis.clearInterval,a=!0){let u=0,h=0,l=10**4,f=.01;const w=C=>n=C(n);r=r||s/2;const m=()=>{const C=e(),O=C+s+r;for(h===0&&(h=C+f);h<O;)h=a?Math.round(h*l)/l:h,t(h,n,u,C),h+=n,u++};let v;const _=()=>{A(),m(),v=o(m,s*1e3)},A=()=>{v!==void 0&&i(v),v=void 0};return{setDuration:w,start:_,stop:()=>{u=0,h=0,A()},pause:()=>A(),duration:n,interval:s,getPhase:()=>h,minLatency:f}}function of(e){return new p(t=>[new j(void 0,t.span,e)])}const nt=e=>{const t=n=>[new j(void 0,n.span,e(n.span.midpoint()))];return new p(t)},ye=nt(e=>1-e%1),qc=ye.toBipolar(),Wt=nt(e=>e%1),Ac=Wt.toBipolar(),ge=nt(e=>Math.sin(Math.PI*2*e)),Tc=ge.fromBipolar(),cf=Tc._early(y(1).div(4)),af=ge._early(y(1).div(4)),Cc=nt(e=>Math.floor(e*2%2)),uf=Cc.toBipolar(),lf=ct(ye,Wt),ff=ct(qc,Ac),Sc=nt(kt);let we=0,be=0;typeof window<"u"&&document.addEventListener("mousemove",e=>{we=e.clientY/document.body.clientHeight,be=e.clientX/document.body.clientWidth});const hf=nt(()=>we),df=nt(()=>we),pf=nt(()=>be),mf=nt(()=>be),yf=e=>{const t=e<<13^e,n=t>>17^t;return n<<5^n},gf=e=>e-Math.trunc(e),wf=e=>yf(Math.trunc(gf(e/300)*536870912)),bf=e=>e%536870912/536870912,Ut=e=>Math.abs(bf(wf(e))),vf=e=>Wt.range(0,e).floor().segment(e),tt=nt(Ut),_f=tt.toBipolar(),ve=e=>tt.fmap(t=>t<e),kf=e=>b(e).fmap(ve).innerJoin(),qf=ve(.5),Mc=e=>tt.fmap(t=>Math.trunc(t*e)),Af=e=>b(e).fmap(Mc).innerJoin(),at=function(e,t,n=!0){const s=Array.isArray(e),r=Object.keys(e).length;return e=Ye(e,b),r===0?P:t.fmap(o=>{let i=o;return s&&(i=n?Math.round(i)%r:Ge(Math.round(i),0,e.length-1)),e[i]})},Nc=function(e,t){return Array.isArray(t)&&([t,e]=[e,t]),Tf(e,t)},Tf=d("pick",function(e,t){return at(e,t,!1).innerJoin()}),Oc=d("pickmod",function(e,t){return at(e,t,!0).innerJoin()}),Cf=d("pickF",function(e,t,n){return n.apply(Nc(e,t))}),Sf=d("pickmodF",function(e,t,n){return n.apply(Oc(e,t))}),Mf=d("pickOut",function(e,t){return at(e,t,!1).outerJoin()}),Nf=d("pickmodOut",function(e,t){return at(e,t,!0).outerJoin()}),Of=d("pickRestart",function(e,t){return at(e,t,!1).restartJoin()}),Bf=d("pickmodRestart",function(e,t){return at(e,t,!0).restartJoin()}),Pf=d("pickReset",function(e,t){return at(e,t,!1).resetJoin()}),zf=d("pickmodReset",function(e,t){return at(e,t,!0).resetJoin()}),{inhabit:Ef,pickSqueeze:xf}=d(["inhabit","pickSqueeze"],function(e,t){return at(e,t,!1).squeezeJoin()}),{inhabitmod:jf,pickmodSqueeze:$f}=d(["inhabitmod","pickmodSqueeze"],function(e,t){return at(e,t,!0).squeezeJoin()}),Ff=(e,t)=>(t=t.map(b),t.length==0?P:e.fmap(n=>{const s=zt(Math.round(n),t.length);return t[s]}).squeezeJoin()),_e=(e,t)=>(t=t.map(b),t.length==0?P:e.range(0,t.length).fmap(n=>{const s=Math.min(Math.max(Math.floor(n),0),t.length-1);return t[s]})),It=(e,t)=>_e(e,t).outerJoin(),Bc=(e,t)=>_e(e,t).innerJoin(),Rf=(...e)=>It(tt,e);p.prototype.choose=function(...e){return It(this,e)};p.prototype.choose2=function(...e){return It(this.fromBipolar(),e)};const Pc=(...e)=>Bc(tt.segment(1),e),Jf=Pc,zc=function(e,...t){const n=t.map(a=>b(a[0])),s=[];let r=0;for(const a of t)r+=a[1],s.push(r);const o=r,i=function(a){const u=a*o;return n[s.findIndex(h=>h>u,s)]};return e.fmap(i)},Lf=(...e)=>zc(...e).outerJoin(),Wf=(...e)=>Lf(tt,...e),Ec=(...e)=>zc(tt.segment(1),...e).innerJoin(),If=Ec,xc=e=>{const t=e.fmap(Math.floor),n=e.fmap(o=>Math.floor(o)+1),s=o=>6*o**5-15*o**4+10*o**3,r=o=>i=>a=>i+s(o)*(a-i);return e.sub(t).fmap(r).appBoth(t.fmap(Ut)).appBoth(n.fmap(Ut))},Hf=xc(Sc.fmap(e=>Number(e))),Df=d("degradeByWith",(e,t,n)=>n.fmap(s=>r=>s).appLeft(e.filterValues(s=>s>t))),Vf=d("degradeBy",function(e,t){return t._degradeByWith(tt,e)}),Qf=d("degrade",e=>e._degradeBy(.5)),Gf=d("undegradeBy",function(e,t){return t._degradeByWith(tt.fmap(n=>1-n),e)}),Uf=d("undegrade",e=>e._undegradeBy(.5)),Kf=d("sometimesBy",function(e,t,n){return b(e).fmap(s=>L(n._degradeBy(s),t(n._undegradeBy(1-s)))).innerJoin()}),Xf=d("sometimes",function(e,t){return t._sometimesBy(.5,e)}),Yf=d("someCyclesBy",function(e,t,n){return b(e).fmap(s=>L(n._degradeByWith(tt._segment(1),s),t(n._degradeByWith(tt.fmap(r=>1-r)._segment(1),1-s)))).innerJoin()}),Zf=d("someCycles",function(e,t){return t._someCyclesBy(.5,e)}),th=d("often",function(e,t){return t.sometimesBy(.75,e)}),eh=d("rarely",function(e,t){return t.sometimesBy(.25,e)}),nh=d("almostNever",function(e,t){return t.sometimesBy(.1,e)}),sh=d("almostAlways",function(e,t){return t.sometimesBy(.9,e)}),rh=d("never",function(e,t){return t}),oh=d("always",function(e,t){return e(t)});let Ft;try{Ft=window?.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let ze=Ft?.getVoices();function ih(e,t,n){Ft.cancel();const s=new SpeechSynthesisUtterance(e);s.lang=t,ze=Ft.getVoices();const r=ze.filter(o=>o.lang.includes(t));typeof n=="number"?s.voice=r[n%r.length]:typeof n=="string"&&(s.voice=r.find(o=>o.name===o)),speechSynthesis.speak(s)}const ch=d("speak",function(e,t,n){return n.onTrigger((s,r)=>{ih(r.value,e,t)})}),jc=async(...e)=>{const t=await Promise.allSettled(e),n=t.filter(s=>s.status==="fulfilled").map(s=>s.value);return t.forEach((s,r)=>{s.status==="rejected"&&console.warn(`evalScope: module with index ${r} could not be loaded:`,s.reason)}),n.forEach(s=>{Object.entries(s).forEach(([r,o])=>{globalThis[r]=o})}),n};function ah(e,t={}){const{wrapExpression:n=!0,wrapAsync:s=!0}=t;n&&(e=`{${e}}`),s&&(e=`(async ()=>${e})()`);const r=`"use strict";return (${e})`;return Function(r)()}const $c=async(e,t,n)=>{let s={};if(t){const i=t(e,n);e=i.output,s=i}return{mode:"javascript",pattern:await ah(e,{wrapExpression:!!t}),meta:s}};class uh{constructor({onTrigger:t,onToggle:n,getTime:s}){this.started=!1,this.cps=.5,this.lastTick=0,this.getTime=s,this.time_at_last_tick_message=0,this.num_cycles_at_cps_change=0,this.onToggle=n,this.latency=.1,this.cycle=0,this.id=Math.round(Date.now()*Math.random()),this.worker_time_dif,this.worker=new SharedWorker(new URL("/assets/clockworker-OodvW4tn.js",import.meta.url)),this.worker.port.start(),this.channel=new BroadcastChannel("strudeltick");let r=0;const o=20,i=10**3,a=(l,f,w)=>{const m=s()-(l+f)+w;if(this.worker_time_dif==null)this.worker_time_dif=m;else{const _=Math.round((this.worker_time_dif*r+m*1)/(r+1)*i)/i;_!=this.worker_time_dif&&(r=4),this.worker_time_dif=_}r=Math.min(r+1,o)},u=l=>{const{num_cycles_at_cps_change:f,cps:w,num_seconds_at_cps_change:m,num_seconds_since_cps_change:v,begin:_,end:A,tickdeadline:k,cycle:S}=l;this.cps=w,this.cycle=S,a(m,v,k),h(_,A,f,m),this.time_at_last_tick_message=this.getTime()},h=(l,f,w,m)=>{if(this.started===!1)return;this.pattern.queryArc(l,f,{_cps:this.cps}).forEach(_=>{if(_.hasOnset()){const A=(_.whole.begin-w)/this.cps+m+this.latency+this.worker_time_dif,k=_.duration/this.cps;t?.(_,0,k,this.cps,A)}})};this.channel.onmessage=l=>{if(!this.started)return;const{payload:f,type:w}=l.data;switch(w){case"tick":u(f)}}}sendMessage(t,n){this.worker.port.postMessage({type:t,payload:n,id:this.id})}now(){const t=(this.getTime()-this.time_at_last_tick_message)*this.cps;return this.cycle+t}setCps(t=1){this.sendMessage("cpschange",{cps:t})}setCycle(t){this.sendMessage("setcycle",{cycle:t})}setStarted(t){this.sendMessage("toggle",{started:t}),this.started=t,this.onToggle?.(t)}start(){W("[cyclist] start"),this.setStarted(!0)}stop(){this.worker_time_dif=null,W("[cyclist] stop"),this.setStarted(!1)}setPattern(t,n=!1){this.pattern=t,n&&!this.started&&this.start()}log(t,n,s){const r=s.filter(o=>o.hasOnset());console.log(`${t.toFixed(4)} - ${n.toFixed(4)} ${Array(r.length).fill("I").join("")}`)}}class Fc{constructor({interval:t,onTrigger:n,onToggle:s,onError:r,getTime:o,latency:i=.1,setInterval:a,clearInterval:u,beforeStart:h}){this.started=!1,this.beforeStart=h,this.cps=.5,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=o,this.num_cycles_at_cps_change=0,this.seconds_at_cps_change,this.onToggle=s,this.latency=i,this.clock=kc(o,(f,w,m,v)=>{this.num_ticks_since_cps_change===0&&(this.num_cycles_at_cps_change=this.lastEnd,this.seconds_at_cps_change=f),this.num_ticks_since_cps_change++;const A=this.num_ticks_since_cps_change*w*this.cps;try{const k=this.lastEnd;this.lastBegin=k;const S=this.num_cycles_at_cps_change+A;if(this.lastEnd=S,this.lastTick=f,f<v){console.log("skip query: too late");return}this.pattern.queryArc(k,S,{_cps:this.cps}).forEach(C=>{if(C.hasOnset()){const O=(C.whole.begin-this.num_cycles_at_cps_change)/this.cps+this.seconds_at_cps_change+i,$=C.duration/this.cps,D=O-f;n?.(C,D,$,this.cps,O)}})}catch(k){W(`[cyclist] error: ${k.message}`),r?.(k)}},t,.1,.1,a,u);let l=this;globalThis.__cyclist__=l}now(){if(!this.started)return 0;const t=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+t*this.cps}setStarted(t){this.started=t,this.onToggle?.(t)}async start(){if(await this.beforeStart?.(),this.num_ticks_since_cps_change=0,this.num_cycles_at_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");W("[cyclist] start"),this.clock.start(),this.setStarted(!0),globalThis.haps_from_outputs=null}pause(){W("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){W("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}async setPattern(t,n=!1){this.pattern=t,n&&!this.started&&await this.start()}setCps(t=.5){this.cps!==t&&(this.cps=t,this.num_ticks_since_cps_change=0)}log(t,n,s){const r=s.filter(o=>o.hasOnset());console.log(`${t.toFixed(4)} - ${n.toFixed(4)} ${Array(r.length).fill("I").join("")}`)}}let Kt;function Xt(){if(!Kt)throw new Error("no time set! use setTime to define a time source");return Kt()}function Yt(e){Kt=e}function lh({defaultOutput:e,onEvalError:t,beforeEval:n,beforeStart:s,afterEval:r,getTime:o,transpiler:i,onToggle:a,editPattern:u,onUpdateState:h,sync:l=!1,setInterval:f,clearInterval:w,id:m}){const v={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},_={id:m},A=q=>{Object.assign(v,q),v.isDirty=v.code!==v.activeCode,v.error=v.evalError||v.schedulerError,h?.(v)},k={onTrigger:Rc({defaultOutput:e,getTime:o}),getTime:o,onToggle:q=>{A({started:q}),a?.(q)},setInterval:f,clearInterval:w,beforeStart:s},S=l&&typeof SharedWorker<"u"?new uh(k):new Fc(k);let E={},C=0,O;const $=function(){return E={},C=0,O=void 0,P},D=async(q,B=!0)=>(q=u?.(q)||q,await S.setPattern(q,B),q);Yt(()=>S.now());const I=()=>S.stop(),V=()=>S.start(),M=()=>S.pause(),ut=()=>S.toggle(),R=q=>S.setCps(q),K=q=>S.setCps(q/60),lt=function(q){return O=q,P},pt=()=>{p.prototype.p=function(B){return B.startsWith("_")||B.endsWith("_")?P:(B==="$"&&(B=`$${C}`,C++),E[B]=this,this)},p.prototype.q=function(B){return P};try{for(let B=1;B<10;++B)Object.defineProperty(p.prototype,`d${B}`,{get(){return this.p(B)},configurable:!0}),Object.defineProperty(p.prototype,`p${B}`,{get(){return this.p(B)},configurable:!0}),p.prototype[`q${B}`]=P}catch(B){console.warn("injectPatternMethods: error:",B)}const q=d("cpm",function(B,bt){return bt._fast(B/60/S.cps)});return jc({all:lt,hush:$,cpm:q,setCps:R,setcps:R,setCpm:K,setcpm:K})};return{scheduler:S,evaluate:async(q,B=!0,bt=!0)=>{if(!q)throw new Error("no code to evaluate");try{A({code:q,pending:!0}),await pt(),Yt(()=>S.now()),await n?.({code:q}),bt&&$();let{pattern:J,meta:rt}=await $c(q,i,_);if(Object.keys(E).length&&(J=L(...Object.values(E))),O&&(J=O(J)),!ce(J)){const vt=`got "${typeof evaluated}" instead of pattern`;throw new Error(vt+(typeof evaluated=="function"?", did you forget to call a function?":"."))}return W("[eval] code updated"),J=await D(J,B),A({miniLocations:rt?.miniLocations||[],widgets:rt?.widgets||[],activeCode:q,pattern:J,evalError:void 0,schedulerError:void 0,pending:!1}),r?.({code:q,pattern:J,meta:rt}),J}catch(J){W(`[eval] error: ${J.message}`,"error"),console.error(J),A({evalError:J,pending:!1}),t?.(J)}},start:V,stop:I,pause:M,setCps:R,setPattern:D,setCode:q=>A({code:q}),toggle:ut,state:v}}const Rc=({getTime:e,defaultOutput:t})=>async(n,s,r,o,i)=>{try{(!n.context.onTrigger||!n.context.dominantTrigger)&&await t(n,s,r,o,i),n.context.onTrigger&&await n.context.onTrigger(e()+s,n,e(),o,i)}catch(a){W(`[cyclist] error: ${a.message}`,"error")}},fh=function(e,t={}){const n=document.getElementById("code"),s="background-image:url("+e+");background-size:contain;";n.style=s;const{className:r}=n,o=(u,h)=>{({style:()=>n.style=s+";"+h,className:()=>n.className=h+" "+r})[u]()},i=Object.entries(t).filter(([u,h])=>typeof h=="function");Object.entries(t).filter(([u,h])=>typeof h=="string").forEach(([u,h])=>o(u,h)),i.length},hh=()=>{const e=document.getElementById("code");e&&(e.style="")};W("🌀 @strudel/core loaded 🌀");globalThis._strudelLoaded&&console.warn(`@strudel/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel/core".`);globalThis._strudelLoaded=!0;const qh=Object.freeze(Object.defineProperty({__proto__:null,Cyclist:Fc,Fraction:y,Hap:j,Pattern:p,State:At,TimeSpan:F,__chooseWith:_e,_brandBy:ve,_fitslice:an,_irand:Mc,_match:un,_mod:zt,_polymeterListSteps:he,_retime:Qt,_slices:Gt,accelerate:_n,activeLabel:Yr,ad:yc,add:Ga,adsr:mc,almostAlways:sh,almostNever:nh,always:oh,amp:Tn,analyze:Fn,anchor:Ao,and:du,apply:Iu,ar:wc,arrange:La,att:Sn,attack:Cn,backgroundImage:fh,band:tu,bandf:Qn,bandq:Kn,bank:$n,base64ToUnicode:Xe,begin:Yn,binshift:Mi,bjork:vc,blshift:su,bor:eu,bp:Un,bpa:Fs,bpattack:$s,bpd:Hs,bpdecay:Is,bpe:Ps,bpenv:Bs,bpf:Gn,bpq:Xn,bpr:nr,bprelease:er,bps:Ks,bpsustain:Us,brak:sl,brand:qf,brandBy:kf,brshift:ru,bxor:nu,bypass:Sl,calculateTactus:Pa,cat:sn,ccn:zi,ccv:Ei,ceil:wu,ch:us,channel:_s,channels:as,choose:Rf,chooseCycles:Pc,chooseInWith:Bc,chooseWith:It,chop:Ll,chord:_o,chunk:vl,chunkBack:ql,chunkback:Al,clamp:Ge,cleanupUi:hh,clip:Ki,coarse:is,code2hash:Ma,color:dc,colour:pc,comb:Ti,compose:ya,compress:Tu,compressSpan:Cu,compressor:Ho,compressorAttack:Qo,compressorKnee:Do,compressorRatio:Vo,compressorRelease:Go,compressspan:Su,constant:ga,control:Pi,controls:Xl,cosine:cf,cosine2:af,cpm:Hu,cps:Ui,createClock:kc,createParam:Lt,createParams:pe,crush:os,ctf:As,ctlNum:Fi,ctranspose:no,curry:T,curve:ec,cut:ks,cutoff:qs,dec:Ln,decay:Jn,degrade:Qf,degradeBy:Vf,degradeByWith:Df,degree:to,delay:br,delayfb:_r,delayfeedback:vr,delayt:Ar,delaytime:qr,deltaSlide:nc,det:Mr,detune:Sr,dfb:kr,dict:qo,dictionary:ko,dist:Io,distort:Wo,div:Xa,djf:wr,drawLine:Ze,drive:cs,dry:Br,ds:gc,dt:Tr,dur:Zi,duration:Yi,early:Du,echo:pl,echoWith:ll,echowith:fl,end:Zn,enhance:qi,eq:uu,eqt:lu,euclid:tf,euclidLegato:sf,euclidLegatoRot:rf,euclidRot:nf,euclidrot:ef,evalScope:jc,evaluate:$c,every:Wu,expression:ti,fadeInTime:Er,fadeOutTime:zr,fadeTime:Pr,fanchor:rr,fast:Eu,fastChunk:Cl,fastGap:Mu,fastcat:ct,fastchunk:Tl,fastgap:Nu,fft:Rn,firstOf:Lu,fit:Vl,flatten:dt,floor:gu,fm:On,fmattack:Pn,fmdecay:zn,fmenv:Bn,fmh:Mn,fmi:Nn,fmrelease:xn,fmsustain:En,fmvelocity:jn,focus:Ou,focusSpan:Bu,focusspan:Pu,fractionalArgs:wa,frameRate:Ri,frames:Ji,freeze:wi,freq:xr,freqToMidi:ee,fromBipolar:vu,fshift:ii,fshiftnote:ci,fshiftphase:ai,ftype:sr,func:mu,gain:qn,gap:St,gat:Gr,gate:Qr,getEventOffsetMs:fa,getFreq:Le,getFrequency:Ie,getPlayableNoteValue:ma,getSoundIndex:pa,getTime:Xt,getTrigger:Rc,gt:iu,gte:au,harmonic:so,hash2code:Na,hbrick:Ni,hcutoff:fr,hold:Vn,hours:Li,hp:dr,hpa:js,hpattack:xs,hpd:Ws,hpdecay:Ls,hpe:Os,hpenv:Ns,hpf:hr,hpq:mr,hpr:tr,hprelease:Zs,hps:Gs,hpsustain:Qs,hresonance:pr,hsl:Ol,hsla:Nl,hurry:xu,id:kt,imag:ki,inhabit:Ef,inhabitmod:jf,inside:Fu,inv:tl,invert:Zu,ir:xo,irand:Af,iresponse:jo,isNote:Rt,isNoteWithOctave:ca,isPattern:ce,isaw:ye,isaw2:qc,iter:yl,iterBack:gl,iterback:wl,jux:ul,juxBy:cl,juxby:al,kcutoff:fi,keep:Va,keepif:Qa,krush:li,label:Zr,lastOf:Ju,late:on,lbrick:Oi,legato:Xi,leslie:Ur,lfo:oc,linger:Uu,listRange:ne,lock:Cr,logKey:te,logger:W,loop:ts,loopAt:Hl,loopAtCps:Ql,loopBegin:es,loopEnd:ss,loopat:Dl,loopatcps:Gl,loopb:ns,loope:rs,lp:Cs,lpa:Es,lpattack:zs,lpd:Js,lpdecay:Rs,lpe:Ms,lpenv:Ss,lpf:Ts,lpq:gr,lpr:Ys,lprelease:Xs,lps:Vs,lpsustain:Ds,lrate:Kr,lsize:Xr,lt:ou,lte:cu,mapArgs:re,mask:Wa,midi2note:da,midiToFreq:gt,midibend:ji,midichan:Bi,midicmd:Wi,miditouch:$i,minutes:Ii,mod:Ya,mode:So,mouseX:mf,mouseY:df,mousex:pf,mousey:hf,mtranspose:eo,mul:Ka,n:bn,nanFallback:We,ne:fu,net:hu,never:rh,noise:ar,note:vn,noteToMidi:Tt,nothing:Y,nudge:io,numeralArgs:X,objectMap:Ye,octave:co,octaveR:oo,octaves:Co,octer:hi,octersub:di,octersubsub:pi,off:nl,offset:To,often:th,or:pu,orbit:ao,outside:Ru,overgain:uo,overshape:lo,pairs:Qe,palindrome:il,pan:fo,panchor:Vr,panorient:yo,panspan:ho,pansplay:po,panwidth:mo,parseFractional:Ve,parseNumeral:se,partials:Ai,patt:$r,pattack:jr,pcurve:Dr,pdec:Rr,pdecay:Fr,penv:Hr,perlin:Hf,perlinWith:xc,ph:ds,phasdp:vs,phaser:hs,phasercenter:ys,phaserdepth:ws,phaserrate:ls,phasersweep:ps,phasr:fs,phc:gs,phd:bs,phs:ms,pick:Nc,pickF:Cf,pickOut:Mf,pickReset:Pf,pickRestart:Of,pickSqueeze:xf,pickmod:Oc,pickmodF:Sf,pickmodOut:Nf,pickmodReset:zf,pickmodRestart:Bf,pickmodSqueeze:$f,pipe:De,pitchJump:sc,pitchJumpTime:rc,ply:zu,pm:Ra,polyTouch:xi,polyrhythm:$a,postgain:An,pow:Za,pr:Fa,prel:Ir,prelease:Wr,press:ol,pressBy:rl,progNum:Hi,psus:Lr,psustain:Jr,pure:it,rand:tt,rand2:_f,randcat:Jf,range:_u,range2:qu,rangex:ku,rarely:eh,rate:go,ratio:Au,rdim:Po,real:_i,ref:Ul,register:d,registerControl:c,reify:b,rel:Dn,release:Hn,removeUndefineds:Ct,repeatCycles:bl,repeatTime:ic,repl:lh,resonance:yr,rev:cn,rfade:Eo,ribbon:Ml,ring:mi,ringdf:gi,ringf:yi,rlp:Oo,room:Mo,roomdim:Bo,roomfade:zo,roomlp:No,roomsize:$o,rotate:He,round:yu,rsize:Jo,run:vf,s:mn,s_add:El,s_alt:zl,s_cat:Z,s_contract:$l,s_expand:jl,s_polymeter:de,s_polymeterSteps:ln,s_sub:xl,s_taper:Rl,s_taperlist:Fl,s_tour:Jl,saw:Wt,saw2:Ac,scram:Si,seconds:Di,segment:Ku,semitone:bo,seq:rn,sequence:ot,set:Da,setStringParser:za,setTime:Yt,shape:Lo,signal:nt,silence:P,sine:Tc,sine2:ge,size:Fo,slice:dn,slide:wo,slow:ju,slowChunk:kl,slowcat:wt,slowcatPrime:ue,slowchunk:_l,smear:Ci,sol2note:Ta,someCycles:Zf,someCyclesBy:Yf,sometimes:Xf,sometimesBy:Kf,songPtr:Vi,sound:yn,source:gn,sparsity:$u,speak:ch,speed:Uo,splice:Il,splitAt:oe,spread:Or,square:Cc,square2:uf,squeeze:Ff,squiz:Xo,src:wn,stack:L,stackBy:Ja,stackCentre:nn,stackLeft:tn,stackRight:en,steady:of,steps:Bl,stepsPerOctave:ro,striate:Wl,struct:Ia,stut:ml,stutWith:hl,stutwith:dl,sub:Ua,superimpose:Ha,sus:In,sustain:Wn,sustainpedal:ei,swing:Yu,swingBy:Xu,sz:Ro,time:Sc,timeCat:fn,timecat:Pl,toBipolar:bu,tokenizeNote:Je,tremdp:si,tremolo:fc,tremolodepth:ni,tremolorate:ri,tremr:oi,tri:lf,tri2:ff,triode:ui,tsdelay:vi,uid:Qi,undegrade:Uf,undegradeBy:Gf,unicodeToBase64:Ke,uniq:Ca,uniqsort:Sa,uniqsortr:Ue,unison:Nr,unit:Ko,v:cr,val:Gi,valueToMidi:la,velocity:kn,vib:or,vibmod:ur,vibrato:ir,vmod:lr,voice:vo,vowel:Yo,waveloss:Zo,wchoose:Wf,wchooseCycles:Ec,when:el,wrandcat:If,xfade:pn,xsdelay:bi,zcrush:uc,zdelay:lc,zipWith:ie,zmod:ac,znoise:cc,zoom:Vu,zoomArc:Qu,zoomarc:Gu,zrand:tc,zzfx:hc},Symbol.toStringTag,{value:"Module"})),Ht=(e="test-canvas",t)=>{let{contextType:n="2d",pixelated:s=!1,pixelRatio:r=window.devicePixelRatio}=t||{},o=document.querySelector("#"+e);if(!o){o=document.createElement("canvas"),o.id=e,o.width=window.innerWidth*r,o.height=window.innerHeight*r,o.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",s&&(o.style.imageRendering="pixelated"),document.body.prepend(o);let i;window.addEventListener("resize",()=>{i&&clearTimeout(i),i=setTimeout(()=>{o.width=window.innerWidth*r,o.height=window.innerHeight*r},200)})}return o.getContext(n)};let qt={};function Jc(e){qt[e]!==void 0&&(cancelAnimationFrame(qt[e]),delete qt[e])}function dh(e){Object.keys(qt).forEach(t=>(!e||t.startsWith(e))&&Jc(t))}let ht={};p.prototype.draw=function(e,t){if(typeof window>"u")return this;let{id:n=1,lookbehind:s=0,lookahead:r=0}=t,o=Math.max(Xt(),0);Jc(n),s=Math.abs(s),ht[n]=(ht[n]||[]).filter(h=>!h.isInFuture(o));let i=this.queryArc(o,o+r).filter(h=>h.hasOnset());ht[n]=ht[n].concat(i);let a;const u=()=>{const h=Xt(),l=h+r;ht[n]=ht[n].filter(m=>m.isInNearPast(s,h));let f=Math.max(a||l,l-1/10);const w=this.queryArc(f,l).filter(m=>m.hasOnset());ht[n]=ht[n].concat(w),a=l,e(ht[n],h,l,this),qt[n]=requestAnimationFrame(u)};return qt[n]=requestAnimationFrame(u),this};const Ah=(e=!0,t)=>{const n=Ht();e&&n.clearRect(0,0,n.canvas.width,n.canvas.height),dh(t)};p.prototype.onPaint=function(e){return this.withState(t=>{t.controls.painters||(t.controls.painters=[]),t.controls.painters.push(e)})};p.prototype.getPainters=function(){let e=[];return this.queryArc(0,0,{painters:e}),e};class ph{constructor(t,n){this.onFrame=t,this.onError=n}start(){const t=this;let n=requestAnimationFrame(function s(r){try{t.onFrame(r)}catch(o){t.onError(o)}n=requestAnimationFrame(s)});t.cancel=()=>{cancelAnimationFrame(n)}}stop(){this.cancel&&this.cancel()}}class Th{constructor(t,n){this.visibleHaps=[],this.lastFrame=null,this.drawTime=n,this.painters=[],this.framer=new ph(()=>{if(!this.scheduler){console.warn("Drawer: no scheduler");return}const s=Math.abs(this.drawTime[0]),r=this.drawTime[1],o=this.scheduler.now()+r;if(this.lastFrame===null){this.lastFrame=o;return}const i=this.scheduler.pattern.queryArc(Math.max(this.lastFrame,o-1/10),o);this.lastFrame=o,this.visibleHaps=(this.visibleHaps||[]).filter(u=>u.endClipped>=o-s-r).concat(i.filter(u=>u.hasOnset()));const a=o-r;t(this.visibleHaps,a,this,this.painters)},s=>{console.warn("draw error",s)})}setDrawTime(t){this.drawTime=t}invalidate(t=this.scheduler,n){if(!t)return;n=n??t.now(),this.scheduler=t;let[s,r]=this.drawTime;const[o,i]=[Math.max(n,0),n+r+.1];this.visibleHaps=this.visibleHaps.filter(u=>u.whole.begin<n),this.painters=[];const a=t.pattern.queryArc(o,i,{painters:this.painters});this.visibleHaps=this.visibleHaps.concat(a)}start(t){this.scheduler=t,this.invalidate(),this.framer.start()}stop(){this.framer&&this.framer.stop()}}function Ch(e){return typeof window>"u"?"#fff":getComputedStyle(document.documentElement).getPropertyValue(e)}let Lc={background:"#222",foreground:"#75baff",caret:"#ffcc00",selection:"rgba(128, 203, 196, 0.5)",selectionMatch:"#036dd626",lineHighlight:"#00000050",gutterBackground:"transparent",gutterForeground:"#8a919966"};function yt(){return Lc}function Sh(e){Lc=e}let Ee="#22222210";p.prototype.animate=function({callback:e,sync:t=!1,smear:n=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const s=Ht();let{clientWidth:r,clientHeight:o}=s.canvas;r*=window.devicePixelRatio,o*=window.devicePixelRatio;let i=n===0?"99":Number((1-n)*100).toFixed(0);i=i.length===1?`0${i}`:i,Ee=`#200010${i}`;const a=u=>{let h;u=Math.round(u),h=this.slow(1e3).queryArc(u,u),s.fillStyle=Ee,s.fillRect(0,0,r,o),h.forEach(l=>{let{x:f,y:w,w:m,h:v,s:_,r:A,angle:k=0,fill:S="darkseagreen"}=l.value;if(m*=r,v*=o,A!==void 0&&k!==void 0){const C=k*2*Math.PI,[O,$]=[(r-m)/2,(o-v)/2];f=O+Math.cos(C)*A*O,w=$+Math.sin(C)*A*$}else f*=r-m,w*=o-v;const E={...l.value,x:f,y:w,w:m,h:v};s.fillStyle=S,_==="rect"?s.fillRect(f,w,m,v):_==="ellipse"&&(s.beginPath(),s.ellipse(f+m/2,w+v/2,m/2,v/2,0,0,2*Math.PI),s.fill()),e&&e(s,E,l)}),window.frame=requestAnimationFrame(a)};return window.frame=requestAnimationFrame(a),P};const{x:Wc,y:Mh,w:Nh,h:Oh,angle:Bh,r:Ph,fill:zh,smear:Eh}=pe("x","y","w","h","angle","r","fill","smear"),xh=d("rescale",function(e,t){return t.mul(Wc(e).w(e).y(e).h(e))}),jh=d("moveXY",function(e,t,n){return n.add(Wc(e).y(t))}),$h=d("zoomIn",function(e,t){const n=it(1).sub(e).div(2);return t.rescale(e).move(n,n)}),Pt=(e,t,n)=>e*(n-t)+t,xe=e=>{let{value:t}=e;typeof e.value!="object"&&(t={value:t});let{note:n,n:s,freq:r,s:o}=t;if(r)return ee(r);if(n=n??s,typeof n=="string")try{return Tt(n)}catch{return 0}return typeof n=="number"?n:o?"_"+o:t};p.prototype.pianoroll=function(e={}){let{cycles:t=4,playhead:n=.5,overscan:s=0,hideNegative:r=!1,ctx:o=Ht(),id:i=1}=e,a=-t*n,u=t*(1-n);const h=(l,f)=>(!r||l.whole.begin>=0)&&l.isWithinTime(f+a,f+u);return this.draw((l,f)=>{ke({...e,time:f,ctx:o,haps:l.filter(w=>h(w,f))})},{lookbehind:a-s,lookahead:u+s,id:i}),this};function ke({time:e,haps:t,cycles:n=4,playhead:s=.5,flipTime:r=0,flipValues:o=0,hideNegative:i=!1,inactive:a=yt().foreground,active:u=yt().foreground,background:h="transparent",smear:l=0,playheadColor:f=yt().foreground,minMidi:w=10,maxMidi:m=90,autorange:v=0,timeframe:_,fold:A=1,vertical:k=0,labels:S=!1,fill:E=1,fillActive:C=!1,strokeActive:O=!0,stroke:$,hideInactive:D=0,colorizeInactive:I=1,fontFamily:V,ctx:M,id:ut}={}){const R=M.canvas.width,K=M.canvas.height;let lt=-n*s,pt=n*(1-s);ut&&(t=t.filter(x=>x.hasTag(ut))),_&&(console.warn("timeframe is deprecated! use from/to instead"),lt=0,pt=_);const mt=k?K:R,st=k?R:K;let q=k?[mt,0]:[0,mt];const B=pt-lt,bt=k?[0,st]:[st,0];let J=m-w+1,rt=st/J,vt=[];r&&q.reverse(),o&&bt.reverse();const{min:Hc,max:Dc,values:Vc}=t.reduce(({min:x,max:Q,values:Mt},Nt)=>{const G=xe(Nt);return{min:G<x?G:x,max:G>Q?G:Q,values:Mt.includes(G)?Mt:[...Mt,G]}},{min:1/0,max:-1/0,values:[]});v&&(w=Hc,m=Dc,J=m-w+1),vt=Vc.sort((x,Q)=>typeof x=="number"&&typeof Q=="number"?x-Q:typeof x=="number"?1:String(x).localeCompare(String(Q))),rt=A?st/vt.length:st/J,M.fillStyle=h,M.globalAlpha=1,l||(M.clearRect(0,0,R,K),M.fillRect(0,0,R,K)),t.forEach(x=>{const Q=x.whole.begin<=e&&x.endClipped>e;let Mt=$??(O&&Q),Nt=!Q&&E||Q&&C;if(D&&!Q)return;let G=x.value?.color;u=G||u,a=I&&G||a,G=Q?u:a,M.fillStyle=Nt?G:"transparent",M.strokeStyle=G;const{velocity:Qc=1,gain:Gc=1}=x.value||{};M.globalAlpha=Qc*Gc;const Uc=(x.whole.begin-(r?pt:lt))/B,qe=Pt(Uc,...q);let Ot=Pt(x.duration/B,0,mt);const Ae=xe(x),Kc=A?vt.indexOf(Ae)/vt.length:(Number(Ae)-w)/J,Te=Pt(Kc,...bt);let Ce=0;const Se=Pt(e/B,...q);let Bt;if(k?Bt=[Te+1-(o?rt:0),mt-Se+qe+Ce+1-(r?0:Ot),rt-2,Ot-2]:Bt=[qe-Se+Ce+1-(r?Ot:0),Te+1-(o?0:rt),Ot-2,rt-2],Mt&&M.strokeRect(...Bt),Nt&&M.fillRect(...Bt),S){const Xc=x.value.note??x.value.s+(x.value.n?`:${x.value.n}`:""),{label:Me,activeLabel:Yc}=x.value,Zc=(Q&&Yc||Me)??Xc;let ta=k?Ot:rt*.75;M.font=`${ta}px ${V||"monospace"}`,M.fillStyle=Nt?"black":G,M.textBaseline="top",M.fillText(Zc,...Bt)}}),M.globalAlpha=1;const xt=Pt(-lt/B,...q);return M.strokeStyle=f,M.beginPath(),k?(M.moveTo(0,xt),M.lineTo(st,xt)):(M.moveTo(xt,0),M.lineTo(xt,st)),M.stroke(),this}function Ic(e,t={}){let[n,s]=e;n=Math.abs(n);const r=s+n,o=r!==0?n/r:0;return{fold:1,...t,cycles:r,playhead:o}}const mh=(e={})=>(t,n,s,r)=>ke({ctx:t,time:n,haps:s,...Ic(r,e)});p.prototype.punchcard=function(e){return this.onPaint(mh(e))};p.prototype.wordfall=function(e){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...e})};function Fh(e){const{drawTime:t,...n}=e;ke({...Ic(t),...n})}function yh(e,t,n,s){const r=(e-90)*Math.PI/180;return[n+Math.cos(r)*t,s+Math.sin(r)*t]}const je=(e,t,n,s,r=0)=>yh((e+r)*360,t*e,n,s);function $e(e){let{ctx:t,from:n=0,to:s=3,margin:r=50,cx:o=100,cy:i=100,rotate:a=0,thickness:u=r/2,color:h=yt().foreground,cap:l="round",stretch:f=1,fromOpacity:w=1,toOpacity:m=1}=e;n*=f,s*=f,a*=f,t.lineWidth=u,t.lineCap=l,t.strokeStyle=h,t.globalAlpha=w,t.beginPath();let[v,_]=je(n,r,o,i,a);t.moveTo(v,_);const A=1/60;let k=n;for(;k<=s;){const[S,E]=je(k,r,o,i,a);t.globalAlpha=(k-n)/(s-n)*m,t.lineTo(S,E),k+=A}t.stroke()}function gh(e){let{stretch:t=1,size:n=80,thickness:s=n/2,cap:r="butt",inset:o=3,playheadColor:i="#ffffff",playheadLength:a=.02,playheadThickness:u=s,padding:h=0,steady:l=1,activeColor:f=yt().foreground,inactiveColor:w=yt().gutterForeground,colorizeInactive:m=0,fade:v=!0,ctx:_,time:A,haps:k,drawTime:S,id:E}=e;E&&(k=k.filter(R=>R.hasTag(E)));const[C,O]=[_.canvas.width,_.canvas.height];_.clearRect(0,0,C*2,O*2);const[$,D]=[C/2,O/2],I={margin:n/t,cx:$,cy:D,stretch:t,cap:r,thickness:s},V={...I,thickness:u,from:o-a,to:o,color:i},[M]=S,ut=l*A;k.forEach(R=>{const K=R.whole.begin<=A&&R.endClipped>A,lt=R.whole.begin-A+o,pt=R.endClipped-A+o-h,mt=R.value?.color||f,st=m||K?mt:w,q=v?1-Math.abs((R.whole.begin-A)/M):1;$e({ctx:_,...I,from:lt,to:pt,rotate:ut,color:st,fromOpacity:q,toOpacity:q})}),$e({ctx:_,...V,rotate:ut})}p.prototype.spiral=function(e={}){return this.onPaint((t,n,s,r)=>gh({ctx:t,time:n,haps:s,drawTime:r,...e}))};const wh=gt(36),Fe=(e,t,n,s)=>{s=s*Math.PI*2;const r=Math.sin(s)*n+e,o=Math.cos(s)*n+t;return[r,o]},Re=(e,t)=>.5-Math.log2(e/t)%1;function bh({haps:e,ctx:t,id:n,hapcircles:s=1,circle:r=0,edo:o=12,root:i=wh,thickness:a=3,hapRadius:u=6,mode:h="flake",margin:l=10}={}){const f=h==="polygon",w=h==="flake",m=t.canvas.width,v=t.canvas.height;t.clearRect(0,0,m,v);const _=yt().foreground,k=Math.min(m,v)/2-a/2-u-l,S=m/2,E=v/2;n&&(e=e.filter(O=>O.hasTag(n))),t.strokeStyle=_,t.fillStyle=_,t.globalAlpha=1,t.lineWidth=a,r&&(t.beginPath(),t.arc(S,E,k,0,2*Math.PI),t.stroke()),o&&(Array.from({length:o},(O,$)=>{const D=Re(i*Math.pow(2,$/o),i),[I,V]=Fe(S,E,k,D);t.beginPath(),t.arc(I,V,u,0,2*Math.PI),t.fill()}),t.stroke());let C=[];t.lineWidth=u,e.forEach(O=>{let $;try{$=Ie(O)}catch{return}const D=Re($,i),[I,V]=Fe(S,E,k,D),M=O.value.color||_;t.strokeStyle=M,t.fillStyle=M;const{velocity:ut=1,gain:R=1}=O.value||{},K=ut*R;t.globalAlpha=K,C.push([I,V,D,M,K]),t.beginPath(),s&&(t.moveTo(I+u,V),t.arc(I,V,u,0,2*Math.PI),t.fill()),w&&(t.moveTo(S,E),t.lineTo(I,V)),t.stroke()}),t.strokeStyle=_,t.globalAlpha=1,f&&C.length&&(C=C.sort((O,$)=>O[2]-$[2]),t.beginPath(),t.moveTo(C[0][0],C[0][1]),C.forEach(([O,$,D,I,V])=>{t.strokeStyle=I,t.globalAlpha=V,t.lineTo(O,$)}),t.lineTo(C[0][0],C[0][1]),t.stroke())}p.prototype.pitchwheel=function(e={}){let{ctx:t=Ht(),id:n=1}=e;return this.tag(n).onPaint((s,r,o)=>bh({...e,time:r,ctx:t,haps:o.filter(i=>i.isActive(r)),id:n}))};let H=[],vh=(e,t)=>{let n=[],s={get(){return s.lc||s.listen(()=>{})(),s.value},l:t||0,lc:0,listen(r,o){return s.lc=n.push(r,o||s.l)/2,()=>{let i=n.indexOf(r);~i&&(n.splice(i,2),--s.lc||s.off())}},notify(r){let o=!H.length;for(let i=0;i<n.length;i+=2)H.push(n[i],n[i+1],s.value,r);if(o){for(let i=0;i<H.length;i+=4){let a;for(let u=i+1;!a&&(u+=4)<H.length;)H[u]<H[i+1]&&(a=H.push(H[i],H[i+1],H[i+2],H[i+3]));a||H[i](H[i+2],H[i+3])}H.length=0}},off(){},set(r){s.value!==r&&(s.value=r,s.notify())},subscribe(r,o){let i=s.listen(r,o);return r(s.value),i},value:e};return s},Rh=(e={})=>{let t=vh(e);return t.setKey=function(n,s){typeof s>"u"?n in t.value&&(t.value={...t.value},delete t.value[n],t.notify(n)):t.value[n]!==s&&(t.value={...t.value,[n]:s},t.notify(n))},t};export{Bc as $,fa as A,se as B,da as C,Th as D,ce as E,ph as F,W as G,Ul as H,d as I,Ie as J,Rt as K,pa as L,ee as M,ma as N,Rh as O,p as P,qh as Q,Ge as R,it as S,P as T,L as U,y as V,fn as W,Et as X,ot as Y,ct as Z,zt as _,Bh as a,tt as a0,za as a1,vh as a2,lh as a3,Ma as a4,la as a5,jc as a6,Na as a7,xh as b,Ah as c,Ch as d,yt as e,zh as f,Ht as g,Oh as h,Sh as i,Ic as j,mh as k,Fh as l,jh as m,bh as n,Uo as o,ke as p,Lo as q,Ph as r,Eh as s,b as t,Xt as u,Tt as v,Nh as w,Wc as x,Mh as y,$h as z};
//# sourceMappingURL=index.BtoTtY-B.js.map
