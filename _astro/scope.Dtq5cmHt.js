import{w as qt,P as X,x as Ct}from"./index.lg0qkVDO.js";import{o as At,e as St,g as de}from"./index.DrQ6bw7J.js";if(typeof DelayNode<"u"){class e extends DelayNode{constructor(n,o,s,a){super(n),o=Math.abs(o),this.delayTime.value=s;const r=n.createGain();r.gain.value=Math.min(Math.abs(a),.995),this.feedback=r.gain;const i=n.createGain();return i.gain.value=o,this.delayGain=i,this.connect(r),this.connect(i),r.connect(this),this.connect=c=>i.connect(c),this}start(n){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,n+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(t,n,o){return new e(this,t,n,o)}}var fe={};fe.generateReverb=function(e,t){for(var n=e.audioContext||new AudioContext,o=n.sampleRate,s=e.numChannels||2,a=e.decayTime*1.5,r=Math.round(e.decayTime*o),i=Math.round(a*o),c=Math.round((e.fadeInTime||0)*o),l=Math.pow(1/1e3,1/r),u=n.createBuffer(s,i,o),h=0;h<s;h++){for(var f=u.getChannelData(h),d=0;d<i;d++)f[d]=$t()*Math.pow(l,d);for(var d=0;d<c;d++)f[d]*=d/c}xt(u,e.lpFreqStart||0,e.lpFreqEnd||0,e.decayTime,t)};fe.generateGraph=function(e,t,n,o,s){var a=document.createElement("canvas");a.width=t,a.height=n;var r=a.getContext("2d");r.fillStyle="#000",r.fillRect(0,0,a.width,a.height),r.fillStyle="#fff";for(var i=t/e.length,c=n/(s-o),l=0;l<e.length;l++)r.fillRect(l*i,n-(e[l]-o)*c,1,1);return a};var xt=function(e,t,n,o,s){if(t==0){s(e);return}var a=kt(e),r=new OfflineAudioContext(e.numberOfChannels,a[0].length,e.sampleRate),i=r.createBufferSource();i.buffer=e;var c=r.createBiquadFilter();t=Math.min(t,e.sampleRate/2),n=Math.min(n,e.sampleRate/2),c.type="lowpass",c.Q.value=1e-4,c.frequency.setValueAtTime(t,0),c.frequency.linearRampToValueAtTime(n,o),i.connect(c),c.connect(r.destination),i.start(),r.oncomplete=function(l){s(l.renderedBuffer)},r.startRendering(),window.filterNode=c},kt=function(e){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);return t},$t=function(){return Math.random()*2-1};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(e,t){const n=t.sampleRate*e,o=this.createBuffer(t.numberOfChannels,t.length,t.sampleRate);for(let s=0;s<t.numberOfChannels;s++){let a=t.getChannelData(s),r=o.getChannelData(s);for(let i=0;i<n;i++)r[i]=a[i]||0}return o},AudioContext.prototype.createReverb=function(e,t,n,o,s){const a=this.createConvolver();return a.generate=(r=2,i=.1,c=15e3,l=1e3,u)=>{a.duration=r,a.fade=i,a.lp=c,a.dim=l,a.ir=u,u?a.buffer=this.adjustLength(r,u):fe.generateReverb({audioContext:this,numChannels:2,decayTime:r,fadeInTime:i,lpFreqStart:c,lpFreqEnd:l},h=>{a.buffer=h})},a.generate(e,t,n,o,s),a});var _e={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},ae:{freqs:[650,1515,2400,3e3,3350],gains:[1,.5,.1008,.0631,.0126],qs:[80,90,120,130,140]},aa:{freqs:[560,900,2570,3e3,3300],gains:[1,.5,.0708,.0631,.0126],qs:[80,90,120,130,140]},oe:{freqs:[500,1430,2300,3e3,3300],gains:[1,.2,.0708,.0316,.01995],qs:[40,60,100,120,120]},ue:{freqs:[250,1750,2150,3200,3300],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},y:{freqs:[400,1460,2400,3e3,3300],gains:[1,.2,.0708,.0316,.02995],qs:[40,60,100,120,120]},uh:{freqs:[600,1250,2100,3100,3500],gains:[1,.3,.0608,.0316,.01995],qs:[40,70,100,120,130]},un:{freqs:[500,1240,2280,3e3,3500],gains:[1,.1,.1708,.0216,.02995],qs:[40,60,100,120,120]},en:{freqs:[600,1480,2450,3200,3300],gains:[1,.15,.0708,.0316,.02995],qs:[40,60,100,120,120]},an:{freqs:[700,1050,2500,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},on:{freqs:[500,1080,2350,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},get æ(){return this.ae},get ø(){return this.oe},get ɑ(){return this.aa},get å(){return this.aa},get ö(){return this.oe},get ü(){return this.ue},get ı(){return this.y}};if(typeof GainNode<"u"){class e extends GainNode{constructor(n,o){if(super(n),!_e[o])throw new Error("vowel: unknown vowel "+o);const{gains:s,qs:a,freqs:r}=_e[o],i=n.createGain();for(let c=0;c<5;c++){const l=n.createGain();l.gain.value=s[c];const u=n.createBiquadFilter();u.type="bandpass",u.Q.value=a[c],u.frequency.value=r[c],this.connect(u),u.connect(l),l.connect(i)}return i.gain.value=8,this.connect=c=>i.connect(c),this}}AudioContext.prototype.createVowelFilter=function(t){return new e(this,t)}}let Le=e=>console.log(e);const D=(...e)=>Le(...e),Rt=e=>{Le=e},Bt=e=>{if(typeof e!="string")return[];const[t,n="",o]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return t?[t,n,o?Number(o):void 0]:[]},Dt={c:0,d:2,e:4,f:5,g:7,a:9,b:11},Gt={"#":1,b:-1,s:1,f:-1},Ie=(e,t=3)=>{const[n,o,s=t]=Bt(e);if(!n)throw new Error('not a note: "'+e+'"');const a=Dt[n.toLowerCase()],r=o?.split("").reduce((i,c)=>i+Gt[c],0)||0;return(Number(s)+1)*12+a+r},wn=e=>Math.pow(2,(e-69)/12)*440,Y=(e,t,n)=>Math.min(Math.max(e,t),n),Mt=e=>12*Math.log(e/440)/Math.LN2+69,Ot=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:o}=e;return typeof n=="number"?Mt(n):typeof o=="string"?Ie(o):typeof o=="number"?o:t};function B(e,t=0,n){return isNaN(Number(e))?(!n&&D(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const He=(e,t)=>(e%t+t)%t,je=(e,t)=>He(Math.round(B(e,0)),t),Et="/_astro/worklets-C2vj9UQA.js";function Qe(e){const t=y().createGain();return t.gain.value=e,t}const Pe=(e,t,n,o)=>o-n===0?0:(t-e)/(o-n);function E(e,t,n,o){const s=new AudioWorkletNode(e,t,o);return Object.entries(n).forEach(([a,r])=>{s.parameters.get(a).value=r}),s}const U=(e,t,n,o,s,a,r,i,c,l="exponential")=>{t=B(t),n=B(n),o=B(o),s=B(s);const u=l==="exponential"?"exponentialRampToValueAtTime":"linearRampToValueAtTime";l==="exponential"&&(a=a===0?.001:a,r=r===0?.001:r);const h=r-a,f=r,d=a+o*h,p=c-i,m=w=>{let v;if(t>w){let b=Pe(a,f,0,t);v=w*b+(a>f?a:0)}else v=(w-t)*Pe(f,d,0,n)+f;return l==="exponential"&&(v=v||.001),v};e.setValueAtTime(a,i),t>p?e[u](m(p),c):t+n>p?(e[u](m(t),i+t),e[u](m(p),c)):(e[u](m(t),i+t),e[u](m(t+n),i+t+n),e.setValueAtTime(d,c)),e[u](a,c+s)};function Ft(e,t,n,o,s,a){const r={threshold:t??-3,ratio:n??10,knee:o??10,attack:s??.005,release:a??.05};return new DynamicsCompressorNode(e,r)}const ee=(e,t="linear",n)=>{const[r,i,c,l]=e;if(r==null&&i==null&&c==null&&l==null)return n??[.001,.001,1,.01];const u=c??(r!=null&&i==null||r==null&&i==null?1:.001);return[Math.max(r??0,.001),Math.max(i??0,.001),Math.min(u,1),Math.max(l??0,.01)]};function ae(e,t,n,o,s,a,r,i,c,l,u,h,f,d){const p="exponential",[m,w,v,b]=ee([s,a,r,i],p,[.005,.14,0,.1]);let C,k;if(f==="ladder"?(C=E(e,"ladder-processor",{frequency:n,q:o,drive:d}),k=C.parameters.get("frequency")):(C=e.createBiquadFilter(),C.type=t,C.Q.value=o,C.frequency.value=n,k=C.frequency),(s??a??r??i??c)!==void 0){c=B(c,1,!0),h=B(h,0,!0);const S=Math.abs(c),F=S*h;let $=Y(2**-F*n,0,2e4),R=Y(2**(S-F)*n,0,2e4);return c<0&&([$,R]=[R,$]),U(k,m,w,v,b,$,R,l,u,p),C}return C}let Ve=e=>e<.5?1:1-(e-.5)/.5;function bn(e,t,n=0){const o=y();if(!n)return e;let s=o.createGain(),a=o.createGain();e.connect(s),t.connect(a),s.gain.value=Ve(n),a.gain.value=Ve(1-n);let r=o.createGain();return s.connect(r),a.connect(r),r}let Nt=["linear","exponential"];function Wt(e,t,n,o){if(!(t.pattack??t.pdecay??t.psustain??t.prelease??t.penv))return;const a=B(t.penv,1,!0),r=Nt[t.pcurve??0];let[i,c,l,u]=ee([t.pattack,t.pdecay,t.psustain,t.prelease],r,[.2,.001,1,.001]),h=t.panchor??l;const f=a*100,d=0-f*h,p=f-f*h;U(e,i,c,l,u,d,p,n,o,r)}function _t(e,t,n){const{vibmod:o=.5,vib:s}=t;let a;if(s>0){a=y().createOscillator(),a.frequency.value=s;const r=y().createGain();return r.gain.value=o*100,a.connect(r),r.connect(e),a.start(n),a}}function Tn(e,t,n,o){const s=e.createConstantSource();s.start(n),s.stop(o),s.onended=()=>{t()}}const jt=(e,t=1,n="sine")=>{const o=y(),s=o.createOscillator();s.type=n,s.frequency.value=e,s.start();const a=new GainNode(o,{gain:t});return s.connect(a),{node:a,stop:r=>s.stop(r)}},Pt=(e,t,n,o="sine")=>{const a=e.value*t,r=a*n;return jt(a,r,o)};function qn(e,t,n){const{fmh:o=1,fmi:s,fmenv:a="exp",fmattack:r,fmdecay:i,fmsustain:c,fmrelease:l,fmvelocity:u,fmwave:h="sine",duration:f}=t;let d,p=()=>{};if(s){const w=y().createGain(),v=Pt(e,o,s,h);if(d=v.node,p=v.stop,![r,i,c,l,u].find(b=>b!==void 0))d.connect(e);else{const[b,C,k,M]=ee([r,i,c,l]),S=n+f;U(w.gain,b,C,k,M,0,1,n,S,a==="exp"?"exponential":"linear"),d.connect(w),w.connect(e)}}return{stop:p}}const he={},re={},Cn=e=>he[e];function Vt(e,t){var n=1024;if(e<n)return e+" B";var o=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],s=-1;do e/=n,++s;while(e>=n);return e.toFixed(1)+" "+o[s]}function zt(e,t){const{s:n,n:o=0,speed:s=1}=e;let a=Ot(e,36),r=a-36,i,c=0;if(Array.isArray(t))c=je(o,t.length),i=t[c];else{const h=d=>Ie(d)-a,f=Object.keys(t).filter(d=>!d.startsWith("_")).reduce((d,p,m)=>!d||Math.abs(h(p))<Math.abs(h(d))?p:d,null);r=-h(f),c=je(o,t[f].length),i=t[f][c]}const l=`${n}:${c}`;let u=Math.abs(s)*Math.pow(2,r/12);return{transpose:r,sampleUrl:i,index:c,midi:a,label:l,playbackRate:u}}const Lt=async(e,t,n)=>{let{sampleUrl:o,label:s,playbackRate:a}=zt(e,t);n&&(o=await n(o));const r=y(),i=await Ke(o,r,s);return e.unit==="c"&&(a=a*i.duration),{buffer:i,playbackRate:a}},It=async(e,t,n)=>{let{buffer:o,playbackRate:s}=await Lt(e,t,n);e.speed<0&&(o=Ht(o));const r=y().createBufferSource();r.buffer=o,r.playbackRate.value=s;const{s:i,loopBegin:c=0,loopEnd:l=1,begin:u=0,end:h=1}=e,f=u*r.buffer.duration;(i.startsWith("wt_")?1:e.loop)&&(r.loop=!0,r.loopStart=c*r.buffer.duration-f,r.loopEnd=l*r.buffer.duration-f);const p=r.buffer.duration/r.playbackRate.value,m=(h-u)*p;return{bufferSource:r,offset:f,bufferDuration:p,sliceDuration:m}},Ke=(e,t,n,o=0)=>{const s=n?`sound "${n}:${o}"`:"sample";if(e=e.replace("#","%23"),!re[e]){D(`[sampler] load ${s}..`,"load-sample",{url:e});const a=Date.now();re[e]=fetch(e).then(r=>r.arrayBuffer()).then(async r=>{const i=Date.now()-a,c=Vt(r.byteLength);D(`[sampler] load ${s}... done! loaded ${c} in ${i}ms`,"loaded-sample",{url:e});const l=await t.decodeAudioData(r);return he[e]=l,l})}return re[e]};function Ht(e){const t=y(),n=t.createBuffer(e.numberOfChannels,e.length,t.sampleRate);for(let o=0;o<e.numberOfChannels;o++)n.copyToChannel(e.getChannelData(o).slice().reverse(),o,o);return n}const An=e=>he[e];function Xe(e){if(e.startsWith("bubo:")){const[t,n]=e.split(":");e=`github:Bubobubobubobubo/dough-${n}`}return e}function Ye(e,t=""){if(!e.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[n,o]=e.split("github:");return o=o.endsWith("/")?o.slice(0,-1):o,o.split("/").length===2&&(o+="/main"),`https://raw.githubusercontent.com/${o}/${t}`}const Qt=(e,t,n=e._base||"")=>Object.entries(e).forEach(([o,s])=>{if(typeof s=="string"&&(s=[s]),typeof s!="object")throw new Error("wrong sample map format for "+o);n=s._base||n,n=Xe(n),n.startsWith("github:")&&(n=Ye(n,""));const a=r=>n+r;Array.isArray(s)?s=s.map(a):s=Object.fromEntries(Object.entries(s).map(([r,i])=>[r,(typeof i=="string"?[i]:i).map(a)])),t(o,s)});let Ze={};function Sn(e,t){Ze[e]=t}function Kt(e){const t=Object.entries(Ze).find(([n])=>e.startsWith(n));if(t)return t[1]}const Xt=async(e,t=e._base||"",n={})=>{if(typeof e=="string"){const a=Kt(e);if(a)return a(e);if(e=Xe(e),e.startsWith("github:")&&(e=Ye(e,"strudel.json")),e.startsWith("local:")&&(e="http://localhost:5432"),e.startsWith("shabda:")){let[i,c]=e.split("shabda:");e=`https://shabda.ndre.gr/${c}.json?strudel=1`}if(e.startsWith("shabda/speech")){let[i,c]=e.split("shabda/speech");c=c.startsWith("/")?c.substring(1):c;let[l,u]=c.split(":"),h="f",f="en-GB";l&&([f,h]=l.split("/")),e=`https://shabda.ndre.gr/speech/${u}.json?gender=${h}&language=${f}&strudel=1'`}if(typeof fetch!="function")return;const r=e.split("/").slice(0,-1).join("/");return typeof fetch>"u"?void 0:fetch(e).then(i=>i.json()).then(i=>Xt(i,t||i._base||r,n)).catch(i=>{throw console.error(i),new Error(`error loading "${e}"`)})}const{prebake:o,tag:s}=n;Qt(e,(a,r)=>Zt(a,(i,c,l)=>Yt(i,c,l,r),{type:"sample",samples:r,baseUrl:t,prebake:o,tag:s}),t)},ze=[];async function Yt(e,t,n,o,s){let{s:a,nudge:r=0,cut:i,loop:c,clip:l=void 0,n:u=0,speed:h=1,duration:f}=t;if(h===0)return;const d=y();let[p,m,w,v]=ee([t.attack,t.decay,t.sustain,t.release]);const{bufferSource:b,sliceDuration:C,offset:k}=await It(t,o,s);if(d.currentTime>e){D(`[sampler] still loading sound "${a}:${u}"`,"highlight");return}if(!b){D(`[sampler] could not load "${a}:${u}"`,"error");return}let M=_t(b.detune,t,e);const S=e+r;b.start(S,k);const F=d.createGain(),$=b.connect(F);l==null&&c==null&&t.release==null&&(f=C);let R=e+f;U($.gain,p,m,w,v,0,1,e,R,"linear"),Wt(b.detune,t,e,R);const V=d.createGain();$.connect(V),b.onended=function(){b.disconnect(),M?.stop(),$.disconnect(),V.disconnect(),n()};let te=R+v+.01;b.stop(te);const I={node:V,bufferSource:b,stop:(N,ve)=>{}};if(i!==void 0){const N=ze[i];N&&(N.node.gain.setValueAtTime(1,S),N.node.gain.linearRampToValueAtTime(0,S+.01)),ze[i]=I}return I}const pe=At();function Zt(e,t,n={}){pe.setKey(e,{onTrigger:t,data:n})}function ie(e){return pe.get()[e]}const Je={s:"triangle",gain:.8,postgain:1,density:".03",ftype:"12db",fanchor:0,resonance:1,hresonance:1,bandq:1,channels:[1,2],phaserdepth:.75,shapevol:1,distortvol:1,delay:0,delayfeedback:.5,delaytime:.25,orbit:1,i:1,velocity:1,fft:8};let ge=new Map(Object.entries(Je));function Ue(e,t){ge.set(e,t)}function q(e){return ge.get(e)}function xn(e){Object.keys(e).forEach(t=>{Ue(t,e[t])})}function Jt(){ge=new Map(Object.entries(Je))}function kn(e){Jt(),e==="1.0"&&Ue("fanchor",.5)}const $n=()=>pe.set({});let Z;const Ut=()=>(Z=new AudioContext,Z),y=()=>Z||Ut();function Rn(){return y().currentTime}let ce;function en(){return ce||(ce=y().audioWorklet.addModule(Et)),ce}async function tn(e={}){const{disableWorklets:t=!1}=e;if(!(typeof window>"u")){if(await y().resume(),t){D("[superdough]: AudioWorklets disabled with disableWorklets");return}try{await en(),D("[superdough] AudioWorklets loaded")}catch(n){console.warn("could not load AudioWorklet effects",n)}D("[superdough] ready")}}let le;async function Bn(e){return le||(le=new Promise(t=>{document.addEventListener("click",async function n(){document.removeEventListener("click",n),await tn(e),t()})})),le}let G={},J,_;function nn(){const e=y(),t=e.destination.maxChannelCount;e.destination.channelCount=t,J=new ChannelMergerNode(e,{numberOfInputs:e.destination.channelCount}),_=new GainNode(e),J.connect(_),_.connect(e.destination)}const me=(e,t=[0,1])=>{const n=y();J==null&&nn();const o=new StereoPannerNode(n);e.connect(o);const s=new ChannelSplitterNode(n,{numberOfOutputs:o.channelCount});o.connect(s),t.forEach((a,r)=>{s.connect(J,r%o.channelCount,Y(a,0,n.destination.channelCount-1))})},Dn=()=>{_!=null&&(_.gain.linearRampToValueAtTime(0,y().currentTime+.01),_=null)};function on(e,t,n,o){if(n=Y(n,0,.98),!G[e]){const a=y().createFeedbackDelay(1,t,n);a.start?.(o),me(a,[0,1]),G[e]=a}return G[e].delayTime.value!==t&&G[e].delayTime.setValueAtTime(t,o),G[e].feedback.value!==n&&G[e].feedback.setValueAtTime(n,o),G[e]}function sn(e,t,n=1,o=.5,s=1e3,a=2e3){const r=y(),i=r.createGain();i.gain.value=a*2,E(r,"lfo-processor",{frequency:n,depth:1,skew:0,phaseoffset:0,time:e,end:t,shape:1,dcoffset:-.5}).connect(i);const l=2;let u=0;const h=[];for(let f=0;f<l;f++){const d=r.createBiquadFilter();d.type="notch",d.gain.value=1,d.frequency.value=s+u,d.Q.value=2-Math.min(Math.max(o*2,0),1.9),i.connect(d.detune),u+=282,f>0&&h[f-1].connect(d),h.push(d)}return h[h.length-1]}function an(e){e=e??0;const t=["12db","ladder","24db"];return typeof e=="number"?t[Math.floor(He(e,t.length))]:e}let x={},K=(e,t)=>e!==void 0&&e!==t;function rn(e,t,n,o,s,a){if(!x[e]){const i=y().createReverb(t,n,o,s,a);me(i,[0,1]),x[e]=i}return(K(t,x[e].duration)||K(n,x[e].fade)||K(o,x[e].lp)||K(s,x[e].dim)||x[e].ir!==a)&&x[e].generate(t,n,o,s,a),x[e]}let A={},j={};function cn(e,t=1024){if(!A[e]){const n=y().createAnalyser();n.fftSize=t,A[e]=n,j[e]=new Float32Array(A[e].frequencyBinCount)}return A[e].fftSize!==t&&(A[e].fftSize=t,j[e]=new Float32Array(A[e].frequencyBinCount)),A[e]}function et(e="time",t=1){const n={time:()=>A[t]?.getFloatTimeDomainData(j[t]),frequency:()=>A[t]?.getFloatFrequencyData(j[t])}[e];if(!n)throw new Error(`getAnalyzerData: ${e} not supported. use one of ${Object.keys(n).join(", ")}`);return n(),j[t]}function ue(e,t,n){const o=Qe(n);return e.connect(o),o.connect(t),o}function Gn(){G={},x={},A={},j={}}const ye=async(e,t,n)=>{t=typeof t=="string"&&t.startsWith("=")?Number(t.slice(1)):s.currentTime+t;let{stretch:o}=e;o!=null&&(t=t-.04);const s=y();if(typeof e!="object")throw new Error(`expected hap.value to be an object, but got "${e}". Hint: append .note() or .s() to the end`,"error");if(e.duration=n,t<s.currentTime){console.warn(`[superdough]: cannot schedule sounds in the past (target: ${t.toFixed(2)}, now: ${s.currentTime.toFixed(2)})`);return}let{s:a=q("s"),bank:r,source:i,gain:c=q("gain"),postgain:l=q("postgain"),density:u=q("density"),fanchor:h=q("fanchor"),drive:f=.69,cutoff:d,lpenv:p,lpattack:m,lpdecay:w,lpsustain:v,lprelease:b,resonance:C=q("resonance"),hpenv:k,hcutoff:M,hpattack:S,hpdecay:F,hpsustain:$,hprelease:R,hresonance:V=q("hresonance"),bpenv:te,bandf:ne,bpattack:I,bpdecay:N,bpsustain:ve,bprelease:at,bandq:rt=q("bandq"),channels:z=q("channels"),phaserrate:we,phaserdepth:be=q("phaserdepth"),phasersweep:it,phasercenter:ct,coarse:Te,crush:qe,shape:Ce,shapevol:lt=q("shapevol"),distort:Ae,distortvol:ut=q("distortvol"),pan:Se,vowel:xe,delay:ke=q("delay"),delayfeedback:$e=q("delayfeedback"),delaytime:Re=q("delaytime"),orbit:Be=q("orbit"),room:De,roomfade:dt,roomlp:ft,roomdim:ht,roomsize:pt,ir:oe,i:Ge=q("i"),velocity:gt=q("velocity"),analyze:Me,fft:mt=q("fft"),compressor:Oe,compressorRatio:yt,compressorKnee:vt,compressorAttack:wt,compressorRelease:bt}=e;c=B(c,1),z=(Array.isArray(z)?z:[z]).map(g=>g-1),c*=gt;let Ee=[];const Tt=()=>{Ee.forEach(g=>g?.disconnect())};r&&a&&(a=`${r}_${a}`,e.s=a);let H;if(i)H=i(t,e,n);else if(ie(a)){const{onTrigger:g}=ie(a),O=await g(t,e,Tt);O&&(H=O.node,O.stop(t+n))}else throw new Error(`sound ${a} not found! Is it loaded?`);if(!H)return;if(s.currentTime>t){D("[webaudio] skip hap: still loading",s.currentTime-t);return}const T=[];T.push(H),o!==void 0&&T.push(E(s,"phase-vocoder-processor",{pitchFactor:o})),T.push(Qe(c));const Q=an(e.ftype);if(d!==void 0){let g=()=>ae(s,"lowpass",d,C,m,w,v,b,p,t,t+n,h,Q,f);T.push(g()),Q==="24db"&&T.push(g())}if(M!==void 0){let g=()=>ae(s,"highpass",M,V,S,F,$,R,k,t,t+n,h);T.push(g()),Q==="24db"&&T.push(g())}if(ne!==void 0){let g=()=>ae(s,"bandpass",ne,rt,I,N,ve,at,te,t,t+n,h);T.push(g()),Q==="24db"&&T.push(g())}if(xe!==void 0){const g=s.createVowelFilter(xe);T.push(g)}if(Te!==void 0&&T.push(E(s,"coarse-processor",{coarse:Te})),qe!==void 0&&T.push(E(s,"crush-processor",{crush:qe})),Ce!==void 0&&T.push(E(s,"shape-processor",{shape:Ce,postgain:lt})),Ae!==void 0&&T.push(E(s,"distort-processor",{distort:Ae,postgain:ut})),Oe!==void 0&&T.push(Ft(s,Oe,yt,vt,wt,bt)),Se!==void 0){const g=s.createStereoPanner();g.pan.value=2*Se-1,T.push(g)}if(we!==void 0&&be>0){const g=sn(t,t+n,we,be,ct,it);T.push(g)}const L=new GainNode(s,{gain:l});T.push(L),me(L,z);let Fe;if(ke>0&&Re>0&&$e>0){const g=on(Be,Re,$e,t);Fe=ue(L,g,ke)}let Ne;if(De>0){let g;if(oe!==void 0){let se,W=ie(oe);Array.isArray(W)?se=W.data.samples[Ge%W.data.samples.length]:typeof W=="object"&&(se=Object.values(W.data.samples).flat()[Ge%Object.values(W.data.samples).length]),g=await Ke(se,s,oe,0)}const O=rn(Be,pt,dt,ft,ht,g);Ne=ue(L,O,De)}let We;if(Me){const g=cn(Me,2**(mt+5));We=ue(L,g,1)}T.slice(1).reduce((g,O)=>g.connect(O),T[0]),Ee=T.concat([Fe,Ne,We])},Mn=(e,t,n,o)=>{ye(t,e-n,t.duration/o)};let P;async function ln(e,t){const n=`dsp-worklet-${Date.now()}`,o=`${t}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${n}', MyProcessor);
`,a=`data:text/javascript;base64,${btoa(o)}`;await e.audioWorklet.addModule(a);const r=new AudioWorkletNode(e,n);return{node:r,stop:()=>r.port.postMessage("stop")}}const tt=()=>{P&&(P?.stop(),P?.node?.disconnect())};typeof window<"u"&&window.addEventListener("message",e=>{e.data==="strudel-stop"?tt():e.data?.dough&&P?.node.port.postMessage(e.data)});const On=async e=>{const t=y();tt(),P=await ln(t,e),P.node.connect(t.destination)};function un(e,t,n,o,s){window.postMessage({time:s,dough:t.value,currentTime:n,duration:t.duration,cps:o})}const{Pattern:nt,logger:dn,repl:fn}=qt;Rt(dn);const ot=e=>(e.ensureObjectValue(),e.value),hn=(e,t,n,o)=>ye(ot(t),e-n,t.duration/o),pn=(e,t,n,o,s)=>ye(ot(e),s?`=${s}`:t,n);nt.prototype.webaudio=function(){return this.onTrigger(hn)};function En(e={}){return e={getTime:()=>y().currentTime,defaultOutput:pn,...e},fn(e)}nt.prototype.dough=function(){return this.onTrigger(un,1)};function gn(e,{align:t=!0,color:n="white",thickness:o=3,scale:s=.25,pos:a=.75,trigger:r=0,ctx:i=de(),id:c=1}={}){i.lineWidth=o,i.strokeStyle=n;let l=i.canvas;if(!e){i.beginPath();let m=a*l.height;i.moveTo(0,m),i.lineTo(l.width,m),i.stroke();return}const u=et("time",c);i.beginPath();const h=e.frequencyBinCount;let f=t?Array.from(u).findIndex((m,w,v)=>w&&v[w-1]>-r&&m<=-r):0;f=Math.max(f,0);const d=l.width*1/h;let p=0;for(let m=f;m<h;m++){const w=u[m]+1,v=(a-s*(w-1))*l.height;m===0?i.moveTo(p,v):i.lineTo(p,v),p+=d}i.stroke()}function mn(e,{color:t="white",scale:n=.25,pos:o=.75,lean:s=.5,min:a=-150,max:r=0,ctx:i=de(),id:c=1}={}){if(!e){i.beginPath();let p=o*u.height;i.moveTo(0,p),i.lineTo(u.width,p),i.stroke();return}const l=et("frequency",c),u=i.canvas;i.fillStyle=t;const h=e.frequencyBinCount,f=u.width*1/h;let d=0;for(let p=0;p<h;p++){const w=Ct((l[p]-a)/(r-a),0,1)*n,v=w*u.height,b=(o-w*s)*u.height;i.fillRect(d,b,Math.max(f,1),v),d+=f}}function st(e=0,t="0,0,0",n=de()){e?(n.fillStyle=`rgba(${t},${1-e})`,n.fillRect(0,0,n.canvas.width,n.canvas.height)):n.clearRect(0,0,n.canvas.width,n.canvas.height)}X.prototype.fscope=function(e={}){let t=e.id??1;return this.analyze(t).draw(()=>{st(e.smear,"0,0,0",e.ctx),A[t]&&mn(A[t],e)},{id:t})};X.prototype.tscope=function(e={}){let t=e.id??1;return this.analyze(t).draw(n=>{e.color=n[0]?.value?.color||St().foreground,e.color,st(e.smear,"0,0,0",e.ctx),gn(A[t],e)},{id:t})};X.prototype.scope=X.prototype.tscope;export{ae as $,kn as A,Ut as B,nn as C,hn as D,En as E,gn as F,mn as G,ie as H,Ue as I,q as J,xn as K,Jt as L,tn as M,Dn as N,A as O,j as P,cn as Q,et as R,ye as S,Mn as T,Cn as U,zt as V,Lt as W,It as X,Ht as Y,An as Z,Ft as _,ee as a,D as a0,Rt as a1,ln as a2,On as a3,un as a4,U as b,_t as c,Wt as d,me as e,Rn as f,y as g,Gn as h,Bn as i,$n as j,bn as k,Qe as l,E as m,qn as n,Tn as o,Ie as p,Y as q,Zt as r,pe as s,wn as t,Sn as u,Qt as v,pn as w,Yt as x,Ke as y,Xt as z};
//# sourceMappingURL=scope.Dtq5cmHt.js.map
