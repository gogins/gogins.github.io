import{b2 as Le,b3 as J,A as De,b4 as Ie,b5 as Ct,b6 as Oe,b7 as xt,b8 as Et,b9 as Ne,ba as Q,bb as Ft,bc as jt}from"./settings.ea7ba944.js";function Pt(a,c){function r(){this.constructor=a}r.prototype=c.prototype,a.prototype=new r}function I(a,c,r,h){var m=Error.call(this,a);return Object.setPrototypeOf&&Object.setPrototypeOf(m,I.prototype),m.expected=c,m.found=r,m.location=h,m.name="SyntaxError",m}Pt(I,Error);function K(a,c,r){return r=r||" ",a.length>c?a:(c-=a.length,r+=r.repeat(c),a+r.slice(0,c))}I.prototype.format=function(a){var c="Error: "+this.message;if(this.location){var r=null,h;for(h=0;h<a.length;h++)if(a[h].source===this.location.source){r=a[h].text.split(/\r\n|\n|\r/g);break}var m=this.location.start,_=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(m):m,A=this.location.source+":"+_.line+":"+_.column;if(r){var w=this.location.end,b=K("",_.line.toString().length," "),p=r[m.line-1],g=m.line===w.line?w.column:p.length+1,y=g-m.column||1;c+=`
 --> `+A+`
`+b+` |
`+_.line+" | "+p+`
`+b+" | "+K("",m.column-1," ")+K("",y,"^")}else c+=`
 at `+A}return c};I.buildMessage=function(a,c){var r={literal:function(p){return'"'+m(p.text)+'"'},class:function(p){var g=p.parts.map(function(y){return Array.isArray(y)?_(y[0])+"-"+_(y[1]):_(y)});return"["+(p.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function h(p){return p.charCodeAt(0).toString(16).toUpperCase()}function m(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+h(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+h(g)})}function _(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+h(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+h(g)})}function A(p){return r[p.type](p)}function w(p){var g=p.map(A),y,C;if(g.sort(),g.length>0){for(y=1,C=1;y<g.length;y++)g[y-1]!==g[y]&&(g[C]=g[y],C++);g.length=C}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function b(p){return p?'"'+m(p)+'"':"end of input"}return"Expected "+w(a)+" but "+b(c)+" found."};function St(a,c){c=c!==void 0?c:{};var r={},h=c.grammarSource,m={start:xe},_=xe,A=".",w="-",b="+",p="0",g=",",y="|",C='"',ze="'",Me="#",We="^",Ze="_",V="[",Y="]",Ge="{",Ue="}",Xe="%",He="<",Je=">",Ke="@",Qe="!",Ve="(",Ye=")",er="/",rr="*",sr="?",tr=":",ee="struct",re="target",se="euclid",te="slow",ne="rotL",ae="rotR",ie="fast",fe="scale",oe="//",ce="cat",nr="$",le="setcps",ue="setbpm",pe="hush",ar=/^[1-9]/,ir=/^[eE]/,fr=/^[0-9]/,ge=/^[ \n\r\t]/,or=/^[0-9a-zA-Z~]/,ve=/^[^\n]/,cr=be("number"),$e=$(".",!1),lr=P([["1","9"]],!1,!1),ur=P(["e","E"],!1,!1),he=$("-",!1),pr=$("+",!1),gr=$("0",!1),vr=P([["0","9"]],!1,!1),$r=be("whitespace"),me=P([" ",`
`,"\r","	"],!1,!1),hr=$(",",!1),mr=$("|",!1),_r=$('"',!1),dr=$("'",!1),wr=P([["0","9"],["a","z"],["A","Z"],"~"],!1,!1),yr=$("#",!1),Ar=$("^",!1),br=$("_",!1),_e=$("[",!1),de=$("]",!1),Cr=$("{",!1),xr=$("}",!1),Er=$("%",!1),Fr=$("<",!1),jr=$(">",!1),Pr=$("@",!1),Sr=$("!",!1),kr=$("(",!1),Rr=$(")",!1),Lr=$("/",!1),Dr=$("*",!1),Ir=$("?",!1),Or=$(":",!1),Nr=$("struct",!1),qr=$("target",!1),Tr=$("euclid",!1),Br=$("slow",!1),zr=$("rotL",!1),Mr=$("rotR",!1),Wr=$("fast",!1),Zr=$("scale",!1),Gr=$("//",!1),we=P([`
`],!0,!1),Ur=$("cat",!1),Xr=$("$",!1),Hr=$("setcps",!1),Jr=$("setbpm",!1),Kr=$("hush",!1),Qr=function(){return parseFloat(Ls())},Vr=function(e){return new yt(e.join(""))},Yr=function(e){return e},es=function(e,s){return e.arguments_.stepsPerCycle=s,e},rs=function(e){return e},ss=function(e){return e.arguments_.alignment="slowcat",e},ts=function(e){return s=>s.options_.weight=e},ns=function(e){return s=>s.options_.reps=e},as=function(e,s,n){return i=>i.options_.ops.push({type_:"bjorklund",arguments_:{pulse:e,step:s,rotation:n}})},is=function(e){return s=>s.options_.ops.push({type_:"stretch",arguments_:{amount:e,type:"slow"}})},fs=function(e){return s=>s.options_.ops.push({type_:"stretch",arguments_:{amount:e,type:"fast"}})},os=function(e){return s=>s.options_.ops.push({type_:"degradeBy",arguments_:{amount:e,seed:Re++}})},cs=function(e){return s=>s.options_.ops.push({type_:"tail",arguments_:{element:e}})},ls=function(e,s){const n=new bt(e,{ops:[],weight:1,reps:1});for(const i of s)i(n);return n},us=function(e){return new W(e,"fastcat")},ps=function(e){return{alignment:"stack",list:e}},gs=function(e){return{alignment:"rand",list:e,seed:Re++}},vs=function(e,s){return s&&s.list.length>0?new W([e,...s.list],s.alignment,s.seed):e},$s=function(e,s){return new W(s?[e,...s.list]:[e],"polymeter")},hs=function(e){return e},ms=function(e){return{name:"struct",args:{mini:e}}},_s=function(e){return{name:"target",args:{name:e}}},ds=function(e,s,n){return{name:"bjorklund",args:{pulse:e,step:parseInt(s)}}},ws=function(e){return{name:"stretch",args:{amount:e}}},ys=function(e){return{name:"shift",args:{amount:"-"+e}}},As=function(e){return{name:"shift",args:{amount:e}}},bs=function(e){return{name:"stretch",args:{amount:"1/"+e}}},Cs=function(e){return{name:"scale",args:{scale:e.join("")}}},ye=function(e,s){return s},xs=function(e,s){return s.unshift(e),new W(s,"slowcat")},Es=function(e){return e},Fs=function(e,s){return new At(e.name,e.args,s)},js=function(e){return e},Ps=function(e){return e},Ss=function(e){return new H("setcps",{value:e})},ks=function(e){return new H("setcps",{value:e/120/2})},Rs=function(){return new H("hush")},t=0,v=0,T=[{line:1,column:1}],E=0,G=[],f=0,B;if("startRule"in c){if(!(c.startRule in m))throw new Error(`Can't start parsing from rule "`+c.startRule+'".');_=m[c.startRule]}function Ls(){return a.substring(v,t)}function Ae(){return U(v,t)}function $(e,s){return{type:"literal",text:e,ignoreCase:s}}function P(e,s,n){return{type:"class",parts:e,inverted:s,ignoreCase:n}}function Ds(){return{type:"end"}}function be(e){return{type:"other",description:e}}function Ce(e){var s=T[e],n;if(s)return s;for(n=e-1;!T[n];)n--;for(s=T[n],s={line:s.line,column:s.column};n<e;)a.charCodeAt(n)===10?(s.line++,s.column=1):s.column++,n++;return T[e]=s,s}function U(e,s,n){var i=Ce(e),l=Ce(s),d={source:h,start:{offset:e,line:i.line,column:i.column},end:{offset:s,line:l.line,column:l.column}};return n&&h&&typeof h.offset=="function"&&(d.start=h.offset(d.start),d.end=h.offset(d.end)),d}function o(e){t<E||(t>E&&(E=t,G=[]),G.push(e))}function Is(e,s,n){return new I(I.buildMessage(e,s),e,s,n)}function xe(){var e;return e=wt(),e}function F(){var e,s;return f++,e=t,Ee(),s=z(),s!==r?(Bs(),Ts(),v=e,e=Qr()):(t=e,e=r),f--,e===r&&f===0&&o(cr),e}function Os(){var e;return a.charCodeAt(t)===46?(e=A,t++):(e=r,f===0&&o($e)),e}function Ns(){var e;return ar.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(lr)),e}function qs(){var e;return ir.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(ur)),e}function Ts(){var e,s,n,i,l;if(e=t,s=qs(),s!==r){if(n=Ee(),n===r&&(n=zs()),n===r&&(n=null),i=[],l=S(),l!==r)for(;l!==r;)i.push(l),l=S();else i=r;i!==r?(s=[s,n,i],e=s):(t=e,e=r)}else t=e,e=r;return e}function Bs(){var e,s,n,i;if(e=t,s=Os(),s!==r){if(n=[],i=S(),i!==r)for(;i!==r;)n.push(i),i=S();else n=r;n!==r?(s=[s,n],e=s):(t=e,e=r)}else t=e,e=r;return e}function z(){var e,s,n,i;if(e=Ms(),e===r)if(e=t,s=Ns(),s!==r){for(n=[],i=S();i!==r;)n.push(i),i=S();s=[s,n],e=s}else t=e,e=r;return e}function Ee(){var e;return a.charCodeAt(t)===45?(e=w,t++):(e=r,f===0&&o(he)),e}function zs(){var e;return a.charCodeAt(t)===43?(e=b,t++):(e=r,f===0&&o(pr)),e}function Ms(){var e;return a.charCodeAt(t)===48?(e=p,t++):(e=r,f===0&&o(gr)),e}function S(){var e;return fr.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(vr)),e}function u(){var e,s;for(f++,e=[],ge.test(a.charAt(t))?(s=a.charAt(t),t++):(s=r,f===0&&o(me));s!==r;)e.push(s),ge.test(a.charAt(t))?(s=a.charAt(t),t++):(s=r,f===0&&o(me));return f--,s=r,f===0&&o($r),e}function k(){var e,s,n,i;return e=t,s=u(),a.charCodeAt(t)===44?(n=g,t++):(n=r,f===0&&o(hr)),n!==r?(i=u(),s=[s,n,i],e=s):(t=e,e=r),e}function Fe(){var e,s,n,i;return e=t,s=u(),a.charCodeAt(t)===124?(n=y,t++):(n=r,f===0&&o(mr)),n!==r?(i=u(),s=[s,n,i],e=s):(t=e,e=r),e}function R(){var e;return a.charCodeAt(t)===34?(e=C,t++):(e=r,f===0&&o(_r)),e===r&&(a.charCodeAt(t)===39?(e=ze,t++):(e=r,f===0&&o(dr))),e}function M(){var e;return or.test(a.charAt(t))?(e=a.charAt(t),t++):(e=r,f===0&&o(wr)),e===r&&(a.charCodeAt(t)===45?(e=w,t++):(e=r,f===0&&o(he)),e===r&&(a.charCodeAt(t)===35?(e=Me,t++):(e=r,f===0&&o(yr)),e===r&&(a.charCodeAt(t)===46?(e=A,t++):(e=r,f===0&&o($e)),e===r&&(a.charCodeAt(t)===94?(e=We,t++):(e=r,f===0&&o(Ar)),e===r&&(a.charCodeAt(t)===95?(e=Ze,t++):(e=r,f===0&&o(br))))))),e}function je(){var e,s,n;if(e=t,u(),s=[],n=M(),n!==r)for(;n!==r;)s.push(n),n=M();else s=r;return s!==r?(n=u(),v=e,e=Vr(s)):(t=e,e=r),e}function Ws(){var e,s,n,i;return e=t,u(),a.charCodeAt(t)===91?(s=V,t++):(s=r,f===0&&o(_e)),s!==r?(u(),n=ke(),n!==r?(u(),a.charCodeAt(t)===93?(i=Y,t++):(i=r,f===0&&o(de)),i!==r?(u(),v=e,e=Yr(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Zs(){var e,s,n,i,l;return e=t,u(),a.charCodeAt(t)===123?(s=Ge,t++):(s=r,f===0&&o(Cr)),s!==r?(u(),n=rt(),n!==r?(u(),a.charCodeAt(t)===125?(i=Ue,t++):(i=r,f===0&&o(xr)),i!==r?(l=Gs(),l===r&&(l=null),u(),v=e,e=es(n,l)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Gs(){var e,s,n;return e=t,a.charCodeAt(t)===37?(s=Xe,t++):(s=r,f===0&&o(Er)),s!==r?(n=O(),n!==r?(v=e,e=rs(n)):(t=e,e=r)):(t=e,e=r),e}function Us(){var e,s,n,i;return e=t,u(),a.charCodeAt(t)===60?(s=He,t++):(s=r,f===0&&o(Fr)),s!==r?(u(),n=j(),n!==r?(u(),a.charCodeAt(t)===62?(i=Je,t++):(i=r,f===0&&o(jr)),i!==r?(u(),v=e,e=ss(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function O(){var e;return e=je(),e===r&&(e=Ws(),e===r&&(e=Zs(),e===r&&(e=Us()))),e}function Pe(){var e;return e=Xs(),e===r&&(e=Js(),e===r&&(e=Ks(),e===r&&(e=Qs(),e===r&&(e=Hs(),e===r&&(e=Vs(),e===r&&(e=Ys())))))),e}function Xs(){var e,s,n;return e=t,a.charCodeAt(t)===64?(s=Ke,t++):(s=r,f===0&&o(Pr)),s!==r?(n=F(),n!==r?(v=e,e=ts(n)):(t=e,e=r)):(t=e,e=r),e}function Hs(){var e,s,n;return e=t,a.charCodeAt(t)===33?(s=Qe,t++):(s=r,f===0&&o(Sr)),s!==r?(n=F(),n!==r?(v=e,e=ns(n)):(t=e,e=r)):(t=e,e=r),e}function Js(){var e,s,n,i,l,d,x;return e=t,a.charCodeAt(t)===40?(s=Ve,t++):(s=r,f===0&&o(kr)),s!==r?(u(),n=N(),n!==r?(u(),i=k(),i!==r?(u(),l=N(),l!==r?(u(),k(),u(),d=N(),d===r&&(d=null),u(),a.charCodeAt(t)===41?(x=Ye,t++):(x=r,f===0&&o(Rr)),x!==r?(v=e,e=as(n,l,d)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function Ks(){var e,s,n;return e=t,a.charCodeAt(t)===47?(s=er,t++):(s=r,f===0&&o(Lr)),s!==r?(n=O(),n!==r?(v=e,e=is(n)):(t=e,e=r)):(t=e,e=r),e}function Qs(){var e,s,n;return e=t,a.charCodeAt(t)===42?(s=rr,t++):(s=r,f===0&&o(Dr)),s!==r?(n=O(),n!==r?(v=e,e=fs(n)):(t=e,e=r)):(t=e,e=r),e}function Vs(){var e,s,n;return e=t,a.charCodeAt(t)===63?(s=sr,t++):(s=r,f===0&&o(Ir)),s!==r?(n=F(),n===r&&(n=null),v=e,e=os(n)):(t=e,e=r),e}function Ys(){var e,s,n;return e=t,a.charCodeAt(t)===58?(s=tr,t++):(s=r,f===0&&o(Or)),s!==r?(n=O(),n!==r?(v=e,e=cs(n)):(t=e,e=r)):(t=e,e=r),e}function N(){var e,s,n,i;if(e=t,s=O(),s!==r){for(n=[],i=Pe();i!==r;)n.push(i),i=Pe();v=e,e=ls(s,n)}else t=e,e=r;return e}function j(){var e,s,n;if(e=t,s=[],n=N(),n!==r)for(;n!==r;)s.push(n),n=N();else s=r;return s!==r&&(v=e,s=us(s)),e=s,e}function Se(){var e,s,n,i,l;if(e=t,s=[],n=t,i=k(),i!==r?(l=j(),l!==r?n=l:(t=n,n=r)):(t=n,n=r),n!==r)for(;n!==r;)s.push(n),n=t,i=k(),i!==r?(l=j(),l!==r?n=l:(t=n,n=r)):(t=n,n=r);else s=r;return s!==r&&(v=e,s=ps(s)),e=s,e}function et(){var e,s,n,i,l;if(e=t,s=[],n=t,i=Fe(),i!==r?(l=j(),l!==r?n=l:(t=n,n=r)):(t=n,n=r),n!==r)for(;n!==r;)s.push(n),n=t,i=Fe(),i!==r?(l=j(),l!==r?n=l:(t=n,n=r)):(t=n,n=r);else s=r;return s!==r&&(v=e,s=gs(s)),e=s,e}function ke(){var e,s,n;return e=t,s=j(),s!==r?(n=Se(),n===r&&(n=et()),n===r&&(n=null),v=e,e=vs(s,n)):(t=e,e=r),e}function rt(){var e,s,n;return e=t,s=j(),s!==r?(n=Se(),n===r&&(n=null),v=e,e=$s(s,n)):(t=e,e=r),e}function st(){var e,s,n,i;return e=t,u(),s=R(),s!==r?(u(),n=ke(),n!==r?(u(),i=R(),i!==r?(v=e,e=hs(n)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function tt(){var e;return e=ut(),e===r&&(e=ft(),e===r&&(e=lt(),e===r&&(e=at(),e===r&&(e=it(),e===r&&(e=nt(),e===r&&(e=ct(),e===r&&(e=ot()))))))),e}function nt(){var e,s,n;return e=t,a.substr(t,6)===ee?(s=ee,t+=6):(s=r,f===0&&o(Nr)),s!==r?(u(),n=L(),n!==r?(v=e,e=ms(n)):(t=e,e=r)):(t=e,e=r),e}function at(){var e,s,n,i,l;return e=t,a.substr(t,6)===re?(s=re,t+=6):(s=r,f===0&&o(qr)),s!==r?(u(),n=R(),n!==r?(i=je(),i!==r?(l=R(),l!==r?(v=e,e=_s(i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function it(){var e,s,n,i;return e=t,a.substr(t,6)===se?(s=se,t+=6):(s=r,f===0&&o(Tr)),s!==r?(u(),n=z(),n!==r?(u(),i=z(),i!==r?(u(),z(),v=e,e=ds(n,i)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r),e}function ft(){var e,s,n;return e=t,a.substr(t,4)===te?(s=te,t+=4):(s=r,f===0&&o(Br)),s!==r?(u(),n=F(),n!==r?(v=e,e=ws(n)):(t=e,e=r)):(t=e,e=r),e}function ot(){var e,s,n;return e=t,a.substr(t,4)===ne?(s=ne,t+=4):(s=r,f===0&&o(zr)),s!==r?(u(),n=F(),n!==r?(v=e,e=ys(n)):(t=e,e=r)):(t=e,e=r),e}function ct(){var e,s,n;return e=t,a.substr(t,4)===ae?(s=ae,t+=4):(s=r,f===0&&o(Mr)),s!==r?(u(),n=F(),n!==r?(v=e,e=As(n)):(t=e,e=r)):(t=e,e=r),e}function lt(){var e,s,n;return e=t,a.substr(t,4)===ie?(s=ie,t+=4):(s=r,f===0&&o(Wr)),s!==r?(u(),n=F(),n!==r?(v=e,e=bs(n)):(t=e,e=r)):(t=e,e=r),e}function ut(){var e,s,n,i,l;if(e=t,a.substr(t,5)===fe?(s=fe,t+=5):(s=r,f===0&&o(Zr)),s!==r)if(u(),n=R(),n!==r){if(i=[],l=M(),l!==r)for(;l!==r;)i.push(l),l=M();else i=r;i!==r?(l=R(),l!==r?(v=e,e=Cs(i)):(t=e,e=r)):(t=e,e=r)}else t=e,e=r;else t=e,e=r;return e}function X(){var e,s,n,i;if(e=t,a.substr(t,2)===oe?(s=oe,t+=2):(s=r,f===0&&o(Gr)),s!==r){for(n=[],ve.test(a.charAt(t))?(i=a.charAt(t),t++):(i=r,f===0&&o(we));i!==r;)n.push(i),ve.test(a.charAt(t))?(i=a.charAt(t),t++):(i=r,f===0&&o(we));s=[s,n],e=s}else t=e,e=r;return e}function pt(){var e,s,n,i,l,d,x,D;if(e=t,a.substr(t,3)===ce?(s=ce,t+=3):(s=r,f===0&&o(Ur)),s!==r)if(u(),a.charCodeAt(t)===91?(n=V,t++):(n=r,f===0&&o(_e)),n!==r)if(u(),i=L(),i!==r){for(l=[],d=t,x=k(),x!==r?(D=L(),D!==r?(v=d,d=ye(i,D)):(t=d,d=r)):(t=d,d=r);d!==r;)l.push(d),d=t,x=k(),x!==r?(D=L(),D!==r?(v=d,d=ye(i,D)):(t=d,d=r)):(t=d,d=r);d=u(),a.charCodeAt(t)===93?(x=Y,t++):(x=r,f===0&&o(de)),x!==r?(v=e,e=xs(i,l)):(t=e,e=r)}else t=e,e=r;else t=e,e=r;else t=e,e=r;return e}function gt(){var e;return e=pt(),e===r&&(e=st()),e}function L(){var e,s,n,i,l;if(e=t,s=gt(),s!==r){for(u(),n=[],i=X();i!==r;)n.push(i),i=X();v=e,e=Es(s)}else t=e,e=r;return e===r&&(e=t,s=tt(),s!==r?(u(),a.charCodeAt(t)===36?(n=nr,t++):(n=r,f===0&&o(Xr)),n!==r?(i=u(),l=L(),l!==r?(v=e,e=Fs(s,l)):(t=e,e=r)):(t=e,e=r)):(t=e,e=r)),e}function vt(){var e,s;return e=t,s=L(),s!==r&&(v=e,s=js(s)),e=s,e===r&&(e=X()),e}function $t(){var e;return e=vt(),e}function ht(){var e,s;return e=t,u(),s=mt(),s===r&&(s=_t(),s===r&&(s=dt())),s!==r?(u(),v=e,e=Ps(s)):(t=e,e=r),e}function mt(){var e,s,n;return e=t,a.substr(t,6)===le?(s=le,t+=6):(s=r,f===0&&o(Hr)),s!==r?(u(),n=F(),n!==r?(v=e,e=Ss(n)):(t=e,e=r)):(t=e,e=r),e}function _t(){var e,s,n;return e=t,a.substr(t,6)===ue?(s=ue,t+=6):(s=r,f===0&&o(Jr)),s!==r?(u(),n=F(),n!==r?(v=e,e=ks(n)):(t=e,e=r)):(t=e,e=r),e}function dt(){var e,s;return e=t,a.substr(t,4)===pe?(s=pe,t+=4):(s=r,f===0&&o(Kr)),s!==r&&(v=e,s=Rs()),e=s,e}function wt(){var e;return e=$t(),e===r&&(e=ht()),e}var yt=function(e){this.type_="atom",this.source_=e,this.location_=Ae()},W=function(e,s,n){this.type_="pattern",this.arguments_={alignment:s},n!==void 0&&(this.arguments_.seed=n),this.source_=e},At=function(e,s,n){this.type_=e,this.arguments_=s,this.source_=n},bt=function(e,s){this.type_="element",this.source_=e,this.options_=s,this.location_=Ae()},H=function(e,s){this.type_="command",this.name_=e,this.options_=s},Re=0;if(B=_(),B!==r&&t===a.length)return B;throw B!==r&&t<a.length&&o(Ds()),Is(G,E<a.length?a.charAt(E):null,E<a.length?U(E,E+1):U(E,E))}const qe=3e-4,kt=(a,c)=>(r,h)=>{const A=a.source_[h].options_?.ops;if(A)for(const w of A)switch(w.type_){case"stretch":{const b=["fast","slow"],{type:p,amount:g}=w.arguments_;if(!b.includes(p))throw new Error(`mini: stretch: type must be one of ${b.join("|")} but got ${p}`);r=Q(r)[p](c(g));break}case"bjorklund":{w.arguments_.rotation?r=r.euclidRot(c(w.arguments_.pulse),c(w.arguments_.step),c(w.arguments_.rotation)):r=r.euclid(c(w.arguments_.pulse),c(w.arguments_.step));break}case"degradeBy":{r=Q(r)._degradeByWith(Oe.early(qe*w.arguments_.seed),w.arguments_.amount??.5);break}case"tail":{const b=c(w.arguments_.element);r=r.fmap(p=>g=>Array.isArray(p)?[...p,g]:[p,g]).appLeft(b);break}default:console.warn(`operator "${w.type_}" not implemented`)}return r};function Rt(a){a.source_=Ft(a.source_.map(c=>{const{reps:r}=c.options_||{};return r?(delete c.options_.reps,Array(r).fill(c)):[c]}))}function q(a,c,r,h=0){r?.(a);const m=_=>q(_,c,r,h);switch(a.type_){case"pattern":{Rt(a);const _=a.source_.map(p=>m(p)).map(kt(a,m)),A=a.arguments_.alignment;if(A==="stack")return De(..._);if(A==="polymeter"){const p=a.arguments_.stepsPerCycle?m(a.arguments_.stepsPerCycle).fmap(y=>Ie(y)):J(Ie(_.length>0?_[0].__weight:1)),g=_.map(y=>y.fast(p.fmap(C=>C.div(y.__weight||1))));return De(...g)}if(A==="rand")return Ct(Oe.early(qe*a.arguments_.seed).segment(1),_);const w=a.source_.some(p=>!!p.options_?.weight);if(!w&&A==="slowcat")return xt(..._);if(w){const p=a.source_.reduce((y,C)=>y+(C.options_?.weight||1),0),g=Et(...a.source_.map((y,C)=>[y.options_?.weight||1,_[C]]));return A==="slowcat"?g._slow(p):(g.__weight=p,g)}const b=Ne(..._);return b.__weight=_.length,b}case"element":return m(a.source_);case"atom":{if(a.source_==="~")return Le;if(!a.location_)return console.warn("no location for",a),a.source_;const _=isNaN(Number(a.source_))?a.source_:Number(a.source_);if(h===-1)return J(_);const[A,w]=Te(c,a,h);return J(_).withLoc(A,w)}case"stretch":return m(a.source_).slow(m(a.arguments_.amount));default:return console.warn(`node type "${a.type_}" not implemented -> returning silence`),Le}}const Te=(a,c,r=0)=>{const{start:h,end:m}=c.location_,_=a?.split("").slice(h.offset,m.offset).join(""),[A=0,w=0]=_?_.split(c.source_).map(b=>b.split("").filter(p=>p===" ").length):[];return[h.offset+A+r,m.offset-w+r]},Z=a=>St(a),Lt=a=>{const c=Z(a);let r=[];return q(c,a,h=>{h.type_==="atom"&&r.push(h)},-1),r},It=(a,c=0)=>Lt(a).map(r=>Te(a,r,c)),Be=(...a)=>{const c=a.map(r=>{const h=`"${r}"`,m=Z(h);return q(m,h)});return Ne(...c)},Ot=(a,c)=>{const r=`"${a}"`,h=Z(r);return q(h,r,null,c)},Nt=a=>{const c=Z(a);return q(c,a)};function qt(a){return typeof a=="string"?Be(a):Q(a)}function Tt(){jt(Be)}export{Lt as a,It as b,Be as c,Ot as d,qt as e,Tt as f,Te as g,Nt as h,I as i,St as j,Z as m,q as p};
