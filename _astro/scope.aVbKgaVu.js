import{e as ft,s as ht,C as pt,h as Ct,P as _,g as fe,j as It}from"./index.diuTzW_X.js";if(typeof DelayNode<"u"){class e extends DelayNode{constructor(n,o,s,a){super(n),o=Math.abs(o),this.delayTime.value=s;const r=n.createGain();r.gain.value=Math.min(Math.abs(a),.995),this.feedback=r.gain;const c=n.createGain();return c.gain.value=o,this.delayGain=c,this.connect(r),this.connect(c),r.connect(this),this.connect=i=>c.connect(i),this}start(n){this.delayGain.gain.setValueAtTime(this.delayGain.gain.value,n+this.delayTime.value)}}AudioContext.prototype.createFeedbackDelay=function(t,n,o){return new e(this,t,n,o)}}var he={};he.generateReverb=function(e,t){for(var n=e.audioContext||new AudioContext,o=n.sampleRate,s=e.numChannels||2,a=e.decayTime*1.5,r=Math.round(e.decayTime*o),c=Math.round(a*o),i=Math.round((e.fadeInTime||0)*o),l=Math.pow(1/1e3,1/r),u=n.createBuffer(s,c,o),g=0;g<s;g++){for(var d=u.getChannelData(g),f=0;f<c;f++)d[f]=yt()*Math.pow(l,f);for(var f=0;f<i;f++)d[f]*=f/i}bt(u,e.lpFreqStart||0,e.lpFreqEnd||0,e.decayTime,t)};he.generateGraph=function(e,t,n,o,s){var a=document.createElement("canvas");a.width=t,a.height=n;var r=a.getContext("2d");r.fillStyle="#000",r.fillRect(0,0,a.width,a.height),r.fillStyle="#fff";for(var c=t/e.length,i=n/(s-o),l=0;l<e.length;l++)r.fillRect(l*c,n-(e[l]-o)*i,1,1);return a};var bt=function(e,t,n,o,s){if(t==0){s(e);return}var a=mt(e),r=new OfflineAudioContext(e.numberOfChannels,a[0].length,e.sampleRate),c=r.createBufferSource();c.buffer=e;var i=r.createBiquadFilter();t=Math.min(t,e.sampleRate/2),n=Math.min(n,e.sampleRate/2),i.type="lowpass",i.Q.value=1e-4,i.frequency.setValueAtTime(t,0),i.frequency.linearRampToValueAtTime(n,o),c.connect(i),i.connect(r.destination),c.start(),r.oncomplete=function(l){s(l.renderedBuffer)},r.startRendering(),window.filterNode=i},mt=function(e){for(var t=[],n=0;n<e.numberOfChannels;n++)t[n]=e.getChannelData(n);return t},yt=function(){return Math.random()*2-1};typeof AudioContext<"u"&&(AudioContext.prototype.adjustLength=function(e,t){const n=t.sampleRate*e,o=this.createBuffer(t.numberOfChannels,t.length,t.sampleRate);for(let s=0;s<t.numberOfChannels;s++){let a=t.getChannelData(s),r=o.getChannelData(s);for(let c=0;c<n;c++)r[c]=a[c]||0}return o},AudioContext.prototype.createReverb=function(e,t,n,o,s){const a=this.createConvolver();return a.generate=(r=2,c=.1,i=15e3,l=1e3,u)=>{a.duration=r,a.fade=c,a.lp=i,a.dim=l,a.ir=u,u?a.buffer=this.adjustLength(r,u):he.generateReverb({audioContext:this,numChannels:2,decayTime:r,fadeInTime:c,lpFreqStart:i,lpFreqEnd:l},g=>{a.buffer=g})},a.generate(e,t,n,o,s),a});var ze={a:{freqs:[660,1120,2750,3e3,3350],gains:[1,.5012,.0708,.0631,.0126],qs:[80,90,120,130,140]},e:{freqs:[440,1800,2700,3e3,3300],gains:[1,.1995,.1259,.1,.1],qs:[70,80,100,120,120]},i:{freqs:[270,1850,2900,3350,3590],gains:[1,.0631,.0631,.0158,.0158],qs:[40,90,100,120,120]},o:{freqs:[430,820,2700,3e3,3300],gains:[1,.3162,.0501,.0794,.01995],qs:[40,80,100,120,120]},u:{freqs:[370,630,2750,3e3,3400],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},ae:{freqs:[650,1515,2400,3e3,3350],gains:[1,.5,.1008,.0631,.0126],qs:[80,90,120,130,140]},aa:{freqs:[560,900,2570,3e3,3300],gains:[1,.5,.0708,.0631,.0126],qs:[80,90,120,130,140]},oe:{freqs:[500,1430,2300,3e3,3300],gains:[1,.2,.0708,.0316,.01995],qs:[40,60,100,120,120]},ue:{freqs:[250,1750,2150,3200,3300],gains:[1,.1,.0708,.0316,.01995],qs:[40,60,100,120,120]},y:{freqs:[400,1460,2400,3e3,3300],gains:[1,.2,.0708,.0316,.02995],qs:[40,60,100,120,120]},uh:{freqs:[600,1250,2100,3100,3500],gains:[1,.3,.0608,.0316,.01995],qs:[40,70,100,120,130]},un:{freqs:[500,1240,2280,3e3,3500],gains:[1,.1,.1708,.0216,.02995],qs:[40,60,100,120,120]},en:{freqs:[600,1480,2450,3200,3300],gains:[1,.15,.0708,.0316,.02995],qs:[40,60,100,120,120]},an:{freqs:[700,1050,2500,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},on:{freqs:[500,1080,2350,3e3,3300],gains:[1,.1,.0708,.0316,.02995],qs:[40,60,100,120,120]},get æ(){return this.ae},get ø(){return this.oe},get ɑ(){return this.aa},get å(){return this.aa},get ö(){return this.oe},get ü(){return this.ue},get ı(){return this.y}};if(typeof GainNode<"u"){class e extends GainNode{constructor(n,o){if(super(n),!ze[o])throw new Error("vowel: unknown vowel "+o);const{gains:s,qs:a,freqs:r}=ze[o],c=n.createGain();for(let i=0;i<5;i++){const l=n.createGain();l.gain.value=s[i];const u=n.createBiquadFilter();u.type="bandpass",u.Q.value=a[i],u.frequency.value=r[i],this.connect(u),u.connect(l),l.connect(c)}return c.gain.value=8,this.connect=i=>c.connect(i),this}}AudioContext.prototype.createVowelFilter=function(t){return new e(this,t)}}let ke=e=>console.log(e);const Z=(...e)=>ke(...e),At=e=>{ke=e},wt=e=>{if(typeof e!="string")return[];const[t,n="",o]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return t?[t,n,o?Number(o):void 0]:[]},Bt={c:0,d:2,e:4,f:5,g:7,a:9,b:11},vt={"#":1,b:-1,s:1,f:-1},Oe=(e,t=3)=>{const[n,o,s=t]=wt(e);if(!n)throw new Error('not a note: "'+e+'"');const a=Bt[n.toLowerCase()],r=o?.split("").reduce((c,i)=>c+vt[i],0)||0;return(Number(s)+1)*12+a+r},on=e=>Math.pow(2,(e-69)/12)*440,$=(e,t,n)=>Math.min(Math.max(e,t),n),Gt=e=>12*Math.log(e/440)/Math.LN2+69,Rt=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:o}=e;if(typeof n=="number")return Gt(n);if(typeof o=="string")return Oe(o);if(typeof o=="number")return o;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t};function R(e,t=0,n){return isNaN(Number(e))?(!n&&Z(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const Tt=(e,t)=>(e%t+t)%t,De=(e,t)=>Tt(Math.round(R(e,0)),t),Xt="data:application/javascript;base64,Ly8gTElDRU5TRSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSB2My4wIHNlZSBodHRwczovL2dpdGh1Yi5jb20vZGt0cjAvV2ViRGlydC9ibG9iL21haW4vTElDRU5TRQovLyBhbGwgdGhlIGNyZWRpdCBnb2VzIHRvIGRrdHIwJ3Mgd2ViZGlydDogaHR0cHM6Ly9naXRodWIuY29tL2RrdHIwL1dlYkRpcnQvYmxvYi81Y2UzZDY5ODM2MmM1NGQ2ZTFiNjhhY2M0N2ViMjk1NWFjNjJjNzkzL2Rpc3QvQXVkaW9Xb3JrbGV0cy5qcwovLyA8MwoKY2xhc3MgQ29hcnNlUHJvY2Vzc29yIGV4dGVuZHMgQXVkaW9Xb3JrbGV0UHJvY2Vzc29yIHsKICBzdGF0aWMgZ2V0IHBhcmFtZXRlckRlc2NyaXB0b3JzKCkgewogICAgcmV0dXJuIFt7IG5hbWU6ICdjb2Fyc2UnLCBkZWZhdWx0VmFsdWU6IDEgfV07CiAgfQoKICBjb25zdHJ1Y3RvcigpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLm5vdFN0YXJ0ZWQgPSB0cnVlOwogIH0KCiAgcHJvY2VzcyhpbnB1dHMsIG91dHB1dHMsIHBhcmFtZXRlcnMpIHsKICAgIGNvbnN0IGlucHV0ID0gaW5wdXRzWzBdOwogICAgY29uc3Qgb3V0cHV0ID0gb3V0cHV0c1swXTsKICAgIGNvbnN0IGNvYXJzZSA9IHBhcmFtZXRlcnMuY29hcnNlOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBvdXRwdXRbMF1bMF0gPSBpbnB1dFswXVswXTsKICAgICAgZm9yIChsZXQgbiA9IDE7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgIGZvciAobGV0IG8gPSAwOyBvIDwgb3V0cHV0Lmxlbmd0aDsgbysrKSB7CiAgICAgICAgICBvdXRwdXRbb11bbl0gPSBuICUgY29hcnNlID09IDAgPyBpbnB1dFswXVtuXSA6IG91dHB1dFtvXVtuIC0gMV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ2NvYXJzZS1wcm9jZXNzb3InLCBDb2Fyc2VQcm9jZXNzb3IpOwoKY2xhc3MgQ3J1c2hQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ2NydXNoJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBjcnVzaCA9IHBhcmFtZXRlcnMuY3J1c2g7CiAgICBjb25zdCBibG9ja1NpemUgPSAxMjg7CiAgICBjb25zdCBoYXNJbnB1dCA9ICEoaW5wdXRbMF0gPT09IHVuZGVmaW5lZCk7CiAgICBpZiAoaGFzSW5wdXQpIHsKICAgICAgdGhpcy5ub3RTdGFydGVkID0gZmFsc2U7CiAgICAgIGlmIChjcnVzaC5sZW5ndGggPT09IDEpIHsKICAgICAgICBjb25zdCB4ID0gTWF0aC5wb3coMiwgY3J1c2hbMF0gLSAxKTsKICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgICBjb25zdCB2YWx1ZSA9IE1hdGgucm91bmQoaW5wdXRbMF1bbl0gKiB4KSAvIHg7CiAgICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgICBvdXRwdXRbb11bbl0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBibG9ja1NpemU7IG4rKykgewogICAgICAgICAgbGV0IHggPSBNYXRoLnBvdygyLCBjcnVzaFtuXSAtIDEpOwogICAgICAgICAgY29uc3QgdmFsdWUgPSBNYXRoLnJvdW5kKGlucHV0WzBdW25dICogeCkgLyB4OwogICAgICAgICAgZm9yIChsZXQgbyA9IDA7IG8gPCBvdXRwdXQubGVuZ3RoOyBvKyspIHsKICAgICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQpyZWdpc3RlclByb2Nlc3NvcignY3J1c2gtcHJvY2Vzc29yJywgQ3J1c2hQcm9jZXNzb3IpOwoKY2xhc3MgU2hhcGVQcm9jZXNzb3IgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgcGFyYW1ldGVyRGVzY3JpcHRvcnMoKSB7CiAgICByZXR1cm4gW3sgbmFtZTogJ3NoYXBlJywgZGVmYXVsdFZhbHVlOiAwIH1dOwogIH0KCiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ub3RTdGFydGVkID0gdHJ1ZTsKICB9CgogIHByb2Nlc3MoaW5wdXRzLCBvdXRwdXRzLCBwYXJhbWV0ZXJzKSB7CiAgICBjb25zdCBpbnB1dCA9IGlucHV0c1swXTsKICAgIGNvbnN0IG91dHB1dCA9IG91dHB1dHNbMF07CiAgICBjb25zdCBzaGFwZTAgPSBwYXJhbWV0ZXJzLnNoYXBlWzBdOwogICAgY29uc3Qgc2hhcGUxID0gc2hhcGUwIDwgMSA/IHNoYXBlMCA6IDEuMCAtIDRlLTEwOwogICAgY29uc3Qgc2hhcGUgPSAoMi4wICogc2hhcGUxKSAvICgxLjAgLSBzaGFwZTEpOwogICAgY29uc3QgYmxvY2tTaXplID0gMTI4OwogICAgY29uc3QgaGFzSW5wdXQgPSAhKGlucHV0WzBdID09PSB1bmRlZmluZWQpOwogICAgaWYgKGhhc0lucHV0KSB7CiAgICAgIHRoaXMubm90U3RhcnRlZCA9IGZhbHNlOwogICAgICBmb3IgKGxldCBuID0gMDsgbiA8IGJsb2NrU2l6ZTsgbisrKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSAoKDEgKyBzaGFwZSkgKiBpbnB1dFswXVtuXSkgLyAoMSArIHNoYXBlICogTWF0aC5hYnMoaW5wdXRbMF1bbl0pKTsKICAgICAgICBmb3IgKGxldCBvID0gMDsgbyA8IG91dHB1dC5sZW5ndGg7IG8rKykgewogICAgICAgICAgb3V0cHV0W29dW25dID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5ub3RTdGFydGVkIHx8IGhhc0lucHV0OwogIH0KfQoKcmVnaXN0ZXJQcm9jZXNzb3IoJ3NoYXBlLXByb2Nlc3NvcicsIFNoYXBlUHJvY2Vzc29yKTsK";function je(e){const t=A().createGain();return t.gain.value=e,t}const Ke=(e,t,n,o)=>o-n===0?0:(t-e)/(o-n),pe=(e,t,n,o,s,a,r,c,i,l="exponential")=>{t=R(t),n=R(n),o=R(o),s=R(s);const u=l==="exponential"?"exponentialRampToValueAtTime":"linearRampToValueAtTime";l==="exponential"&&(a=a===0?.001:a,r=r===0?.001:r);const g=r-a,d=r,f=a+o*g,C=i-c,b=m=>{let p;if(t>m){let B=Ke(a,d,0,t);p=m*B+(a>d?a:0)}else p=(m-t)*Ke(d,f,0,n)+d;return l==="exponential"&&(p=p||.001),p};e.setValueAtTime(a,c),t>C?e[u](b(C),i):t+n>C?(e[u](b(t),c+t),e[u](b(C),i)):(e[u](b(t),c+t),e[u](b(t+n),c+t+n),e.setValueAtTime(f,i)),e[u](a,i+s)};function Vt(e,t,n,o,s,a){const r={threshold:t??-3,ratio:n??10,knee:o??10,attack:s??.005,release:a??.05};return new DynamicsCompressorNode(e,r)}const Ce=(e,t="linear",n)=>{const[r,c,i,l]=e;if(r==null&&c==null&&i==null&&l==null)return n??[.001,.001,1,.01];const u=i??(r!=null&&c==null||r==null&&c==null?1:.001);return[Math.max(r??0,.001),Math.max(c??0,.001),Math.min(u,1),Math.max(l??0,.01)]};function ie(e,t,n,o,s,a,r,c,i,l,u,g){const d="exponential",[f,C,b,m]=Ce([s,a,r,c],d,[.005,.14,0,.1]),p=e.createBiquadFilter();if(p.type=t,p.Q.value=o,p.frequency.value=n,(s??a??r??c??i)!==void 0){i=R(i,1,!0),g=R(g,0,!0);const T=Math.abs(i),X=T*g;let V=$(2**-X*n,0,2e4),W=$(2**(T-X)*n,0,2e4);return i<0&&([V,W]=[W,V]),pe(p.frequency,f,C,b,m,V,W,l,u,d),p}return p}let Ye=e=>e<.5?1:1-(e-.5)/.5;function an(e,t,n=0){const o=A();if(!n)return e;let s=o.createGain(),a=o.createGain();e.connect(s),t.connect(a),s.gain.value=Ye(n),a.gain.value=Ye(1-n);let r=o.createGain();return s.connect(r),a.connect(r),r}let Nt=["linear","exponential"];function Wt(e,t,n,o){if(!(t.pattack??t.pdecay??t.psustain??t.prelease??t.penv))return;const a=R(t.penv,1,!0),r=Nt[t.pcurve??0];let[c,i,l,u]=Ce([t.pattack,t.pdecay,t.psustain,t.prelease],r,[.2,.001,1,.001]),g=t.panchor??l;const d=a*100,f=0-d*g,C=d-d*g;pe(e,c,i,l,u,f,C,n,o,r)}function St(e,t,n){const{vibmod:o=.5,vib:s}=t;let a;if(s>0){a=A().createOscillator(),a.frequency.value=s;const r=A().createGain();return r.gain.value=o*100,a.connect(r),r.connect(e),a.start(n),a}}const Ie={},le={},sn=e=>Ie[e];function Ht(e,t){var n=t?1e3:1024;if(e<n)return e+" B";var o=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],s=-1;do e/=n,++s;while(e>=n);return e.toFixed(1)+" "+o[s]}const Zt=async(e,t,n,o,s,a,r)=>{let c=0;s!==void 0&&n!==void 0&&Z("[sampler] hap has note and freq. ignoring note","warning");let i=Rt({freq:s,note:n},36);c=i-36;const l=A();let u,g=0;if(Array.isArray(a))g=De(t,a.length),u=a[g];else{const b=p=>Oe(p)-i,m=Object.keys(a).filter(p=>!p.startsWith("_")).reduce((p,B,T)=>!p||Math.abs(b(B))<Math.abs(b(p))?B:p,null);c=-b(m),g=De(t,a[m].length),u=a[m][g]}r&&(u=await r(u));let d=await Qe(u,l,e,g);o<0&&(d=xt(d));const f=l.createBufferSource();f.buffer=d;const C=1*Math.pow(2,c/12);return f.playbackRate.value=C,f},Qe=(e,t,n,o=0)=>{const s=n?`sound "${n}:${o}"`:"sample";if(e=e.replace("#","%23"),!le[e]){Z(`[sampler] load ${s}..`,"load-sample",{url:e});const a=Date.now();le[e]=fetch(e).then(r=>r.arrayBuffer()).then(async r=>{const c=Date.now()-a,i=Ht(r.byteLength);Z(`[sampler] load ${s}... done! loaded ${i} in ${c}ms`,"loaded-sample",{url:e});const l=await t.decodeAudioData(r);return Ie[e]=l,l})}return le[e]};function xt(e){const t=A(),n=t.createBuffer(e.numberOfChannels,e.length,t.sampleRate);for(let o=0;o<e.numberOfChannels;o++)n.copyToChannel(e.getChannelData(o).slice().reverse(),o,o);return n}const rn=e=>Ie[e];function Je(e){if(e.startsWith("bubo:")){const[t,n]=e.split(":");e=`github:Bubobubobubobubo/dough-${n}`}return e}function Le(e,t=""){if(!e.startsWith("github:"))throw new Error('expected "github:" at the start of pseudoUrl');let[n,o]=e.split("github:");return o=o.endsWith("/")?o.slice(0,-1):o,o.split("/").length===2&&(o+="/main"),`https://raw.githubusercontent.com/${o}/${t}`}const Mt=(e,t,n=e._base||"")=>Object.entries(e).forEach(([o,s])=>{if(typeof s=="string"&&(s=[s]),typeof s!="object")throw new Error("wrong sample map format for "+o);n=s._base||n,n=Je(n),n.startsWith("github:")&&(n=Le(n,""));const a=r=>n+r;Array.isArray(s)?s=s.map(a):s=Object.fromEntries(Object.entries(s).map(([r,c])=>[r,(typeof c=="string"?[c]:c).map(a)])),t(o,s)});let Ee={};function cn(e,t){Ee[e]=t}function Ft(e){const t=Object.entries(Ee).find(([n])=>e.startsWith(n));if(t)return t[1]}const zt=async(e,t=e._base||"",n={})=>{if(typeof e=="string"){const a=Ft(e);if(a)return a(e);if(e=Je(e),e.startsWith("github:")&&(e=Le(e,"strudel.json")),e.startsWith("shabda:")){let[c,i]=e.split("shabda:");e=`https://shabda.ndre.gr/${i}.json?strudel=1`}if(e.startsWith("shabda/speech")){let[c,i]=e.split("shabda/speech");i=i.startsWith("/")?i.substring(1):i;let[l,u]=i.split(":"),g="f",d="en-GB";l&&([d,g]=l.split("/")),e=`https://shabda.ndre.gr/speech/${u}.json?gender=${g}&language=${d}&strudel=1'`}if(typeof fetch!="function")return;const r=e.split("/").slice(0,-1).join("/");return typeof fetch>"u"?void 0:fetch(e).then(c=>c.json()).then(c=>zt(c,t||c._base||r,n)).catch(c=>{throw console.error(c),new Error(`error loading "${e}"`)})}const{prebake:o,tag:s}=n;Mt(e,(a,r)=>Kt(a,(c,i,l)=>Dt(c,i,l,r),{type:"sample",samples:r,baseUrl:t,prebake:o,tag:s}),t)},qe=[];async function Dt(e,t,n,o,s){let{s:a,freq:r,unit:c,nudge:i=0,cut:l,loop:u,clip:g=void 0,n:d=0,note:f,speed:C=1,loopBegin:b=0,begin:m=0,loopEnd:p=1,end:B=1,duration:T}=t;if(C===0)return;u=a.startsWith("wt_")?1:t.loop;const X=A();let[V,W,te,J]=Ce([t.attack,t.decay,t.sustain,t.release]);const K=e+i,I=await Zt(a,d,f,C,r,o,s);let ne=St(I.detune,t,e);if(X.currentTime>e){Z(`[sampler] still loading sound "${a}:${d}"`,"highlight");return}if(!I){Z(`[sampler] could not load "${a}:${d}"`,"error");return}I.playbackRate.value=Math.abs(C)*I.playbackRate.value,c==="c"&&(I.playbackRate.value=I.playbackRate.value*I.buffer.duration*1);const x=m*I.buffer.duration;u&&(I.loop=!0,I.loopStart=b*I.buffer.duration-x,I.loopEnd=p*I.buffer.duration-x),I.start(K,x);const oe=X.createGain(),Y=I.connect(oe);if(g==null&&u==null&&t.release==null){const v=I.buffer.duration/I.playbackRate.value;T=(B-m)*v}let q=e+T;pe(Y.gain,V,W,te,J,0,1,e,q,"linear"),Wt(I.detune,t,e,q);const k=X.createGain();Y.connect(k),I.onended=function(){I.disconnect(),ne?.stop(),Y.disconnect(),k.disconnect(),n()};let ae=q+J+.01;I.stop(ae);const O={node:k,bufferSource:I,stop:(v,Ae)=>{}};if(l!==void 0){const v=qe[l];v&&(v.node.gain.setValueAtTime(1,K),v.node.gain.linearRampToValueAtTime(0,K+.01)),qe[l]=O}return O}const be=ft();function Kt(e,t,n={}){be.setKey(e,{onTrigger:t,data:n})}function ue(e){return be.get()[e]}const ln=()=>be.set({});let U;const Yt=()=>(U=new AudioContext,U),A=()=>U||Yt();let E;function qt(){return E||(E=A().audioWorklet.addModule(Xt),E)}function de(e,t,n){const o=new AudioWorkletNode(e,t);return Object.entries(n).forEach(([s,a])=>{o.parameters.get(s).value=a}),o}async function kt(e={}){const{disableWorklets:t=!1}=e;typeof window<"u"&&(await A().resume(),t?console.log("disableWorklets: AudioWorklet effects coarse, crush and shape are skipped!"):await qt().catch(n=>{console.warn("could not load AudioWorklet effects coarse, crush and shape",n)}))}async function un(e){return new Promise(t=>{document.addEventListener("click",async function n(){await kt(e),t(),document.removeEventListener("click",n)})})}let H={},ee,z;function Ot(){const e=A(),t=e.destination.maxChannelCount;e.destination.channelCount=t,ee=new ChannelMergerNode(e,{numberOfInputs:e.destination.channelCount}),z=new GainNode(e),ee.connect(z),z.connect(e.destination)}const me=(e,t=[0,1])=>{const n=A();ee==null&&Ot();const o=new StereoPannerNode(n);e.connect(o);const s=new ChannelSplitterNode(n,{numberOfOutputs:o.channelCount});o.connect(s),t.forEach((a,r)=>{s.connect(ee,r%o.channelCount,$(a,0,n.destination.channelCount-1))})},dn=()=>{z!=null&&(z.gain.linearRampToValueAtTime(0,A().currentTime+.01),z=null)};function jt(e,t,n,o){if(n=$(n,0,.98),!H[e]){const a=A().createFeedbackDelay(1,t,n);a.start?.(o),me(a,[0,1]),H[e]=a}return H[e].delayTime.value!==t&&H[e].delayTime.setValueAtTime(t,o),H[e].feedback.value!==n&&H[e].feedback.setValueAtTime(n,o),H[e]}const N={};function Qt(e,t,n=1,o=.5,s=1e3,a=2e3){const r=A(),c=r.createGain();c.gain.value=a,N[e]==null&&(N[e]=r.createOscillator(),N[e].frequency.value=n,N[e].type="sine",N[e].start()),N[e].connect(c),N[e].frequency.value!=n&&N[e].frequency.setValueAtTime(n,t);const i=2;let l=0;const u=[];for(let g=0;g<i;g++){const d=r.createBiquadFilter();d.type="notch",d.gain.value=1,d.frequency.value=s+l,d.Q.value=2-Math.min(Math.max(o*2,0),1.9),c.connect(d.detune),l+=282,g>0&&u[g-1].connect(d),u.push(d)}return u[u.length-1]}let G={},P=(e,t)=>e!==void 0&&e!==t;function Jt(e,t,n,o,s,a){if(!G[e]){const c=A().createReverb(t,n,o,s,a);me(c,[0,1]),G[e]=c}return(P(t,G[e].duration)||P(n,G[e].fade)||P(o,G[e].lp)||P(s,G[e].dim)||G[e].ir!==a)&&G[e].generate(t,n,o,s,a),G[e]}let w,Q;function Lt(e=2048){if(!w){const t=A().createAnalyser();t.fftSize=e,w=t,Q=new Float32Array(w.frequencyBinCount)}return w.fftSize!==e&&(w.fftSize=e,Q=new Float32Array(w.frequencyBinCount)),w}function Pe(e="time"){const t={time:()=>w?.getFloatTimeDomainData(Q),frequency:()=>w?.getFloatFrequencyData(Q)}[e];if(!t)throw new Error(`getAnalyzerData: ${e} not supported. use one of ${Object.keys(t).join(", ")}`);return t(),Q}function ge(e,t,n){const o=je(n);return e.connect(o),o.connect(t),o}const ye=async(e,t,n)=>{const o=A();if(typeof e!="object")throw new Error(`expected hap.value to be an object, but got "${e}". Hint: append .note() or .s() to the end`,"error");e.duration=n;let s=o.currentTime+t,{s:a="triangle",bank:r,source:c,gain:i=.8,postgain:l=1,density:u=.03,ftype:g="12db",fanchor:d=.5,cutoff:f,lpenv:C,lpattack:b,lpdecay:m,lpsustain:p,lprelease:B,resonance:T=1,hpenv:X,hcutoff:V,hpattack:W,hpdecay:te,hpsustain:J,hprelease:K,hresonance:I=1,bpenv:ne,bandf:x,bpattack:oe,bpdecay:Y,bpsustain:q,bprelease:k,bandq:ae=1,channels:M=[1,2],phaser:O,phaserdepth:v=.75,phasersweep:Ae,phasercenter:tt,coarse:we,crush:Be,shape:ve,pan:Ge,vowel:Re,delay:Te=0,delayfeedback:Xe=.5,delaytime:Ve=.25,orbit:se=1,room:Ne,roomfade:nt,roomlp:ot,roomdim:at,roomsize:st,ir:re,i:We=0,velocity:rt=1,analyze:Se,fft:ct=8,compressor:He,compressorRatio:it,compressorKnee:lt,compressorAttack:ut,compressorRelease:dt}=e;i=R(i,1),M=(Array.isArray(M)?M:[M]).map(h=>h-1),i*=rt;let Ze=[];const gt=()=>{Ze.forEach(h=>h?.disconnect())};r&&a&&(a=`${r}_${a}`);let L;if(c)L=c(s,e,n);else if(ue(a)){const{onTrigger:h}=ue(a),S=await h(s,e,gt);S&&(L=S.node,S.stop(s+n))}else throw new Error(`sound ${a} not found! Is it loaded?`);if(!L)return;if(o.currentTime>s){Z("[webaudio] skip hap: still loading",o.currentTime-s);return}const y=[];if(y.push(L),y.push(je(i)),f!==void 0){let h=()=>ie(o,"lowpass",f,T,b,m,p,B,C,s,s+n,d);y.push(h()),g==="24db"&&y.push(h())}if(V!==void 0){let h=()=>ie(o,"highpass",V,I,W,te,J,K,X,s,s+n,d);y.push(h()),g==="24db"&&y.push(h())}if(x!==void 0){let h=()=>ie(o,"bandpass",x,ae,oe,Y,q,k,ne,s,s+n,d);y.push(h()),g==="24db"&&y.push(h())}if(Re!==void 0){const h=o.createVowelFilter(Re);y.push(h)}if(we!==void 0&&y.push(de(o,"coarse-processor",{coarse:we})),Be!==void 0&&y.push(de(o,"crush-processor",{crush:Be})),ve!==void 0&&y.push(de(o,"shape-processor",{shape:ve})),He!==void 0&&y.push(Vt(o,He,it,lt,ut,dt)),Ge!==void 0){const h=o.createStereoPanner();h.pan.value=2*Ge-1,y.push(h)}if(O!==void 0&&v>0){const h=Qt(se,s,O,v,tt,Ae);y.push(h)}const j=new GainNode(o,{gain:l});y.push(j),me(j,M);let xe;if(Te>0&&Ve>0&&Xe>0){const h=jt(se,Ve,Xe,s);xe=ge(j,h,Te)}let Me;if(Ne>0){let h;if(re!==void 0){let ce,F=ue(re);Array.isArray(F)?ce=F.data.samples[We%F.data.samples.length]:typeof F=="object"&&(ce=Object.values(F.data.samples).flat()[We%Object.values(F.data.samples).length]),h=await Qe(ce,o,re,0)}const S=Jt(se,st,nt,ot,at,h);Me=ge(j,S,Ne)}let Fe;if(Se){const h=Lt(2**(ct+5));Fe=ge(j,h,Se)}y.slice(1).reduce((h,S)=>h.connect(S),y[0]),Ze=y.concat([xe,Me,Fe])},gn=(e,t,n,o)=>ye(t,e-n,t.duration/o);let D;async function Et(e,t){const n=`dsp-worklet-${Date.now()}`,o=`${t}
let __q = []; // trigger queue
class MyProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.t = 0;
    this.stopped = false;
    this.port.onmessage = (e) => {
      if(e.data==='stop') {
        this.stopped = true;
      } else if(e.data?.dough) {
        __q.push(e.data)
      } else {
        msg?.(e.data)
      }
    };
  }
  process(inputs, outputs, parameters) {
    const output = outputs[0];
    if(__q.length) {
      for(let i=0;i<__q.length;++i) {
        const deadline = __q[i].time-currentTime;
        if(deadline<=0) {
          trigger(__q[i].dough)
          __q.splice(i,1)
        }
      }
    }
    for (let i = 0; i < output[0].length; i++) {
      const out = dsp(this.t / sampleRate);
      output.forEach((channel) => {
        channel[i] = out;
      });
      this.t++;
    }
  return !this.stopped;
  }
}
registerProcessor('${n}', MyProcessor);
`,a=`data:text/javascript;base64,${btoa(o)}`;await e.audioWorklet.addModule(a);const r=new AudioWorkletNode(e,n);return{node:r,stop:()=>r.port.postMessage("stop")}}const _e=()=>{D&&(D?.stop(),D?.node?.disconnect())};typeof window<"u"&&window.addEventListener("message",e=>{e.data==="strudel-stop"?_e():e.data?.dough&&D?.node.port.postMessage(e.data)});const fn=async e=>{const t=A();_e(),D=await Et(t,e),D.node.connect(t.destination)};function Pt(e,t,n,o,s){window.postMessage({time:e,dough:t.value,currentTime:n,duration:o,cps:s})}const{Pattern:$e,logger:_t}=ht;At(_t);const Ue=e=>(e.ensureObjectValue(),{...e.value,velocity:e.context.velocity}),$t=(e,t,n,o)=>{globalThis.haps_from_outputs&&globalThis.haps_from_outputs.push(t),ye(Ue(t),e-n,t.duration/o)},Ut=(e,t,n)=>{globalThis.haps_from_outputs&&globalThis.haps_from_outputs.push(e),ye(Ue(e),t,n)};$e.prototype.webaudio=function(){return this.onTrigger($t)};function hn(e={}){e={getTime:()=>A().currentTime,defaultOutput:Ut,...e};const{defaultOutput:t,getTime:n}=e;return new pt({...e,onTrigger:Ct({defaultOutput:t,getTime:n})})}$e.prototype.dough=function(){return this.onTrigger(Pt,1)};function en(e,{align:t=!0,color:n="white",thickness:o=3,scale:s=.25,pos:a=.75,trigger:r=0}={}){const c=fe(),i=Pe("time");c.lineWidth=o,c.strokeStyle=n,c.beginPath();let l=c.canvas;const u=e.frequencyBinCount;let g=t?Array.from(i).findIndex((C,b,m)=>b&&m[b-1]>-r&&C<=-r):0;g=Math.max(g,0);const d=l.width*1/u;let f=0;for(let C=g;C<u;C++){const b=i[C]+1,m=(a-s*(b-1))*l.height;C===0?c.moveTo(f,m):c.lineTo(f,m),f+=d}c.stroke()}function tn(e,{color:t="white",scale:n=.25,pos:o=.75,lean:s=.5,min:a=-150,max:r=0}={}){const c=Pe("frequency"),i=fe(),l=i.canvas;i.fillStyle=t;const u=e.frequencyBinCount,g=l.width*1/u;let d=0;for(let f=0;f<u;f++){const b=It((c[f]-a)/(r-a),0,1)*n,m=b*l.height,p=(o-b*s)*l.height;i.fillRect(d,p,Math.max(g,1),m),d+=g}}function et(e=0,t="0,0,0"){const n=fe();e?(n.fillStyle=`rgba(${t},${1-e})`,n.fillRect(0,0,n.canvas.width,n.canvas.height)):n.clearRect(0,0,n.canvas.width,n.canvas.height)}_.prototype.fscope=function(e={}){return this.analyze(1).draw(()=>{et(e.smear),w&&tn(w,e)})};_.prototype.tscope=function(e={}){return this.analyze(1).draw(()=>{et(e.smear),w&&en(w,e)})};_.prototype.scope=_.prototype.tscope;export{ln as A,kt as B,dn as C,w as D,Q as E,Lt as F,Pe as G,ye as H,gn as I,sn as J,Zt as K,xt as L,rn as M,Vt as N,ie as O,Z as P,At as Q,Et as R,fn as S,Pt as T,Ce as a,pe as b,St as c,Wt as d,me as e,an as f,A as g,je as h,un as i,cn as j,zt as k,Qe as l,on as m,Oe as n,Dt as o,Mt as p,Yt as q,Kt as r,be as s,Ot as t,$t as u,hn as v,Ut as w,en as x,tn as y,ue as z};
