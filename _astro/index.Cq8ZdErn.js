/**
 * @license Fraction.js v4.3.7 31/08/2023
 * https://www.xarg.org/2014/03/rational-numbers-in-javascript/
 *
 * Copyright (c) 2023, Robert Eisele (robert@raw.org)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 **/var Yc=2e3,w={s:1,n:0,d:1};function at(e,t){if(isNaN(e=parseInt(e,10)))throw $t();return e*t}function z(e,t){if(t===0)throw Yt();var n=Object.create(N.prototype);n.s=e<0?-1:1,e=e<0?-e:e;var s=gt(e,t);return n.n=e/s,n.d=t/s,n}function Ce(e){for(var t={},n=e,s=2,r=4;r<=n;){for(;n%s===0;)n/=s,t[s]=(t[s]||0)+1;r+=1+2*s++}return n!==e?n>1&&(t[n]=(t[n]||0)+1):t[e]=(t[e]||0)+1,t}var U=function(e,t){var n=0,s=1,r=1,o=0,i=0,a=0,u=1,f=1,l=0,h=1,y=1,p=1,_=1e7,v;if(e!=null)if(t!==void 0){if(n=e,s=t,r=n*s,n%1!==0||s%1!==0)throw na()}else switch(typeof e){case"object":{if("d"in e&&"n"in e)n=e.n,s=e.d,"s"in e&&(n*=e.s);else if(0 in e)n=e[0],1 in e&&(s=e[1]);else throw $t();r=n*s;break}case"number":{if(e<0&&(r=e,e=-e),e%1===0)n=e;else if(e>0){for(e>=1&&(f=Math.pow(10,Math.floor(1+Math.log(e)/Math.LN10)),e/=f);h<=_&&p<=_;)if(v=(l+y)/(h+p),e===v){h+p<=_?(n=l+y,s=h+p):p>h?(n=y,s=p):(n=l,s=h);break}else e>v?(l+=y,h+=p):(y+=l,p+=h),h>_?(n=y,s=p):(n=l,s=h);n*=f}else(isNaN(e)||isNaN(t))&&(s=n=NaN);break}case"string":{if(h=e.match(/\d+|./g),h===null)throw $t();if(h[l]==="-"?(r=-1,l++):h[l]==="+"&&l++,h.length===l+1?i=at(h[l++],r):h[l+1]==="."||h[l]==="."?(h[l]!=="."&&(o=at(h[l++],r)),l++,(l+1===h.length||h[l+1]==="("&&h[l+3]===")"||h[l+1]==="'"&&h[l+3]==="'")&&(i=at(h[l],r),u=Math.pow(10,h[l].length),l++),(h[l]==="("&&h[l+2]===")"||h[l]==="'"&&h[l+2]==="'")&&(a=at(h[l+1],r),f=Math.pow(10,h[l+1].length)-1,l+=3)):h[l+1]==="/"||h[l+1]===":"?(i=at(h[l],r),u=at(h[l+2],1),l+=3):h[l+3]==="/"&&h[l+1]===" "&&(o=at(h[l],r),i=at(h[l+2],r),u=at(h[l+4],1),l+=5),h.length<=l){s=u*f,r=n=a+s*o+f*i;break}}default:throw $t()}if(s===0)throw Yt();w.s=r<0?-1:1,w.n=Math.abs(n),w.d=Math.abs(s)};function Zc(e,t,n){for(var s=1;t>0;e=e*e%n,t>>=1)t&1&&(s=s*e%n);return s}function ta(e,t){for(;t%2===0;t/=2);for(;t%5===0;t/=5);if(t===1)return 0;for(var n=10%t,s=1;n!==1;s++)if(n=n*10%t,s>Yc)return 0;return s}function ea(e,t,n){for(var s=1,r=Zc(10,n,t),o=0;o<300;o++){if(s===r)return o;s=s*10%t,r=r*10%t}return 0}function gt(e,t){if(!e)return t;if(!t)return e;for(;;){if(e%=t,!e)return t;if(t%=e,!t)return e}}function N(e,t){if(U(e,t),this instanceof N)e=gt(w.d,w.n),this.s=w.s,this.n=w.n/e,this.d=w.d/e;else return z(w.s*w.n,w.d)}var Yt=function(){return new Error("Division by Zero")},$t=function(){return new Error("Invalid argument")},na=function(){return new Error("Parameters must be integer")};N.prototype={s:1,n:0,d:1,abs:function(){return z(this.n,this.d)},neg:function(){return z(-this.s*this.n,this.d)},add:function(e,t){return U(e,t),z(this.s*this.n*w.d+w.s*this.d*w.n,this.d*w.d)},sub:function(e,t){return U(e,t),z(this.s*this.n*w.d-w.s*this.d*w.n,this.d*w.d)},mul:function(e,t){return U(e,t),z(this.s*w.s*this.n*w.n,this.d*w.d)},div:function(e,t){return U(e,t),z(this.s*w.s*this.n*w.d,this.d*w.n)},clone:function(){return z(this.s*this.n,this.d)},mod:function(e,t){if(isNaN(this.n)||isNaN(this.d))return new N(NaN);if(e===void 0)return z(this.s*this.n%this.d,1);if(U(e,t),w.n===0&&this.d===0)throw Yt();return z(this.s*(w.d*this.n)%(w.n*this.d),w.d*this.d)},gcd:function(e,t){return U(e,t),z(gt(w.n,this.n)*gt(w.d,this.d),w.d*this.d)},lcm:function(e,t){return U(e,t),w.n===0&&this.n===0?z(0,1):z(w.n*this.n,gt(w.n,this.n)*gt(w.d,this.d))},ceil:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new N(NaN):z(Math.ceil(e*this.s*this.n/this.d),e)},floor:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new N(NaN):z(Math.floor(e*this.s*this.n/this.d),e)},round:function(e){return e=Math.pow(10,e||0),isNaN(this.n)||isNaN(this.d)?new N(NaN):z(Math.round(e*this.s*this.n/this.d),e)},roundTo:function(e,t){return U(e,t),z(this.s*Math.round(this.n*w.d/(this.d*w.n))*w.n,w.d)},inverse:function(){return z(this.s*this.d,this.n)},pow:function(e,t){if(U(e,t),w.d===1)return w.s<0?z(Math.pow(this.s*this.d,w.n),Math.pow(this.n,w.n)):z(Math.pow(this.s*this.n,w.n),Math.pow(this.d,w.n));if(this.s<0)return null;var n=Ce(this.n),s=Ce(this.d),r=1,o=1;for(var i in n)if(i!=="1"){if(i==="0"){r=0;break}if(n[i]*=w.n,n[i]%w.d===0)n[i]/=w.d;else return null;r*=Math.pow(i,n[i])}for(var i in s)if(i!=="1"){if(s[i]*=w.n,s[i]%w.d===0)s[i]/=w.d;else return null;o*=Math.pow(i,s[i])}return w.s<0?z(o,r):z(r,o)},equals:function(e,t){return U(e,t),this.s*this.n*w.d===w.s*w.n*this.d},compare:function(e,t){U(e,t);var n=this.s*this.n*w.d-w.s*w.n*this.d;return(0<n)-(n<0)},simplify:function(e){if(isNaN(this.n)||isNaN(this.d))return this;e=e||.001;for(var t=this.abs(),n=t.toContinued(),s=1;s<n.length;s++){for(var r=z(n[s-1],1),o=s-2;o>=0;o--)r=r.inverse().add(n[o]);if(Math.abs(r.sub(t).valueOf())<e)return r.mul(this.s)}return this},divisible:function(e,t){return U(e,t),!(!(w.n*this.d)||this.n*w.d%(w.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(e){var t,n="",s=this.n,r=this.d;return this.s<0&&(n+="-"),r===1?n+=s:(e&&(t=Math.floor(s/r))>0&&(n+=t,n+=" ",s%=r),n+=s,n+="/",n+=r),n},toLatex:function(e){var t,n="",s=this.n,r=this.d;return this.s<0&&(n+="-"),r===1?n+=s:(e&&(t=Math.floor(s/r))>0&&(n+=t,s%=r),n+="\\frac{",n+=s,n+="}{",n+=r,n+="}"),n},toContinued:function(){var e,t=this.n,n=this.d,s=[];if(isNaN(t)||isNaN(n))return s;do s.push(Math.floor(t/n)),e=t%n,t=n,n=e;while(t!==1);return s},toString:function(e){var t=this.n,n=this.d;if(isNaN(t)||isNaN(n))return"NaN";e=e||15;var s=ta(t,n),r=ea(t,n,s),o=this.s<0?"-":"";if(o+=t/n|0,t%=n,t*=10,t&&(o+="."),s){for(var i=r;i--;)o+=t/n|0,t%=n,t*=10;o+="(";for(var i=s;i--;)o+=t/n|0,t%=n,t*=10;o+=")"}else for(var i=e;t&&i--;)o+=t/n|0,t%=n,t*=10;return o}};const Zt="strudel.log";let sa=1e3,Se,Me;function W(e,t,n={}){let s=performance.now();Se===e&&s-Me<sa||(Se=e,Me=s,console.log(`%c${e}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(Zt,{detail:{message:e,type:t,data:n}})))}W.key=Zt;const ra=e=>/^[a-gA-G][#bs]*[0-9]$/.test(e),Ft=e=>/^[a-gA-G][#bsf]*[0-9]?$/.test(e),$e=e=>{if(typeof e!="string")return[];const[t,n="",s]=e.match(/^([a-gA-G])([#bsf]*)([0-9]*)$/)?.slice(1)||[];return t?[t,n,s?Number(s):void 0]:[]},oa={c:0,d:2,e:4,f:5,g:7,a:9,b:11},ia={"#":1,b:-1,s:1,f:-1},kt=(e,t=3)=>{const[n,s,r=t]=$e(e);if(!n)throw new Error('not a note: "'+e+'"');const o=oa[n.toLowerCase()],i=s?.split("").reduce((a,u)=>a+ia[u],0)||0;return(Number(r)+1)*12+o+i},dt=e=>Math.pow(2,(e-69)/12)*440,te=e=>12*Math.log(e/440)/Math.LN2+69,ca=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:s}=e;if(typeof n=="number")return te(n);if(typeof s=="string")return kt(s);if(typeof s=="number")return s;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t},aa=(e,t)=>(e-t)*1e3,Re=e=>dt(typeof e=="number"?e:kt(e)),ua=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],la=e=>{const t=Math.floor(e/12)-1;return ua[e%12]+t},Ot=(e,t)=>(e%t+t)%t;function Fe(e,t=0){return isNaN(Number(e))?(W(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const fa=(e,t)=>Ot(Math.round(Fe(e??0,0)),t),ha=e=>{let{value:t,context:n}=e,s=t;if(typeof s=="object"&&!Array.isArray(s)&&(s=s.note||s.n||s.value,s===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(t)}`);if(typeof s=="number"&&n.type!=="frequency")s=dt(e.value);else if(typeof s=="number"&&n.type==="frequency")s=e.value;else if(typeof s!="string"||!Ft(s))throw new Error("not a note: "+JSON.stringify(s));return s},Je=e=>{let{value:t,context:n}=e;if(typeof t=="object")return t.freq?t.freq:Re(t.note||t.n||t.value);if(typeof t=="number"&&n.type!=="frequency")t=dt(e.value);else if(typeof t=="string"&&Ft(t))t=dt(kt(e.value));else if(typeof t!="number")throw new Error("not a note or frequency: "+t);return t},Le=(e,t)=>e.slice(t).concat(e.slice(0,t)),Ie=(...e)=>e.reduce((t,n)=>(...s)=>t(n(...s)),t=>t),da=(...e)=>Ie(...e.reverse()),qt=e=>e.filter(t=>t!=null),lt=e=>[].concat(...e),wt=e=>e,pa=(e,t)=>e,ee=(e,t)=>Array.from({length:t-e+1},(n,s)=>s+e);function A(e,t,n=e.length){const s=function r(...o){if(o.length>=n)return e.apply(this,o);{const i=function(...a){return r.apply(this,o.concat(a))};return t&&t(i,o),i}};return t&&t(s,[]),s}function ne(e){const t=Number(e);if(!isNaN(t))return t;if(Ft(e))return kt(e);throw new Error(`cannot parse as numeral: "${e}"`)}function se(e,t){return(...n)=>e(...n.map(t))}function K(e){return se(e,ne)}function We(e){const t=Number(e);if(!isNaN(t))return t;const n={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[e];if(typeof n<"u")return n;throw new Error(`cannot parse as fractional: "${e}"`)}const ma=e=>se(e,We),re=function(e,t){return[t.slice(0,e),t.slice(e)]},oe=(e,t,n)=>t.map((s,r)=>e(s,n[r])),He=function(e){const t=[];for(let n=0;n<e.length-1;++n)t.push([e[n],e[n+1]]);return t},De=(e,t,n)=>Math.min(Math.max(e,t),n),ya=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],ga=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],wa=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],ba=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],va=["I","Ro","Ha","Ni","Ho","He","To"],_a=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],ka=(e,t="letters")=>{const s=(t==="solfeggio"?ya:t==="indian"?ga:t==="german"?wa:t==="byzantine"?ba:t==="japanese"?va:_a)[e%12],r=Math.floor(e/12)-1;return s+r};function qa(e){var t={};return e.filter(function(n){return t.hasOwn(n)?!1:t[n]=!0})}function Aa(e){return e.sort().filter(function(t,n,s){return!n||t!=s[n-1]})}function Ve(e){return e.sort((t,n)=>t.compare(n)).filter(function(t,n,s){return!n||t.ne(s[n-1])})}function Qe(e){const t=new TextEncoder().encode(e);return btoa(String.fromCharCode(...t))}function Ge(e){const t=new Uint8Array(atob(e).split("").map(s=>s.charCodeAt(0)));return new TextDecoder().decode(t)}function Ta(e){return encodeURIComponent(Qe(e))}function Ca(e){return Ge(decodeURIComponent(e))}function Ue(e,t){return Array.isArray(e)?e.map(t):Object.fromEntries(Object.entries(e).map(([n,s],r)=>[n,t(s,n,r)]))}N.prototype.sam=function(){return this.floor()};N.prototype.nextSam=function(){return this.sam().add(1)};N.prototype.wholeCycle=function(){return new R(this.sam(),this.nextSam())};N.prototype.cyclePos=function(){return this.sub(this.sam())};N.prototype.lt=function(e){return this.compare(e)<0};N.prototype.gt=function(e){return this.compare(e)>0};N.prototype.lte=function(e){return this.compare(e)<=0};N.prototype.gte=function(e){return this.compare(e)>=0};N.prototype.eq=function(e){return this.compare(e)==0};N.prototype.ne=function(e){return this.compare(e)!=0};N.prototype.max=function(e){return this.gt(e)?this:e};N.prototype.maximum=function(...e){return e=e.map(t=>new N(t)),e.reduce((t,n)=>n.max(t),this)};N.prototype.min=function(e){return this.lt(e)?this:e};N.prototype.mulmaybe=function(e){return e!==void 0?this.mul(e):void 0};N.prototype.divmaybe=function(e){return e!==void 0?this.div(e):void 0};N.prototype.addmaybe=function(e){return e!==void 0?this.add(e):void 0};N.prototype.submaybe=function(e){return e!==void 0?this.sub(e):void 0};N.prototype.show=function(){return this.s*this.n+"/"+this.d};N.prototype.or=function(e){return this.eq(0)?e:this};const g=e=>N(e),Sa=(...e)=>{if(e=qt(e),e.length!==0)return e.reduce((t,n)=>t.gcd(n),g(1))},Bt=(...e)=>{if(e=qt(e),e.length!==0)return e.reduce((t,n)=>t===void 0||n===void 0?void 0:t.lcm(n),g(1))};g._original=N;class R{constructor(t,n){this.begin=g(t),this.end=g(n)}get spanCycles(){const t=[];var n=this.begin;const s=this.end,r=s.sam();if(n.equals(s))return[new R(n,s)];for(;s.gt(n);){if(n.sam().equals(r)){t.push(new R(n,this.end));break}const o=n.nextSam();t.push(new R(n,o)),n=o}return t}get duration(){return this.end.sub(this.begin)}cycleArc(){const t=this.begin.cyclePos(),n=t.add(this.duration);return new R(t,n)}withTime(t){return new R(t(this.begin),t(this.end))}withEnd(t){return new R(this.begin,t(this.end))}withCycle(t){const n=this.begin.sam(),s=n.add(t(this.begin.sub(n))),r=n.add(t(this.end.sub(n)));return new R(s,r)}intersection(t){const n=this.begin.max(t.begin),s=this.end.min(t.end);if(!n.gt(s)&&!(n.equals(s)&&(n.equals(this.end)&&this.begin.lt(this.end)||n.equals(t.end)&&t.begin.lt(t.end))))return new R(n,s)}intersection_e(t){const n=this.intersection(t);if(n==null)throw"TimeSpans do not intersect";return n}midpoint(){return this.begin.add(this.duration.div(g(2)))}equals(t){return this.begin.equals(t.begin)&&this.end.equals(t.end)}show(){return this.begin.show()+" → "+this.end.show()}}class ${constructor(t,n,s,r={},o=!1){this.whole=t,this.part=n,this.value=s,this.context=r,this.stateful=o,o&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){let t;return typeof this.value?.duration=="number"?t=g(this.value.duration):t=this.whole.end.sub(this.whole.begin),typeof this.value?.clip=="number"?t.mul(this.value.clip):t}get endClipped(){return this.whole.begin.add(this.duration)}isActive(t){return this.whole.begin<=t&&this.endClipped>=t}isInPast(t){return t>this.endClipped}isInNearPast(t,n){return n-t<=this.endClipped}isInFuture(t){return t<this.whole.begin}isInNearFuture(t,n){return n<this.whole.begin&&n>this.whole.begin-t}isWithinTime(t,n){return this.whole.begin<=n&&this.endClipped>=t}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(t){const n=this.whole?t(this.whole):void 0;return new $(n,t(this.part),this.value,this.context)}withValue(t){return new $(this.whole,this.part,t(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}hasTag(t){return this.context.tags?.includes(t)}resolveState(t){if(this.stateful&&this.hasOnset()){console.log("stateful");const n=this.value,[s,r]=n(t);return[s,new $(this.whole,this.part,r,this.context,!1)]}return[t,this]}spanEquals(t){return this.whole==null&&t.whole==null||this.whole.equals(t.whole)}equals(t){return this.spanEquals(t)&&this.part.equals(t.part)&&this.value===t.value}show(t=!1){const n=typeof this.value=="object"?t?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var s="";if(this.whole==null)s="~"+this.part.show;else{var r=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(s=this.whole.begin.show()+" ⇜ "),r||(s+="("),s+=this.part.show(),r||(s+=")"),this.whole.end.equals(this.part.end)||(s+=" ⇝ "+this.whole.end.show())}return"[ "+s+" | "+n+" ]"}showWhole(t=!1){return`${this.whole==null?"~":this.whole.show()}: ${typeof this.value=="object"?t?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value}`}combineContext(t){const n=this;return{...n.context,...t.context,locations:(n.context.locations||[]).concat(t.context.locations||[])}}setContext(t){return new $(this.whole,this.part,this.value,t)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class vt{constructor(t,n={}){this.span=t,this.controls=n}setSpan(t){return new vt(t,this.controls)}withSpan(t){return this.setSpan(t(this.span))}setControls(t){return new vt(this.span,t)}}function Ma(e,t,n){if(t?.value!==void 0&&Object.keys(t).length===1)return W("[warn]: Can't do arithmetic on control pattern."),e;const s=Object.keys(e).filter(r=>Object.keys(t).includes(r));return Object.assign({},e,t,Object.fromEntries(s.map(r=>[r,n(e[r],t[r])])))}A((e,t)=>e*t);A((e,t)=>t.map(e));function Ke(e,t=60){let n=0,s=g(0),r=[""],o="";for(;r[0].length<t;){const i=e.queryArc(n,n+1),a=i.filter(l=>l.hasOnset()).map(l=>l.duration),u=Sa(...a),f=u.inverse();r=r.map(l=>l+"|"),o+="|";for(let l=0;l<f;l++){const[h,y]=[s,s.add(u)],p=i.filter(v=>v.whole.begin.lte(h)&&v.whole.end.gte(y)),_=p.length-r.length;_>0&&(r=r.concat(Array(_).fill(o))),r=r.map((v,q)=>{const k=p[q];if(k){const O=k.whole.begin.eq(h)?""+k.value:"-";return v+O}return v+"."}),o+=".",s=s.add(u)}n++}return r.join(`
`)}let Dt,et=!0;const Na=function(e){et=!!e},Oa=e=>Dt=e;class m{constructor(t,n=void 0){this.query=t,this._Pattern=!0,this.tactus=n}get tactus(){return this.__tactus}set tactus(t){this.__tactus=t===void 0?void 0:g(t)}setTactus(t){return this.tactus=t,this}withTactus(t){return et?new m(this.query,this.tactus===void 0?void 0:t(this.tactus)):this}get hasTactus(){return this.tactus!==void 0}withValue(t){const n=new m(s=>this.query(s).map(r=>r.withValue(t)));return n.tactus=this.tactus,n}fmap(t){return this.withValue(t)}appWhole(t,n){const s=this,r=function(o){const i=s.query(o),a=n.query(o),u=function(f,l){const h=f.part.intersection(l.part);if(h!=null)return new $(t(f.whole,l.whole),h,f.value(l.value),l.combineContext(f))};return lt(i.map(f=>qt(a.map(l=>u(f,l)))))};return new m(r)}appBoth(t){const n=this,s=function(o,i){if(!(o==null||i==null))return o.intersection_e(i)},r=n.appWhole(s,t);return et&&(r.tactus=Bt(t.tactus,n.tactus)),r}appLeft(t){const n=this,s=function(o){const i=[];for(const a of n.query(o)){const u=t.query(o.setSpan(a.wholeOrPart()));for(const f of u){const l=a.whole,h=a.part.intersection(f.part);if(h){const y=a.value(f.value),p=f.combineContext(a),_=new $(l,h,y,p);i.push(_)}}}return i},r=new m(s);return r.tactus=this.tactus,r}appRight(t){const n=this,s=function(o){const i=[];for(const a of t.query(o)){const u=n.query(o.setSpan(a.wholeOrPart()));for(const f of u){const l=a.whole,h=f.part.intersection(a.part);if(h){const y=f.value(a.value),p=a.combineContext(f),_=new $(l,h,y,p);i.push(_)}}}return i},r=new m(s);return r.tactus=t.tactus,r}bindWhole(t,n){const s=this,r=function(o){const i=function(u,f){return new $(t(u.whole,f.whole),f.part,f.value,Object.assign({},u.context,f.context,{locations:(u.context.locations||[]).concat(f.context.locations||[])}))},a=function(u){return n(u.value).query(o.setSpan(u.part)).map(f=>i(u,f))};return lt(s.query(o).map(u=>a(u)))};return new m(r)}bind(t){const n=function(s,r){if(!(s==null||r==null))return s.intersection_e(r)};return this.bindWhole(n,t)}join(){return this.bind(wt)}outerBind(t){return this.bindWhole(n=>n,t).setTactus(this.tactus)}outerJoin(){return this.outerBind(wt)}innerBind(t){return this.bindWhole((n,s)=>s,t)}innerJoin(){return this.innerBind(wt)}resetJoin(t=!1){const n=this;return new m(s=>n.discreteOnly().query(s).map(r=>r.value.late(t?r.whole.begin:r.whole.begin.cyclePos()).query(s).map(o=>new $(o.whole?o.whole.intersection(r.whole):void 0,o.part.intersection(r.part),o.value).setContext(r.combineContext(o))).filter(o=>o.part)).flat())}restartJoin(){return this.resetJoin(!0)}squeezeJoin(){const t=this;function n(s){const r=t.discreteOnly().query(s);function o(a){const f=a.value._focusSpan(a.wholeOrPart()).query(s.setSpan(a.part));function l(h,y){let p;if(y.whole&&h.whole&&(p=y.whole.intersection(h.whole),!p))return;const _=y.part.intersection(h.part);if(!_)return;const v=y.combineContext(h);return new $(p,_,y.value,v)}return f.map(h=>l(a,h))}return lt(r.map(o)).filter(a=>a)}return new m(n)}squeezeBind(t){return this.fmap(t).squeezeJoin()}queryArc(t,n,s={}){try{return this.query(new vt(new R(t,n),s))}catch(r){return W(`[query]: ${r.message}`,"error"),[]}}splitQueries(){const t=this,n=s=>lt(s.span.spanCycles.map(r=>t.query(s.setSpan(r))));return new m(n)}withQuerySpan(t){return new m(n=>this.query(n.withSpan(t)))}withQuerySpanMaybe(t){const n=this;return new m(s=>{const r=s.withSpan(t);return r.span?n.query(r):[]})}withQueryTime(t){return new m(n=>this.query(n.withSpan(s=>s.withTime(t))))}withHapSpan(t){return new m(n=>this.query(n).map(s=>s.withSpan(t)))}withHapTime(t){return this.withHapSpan(n=>n.withTime(t))}withHaps(t){const n=new m(s=>t(this.query(s),s));return n.tactus=this.tactus,n}withHap(t){return this.withHaps(n=>n.map(t))}setContext(t){return this.withHap(n=>n.setContext(t))}withContext(t){const n=this.withHap(s=>s.setContext(t(s.context)));return this.__pure!==void 0&&(n.__pure=this.__pure,n.__pure_loc=this.__pure_loc),n}stripContext(){return this.withHap(t=>t.setContext({}))}withLoc(t,n){const s={start:t,end:n},r=this.withContext(o=>{const i=(o.locations||[]).concat([s]);return{...o,locations:i}});return this.__pure&&(r.__pure=this.__pure,r.__pure_loc=s),r}filterHaps(t){return new m(n=>this.query(n).filter(t))}filterValues(t){return new m(n=>this.query(n).filter(s=>t(s.value))).setTactus(this.tactus)}removeUndefineds(){return this.filterValues(t=>t!=null)}onsetsOnly(){return this.filterHaps(t=>t.hasOnset())}discreteOnly(){return this.filterHaps(t=>t.whole)}defragmentHaps(){return this.discreteOnly().withHaps(n=>{const s=[];for(var r=0;r<n.length;++r){for(var o=!0,i=n[r];o;){const f=JSON.stringify(n[r].value);for(var a=!1,u=r+1;u<n.length;u++){const l=n[u];if(i.whole.equals(l.whole)){if(i.part.begin.eq(l.part.end)){if(f===JSON.stringify(l.value)){i=new $(i.whole,new R(l.part.begin,i.part.end),i.value),n.splice(u,1),a=!0;break}}else if(l.part.begin.eq(i.part.end)&&f==JSON.stringify(l.value)){i=new $(i.whole,new R(i.part.begin,l.part.end),i.value),n.splice(u,1),a=!0;break}}}o=a}s.push(i)}return s})}firstCycle(t=!1){var n=this;return t||(n=n.stripContext()),n.query(new vt(new R(g(0),g(1))))}get firstCycleValues(){return this.firstCycle().map(t=>t.value)}get showFirstCycle(){return this.firstCycle().map(t=>`${t.value}: ${t.whole.begin.toFraction()} - ${t.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(t=>t.sort((n,s)=>n.part.begin.sub(s.part.begin).or(n.part.end.sub(s.part.end)).or(n.whole.begin.sub(s.whole.begin).or(n.whole.end.sub(s.whole.end)))))}asNumber(){return this.fmap(ne)}_opIn(t,n){return this.fmap(n).appLeft(b(t))}_opOut(t,n){return this.fmap(n).appRight(b(t))}_opMix(t,n){return this.fmap(n).appBoth(b(t))}_opSqueeze(t,n){const s=b(t);return this.fmap(r=>s.fmap(o=>n(r)(o))).squeezeJoin()}_opSqueezeOut(t,n){const s=this;return b(t).fmap(o=>s.fmap(i=>n(i)(o))).squeezeJoin()}_opReset(t,n){return b(t).fmap(r=>this.fmap(o=>n(o)(r))).resetJoin()}_opRestart(t,n){return b(t).fmap(r=>this.fmap(o=>n(o)(r))).restartJoin()}layer(...t){return J(...t.map(n=>n(this)))}superimpose(...t){return this.stack(...t.map(n=>n(this)))}stack(...t){return J(this,...t)}sequence(...t){return st(this,...t)}seq(...t){return st(this,...t)}cat(...t){return tn(this,...t)}fastcat(...t){return ot(this,...t)}slowcat(...t){return pt(this,...t)}onTrigger(t,n=!0){return this.withHap(s=>s.setContext({...s.context,onTrigger:(...r)=>{s.context.onTrigger?.(...r),t(...r)},dominantTrigger:s.context.dominantTrigger||n}))}log(t=(s,r)=>`[hap] ${r.showWhole(!0)}`,n=(s,r)=>({hap:r})){return this.onTrigger((...s)=>{W(t(...s),void 0,n(...s))},!1)}logValues(t=wt){return this.log((n,s)=>t(s.value))}drawLine(){return console.log(Ke(this)),this}}function Ba(e,t){let n=[];return t.forEach(s=>{const r=n.findIndex(([o])=>e(s,o));r===-1?n.push([s]):n[r].push(s)}),n}const Pa=(e,t)=>e.spanEquals(t);m.prototype.collect=function(){return this.withHaps(e=>Ba(Pa,e).map(t=>new $(t[0].whole,t[0].part,t,{})))};m.prototype.arpWith=function(e){return this.collect().fmap(t=>b(e(t))).innerJoin().withHap(t=>new $(t.whole,t.part,t.value.value,t.combineContext(t.value)))};m.prototype.arp=function(e){return this.arpWith(t=>e.fmap(n=>t[n%t.length]))};function jt(e){return!Array.isArray(e)&&typeof e=="object"}function za(e,t,n){return jt(e)||jt(t)?(jt(e)||(e={value:e}),jt(t)||(t={value:t}),Ma(e,t,n)):n(e,t)}(function(){const e={set:[(n,s)=>s],keep:[n=>n],keepif:[(n,s)=>s?n:void 0],add:[K((n,s)=>n+s)],sub:[K((n,s)=>n-s)],mul:[K((n,s)=>n*s)],div:[K((n,s)=>n/s)],mod:[K(Ot)],pow:[K(Math.pow)],band:[K((n,s)=>n&s)],bor:[K((n,s)=>n|s)],bxor:[K((n,s)=>n^s)],blshift:[K((n,s)=>n<<s)],brshift:[K((n,s)=>n>>s)],lt:[(n,s)=>n<s],gt:[(n,s)=>n>s],lte:[(n,s)=>n<=s],gte:[(n,s)=>n>=s],eq:[(n,s)=>n==s],eqt:[(n,s)=>n===s],ne:[(n,s)=>n!=s],net:[(n,s)=>n!==s],and:[(n,s)=>n&&s],or:[(n,s)=>n||s],func:[(n,s)=>s(n)]},t=["In","Out","Mix","Squeeze","SqueezeOut","Reset","Restart"];for(const[n,[s,r]]of Object.entries(e)){m.prototype["_"+n]=function(o){return this.fmap(i=>s(i,o))},Object.defineProperty(m.prototype,n,{get:function(){const o=this,i=(...a)=>o[n].in(...a);for(const a of t)i[a.toLowerCase()]=function(...u){var f=o;u=st(u),r&&(f=r(f),u=r(u));var l;return n==="keepif"?(l=f["_op"+a](u,h=>y=>s(h,y)),l=l.removeUndefineds()):l=f["_op"+a](u,h=>y=>za(h,y,s)),l};return i.squeezein=i.squeeze,i}});for(const o of t)m.prototype[o.toLowerCase()]=function(...i){return this.set[o.toLowerCase()](i)}}m.prototype.struct=function(...n){return this.keepif.out(...n)},m.prototype.structAll=function(...n){return this.keep.out(...n)},m.prototype.mask=function(...n){return this.keepif.in(...n)},m.prototype.maskAll=function(...n){return this.keep.in(...n)},m.prototype.reset=function(...n){return this.keepif.reset(...n)},m.prototype.resetAll=function(...n){return this.keep.reset(...n)},m.prototype.restart=function(...n){return this.keepif.restart(...n)},m.prototype.restartAll=function(...n){return this.keep.restart(...n)}})();const Ea=J,xa=J,ja=he,At=e=>new m(()=>[],e),P=At(1),X=At(0);function rt(e){function t(s){return s.span.spanCycles.map(r=>new $(g(r.begin).wholeCycle(),r,e))}const n=new m(t,1);return n.__pure=e,n}function ie(e){return e instanceof m||e?._Pattern}function b(e){return ie(e)?e:Dt&&typeof e=="string"?Dt(e):rt(e)}function J(...e){e=e.map(s=>Array.isArray(s)?st(...s):b(s));const t=s=>lt(e.map(r=>r.query(s))),n=new m(t);return et&&(n.tactus=Bt(...e.map(s=>s.tactus))),n}function ce(e,t){if(t=t.map(o=>Array.isArray(o)?st(...o):b(o)),t.length===0)return P;if(t.length===1)return t[0];const[n,...s]=t.map(o=>o.tactus),r=et?n.maximum(...s):void 0;return J(...e(r,t))}function Xe(...e){return ce((t,n)=>n.map(s=>s.tactus.eq(t)?s:Y(s,At(t.sub(s.tactus)))),e)}function Ye(...e){return ce((t,n)=>n.map(s=>s.tactus.eq(t)?s:Y(At(t.sub(s.tactus)),s)),e)}function Ze(...e){return ce((t,n)=>n.map(s=>{if(s.tactus.eq(t))return s;const r=At(t.sub(s.tactus).div(2));return Y(r,s,r)}),e)}function $a(e,...t){const[n,...s]=t.map(i=>i.tactus),r=n.maximum(...s),o={centre:Ze,left:Xe,right:Ye,expand:J,repeat:(...i)=>cn(r,...i)};return e.inhabit(o).fmap(i=>i(...t)).innerJoin().setTactus(r)}function pt(...e){if(e=e.map(s=>Array.isArray(s)?ot(...s):b(s)),e.length==1)return e[0];const t=function(s){const r=s.span,o=Ot(r.begin.sam(),e.length),i=e[o];if(!i)return[];const a=r.begin.floor().sub(r.begin.div(e.length).floor());return i.withHapTime(u=>u.add(a)).query(s.setSpan(r.withTime(u=>u.sub(a))))},n=et?Bt(...e.map(s=>s.tactus)):void 0;return new m(t).splitQueries().setTactus(n)}function ae(...e){e=e.map(b);const t=function(n){const s=Math.floor(n.span.begin)%e.length;return e[s]?.query(n)||[]};return new m(t).splitQueries()}function tn(...e){return pt(...e)}function Ra(...e){const t=e.reduce((n,[s])=>n+s,0);return e=e.map(([n,s])=>[n,s.fast(n)]),Y(...e).slow(t)}function ot(...e){let t=pt(...e);return e.length>1&&(t=t._fast(e.length),t.tactus=e.length),t}function st(...e){return ot(...e)}function en(...e){return ot(...e)}function Vt(e){return Array.isArray(e)?e.length==0?[P,0]:e.length==1?Vt(e[0]):[ot(...e.map(t=>Vt(t)[0])),e.length]:[b(e),1]}const Fa=A((e,t)=>b(t).mask(e)),Ja=A((e,t)=>b(t).struct(e)),La=A((e,t)=>b(t).superimpose(...e)),Ia=A((e,t)=>b(t).set(e)),Wa=A((e,t)=>b(t).keep(e)),Ha=A((e,t)=>b(t).keepif(e)),Da=A((e,t)=>b(t).add(e)),Va=A((e,t)=>b(t).sub(e)),Qa=A((e,t)=>b(t).mul(e)),Ga=A((e,t)=>b(t).div(e)),Ua=A((e,t)=>b(t).mod(e)),Ka=A((e,t)=>b(t).pow(e)),Xa=A((e,t)=>b(t).band(e)),Ya=A((e,t)=>b(t).bor(e)),Za=A((e,t)=>b(t).bxor(e)),tu=A((e,t)=>b(t).blshift(e)),eu=A((e,t)=>b(t).brshift(e)),nu=A((e,t)=>b(t).lt(e)),su=A((e,t)=>b(t).gt(e)),ru=A((e,t)=>b(t).lte(e)),ou=A((e,t)=>b(t).gte(e)),iu=A((e,t)=>b(t).eq(e)),cu=A((e,t)=>b(t).eqt(e)),au=A((e,t)=>b(t).ne(e)),uu=A((e,t)=>b(t).net(e)),lu=A((e,t)=>b(t).and(e)),fu=A((e,t)=>b(t).or(e)),hu=A((e,t)=>b(t).func(e));function d(e,t,n=!0,s=!1,r=o=>o.innerJoin()){if(Array.isArray(e)){const a={};for(const u of e)a[u]=d(u,t,n);return a}const o=t.length;var i;return n?i=function(...a){a=a.map(b);const u=a[a.length-1];let f;if(o===1)f=t(u);else{const l=a.slice(0,-1);if(l.every(h=>h.__pure!=null)){const h=l.map(p=>p.__pure),y=l.filter(p=>p.__pure_loc).map(p=>p.__pure_loc);f=t(...h,u),f=f.withContext(p=>{const _=(p.locations||[]).concat(y);return{...p,locations:_}})}else{const[h,...y]=l;let p=(..._)=>t(..._,u);p=A(p,null,o-1),f=r(y.reduce((_,v)=>_.appLeft(v),h.fmap(p)))}}return s&&(f.tactus=u.tactus),f}:i=function(...a){a=a.map(b);const u=t(...a);return s&&(u.tactus=a[a.length-1].tactus),u},m.prototype[e]=function(...a){if(o===2&&a.length!==1)a=[st(...a)];else if(o!==a.length+1)throw new Error(`.${e}() expects ${o-1} inputs but got ${a.length}.`);return a=a.map(b),i(...a,this)},o>1&&(m.prototype["_"+e]=function(...a){return t(...a,this)}),A(i,null,o)}function Jt(e,t,n=!0,s=!1,r=o=>o.stepJoin()){return d(e,t,n,s,r)}const du=d("round",function(e){return e.asNumber().fmap(t=>Math.round(t))}),pu=d("floor",function(e){return e.asNumber().fmap(t=>Math.floor(t))}),mu=d("ceil",function(e){return e.asNumber().fmap(t=>Math.ceil(t))}),yu=d("toBipolar",function(e){return e.fmap(t=>t*2-1)}),gu=d("fromBipolar",function(e){return e.fmap(t=>(t+1)/2)}),wu=d("range",function(e,t,n){return n.mul(t-e).add(e)}),bu=d("rangex",function(e,t,n){return n._range(Math.log(e),Math.log(t)).fmap(Math.exp)}),vu=d("range2",function(e,t,n){return n.fromBipolar()._range(e,t)}),_u=d("ratio",e=>e.fmap(t=>Array.isArray(t)?t.slice(1).reduce((n,s)=>n/s,t[0]):t)),ku=d("compress",function(e,t,n){return e=g(e),t=g(t),e.gt(t)||e.gt(1)||t.gt(1)||e.lt(0)||t.lt(0)?P:n._fastGap(g(1).div(t.sub(e)))._late(e)}),{compressSpan:qu,compressspan:Au}=d(["compressSpan","compressspan"],function(e,t){return t._compress(e.begin,e.end)}),{fastGap:Tu,fastgap:Cu}=d(["fastGap","fastgap"],function(e,t){const n=function(r){const o=r.begin.sam(),i=r.begin.sub(o).mul(e).min(1),a=r.end.sub(o).mul(e).min(1);if(!(i>=1))return new R(o.add(i),o.add(a))},s=function(r){const o=r.part.begin,i=r.part.end,a=o.sam(),u=o.sub(a).div(e).min(1),f=i.sub(a).div(e).min(1),l=new R(a.add(u),a.add(f)),h=r.whole?new R(l.begin.sub(o.sub(r.whole.begin).div(e)),l.end.add(r.whole.end.sub(i).div(e))):void 0;return new $(h,l,r.value,r.context)};return t.withQuerySpanMaybe(n).withHap(s).splitQueries()}),Su=d("focus",function(e,t,n){return e=g(e),t=g(t),n._fast(g(1).div(t.sub(e))).late(e.cyclePos())}),{focusSpan:Mu,focusspan:Nu}=d(["focusSpan","focusspan"],function(e,t){return t._focus(e.begin,e.end)}),Ou=d("ply",function(e,t){const n=t.fmap(s=>rt(s)._fast(e)).squeezeJoin();return et&&(n.tactus=g(e).mulmaybe(t.tactus)),n}),{fast:Bu,density:mh}=d(["fast","density"],function(e,t){return e===0?P:(e=g(e),t.withQueryTime(s=>s.mul(e)).withHapTime(s=>s.div(e)).setTactus(t.tactus))},!0,!0),Pu=d("hurry",function(e,t){return t._fast(e).mul(rt({speed:e}))}),{slow:zu,sparsity:Eu}=d(["slow","sparsity"],function(e,t){return e===0?P:t._fast(g(1).div(e))}),xu=d("inside",function(e,t,n){return t(n._slow(e))._fast(e)}),ju=d("outside",function(e,t,n){return t(n._fast(e))._slow(e)}),$u=d("lastOf",function(e,t,n){const s=Array(e-1).fill(n);return s.push(t(n)),ae(...s)}),{firstOf:Ru,every:Fu}=d(["firstOf","every"],function(e,t,n){const s=Array(e-1).fill(n);return s.unshift(t(n)),ae(...s)}),Ju=d("apply",function(e,t){return e(t)}),Lu=d("cpm",function(e,t){return t._fast(e/60/1)}),Iu=d("early",function(e,t){return e=g(e),t.withQueryTime(n=>n.add(e)).withHapTime(n=>n.sub(e))},!0,!0),nn=d("late",function(e,t){return e=g(e),t._early(g(0).sub(e))},!0,!0),Wu=d("zoom",function(e,t,n){if(t=g(t),e=g(e),e.gte(t))return X;const s=t.sub(e),r=et?n.tactus.mulmaybe(s):void 0;return n.withQuerySpan(o=>o.withCycle(i=>i.mul(s).add(e))).withHapSpan(o=>o.withCycle(i=>i.sub(e).div(s))).splitQueries().setTactus(r)}),{zoomArc:Hu,zoomarc:Du}=d(["zoomArc","zoomarc"],function(e,t){return t.zoom(e.begin,e.end)}),Vu=d("linger",function(e,t){return e==0?P:e<0?t._zoom(e.add(1),1)._slow(e):t._zoom(0,e)._slow(e)},!0,!0),Qu=d("segment",function(e,t){return t.struct(rt(!0)._fast(e)).setTactus(e)}),Gu=d("swingBy",(e,t,n)=>n.inside(t,nn(en(0,e/2)))),Uu=d("swing",(e,t)=>t.swingBy(1/3,e)),{invert:Ku,inv:Xu}=d(["invert","inv"],function(e){return e.fmap(t=>!t)},!0,!0),Yu=d("when",function(e,t,n){return e?t(n):n}),Zu=d("off",function(e,t,n){return J(n,t(n.late(e)))}),tl=d("brak",function(e){return e.when(pt(!1,!0),t=>ot(t,P)._late(.25))}),sn=d("rev",function(e){const t=function(n){const s=n.span,r=s.begin.sam(),o=s.begin.nextSam(),i=function(u){const f=u.withTime(h=>r.add(o.sub(h))),l=f.begin;return f.begin=f.end,f.end=l,f};return e.query(n.setSpan(i(s))).map(u=>u.withSpan(i))};return new m(t).splitQueries()},!1,!0),el=d("pressBy",function(e,t){return t.fmap(n=>rt(n).compress(e,1)).squeezeJoin()}),nl=d("press",function(e){return e._pressBy(.5)});m.prototype.hush=function(){return P};const sl=d("palindrome",function(e){return e.lastOf(2,sn)},!0,!0),{juxBy:rl,juxby:ol}=d(["juxBy","juxby"],function(e,t,n){e/=2;const s=function(i,a,u){return a in i?i[a]:u},r=n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)-e})),o=t(n.withValue(i=>Object.assign({},i,{pan:s(i,"pan",.5)+e})));return J(r,o).setTactus(et?Bt(r.tactus,o.tactus):void 0)}),il=d("jux",function(e,t){return t._juxBy(1,e,t)}),{echoWith:cl,echowith:al,stutWith:ul,stutwith:ll}=d(["echoWith","echowith","stutWith","stutwith"],function(e,t,n,s){return J(...ee(0,e-1).map(r=>n(s.late(g(t).mul(r)),r)))}),fl=d("echo",function(e,t,n,s){return s._echoWith(e,t,(r,o)=>r.gain(Math.pow(n,o)))}),hl=d("stut",function(e,t,n,s){return s._echoWith(e,n,(r,o)=>r.gain(Math.pow(t,o)))}),ue=function(e,t,n=!1){return e=g(e),pt(...ee(0,e.sub(1)).map(s=>n?t.late(g(s).div(e)):t.early(g(s).div(e))))},dl=d("iter",function(e,t){return ue(e,t,!1)},!0,!0),{iterBack:pl,iterback:ml}=d(["iterBack","iterback"],function(e,t){return ue(e,t,!0)},!0,!0),{repeatCycles:yl}=d("repeatCycles",function(e,t){return new m(function(n){const s=n.span.begin.sam(),r=s.div(e).sam(),o=s.sub(r);return n=n.withSpan(i=>i.withTime(a=>a.sub(o))),t.query(n).map(i=>i.withSpan(a=>a.withTime(u=>u.add(o))))}).splitQueries()},!0,!0),le=function(e,t,n,s=!1,r=!1){const o=Array(e-1).fill(!1);o.unshift(!0);const i=ue(e,st(...o),!s);return r||(n=n.repeatCycles(e)),n.when(i,t)},{chunk:gl,slowchunk:wl,slowChunk:bl}=d(["chunk","slowchunk","slowChunk"],function(e,t,n){return le(e,t,n,!1,!1)}),{chunkBack:vl,chunkback:_l}=d(["chunkBack","chunkback"],function(e,t,n){return le(e,t,n,!0)}),{fastchunk:kl,fastChunk:ql}=d(["fastchunk","fastChunk"],function(e,t,n){return le(e,t,n,!1,!0)}),Al=d("bypass",function(e,t){return e=!!parseInt(e),e?P:t},!0,!0),Tl=d("ribbon",(e,t,n)=>n.early(e).restart(rt(1).slow(t))),Cl=d("hsla",(e,t,n,s,r)=>r.color(`hsla(${e}turn,${t*100}%,${n*100}%,${s})`)),Sl=d("hsl",(e,t,n,s)=>s.color(`hsl(${e}turn,${t*100}%,${n*100}%)`));m.prototype.tag=function(e){return this.withContext(t=>({...t,tags:(t.tags||[]).concat([e])}))};m.prototype.stepJoin=function(){const e=this,t=Y(...Qt(Gt(e.queryArc(0,1)))).tactus,n=function(s){const o=e.early(s.span.begin.sam()).query(s.setSpan(new R(g(0),g(1))));return Y(...Qt(Gt(o))).query(s)};return new m(n,t)};function Qt(e){const t=e.filter((o,i)=>i.hasTactus).reduce((o,i)=>o.add(i),g(0)),n=qt(e.map((o,i)=>i.tactus)).reduce((o,i)=>o.add(i),g(0)),s=t.eq(0)?void 0:n.div(t);function r(o,i){return i.tactus===void 0?[o.mulmaybe(s),i]:[i.tactus,i]}return e.map(o=>r(...o))}function Gt(e){const t=lt(e.map(r=>[r.part.begin,r.part.end])),n=Ve([g(0),g(1),...t]);return He(n).map(r=>[r[1].sub(r[0]),J(...rn(new R(...r),e).map(o=>o.value.withHap(i=>i.setContext(i.combineContext(o)))))])}function rn(e,t){return qt(t.map(n=>on(e,n)))}function on(e,t){const n=e.intersection(t.part);if(n!=null)return new $(t.whole,n,t.value,t.context)}const Ml=d("steps",function(e,t){return t.tactus===void 0?t:t.tactus.eq(g(0))?X:t.fast(g(e).div(t.tactus))});function fe(e,...t){const n=t.map(r=>Vt(r));if(n.length==0)return P;e==0&&(e=n[0][1]);const s=[];for(const r of n)r[1]!=0&&(e==r[1]?s.push(r[0]):s.push(r[0]._fast(g(e).div(g(r[1])))));return J(...s)}function cn(e,...t){return t.length==0?P:Array.isArray(t[0])?fe(e,...t):he(...t).steps(e)}function he(...e){if(Array.isArray(e[0]))return fe(0,...e);if(e=e.filter(o=>o.hasTactus),e.length==0)return P;const t=e[0].tactus;if(t.eq(g(0)))return X;const[n,...s]=e,r=J(n,...s.map(o=>o._slow(o.tactus.div(t))));return r.tactus=t,r}function Y(...e){if(e.length===0)return X;const t=i=>Array.isArray(i)?i:[i.tactus,i];if(e=e.map(t),e.find(i=>i[0]===void 0)){const i=e.map(u=>u[0]).filter(u=>u!==void 0);if(i.length===0)return ot(...e.map(u=>u[1]));if(i.length===e.length)return X;const a=i.reduce((u,f)=>u.add(f),g(0)).div(i.length);for(let u of e)u[0]===void 0&&(u[0]=a)}if(e.length==1){const i=b(e[0][1]);return i.tactus=e[0][0],i}const n=e.map(i=>i[0]).reduce((i,a)=>i.add(a),g(0));let s=g(0);const r=[];for(const[i,a]of e){if(g(i).eq(0))continue;const u=s.add(i);r.push(b(a)._compress(s.div(n),u.div(n))),s=u}const o=J(...r);return o.tactus=n,o}const Nl=Y,an=Y;function Ol(...e){e=e.map(r=>Array.isArray(r)?r.map(b):[b(r)]);const t=Bt(...e.map(r=>g(r.length)));let n=[];for(let r=0;r<t;++r)n.push(...e.map(o=>o.length==0?P:o[r%o.length]));n=n.filter(r=>r.hasTactus&&r.tactus>0);const s=n.reduce((r,o)=>r.add(o.tactus),g(0));return n=Y(...n),n.tactus=s,n}const Bl=Jt("s_add",function(e,t){if(!t.hasTactus||t.tactus.lte(0)||(e=g(e),e.eq(0)))return X;const n=e<0;n&&(e=e.abs());const s=e.div(t.tactus);return s.lte(0)?X:s.gte(1)?t:n?t.zoom(g(1).sub(s),1):t.zoom(0,s)}),Pl=Jt("s_sub",function(e,t){return t.hasTactus?(e=g(e),e.lt(0)?t.s_add(g(0).sub(t.tactus.add(e))):t.s_add(t.tactus.sub(e))):X}),zl=Jt("s_expand",function(e,t){return t.withTactus(n=>n.mul(g(e)))}),El=Jt("s_contract",function(e,t){return t.withTactus(n=>n.div(g(e)))});m.prototype.s_taperlist=function(e,t){const n=this;if(!n.hasTactus)return[n];if(t=t-1,t===0)return[n];const s=[],r=e>0;e=g(Math.abs(e));const o=n.tactus.sub(e.mul(g(t))).max(g(0));for(let i=0;i<t;++i)s.push(n.zoom(0,o.add(e.mul(g(i))).div(n.tactus)));return s.push(n),r&&s.reverse(),s};const xl=(e,t,n)=>n.s_taperlist(e,t),jl=d("s_taper",function(e,t,n){if(!n.hasTactus)return X;const s=n.s_taperlist(e,t),r=Y(...s);return r.tactus=s.reduce((o,i)=>o.add(i.tactus),g(0)),r},!0,!1,e=>e.stepJoin());m.prototype.s_tour=function(...e){return Y(...[].concat(...e.map((t,n)=>[...e.slice(0,e.length-n),this,...e.slice(e.length-n)]),this,...e))};const $l=function(e,...t){return e.s_tour(...t)},Rl=d("chop",function(e,t){const s=Array.from({length:e},(o,i)=>i).map(o=>({begin:o/e,end:(o+1)/e})),r=function(o){return st(s.map(i=>Object.assign({},o,i)))};return t.squeezeBind(r).setTactus(et?g(e).mulmaybe(t.tactus):void 0)}),Fl=d("striate",function(e,t){const s=Array.from({length:e},(o,i)=>i).map(o=>({begin:o/e,end:(o+1)/e})),r=pt(...s);return t.set(r)._fast(e).setTactus(et?g(e).mulmaybe(t.tactus):void 0)}),un=function(e,t,n=.5){return t.speed(1/e*n).unit("c").slow(e)},ln=d("slice",function(e,t,n){return e.innerBind(s=>t.outerBind(r=>n.outerBind(o=>{o=o instanceof Object?o:{s:o};const i=Array.isArray(s)?s[r]:r/s,a=Array.isArray(s)?s[r+1]:(r+1)/s;return rt({begin:i,end:a,_slices:s,...o})}))).setTactus(t.tactus)},!1),Jl=d("splice",function(e,t,n){const s=ln(e,t,n);return new m(r=>{const o=r.controls._cps||1;return s.query(r).map(a=>a.withValue(u=>({speed:o/u._slices/a.whole.duration*(u.speed||1),unit:"c",...u})))}).setTactus(t.tactus)},!1),{loopAt:Ll,loopat:Il}=d(["loopAt","loopat"],function(e,t){return new m(n=>un(e,t,n.controls._cps).query(n))}),Wl=d("fit",e=>e.withHaps((t,n)=>t.map(s=>s.withValue(r=>({...r,speed:(n.controls._cps||1)/s.whole.duration,unit:"c"}))))),{loopAtCps:Hl,loopatcps:Dl}=d(["loopAtCps","loopatcps"],function(e,t,n){return un(e,n,t)}),Vl=e=>rt(1).withValue(()=>b(e())).innerJoin();let Ne=e=>e<.5?1:1-(e-.5)/.5,fn=(e,t,n)=>{t=b(t),e=b(e),n=b(n);let s=t.fmap(o=>({gain:Ne(o)})),r=t.fmap(o=>({gain:Ne(1-o)}));return J(e.mul(s),n.mul(r))};m.prototype.xfade=function(e,t){return fn(this,e,t)};function Lt(e){let t=Array.isArray(e);e=t?e:[e];const n=e[0],s=i=>{let a;if(typeof i=="object"&&i.value!==void 0&&(a={...i},i=i.value,delete a.value),t&&Array.isArray(i)){const u=a||{};return i.forEach((f,l)=>{l<e.length&&(u[e[l]]=f)}),u}else return a?(a[n]=i,a):{[n]:i}},r=(...i)=>st(...i).withValue(s),o=function(...i){return i.length?this.set(r(...i)):this.fmap(s)};return m.prototype[n]=o,r}function c(e,...t){const n=Array.isArray(e)?e[0]:e;let s={};return s[n]=Lt(e),t.forEach(r=>{s[r]=s[n],m.prototype[r]=m.prototype[n]}),s}const{s:hn,sound:dn}=c(["s","n","gain"],"sound"),{source:pn,src:mn}=c("source","src"),{n:yn}=c("n"),{note:gn}=c(["note","n"]),{accelerate:wn}=c("accelerate"),{velocity:bn}=c("velocity"),{gain:vn}=c("gain"),{postgain:_n}=c("postgain"),{amp:kn}=c("amp"),{attack:qn,att:An}=c("attack","att"),{fmh:Tn}=c(["fmh","fmi"],"fmh"),{fmi:Cn,fm:Sn}=c(["fmi","fmh"],"fm"),{fmenv:Mn}=c("fmenv"),{fmattack:Nn}=c("fmattack"),{fmdecay:On}=c("fmdecay"),{fmsustain:Bn}=c("fmsustain"),{fmrelease:Pn}=c("fmrelease"),{fmvelocity:zn}=c("fmvelocity"),{bank:En}=c("bank"),{analyze:xn}=c("analyze"),{fft:jn}=c("fft"),{decay:$n,dec:Rn}=c("decay","dec"),{sustain:Fn,sus:Jn}=c("sustain","sus"),{release:Ln,rel:In}=c("release","rel"),{hold:Wn}=c("hold"),{bandf:Hn,bpf:Dn,bp:Vn}=c(["bandf","bandq","bpenv"],"bpf","bp"),{bandq:Qn,bpq:Gn}=c("bandq","bpq"),{begin:Un}=c("begin"),{end:Kn}=c("end"),{loop:Xn}=c("loop"),{loopBegin:Yn,loopb:Zn}=c("loopBegin","loopb"),{loopEnd:ts,loope:es}=c("loopEnd","loope"),{crush:ns}=c("crush"),{coarse:ss}=c("coarse"),{channels:rs,ch:os}=c("channels","ch"),{phaserrate:is,phasr:cs}=c("phaserrate","phasr"),{phaser:as,ph:us}=c(["phaser","phaserdepth","phasercenter","phasersweep"],"ph"),{phasersweep:ls,phs:fs}=c("phasersweep","phs"),{phasercenter:hs,phc:ds}=c("phasercenter","phc"),{phaserdepth:ps,phd:ms,phasdp:ys}=c("phaserdepth","phd","phasdp"),{channel:gs}=c("channel"),{cut:ws}=c("cut"),{cutoff:bs,ctf:vs,lpf:_s,lp:ks}=c(["cutoff","resonance","lpenv"],"ctf","lpf","lp"),{lpenv:qs,lpe:As}=c("lpenv","lpe"),{hpenv:Ts,hpe:Cs}=c("hpenv","hpe"),{bpenv:Ss,bpe:Ms}=c("bpenv","bpe"),{lpattack:Ns,lpa:Os}=c("lpattack","lpa"),{hpattack:Bs,hpa:Ps}=c("hpattack","hpa"),{bpattack:zs,bpa:Es}=c("bpattack","bpa"),{lpdecay:xs,lpd:js}=c("lpdecay","lpd"),{hpdecay:$s,hpd:Rs}=c("hpdecay","hpd"),{bpdecay:Fs,bpd:Js}=c("bpdecay","bpd"),{lpsustain:Ls,lps:Is}=c("lpsustain","lps"),{hpsustain:Ws,hps:Hs}=c("hpsustain","hps"),{bpsustain:Ds,bps:Vs}=c("bpsustain","bps"),{lprelease:Qs,lpr:Gs}=c("lprelease","lpr"),{hprelease:Us,hpr:Ks}=c("hprelease","hpr"),{bprelease:Xs,bpr:Ys}=c("bprelease","bpr"),{ftype:Zs}=c("ftype"),{fanchor:tr}=c("fanchor"),{vib:er,vibrato:nr,v:sr}=c(["vib","vibmod"],"vibrato","v"),{noise:rr}=c("noise"),{vibmod:or,vmod:ir}=c(["vibmod","vib"],"vmod"),{hcutoff:cr,hpf:ar,hp:ur}=c(["hcutoff","hresonance","hpenv"],"hpf","hp"),{hresonance:lr,hpq:fr}=c("hresonance","hpq"),{resonance:hr,lpq:dr}=c("resonance","lpq"),{djf:pr}=c("djf"),{delay:mr}=c(["delay","delaytime","delayfeedback"]),{delayfeedback:yr,delayfb:gr,dfb:wr}=c("delayfeedback","delayfb","dfb"),{delaytime:br,delayt:vr,dt:_r}=c("delaytime","delayt","dt"),{lock:kr}=c("lock"),{detune:qr,det:Ar}=c("detune","det"),{unison:Tr}=c("unison"),{spread:Cr}=c("spread"),{dry:Sr}=c("dry"),{fadeTime:Mr,fadeOutTime:Nr}=c("fadeTime","fadeOutTime"),{fadeInTime:Or}=c("fadeInTime"),{freq:Br}=c("freq"),{pattack:Pr,patt:zr}=c("pattack","patt"),{pdecay:Er,pdec:xr}=c("pdecay","pdec"),{psustain:jr,psus:$r}=c("psustain","psus"),{prelease:Rr,prel:Fr}=c("prelease","prel"),{penv:Jr}=c("penv"),{pcurve:Lr}=c("pcurve"),{panchor:Ir}=c("panchor"),{gate:Wr,gat:Hr}=c("gate","gat"),{leslie:Dr}=c("leslie"),{lrate:Vr}=c("lrate"),{lsize:Qr}=c("lsize"),{activeLabel:Gr}=c("activeLabel"),{label:Ur}=c(["label","activeLabel"]),{degree:Kr}=c("degree"),{mtranspose:Xr}=c("mtranspose"),{ctranspose:Yr}=c("ctranspose"),{harmonic:Zr}=c("harmonic"),{stepsPerOctave:to}=c("stepsPerOctave"),{octaveR:eo}=c("octaveR"),{nudge:no}=c("nudge"),{octave:so}=c("octave"),{orbit:ro}=c("orbit"),{overgain:oo}=c("overgain"),{overshape:io}=c("overshape"),{pan:co}=c("pan"),{panspan:ao}=c("panspan"),{pansplay:uo}=c("pansplay"),{panwidth:lo}=c("panwidth"),{panorient:fo}=c("panorient"),{rate:ho}=c("rate"),{slide:po}=c("slide"),{semitone:mo}=c("semitone"),{voice:yo}=c("voice"),{chord:go}=c("chord"),{dictionary:wo,dict:bo}=c("dictionary","dict"),{anchor:vo}=c("anchor"),{offset:_o}=c("offset"),{octaves:ko}=c("octaves"),{mode:qo}=c(["mode","anchor"]),{room:Ao}=c(["room","size"]),{roomlp:To,rlp:Co}=c("roomlp","rlp"),{roomdim:So,rdim:Mo}=c("roomdim","rdim"),{roomfade:No,rfade:Oo}=c("roomfade","rfade"),{ir:Bo,iresponse:Po}=c(["ir","i"],"iresponse"),{roomsize:zo,size:Eo,sz:xo,rsize:jo}=c("roomsize","size","sz","rsize"),{shape:$o}=c(["shape","shapevol"]),{distort:Ro,dist:Fo}=c(["distort","distortvol"],"dist"),{compressor:Jo}=c(["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]),{compressorKnee:Lo}=c("compressorKnee"),{compressorRatio:Io}=c("compressorRatio"),{compressorAttack:Wo}=c("compressorAttack"),{compressorRelease:Ho}=c("compressorRelease"),{speed:Do}=c("speed"),{unit:Vo}=c("unit"),{squiz:Qo}=c("squiz"),{vowel:Go}=c("vowel"),{waveloss:Uo}=c("waveloss"),{density:Ql}=c("density"),{expression:Ko}=c("expression"),{sustainpedal:Xo}=c("sustainpedal"),{tremolodepth:Yo,tremdp:Zo}=c("tremolodepth","tremdp"),{tremolorate:ti,tremr:ei}=c("tremolorate","tremr"),{fshift:ni}=c("fshift"),{fshiftnote:si}=c("fshiftnote"),{fshiftphase:ri}=c("fshiftphase"),{triode:oi}=c("triode"),{krush:ii}=c("krush"),{kcutoff:ci}=c("kcutoff"),{octer:ai}=c("octer"),{octersub:ui}=c("octersub"),{octersubsub:li}=c("octersubsub"),{ring:fi}=c("ring"),{ringf:hi}=c("ringf"),{ringdf:di}=c("ringdf"),{freeze:pi}=c("freeze"),{xsdelay:mi}=c("xsdelay"),{tsdelay:yi}=c("tsdelay"),{real:gi}=c("real"),{imag:wi}=c("imag"),{enhance:bi}=c("enhance"),{partials:vi}=c("partials"),{comb:_i}=c("comb"),{smear:ki}=c("smear"),{scram:qi}=c("scram"),{binshift:Ai}=c("binshift"),{hbrick:Ti}=c("hbrick"),{lbrick:Ci}=c("lbrick"),{midichan:Si}=c("midichan"),{control:Mi}=c("control"),{ccn:Ni}=c("ccn"),{ccv:Oi}=c("ccv"),{polyTouch:Bi}=c("polyTouch"),{midibend:Pi}=c("midibend"),{miditouch:zi}=c("miditouch"),{ctlNum:Ei}=c("ctlNum"),{frameRate:xi}=c("frameRate"),{frames:ji}=c("frames"),{hours:$i}=c("hours"),{midicmd:Ri}=c("midicmd"),{minutes:Fi}=c("minutes"),{progNum:Ji}=c("progNum"),{seconds:Li}=c("seconds"),{songPtr:Ii}=c("songPtr"),{uid:Wi}=c("uid"),{val:Hi}=c("val"),{cps:Di}=c("cps"),{clip:Vi,legato:Qi}=c("clip","legato"),{duration:Gi,dur:Ui}=c("duration","dur"),{zrand:Ki}=c("zrand"),{curve:Xi}=c("curve"),{deltaSlide:Yi}=c("deltaSlide"),{pitchJump:Zi}=c("pitchJump"),{pitchJumpTime:tc}=c("pitchJumpTime"),{lfo:ec,repeatTime:nc}=c("lfo","repeatTime"),{znoise:sc}=c("znoise"),{zmod:rc}=c("zmod"),{zcrush:oc}=c("zcrush"),{zdelay:ic}=c("zdelay"),{tremolo:cc}=c("tremolo"),{zzfx:ac}=c("zzfx"),{color:uc,colour:lc}=c(["color","colour"]);let de=(...e)=>e.reduce((t,n)=>Object.assign(t,{[n]:Lt(n)}),{});const fc=d("adsr",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s,r,o]=e;return t.set({attack:n,decay:s,sustain:r,release:o})}),hc=d("ad",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=n]=e;return t.attack(n).decay(s)}),dc=d("ds",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=0]=e;return t.set({decay:n,sustain:s})}),pc=d("ar",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=n]=e;return t.set({attack:n,release:s})}),Gl=Object.freeze(Object.defineProperty({__proto__:null,accelerate:wn,activeLabel:Gr,ad:hc,adsr:fc,amp:kn,analyze:xn,anchor:vo,ar:pc,att:An,attack:qn,bandf:Hn,bandq:Qn,bank:En,begin:Un,binshift:Ai,bp:Vn,bpa:Es,bpattack:zs,bpd:Js,bpdecay:Fs,bpe:Ms,bpenv:Ss,bpf:Dn,bpq:Gn,bpr:Ys,bprelease:Xs,bps:Vs,bpsustain:Ds,ccn:Ni,ccv:Oi,ch:os,channel:gs,channels:rs,chord:go,clip:Vi,coarse:ss,color:uc,colour:lc,comb:_i,compressor:Jo,compressorAttack:Wo,compressorKnee:Lo,compressorRatio:Io,compressorRelease:Ho,control:Mi,cps:Di,createParam:Lt,createParams:de,crush:ns,ctf:vs,ctlNum:Ei,ctranspose:Yr,curve:Xi,cut:ws,cutoff:bs,dec:Rn,decay:$n,degree:Kr,delay:mr,delayfb:gr,delayfeedback:yr,delayt:vr,delaytime:br,deltaSlide:Yi,density:Ql,det:Ar,detune:qr,dfb:wr,dict:bo,dictionary:wo,dist:Fo,distort:Ro,djf:pr,dry:Sr,ds:dc,dt:_r,dur:Ui,duration:Gi,end:Kn,enhance:bi,expression:Ko,fadeInTime:Or,fadeOutTime:Nr,fadeTime:Mr,fanchor:tr,fft:jn,fm:Sn,fmattack:Nn,fmdecay:On,fmenv:Mn,fmh:Tn,fmi:Cn,fmrelease:Pn,fmsustain:Bn,fmvelocity:zn,frameRate:xi,frames:ji,freeze:pi,freq:Br,fshift:ni,fshiftnote:si,fshiftphase:ri,ftype:Zs,gain:vn,gat:Hr,gate:Wr,harmonic:Zr,hbrick:Ti,hcutoff:cr,hold:Wn,hours:$i,hp:ur,hpa:Ps,hpattack:Bs,hpd:Rs,hpdecay:$s,hpe:Cs,hpenv:Ts,hpf:ar,hpq:fr,hpr:Ks,hprelease:Us,hps:Hs,hpsustain:Ws,hresonance:lr,imag:wi,ir:Bo,iresponse:Po,kcutoff:ci,krush:ii,label:Ur,lbrick:Ci,legato:Qi,leslie:Dr,lfo:ec,lock:kr,loop:Xn,loopBegin:Yn,loopEnd:ts,loopb:Zn,loope:es,lp:ks,lpa:Os,lpattack:Ns,lpd:js,lpdecay:xs,lpe:As,lpenv:qs,lpf:_s,lpq:dr,lpr:Gs,lprelease:Qs,lps:Is,lpsustain:Ls,lrate:Vr,lsize:Qr,midibend:Pi,midichan:Si,midicmd:Ri,miditouch:zi,minutes:Fi,mode:qo,mtranspose:Xr,n:yn,noise:rr,note:gn,nudge:no,octave:so,octaveR:eo,octaves:ko,octer:ai,octersub:ui,octersubsub:li,offset:_o,orbit:ro,overgain:oo,overshape:io,pan:co,panchor:Ir,panorient:fo,panspan:ao,pansplay:uo,panwidth:lo,partials:vi,patt:zr,pattack:Pr,pcurve:Lr,pdec:xr,pdecay:Er,penv:Jr,ph:us,phasdp:ys,phaser:as,phasercenter:hs,phaserdepth:ps,phaserrate:is,phasersweep:ls,phasr:cs,phc:ds,phd:ms,phs:fs,pitchJump:Zi,pitchJumpTime:tc,polyTouch:Bi,postgain:_n,prel:Fr,prelease:Rr,progNum:Ji,psus:$r,psustain:jr,rate:ho,rdim:Mo,real:gi,registerControl:c,rel:In,release:Ln,repeatTime:nc,resonance:hr,rfade:Oo,ring:fi,ringdf:di,ringf:hi,rlp:Co,room:Ao,roomdim:So,roomfade:No,roomlp:To,roomsize:zo,rsize:jo,s:hn,scram:qi,seconds:Li,semitone:mo,shape:$o,size:Eo,slide:po,smear:ki,songPtr:Ii,sound:dn,source:pn,speed:Do,spread:Cr,squiz:Qo,src:mn,stepsPerOctave:to,sus:Jn,sustain:Fn,sustainpedal:Xo,sz:xo,tremdp:Zo,tremolo:cc,tremolodepth:Yo,tremolorate:ti,tremr:ei,triode:oi,tsdelay:yi,uid:Wi,unison:Tr,unit:Vo,v:sr,val:Hi,velocity:bn,vib:er,vibmod:or,vibrato:nr,vmod:ir,voice:yo,vowel:Go,waveloss:Uo,xsdelay:mi,zcrush:oc,zdelay:ic,zmod:rc,znoise:sc,zrand:Ki,zzfx:ac},Symbol.toStringTag,{value:"Module"})),Ul=function(e,t){const[n,s]=e,[r,o]=t,[i,a]=re(s,r);return[[s,n-s],[oe((u,f)=>u.concat(f),i,o),a]]},Kl=function(e,t){const[n,s]=e,[r,o]=t,[i,a]=re(n,o);return[[n,s-n],[oe((f,l)=>f.concat(l),r,i),a]]},mc=function(e,t){const[n,s]=e;return Math.min(n,s)<=1?[e,t]:mc(...n>s?Ul(e,t):Kl(e,t))},yc=function(e,t){const n=e<0;e=Math.abs(e);const s=t-e,r=Array(e).fill([1]),o=Array(s).fill([0]),i=mc([e,s],[r,o]),a=lt(i[1][0]).concat(lt(i[1][1]));return n?a.map(u=>u===0?1:0):a},pe=function(e,t,n){const s=yc(e,t);return n?Le(s,-n):s},Xl=d("euclid",function(e,t,n){return n.struct(pe(e,t,0))}),{euclidrot:Yl,euclidRot:Zl}=d(["euclidrot","euclidRot"],function(e,t,n,s){return s.struct(pe(e,t,n))}),gc=function(e,t,n,s){if(e<1)return P;const o=pe(e,t,n).join("").split("1").slice(1).map(i=>[i.length+1,!0]);return s.struct(an(...o))},tf=d(["euclidLegato"],function(e,t,n){return gc(e,t,0,n)}),ef=d(["euclidLegatoRot"],function(e,t,n,s){return gc(e,t,n,s)});function wc(e,t,n=.05,s=.1,r=.1,o=globalThis.setInterval,i=globalThis.clearInterval,a=!0){let u=0,f=0,l=10**4,h=.01;const y=S=>n=S(n);r=r||s/2;const p=()=>{const S=e(),B=S+s+r;for(f===0&&(f=S+h);f<B;)f=a?Math.round(f*l)/l:f,t(f,n,u,S),f+=n,u++};let _;const v=()=>{q(),p(),_=o(p,s*1e3)},q=()=>{_!==void 0&&i(_),_=void 0};return{setDuration:y,start:v,stop:()=>{u=0,f=0,q()},pause:()=>q(),duration:n,interval:s,getPhase:()=>f,minLatency:h}}function nf(e){return new m(t=>[new $(void 0,t.span,e)])}const mt=e=>{const t=n=>[new $(void 0,n.span,e(n.span.midpoint()))];return new m(t)},me=mt(e=>1-e%1),bc=me.toBipolar(),It=mt(e=>e%1),vc=It.toBipolar(),ye=mt(e=>Math.sin(Math.PI*2*e)),_c=ye.fromBipolar(),sf=_c._early(g(1).div(4)),rf=ye._early(g(1).div(4)),kc=mt(e=>Math.floor(e*2%2)),of=kc.toBipolar(),cf=ot(me,It),af=ot(bc,vc),qc=mt(wt),uf=e=>{const t=e<<13^e,n=t>>17^t;return n<<5^n},lf=e=>e-Math.trunc(e),ff=e=>uf(Math.trunc(lf(e/300)*536870912)),hf=e=>e%536870912/536870912,Ut=e=>Math.abs(hf(ff(e))),df=e=>It.range(0,e).floor().segment(e),Z=mt(Ut),pf=Z.toBipolar(),ge=e=>Z.fmap(t=>t<e),mf=e=>b(e).fmap(ge).innerJoin(),yf=ge(.5),Ac=e=>Z.fmap(t=>Math.trunc(t*e)),gf=e=>b(e).fmap(Ac).innerJoin(),it=function(e,t,n=!0){const s=Array.isArray(e),r=Object.keys(e).length;return e=Ue(e,b),r===0?P:t.fmap(o=>{let i=o;return s&&(i=n?Math.round(i)%r:De(Math.round(i),0,e.length-1)),e[i]})},Tc=function(e,t){return Array.isArray(t)&&([t,e]=[e,t]),wf(e,t)},wf=d("pick",function(e,t){return it(e,t,!1).innerJoin()}),Cc=d("pickmod",function(e,t){return it(e,t,!0).innerJoin()}),bf=d("pickF",function(e,t,n){return n.apply(Tc(e,t))}),vf=d("pickmodF",function(e,t,n){return n.apply(Cc(e,t))}),_f=d("pickOut",function(e,t){return it(e,t,!1).outerJoin()}),kf=d("pickmodOut",function(e,t){return it(e,t,!0).outerJoin()}),qf=d("pickRestart",function(e,t){return it(e,t,!1).restartJoin()}),Af=d("pickmodRestart",function(e,t){return it(e,t,!0).restartJoin()}),Tf=d("pickReset",function(e,t){return it(e,t,!1).resetJoin()}),Cf=d("pickmodReset",function(e,t){return it(e,t,!0).resetJoin()}),{inhabit:Sf,pickSqueeze:Mf}=d(["inhabit","pickSqueeze"],function(e,t){return it(e,t,!1).squeezeJoin()}),{inhabitmod:Nf,pickmodSqueeze:Of}=d(["inhabitmod","pickmodSqueeze"],function(e,t){return it(e,t,!0).squeezeJoin()}),Bf=(e,t)=>(t=t.map(b),t.length==0?P:e.fmap(n=>{const s=Ot(Math.round(n),t.length);return t[s]}).squeezeJoin()),we=(e,t)=>(t=t.map(b),t.length==0?P:e.range(0,t.length).fmap(n=>{const s=Math.min(Math.max(Math.floor(n),0),t.length-1);return t[s]})),Wt=(e,t)=>we(e,t).outerJoin(),Sc=(e,t)=>we(e,t).innerJoin(),Pf=(...e)=>Wt(Z,e);m.prototype.choose=function(...e){return Wt(this,e)};m.prototype.choose2=function(...e){return Wt(this.fromBipolar(),e)};const Mc=(...e)=>Sc(Z.segment(1),e),zf=Mc,Nc=function(e,...t){const n=t.map(a=>b(a[0])),s=[];let r=0;for(const a of t)r+=a[1],s.push(r);const o=r,i=function(a){const u=a*o;return n[s.findIndex(f=>f>u,s)]};return e.fmap(i)},Ef=(...e)=>Nc(...e).outerJoin(),xf=(...e)=>Ef(Z,...e),Oc=(...e)=>Nc(Z.segment(1),...e).innerJoin(),jf=Oc,Bc=e=>{const t=e.fmap(Math.floor),n=e.fmap(o=>Math.floor(o)+1),s=o=>6*o**5-15*o**4+10*o**3,r=o=>i=>a=>i+s(o)*(a-i);return e.sub(t).fmap(r).appBoth(t.fmap(Ut)).appBoth(n.fmap(Ut))},$f=Bc(qc.fmap(e=>Number(e))),Rf=d("degradeByWith",(e,t,n)=>n.fmap(s=>r=>s).appLeft(e.filterValues(s=>s>t))),Ff=d("degradeBy",function(e,t){return t._degradeByWith(Z,e)}),Jf=d("degrade",e=>e._degradeBy(.5)),Lf=d("undegradeBy",function(e,t){return t._degradeByWith(Z.fmap(n=>1-n),e)}),If=d("undegrade",e=>e._undegradeBy(.5)),Wf=d("sometimesBy",function(e,t,n){return b(e).fmap(s=>J(n._degradeBy(s),t(n._undegradeBy(1-s)))).innerJoin()}),Hf=d("sometimes",function(e,t){return t._sometimesBy(.5,e)}),Df=d("someCyclesBy",function(e,t,n){return b(e).fmap(s=>J(n._degradeByWith(Z._segment(1),s),t(n._degradeByWith(Z.fmap(r=>1-r)._segment(1),1-s)))).innerJoin()}),Vf=d("someCycles",function(e,t){return t._someCyclesBy(.5,e)}),Qf=d("often",function(e,t){return t.sometimesBy(.75,e)}),Gf=d("rarely",function(e,t){return t.sometimesBy(.25,e)}),Uf=d("almostNever",function(e,t){return t.sometimesBy(.1,e)}),Kf=d("almostAlways",function(e,t){return t.sometimesBy(.9,e)}),Xf=d("never",function(e,t){return t}),Yf=d("always",function(e,t){return e(t)});let Rt;try{Rt=window?.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let Oe=Rt?.getVoices();function Zf(e,t,n){Rt.cancel();const s=new SpeechSynthesisUtterance(e);s.lang=t,Oe=Rt.getVoices();const r=Oe.filter(o=>o.lang.includes(t));typeof n=="number"?s.voice=r[n%r.length]:typeof n=="string"&&(s.voice=r.find(o=>o.name===o)),speechSynthesis.speak(s)}const th=d("speak",function(e,t,n){return n.onTrigger((s,r)=>{Zf(r.value,e,t)})}),Pc=async(...e)=>{const t=await Promise.allSettled(e),n=t.filter(s=>s.status==="fulfilled").map(s=>s.value);return t.forEach((s,r)=>{s.status==="rejected"&&console.warn(`evalScope: module with index ${r} could not be loaded:`,s.reason)}),n.forEach(s=>{Object.entries(s).forEach(([r,o])=>{globalThis[r]=o})}),n};function eh(e,t={}){const{wrapExpression:n=!0,wrapAsync:s=!0}=t;n&&(e=`{${e}}`),s&&(e=`(async ()=>${e})()`);const r=`"use strict";return (${e})`;return Function(r)()}const zc=async(e,t)=>{let n={};if(t){const o=t(e);e=o.output,n=o}return{mode:"javascript",pattern:await eh(e,{wrapExpression:!!t}),meta:n}};class nh{constructor({onTrigger:t,onToggle:n,getTime:s}){this.started=!1,this.cps=.5,this.lastTick=0,this.getTime=s,this.time_at_last_tick_message=0,this.num_cycles_at_cps_change=0,this.onToggle=n,this.latency=.1,this.cycle=0,this.id=Math.round(Date.now()*Math.random()),this.worker_time_dif,this.worker=new SharedWorker(new URL("/assets/clockworker-OodvW4tn.js",import.meta.url)),this.worker.port.start(),this.channel=new BroadcastChannel("strudeltick");let r=0;const o=20,i=10**3,a=(l,h,y)=>{const p=s()-(l+h)+y;if(this.worker_time_dif==null)this.worker_time_dif=p;else{const v=Math.round((this.worker_time_dif*r+p*1)/(r+1)*i)/i;v!=this.worker_time_dif&&(r=4),this.worker_time_dif=v}r=Math.min(r+1,o)},u=l=>{const{num_cycles_at_cps_change:h,cps:y,num_seconds_at_cps_change:p,num_seconds_since_cps_change:_,begin:v,end:q,tickdeadline:k,cycle:E}=l;this.cps=y,this.cycle=E,a(p,_,k),f(v,q,h,p),this.time_at_last_tick_message=this.getTime()},f=(l,h,y,p)=>{if(this.started===!1)return;this.pattern.queryArc(l,h,{_cps:this.cps}).forEach(v=>{if(v.hasOnset()){const q=(v.whole.begin-y)/this.cps+p+this.latency+this.worker_time_dif,k=v.duration/this.cps;t?.(v,0,k,this.cps,q)}})};this.channel.onmessage=l=>{if(!this.started)return;const{payload:h,type:y}=l.data;switch(y){case"tick":u(h)}}}sendMessage(t,n){this.worker.port.postMessage({type:t,payload:n,id:this.id})}now(){const t=(this.getTime()-this.time_at_last_tick_message)*this.cps;return this.cycle+t}setCps(t=1){this.sendMessage("cpschange",{cps:t})}setCycle(t){this.sendMessage("setcycle",{cycle:t})}setStarted(t){this.sendMessage("toggle",{started:t}),this.started=t,this.onToggle?.(t)}start(){W("[cyclist] start"),this.setStarted(!0)}stop(){this.worker_time_dif=null,W("[cyclist] stop"),this.setStarted(!1)}setPattern(t,n=!1){this.pattern=t,n&&!this.started&&this.start()}log(t,n,s){const r=s.filter(o=>o.hasOnset());console.log(`${t.toFixed(4)} - ${n.toFixed(4)} ${Array(r.length).fill("I").join("")}`)}}class Ec{constructor({interval:t,onTrigger:n,onToggle:s,onError:r,getTime:o,latency:i=.1,setInterval:a,clearInterval:u}){this.started=!1,this.cps=.5,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=o,this.num_cycles_at_cps_change=0,this.seconds_at_cps_change,this.onToggle=s,this.latency=i,this.clock=wc(o,(l,h,y,p)=>{this.num_ticks_since_cps_change===0&&(this.num_cycles_at_cps_change=this.lastEnd,this.seconds_at_cps_change=l),this.num_ticks_since_cps_change++;const v=this.num_ticks_since_cps_change*h*this.cps;try{const q=this.lastEnd;this.lastBegin=q;const k=this.num_cycles_at_cps_change+v;if(this.lastEnd=k,this.lastTick=l,l<p){console.log("skip query: too late");return}this.pattern.queryArc(q,k,{_cps:this.cps}).forEach(O=>{if(O.hasOnset()){const S=(O.whole.begin-this.num_cycles_at_cps_change)/this.cps+this.seconds_at_cps_change+i,B=O.duration/this.cps,F=S-l;n?.(O,F,B,this.cps,S)}})}catch(q){W(`[cyclist] error: ${q.message}`),r?.(q)}},t,.1,.1,a,u);let f=this;globalThis.__cyclist__=f}now(){if(!this.started)return 0;const t=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+t*this.cps}setStarted(t){this.started=t,this.onToggle?.(t)}start(){if(this.num_ticks_since_cps_change=0,this.num_cycles_at_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");W("[cyclist] start"),this.clock.start(),this.setStarted(!0),globalThis.haps_from_outputs=null}pause(){W("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){W("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}setPattern(t,n=!1){this.pattern=t,n&&!this.started&&this.start()}setCps(t=.5){this.cps!==t&&(this.cps=t,this.num_ticks_since_cps_change=0)}log(t,n,s){const r=s.filter(o=>o.hasOnset());console.log(`${t.toFixed(4)} - ${n.toFixed(4)} ${Array(r.length).fill("I").join("")}`)}}let Kt;function Xt(){if(!Kt)throw new Error("no time set! use setTime to define a time source");return Kt()}function xc(e){Kt=e}function sh({defaultOutput:e,onEvalError:t,beforeEval:n,afterEval:s,getTime:r,transpiler:o,onToggle:i,editPattern:a,onUpdateState:u,sync:f=!1,setInterval:l,clearInterval:h}){const y={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},p=C=>{Object.assign(y,C),y.isDirty=y.code!==y.activeCode,y.error=y.evalError||y.schedulerError,u?.(y)},_={onTrigger:jc({defaultOutput:e,getTime:r}),getTime:r,onToggle:C=>{p({started:C}),i?.(C)},setInterval:l,clearInterval:h},v=f&&typeof SharedWorker<"u"?new nh(_):new Ec(_);let q={},k=0,E;const O=function(){return q={},k=0,E=void 0,P},S=(C,M=!0)=>{C=a?.(C)||C,v.setPattern(C,M)};xc(()=>v.now());const B=()=>v.stop(),F=()=>v.start(),tt=()=>v.pause(),H=()=>v.toggle(),I=C=>v.setCps(C),T=C=>v.setCps(C/60),ct=function(C){return E=C,P},L=()=>{m.prototype.p=function(M){return M.startsWith("_")||M.endsWith("_")?P:(M==="$"&&(M=`$${k}`,k++),q[M]=this,this)},m.prototype.q=function(M){return P};try{for(let M=1;M<10;++M)Object.defineProperty(m.prototype,`d${M}`,{get(){return this.p(M)},configurable:!0}),Object.defineProperty(m.prototype,`p${M}`,{get(){return this.p(M)},configurable:!0}),m.prototype[`q${M}`]=P}catch(M){console.warn("injectPatternMethods: error:",M)}const C=d("cpm",function(M,V){return V._fast(M/60/v.cps)});return Pc({all:ct,hush:O,cpm:C,setCps:I,setcps:I,setCpm:T,setcpm:T})};return{scheduler:v,evaluate:async(C,M=!0,V=!0)=>{if(!C)throw new Error("no code to evaluate");try{p({code:C,pending:!0}),await L(),await n?.({code:C}),V&&O();let{pattern:j,meta:ht}=await zc(C,o);if(Object.keys(q).length&&(j=J(...Object.values(q))),E&&(j=E(j)),!ie(j)){const Pt=`got "${typeof evaluated}" instead of pattern`;throw new Error(Pt+(typeof evaluated=="function"?", did you forget to call a function?":"."))}return W("[eval] code updated"),S(j,M),p({miniLocations:ht?.miniLocations||[],widgets:ht?.widgets||[],activeCode:C,pattern:j,evalError:void 0,schedulerError:void 0,pending:!1}),s?.({code:C,pattern:j,meta:ht}),j}catch(j){W(`[eval] error: ${j.message}`,"error"),console.error(j),p({evalError:j,pending:!1}),t?.(j)}},start:F,stop:B,pause:tt,setCps:I,setPattern:S,setCode:C=>p({code:C}),toggle:H,state:y}}const jc=({getTime:e,defaultOutput:t})=>async(n,s,r,o,i)=>{try{(!n.context.onTrigger||!n.context.dominantTrigger)&&await t(n,s,r,o,i),n.context.onTrigger&&await n.context.onTrigger(e()+s,n,e(),o,i)}catch(a){W(`[cyclist] error: ${a.message}`,"error")}},rh=function(e,t={}){const n=document.getElementById("code"),s="background-image:url("+e+");background-size:contain;";n.style=s;const{className:r}=n,o=(u,f)=>{({style:()=>n.style=s+";"+f,className:()=>n.className=f+" "+r})[u]()},i=Object.entries(t).filter(([u,f])=>typeof f=="function");Object.entries(t).filter(([u,f])=>typeof f=="string").forEach(([u,f])=>o(u,f)),i.length},oh=()=>{const e=document.getElementById("code");e&&(e.style="")};W("🌀 @strudel/core loaded 🌀");globalThis._strudelLoaded&&console.warn(`@strudel/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel/core".`);globalThis._strudelLoaded=!0;const yh=Object.freeze(Object.defineProperty({__proto__:null,Cyclist:Ec,Fraction:g,Hap:$,Pattern:m,State:vt,TimeSpan:R,__chooseWith:we,_brandBy:ge,_fitslice:rn,_irand:Ac,_match:on,_mod:Ot,_polymeterListSteps:fe,_retime:Qt,_slices:Gt,accelerate:wn,activeLabel:Gr,ad:hc,add:Da,adsr:fc,almostAlways:Kf,almostNever:Uf,always:Yf,amp:kn,analyze:xn,anchor:vo,and:lu,apply:Ju,ar:pc,arrange:Ra,att:An,attack:qn,backgroundImage:rh,band:Xa,bandf:Hn,bandq:Qn,bank:En,base64ToUnicode:Ge,begin:Un,binshift:Ai,bjork:yc,blshift:tu,bor:Ya,bp:Vn,bpa:Es,bpattack:zs,bpd:Js,bpdecay:Fs,bpe:Ms,bpenv:Ss,bpf:Dn,bpq:Gn,bpr:Ys,bprelease:Xs,bps:Vs,bpsustain:Ds,brak:tl,brand:yf,brandBy:mf,brshift:eu,bxor:Za,bypass:Al,calculateTactus:Na,cat:tn,ccn:Ni,ccv:Oi,ceil:mu,ch:os,channel:gs,channels:rs,choose:Pf,chooseCycles:Mc,chooseInWith:Sc,chooseWith:Wt,chop:Rl,chord:go,chunk:gl,chunkBack:vl,chunkback:_l,clamp:De,cleanupUi:oh,clip:Vi,coarse:ss,code2hash:Ta,color:uc,colour:lc,comb:_i,compose:da,compress:ku,compressSpan:qu,compressor:Jo,compressorAttack:Wo,compressorKnee:Lo,compressorRatio:Io,compressorRelease:Ho,compressspan:Au,constant:pa,control:Mi,controls:Gl,cosine:sf,cosine2:rf,cpm:Lu,cps:Di,createClock:wc,createParam:Lt,createParams:de,crush:ns,ctf:vs,ctlNum:Ei,ctranspose:Yr,curry:A,curve:Xi,cut:ws,cutoff:bs,dec:Rn,decay:$n,degrade:Jf,degradeBy:Ff,degradeByWith:Rf,degree:Kr,delay:mr,delayfb:gr,delayfeedback:yr,delayt:vr,delaytime:br,deltaSlide:Yi,det:Ar,detune:qr,dfb:wr,dict:bo,dictionary:wo,dist:Fo,distort:Ro,div:Ga,djf:pr,drawLine:Ke,dry:Sr,ds:dc,dt:_r,dur:Ui,duration:Gi,early:Iu,echo:fl,echoWith:cl,echowith:al,end:Kn,enhance:bi,eq:iu,eqt:cu,euclid:Xl,euclidLegato:tf,euclidLegatoRot:ef,euclidRot:Zl,euclidrot:Yl,evalScope:Pc,evaluate:zc,every:Fu,expression:Ko,fadeInTime:Or,fadeOutTime:Nr,fadeTime:Mr,fanchor:tr,fast:Bu,fastChunk:ql,fastGap:Tu,fastcat:ot,fastchunk:kl,fastgap:Cu,fft:jn,firstOf:Ru,fit:Wl,flatten:lt,floor:pu,fm:Sn,fmattack:Nn,fmdecay:On,fmenv:Mn,fmh:Tn,fmi:Cn,fmrelease:Pn,fmsustain:Bn,fmvelocity:zn,focus:Su,focusSpan:Mu,focusspan:Nu,fractionalArgs:ma,frameRate:xi,frames:ji,freeze:pi,freq:Br,freqToMidi:te,fromBipolar:gu,fshift:ni,fshiftnote:si,fshiftphase:ri,ftype:Zs,func:hu,gain:vn,gap:At,gat:Hr,gate:Wr,getEventOffsetMs:aa,getFreq:Re,getFrequency:Je,getPlayableNoteValue:ha,getSoundIndex:fa,getTime:Xt,getTrigger:jc,gt:su,gte:ou,harmonic:Zr,hash2code:Ca,hbrick:Ti,hcutoff:cr,hold:Wn,hours:$i,hp:ur,hpa:Ps,hpattack:Bs,hpd:Rs,hpdecay:$s,hpe:Cs,hpenv:Ts,hpf:ar,hpq:fr,hpr:Ks,hprelease:Us,hps:Hs,hpsustain:Ws,hresonance:lr,hsl:Sl,hsla:Cl,hurry:Pu,id:wt,imag:wi,inhabit:Sf,inhabitmod:Nf,inside:xu,inv:Xu,invert:Ku,ir:Bo,irand:gf,iresponse:Po,isNote:Ft,isNoteWithOctave:ra,isPattern:ie,isaw:me,isaw2:bc,iter:dl,iterBack:pl,iterback:ml,jux:il,juxBy:rl,juxby:ol,kcutoff:ci,keep:Wa,keepif:Ha,krush:ii,label:Ur,lastOf:$u,late:nn,lbrick:Ci,legato:Qi,leslie:Dr,lfo:ec,linger:Vu,listRange:ee,lock:kr,logKey:Zt,logger:W,loop:Xn,loopAt:Ll,loopAtCps:Hl,loopBegin:Yn,loopEnd:ts,loopat:Il,loopatcps:Dl,loopb:Zn,loope:es,lp:ks,lpa:Os,lpattack:Ns,lpd:js,lpdecay:xs,lpe:As,lpenv:qs,lpf:_s,lpq:dr,lpr:Gs,lprelease:Qs,lps:Is,lpsustain:Ls,lrate:Vr,lsize:Qr,lt:nu,lte:ru,mapArgs:se,mask:Fa,midi2note:la,midiToFreq:dt,midibend:Pi,midichan:Si,midicmd:Ri,miditouch:zi,minutes:Fi,mod:Ua,mode:qo,mtranspose:Xr,mul:Qa,n:yn,nanFallback:Fe,ne:au,net:uu,never:Xf,noise:rr,note:gn,noteToMidi:kt,nothing:X,nudge:no,numeralArgs:K,objectMap:Ue,octave:so,octaveR:eo,octaves:ko,octer:ai,octersub:ui,octersubsub:li,off:Zu,offset:_o,often:Qf,or:fu,orbit:ro,outside:ju,overgain:oo,overshape:io,pairs:He,palindrome:sl,pan:co,panchor:Ir,panorient:fo,panspan:ao,pansplay:uo,panwidth:lo,parseFractional:We,parseNumeral:ne,partials:vi,patt:zr,pattack:Pr,pcurve:Lr,pdec:xr,pdecay:Er,penv:Jr,perlin:$f,perlinWith:Bc,ph:us,phasdp:ys,phaser:as,phasercenter:hs,phaserdepth:ps,phaserrate:is,phasersweep:ls,phasr:cs,phc:ds,phd:ms,phs:fs,pick:Tc,pickF:bf,pickOut:_f,pickReset:Tf,pickRestart:qf,pickSqueeze:Mf,pickmod:Cc,pickmodF:vf,pickmodOut:kf,pickmodReset:Cf,pickmodRestart:Af,pickmodSqueeze:Of,pipe:Ie,pitchJump:Zi,pitchJumpTime:tc,ply:Ou,pm:ja,polyTouch:Bi,polyrhythm:Ea,postgain:_n,pow:Ka,pr:xa,prel:Fr,prelease:Rr,press:nl,pressBy:el,progNum:Ji,psus:$r,psustain:jr,pure:rt,rand:Z,rand2:pf,randcat:zf,range:wu,range2:vu,rangex:bu,rarely:Gf,rate:ho,ratio:_u,rdim:Mo,real:gi,ref:Vl,register:d,registerControl:c,reify:b,rel:In,release:Ln,removeUndefineds:qt,repeatCycles:yl,repeatTime:nc,repl:sh,resonance:hr,rev:sn,rfade:Oo,ribbon:Tl,ring:fi,ringdf:di,ringf:hi,rlp:Co,room:Ao,roomdim:So,roomfade:No,roomlp:To,roomsize:zo,rotate:Le,round:du,rsize:jo,run:df,s:hn,s_add:Bl,s_alt:Ol,s_cat:Y,s_contract:El,s_expand:zl,s_polymeter:he,s_polymeterSteps:cn,s_sub:Pl,s_taper:jl,s_taperlist:xl,s_tour:$l,saw:It,saw2:vc,scram:qi,seconds:Li,segment:Qu,semitone:mo,seq:en,sequence:st,set:Ia,setStringParser:Oa,setTime:xc,shape:$o,signal:mt,silence:P,sine:_c,sine2:ye,size:Eo,slice:ln,slide:po,slow:zu,slowChunk:bl,slowcat:pt,slowcatPrime:ae,slowchunk:wl,smear:ki,sol2note:ka,someCycles:Vf,someCyclesBy:Df,sometimes:Hf,sometimesBy:Wf,songPtr:Ii,sound:dn,source:pn,sparsity:Eu,speak:th,speed:Do,splice:Jl,splitAt:re,spread:Cr,square:kc,square2:of,squeeze:Bf,squiz:Qo,src:mn,stack:J,stackBy:$a,stackCentre:Ze,stackLeft:Xe,stackRight:Ye,steady:nf,steps:Ml,stepsPerOctave:to,striate:Fl,struct:Ja,stut:hl,stutWith:ul,stutwith:ll,sub:Va,superimpose:La,sus:Jn,sustain:Fn,sustainpedal:Xo,swing:Uu,swingBy:Gu,sz:xo,time:qc,timeCat:an,timecat:Nl,toBipolar:yu,tokenizeNote:$e,tremdp:Zo,tremolo:cc,tremolodepth:Yo,tremolorate:ti,tremr:ei,tri:cf,tri2:af,triode:oi,tsdelay:yi,uid:Wi,undegrade:If,undegradeBy:Lf,unicodeToBase64:Qe,uniq:qa,uniqsort:Aa,uniqsortr:Ve,unison:Tr,unit:Vo,v:sr,val:Hi,valueToMidi:ca,velocity:bn,vib:er,vibmod:or,vibrato:nr,vmod:ir,voice:yo,vowel:Go,waveloss:Uo,wchoose:xf,wchooseCycles:Oc,when:Yu,wrandcat:jf,xfade:fn,xsdelay:mi,zcrush:oc,zdelay:ic,zipWith:oe,zmod:rc,znoise:sc,zoom:Wu,zoomArc:Hu,zoomarc:Du,zrand:Ki,zzfx:ac},Symbol.toStringTag,{value:"Module"})),Ht=(e="test-canvas",t)=>{let{contextType:n="2d",pixelated:s=!1,pixelRatio:r=window.devicePixelRatio}=t||{},o=document.querySelector("#"+e);if(!o){o=document.createElement("canvas"),o.id=e,o.width=window.innerWidth*r,o.height=window.innerHeight*r,o.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",s&&(o.style.imageRendering="pixelated"),document.body.prepend(o);let i;window.addEventListener("resize",()=>{i&&clearTimeout(i),i=setTimeout(()=>{o.width=window.innerWidth*r,o.height=window.innerHeight*r},200)})}return o.getContext(n)};let bt={};function $c(e){bt[e]!==void 0&&(cancelAnimationFrame(bt[e]),delete bt[e])}function ih(){Object.keys(bt).forEach(e=>$c(e))}let ut={};m.prototype.draw=function(e,t){if(typeof window>"u")return this;let{id:n=1,lookbehind:s=0,lookahead:r=0}=t,o=Math.max(Xt(),0);$c(n),s=Math.abs(s),ut[n]=(ut[n]||[]).filter(f=>!f.isInFuture(o));let i=this.queryArc(o,o+r).filter(f=>f.hasOnset());ut[n]=ut[n].concat(i);let a;const u=()=>{const f=Xt(),l=f+r;ut[n]=ut[n].filter(p=>p.isInNearPast(s,f));let h=Math.max(a||l,l-1/10);const y=this.queryArc(h,l).filter(p=>p.hasOnset());ut[n]=ut[n].concat(y),a=l,e(ut[n],f,l,this),bt[n]=requestAnimationFrame(u)};return bt[n]=requestAnimationFrame(u),this};const gh=(e=!0)=>{const t=Ht();e&&t.clearRect(0,0,t.canvas.width,t.canvas.width),ih(),window.strudelScheduler&&clearInterval(window.strudelScheduler)};m.prototype.onPaint=function(){return console.warn("[draw] onPaint was not overloaded. Some drawings might not work"),this};class ch{constructor(t,n){this.onFrame=t,this.onError=n}start(){const t=this;let n=requestAnimationFrame(function s(r){try{t.onFrame(r)}catch(o){t.onError(o)}n=requestAnimationFrame(s)});t.cancel=()=>{cancelAnimationFrame(n)}}stop(){this.cancel&&this.cancel()}}class wh{constructor(t,n){this.visibleHaps=[],this.lastFrame=null,this.drawTime=n,this.framer=new ch(()=>{if(!this.scheduler){console.warn("Drawer: no scheduler");return}const s=Math.abs(this.drawTime[0]),r=this.drawTime[1],o=this.scheduler.now()+r;if(this.lastFrame===null){this.lastFrame=o;return}const i=this.scheduler.pattern.queryArc(Math.max(this.lastFrame,o-1/10),o);this.lastFrame=o,this.visibleHaps=(this.visibleHaps||[]).filter(u=>u.endClipped>=o-s-r).concat(i.filter(u=>u.hasOnset()));const a=o-r;t(this.visibleHaps,a,this)},s=>{console.warn("draw error",s)})}setDrawTime(t){this.drawTime=t}invalidate(t=this.scheduler,n){if(!t)return;n=n??t.now(),this.scheduler=t;let[s,r]=this.drawTime;const[o,i]=[Math.max(n,0),n+r+.1];this.visibleHaps=this.visibleHaps.filter(u=>u.whole.begin<n);const a=t.pattern.queryArc(o,i);this.visibleHaps=this.visibleHaps.concat(a)}start(t){this.scheduler=t,this.invalidate(),this.framer.start()}stop(){this.framer&&this.framer.stop()}}function bh(e){return typeof window>"u"?"#fff":getComputedStyle(document.documentElement).getPropertyValue(e)}let Rc={};function _t(){return Rc}function vh(e){Rc=e}let Be="#22222210";m.prototype.animate=function({callback:e,sync:t=!1,smear:n=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const s=Ht();let{clientWidth:r,clientHeight:o}=s.canvas;r*=window.devicePixelRatio,o*=window.devicePixelRatio;let i=n===0?"99":Number((1-n)*100).toFixed(0);i=i.length===1?`0${i}`:i,Be=`#200010${i}`;const a=u=>{let f;u=Math.round(u),f=this.slow(1e3).queryArc(u,u),s.fillStyle=Be,s.fillRect(0,0,r,o),f.forEach(l=>{let{x:h,y,w:p,h:_,s:v,r:q,angle:k=0,fill:E="darkseagreen"}=l.value;if(p*=r,_*=o,q!==void 0&&k!==void 0){const S=k*2*Math.PI,[B,F]=[(r-p)/2,(o-_)/2];h=B+Math.cos(S)*q*B,y=F+Math.sin(S)*q*F}else h*=r-p,y*=o-_;const O={...l.value,x:h,y,w:p,h:_};s.fillStyle=E,v==="rect"?s.fillRect(h,y,p,_):v==="ellipse"&&(s.beginPath(),s.ellipse(h+p/2,y+_/2,p/2,_/2,0,0,2*Math.PI),s.fill()),e&&e(s,O,l)}),window.frame=requestAnimationFrame(a)};return window.frame=requestAnimationFrame(a),P};const{x:Fc,y:_h,w:kh,h:qh,angle:Ah,r:Th,fill:Ch,smear:Sh}=de("x","y","w","h","angle","r","fill","smear"),Mh=d("rescale",function(e,t){return t.mul(Fc(e).w(e).y(e).h(e))}),Nh=d("moveXY",function(e,t,n){return n.add(Fc(e).y(t))}),Oh=d("zoomIn",function(e,t){const n=rt(1).sub(e).div(2);return t.rescale(e).move(n,n)}),Nt=(e,t,n)=>e*(n-t)+t,Pe=e=>{let{value:t}=e;typeof e.value!="object"&&(t={value:t});let{note:n,n:s,freq:r,s:o}=t;if(r)return te(r);if(n=n??s,typeof n=="string")try{return kt(n)}catch{return 0}return typeof n=="number"?n:o?"_"+o:t};m.prototype.pianoroll=function(e={}){let{cycles:t=4,playhead:n=.5,overscan:s=0,hideNegative:r=!1,ctx:o=Ht(),id:i=1}=e,a=-t*n,u=t*(1-n);const f=(l,h)=>(!r||l.whole.begin>=0)&&l.isWithinTime(h+a,h+u);return this.draw((l,h)=>{be({...e,time:h,ctx:o,haps:l.filter(y=>f(y,h))})},{lookbehind:a-s,lookahead:u+s,id:i}),this};function be({time:e,haps:t,cycles:n=4,playhead:s=.5,flipTime:r=0,flipValues:o=0,hideNegative:i=!1,inactive:a=_t().foreground,active:u=_t().foreground,background:f="transparent",smear:l=0,playheadColor:h="white",minMidi:y=10,maxMidi:p=90,autorange:_=0,timeframe:v,fold:q=0,vertical:k=0,labels:E=!1,fill:O=1,fillActive:S=!1,strokeActive:B=!0,stroke:F,hideInactive:tt=0,colorizeInactive:H=1,fontFamily:I,ctx:T,id:ct}={}){const L=T.canvas.width,nt=T.canvas.height;let ft=-n*s,C=n*(1-s);ct&&(t=t.filter(x=>x.hasTag(ct))),v&&(console.warn("timeframe is deprecated! use from/to instead"),ft=0,C=v);const M=k?nt:L,V=k?L:nt;let j=k?[M,0]:[0,M];const ht=C-ft,Pt=k?[0,V]:[V,0];let zt=p-y+1,yt=V/zt,Et=[];r&&j.reverse(),o&&Pt.reverse();const{min:Lc,max:Ic,values:Wc}=t.reduce(({min:x,max:Q,values:Tt},Ct)=>{const G=Pe(Ct);return{min:G<x?G:x,max:G>Q?G:Q,values:Tt.includes(G)?Tt:[...Tt,G]}},{min:1/0,max:-1/0,values:[]});_&&(y=Lc,p=Ic,zt=p-y+1),Et=Wc.sort((x,Q)=>typeof x=="number"&&typeof Q=="number"?x-Q:typeof x=="number"?1:String(x).localeCompare(String(Q))),yt=q?V/Et.length:V/zt,T.fillStyle=f,T.globalAlpha=1,l||(T.clearRect(0,0,L,nt),T.fillRect(0,0,L,nt)),t.forEach(x=>{const Q=x.whole.begin<=e&&x.endClipped>e;let Tt=F??(B&&Q),Ct=!Q&&O||Q&&S;if(tt&&!Q)return;let G=x.value?.color;u=G||u,a=H&&G||a,G=Q?u:a,T.fillStyle=Ct?G:"transparent",T.strokeStyle=G;const{velocity:Hc=1,gain:Dc=1}=x.value||{};T.globalAlpha=Hc*Dc;const Vc=(x.whole.begin-(r?C:ft))/ht,ve=Nt(Vc,...j);let St=Nt(x.duration/ht,0,M);const _e=Pe(x),Qc=q?Et.indexOf(_e)/Et.length:(Number(_e)-y)/zt,ke=Nt(Qc,...Pt);let qe=0;const Ae=Nt(e/ht,...j);let Mt;if(k?Mt=[ke+1-(o?yt:0),M-Ae+ve+qe+1-(r?0:St),yt-2,St-2]:Mt=[ve-Ae+qe+1-(r?St:0),ke+1-(o?0:yt),St-2,yt-2],Tt&&T.strokeRect(...Mt),Ct&&T.fillRect(...Mt),E){const Gc=x.value.note??x.value.s+(x.value.n?`:${x.value.n}`:""),{label:Te,activeLabel:Uc}=x.value,Kc=(Q&&Uc||Te)??Gc;let Xc=k?St:yt*.75;T.font=`${Xc}px ${I||"monospace"}`,T.fillStyle=Ct?"black":G,T.textBaseline="top",T.fillText(Kc,...Mt)}}),T.globalAlpha=1;const xt=Nt(-ft/ht,...j);return T.strokeStyle=h,T.beginPath(),k?(T.moveTo(0,xt),T.lineTo(V,xt)):(T.moveTo(xt,0),T.lineTo(xt,V)),T.stroke(),this}function Jc(e,t={}){let[n,s]=e;n=Math.abs(n);const r=s+n,o=n/r;return{fold:1,...t,cycles:r,playhead:o}}const ah=(e={})=>(t,n,s,r)=>be({ctx:t,time:n,haps:s,...Jc(r,e)});m.prototype.punchcard=function(e){return this.onPaint(ah(e))};m.prototype.wordfall=function(e){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...e})};function Bh(e){const{drawTime:t,...n}=e;be({...Jc(t),...n})}function uh(e,t,n,s){const r=(e-90)*Math.PI/180;return[n+Math.cos(r)*t,s+Math.sin(r)*t]}const ze=(e,t,n,s,r=0)=>uh((e+r)*360,t*e,n,s);function Ee(e){let{ctx:t,from:n=0,to:s=3,margin:r=50,cx:o=100,cy:i=100,rotate:a=0,thickness:u=r/2,color:f=_t().foreground,cap:l="round",stretch:h=1,fromOpacity:y=1,toOpacity:p=1}=e;n*=h,s*=h,a*=h,t.lineWidth=u,t.lineCap=l,t.strokeStyle=f,t.globalAlpha=y,t.beginPath();let[_,v]=ze(n,r,o,i,a);t.moveTo(_,v);const q=1/60;let k=n;for(;k<=s;){const[E,O]=ze(k,r,o,i,a);t.globalAlpha=(k-n)/(s-n)*p,t.lineTo(E,O),k+=q}t.stroke()}function lh(e){let{stretch:t=1,size:n=80,thickness:s=n/2,cap:r="butt",inset:o=3,playheadColor:i="#ffffff",playheadLength:a=.02,playheadThickness:u=s,padding:f=0,steady:l=1,activeColor:h=_t().foreground,inactiveColor:y=_t().gutterForeground,colorizeInactive:p=0,fade:_=!0,ctx:v,time:q,haps:k,drawTime:E,id:O}=e;O&&(k=k.filter(L=>L.hasTag(O)));const[S,B]=[v.canvas.width,v.canvas.height];v.clearRect(0,0,S*2,B*2);const[F,tt]=[S/2,B/2],H={margin:n/t,cx:F,cy:tt,stretch:t,cap:r,thickness:s},I={...H,thickness:u,from:o-a,to:o,color:i},[T]=E,ct=l*q;k.forEach(L=>{const nt=L.whole.begin<=q&&L.endClipped>q,ft=L.whole.begin-q+o,C=L.endClipped-q+o-f,M=L.value?.color||h,V=p||nt?M:y,j=_?1-Math.abs((L.whole.begin-q)/T):1;Ee({ctx:v,...H,from:ft,to:C,rotate:ct,color:V,fromOpacity:j,toOpacity:j})}),Ee({ctx:v,...I,rotate:ct})}m.prototype.spiral=function(e={}){return this.onPaint((t,n,s,r)=>lh({ctx:t,time:n,haps:s,drawTime:r,...e}))};const fh=dt(36),xe=(e,t,n,s)=>{s=s*Math.PI*2;const r=Math.sin(s)*n+e,o=Math.cos(s)*n+t;return[r,o]},je=(e,t)=>.5-Math.log2(e/t)%1;function hh({haps:e,ctx:t,id:n,hapcircles:s=1,circle:r=0,edo:o=12,root:i=fh,thickness:a=3,hapRadius:u=6,mode:f="flake",margin:l=10}={}){const h=f==="polygon",y=f==="flake",p=t.canvas.width,_=t.canvas.height;t.clearRect(0,0,p,_);const v=_t().foreground,k=Math.min(p,_)/2-a/2-u-l,E=p/2,O=_/2;n&&(e=e.filter(B=>B.hasTag(n))),t.strokeStyle=v,t.fillStyle=v,t.globalAlpha=1,t.lineWidth=a,r&&(t.beginPath(),t.arc(E,O,k,0,2*Math.PI),t.stroke()),o&&(Array.from({length:o},(B,F)=>{const tt=je(i*Math.pow(2,F/o),i),[H,I]=xe(E,O,k,tt);t.beginPath(),t.arc(H,I,u,0,2*Math.PI),t.fill()}),t.stroke());let S=[];t.lineWidth=u,e.forEach(B=>{let F;try{F=Je(B)}catch{return}const tt=je(F,i),[H,I]=xe(E,O,k,tt),T=B.value.color||v;t.strokeStyle=T,t.fillStyle=T;const{velocity:ct=1,gain:L=1}=B.value||{},nt=ct*L;t.globalAlpha=nt,S.push([H,I,tt,T,nt]),t.beginPath(),s&&(t.moveTo(H+u,I),t.arc(H,I,u,0,2*Math.PI),t.fill()),y&&(t.moveTo(E,O),t.lineTo(H,I)),t.stroke()}),t.strokeStyle=v,t.globalAlpha=1,h&&S.length&&(S=S.sort((B,F)=>B[2]-F[2]),t.beginPath(),t.moveTo(S[0][0],S[0][1]),S.forEach(([B,F,tt,H,I])=>{t.strokeStyle=H,t.globalAlpha=I,t.lineTo(B,F)}),t.lineTo(S[0][0],S[0][1]),t.stroke())}m.prototype.pitchwheel=function(e={}){let{ctx:t=Ht(),id:n=1}=e;return this.tag(n).onPaint((s,r,o)=>hh({...e,time:r,ctx:t,haps:o.filter(i=>i.isActive(r)),id:n}))};let D=[],dh=(e,t)=>{let n=[],s={get(){return s.lc||s.listen(()=>{})(),s.value},l:t||0,lc:0,listen(r,o){return s.lc=n.push(r,o||s.l)/2,()=>{let i=n.indexOf(r);~i&&(n.splice(i,2),--s.lc||s.off())}},notify(r){let o=!D.length;for(let i=0;i<n.length;i+=2)D.push(n[i],n[i+1],s.value,r);if(o){for(let i=0;i<D.length;i+=4){let a;for(let u=i+1;!a&&(u+=4)<D.length;)D[u]<D[i+1]&&(a=D.push(D[i],D[i+1],D[i+2],D[i+3]));a||D[i](D[i+2],D[i+3])}D.length=0}},off(){},set(r){s.value!==r&&(s.value=r,s.notify())},subscribe(r,o){let i=s.listen(r,o);return r(s.value),i},value:e};return s},Ph=(e={})=>{let t=dh(e);return t.setKey=function(n,s){typeof s>"u"?n in t.value&&(t.value={...t.value},delete t.value[n],t.notify(n)):t.value[n]!==s&&(t.value={...t.value,[n]:s},t.notify(n))},t};export{Sc as $,la as A,ie as B,W as C,wh as D,Vl as E,ch as F,d as G,Je as H,Ft as I,fa as J,te as K,ha as L,Ph as M,yh as N,Ec as O,m as P,jc as Q,De as R,rt as S,P as T,J as U,g as V,an as W,Bt as X,st as Y,ot as Z,Ot as _,Ah as a,Z as a0,b as a1,Oa as a2,dh as a3,sh as a4,Ta as a5,ca as a6,Pc as a7,Ca as a8,Mh as b,gh as c,bh as d,_t as e,Ch as f,Ht as g,qh as h,vh as i,Jc as j,ah as k,Bh as l,Nh as m,hh as n,Do as o,be as p,$o as q,Th as r,Sh as s,kt as t,aa as u,ne as v,kh as w,Fc as x,_h as y,Oh as z};
//# sourceMappingURL=index.Cq8ZdErn.js.map
