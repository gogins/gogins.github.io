import{P as R,g as ce,j as He,k as Ee,d as ee,o as Ie,q as Oe,n as Re,e as ze,t as Le}from"./index.CEVOgZNG.js";const x=(n="test-canvas",e)=>{let{contextType:t="2d",pixelated:o=!1,pixelRatio:i=window.devicePixelRatio}=e||{},r=document.querySelector("#"+n);if(!r){r=document.createElement("canvas"),r.id=n,r.width=window.innerWidth*i,r.height=window.innerHeight*i,r.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",o&&(r.style.imageRendering="pixelated"),document.body.prepend(r);let s;window.addEventListener("resize",()=>{s&&clearTimeout(s),s=setTimeout(()=>{r.width=window.innerWidth*i,r.height=window.innerHeight*i},200)})}return r.getContext(t)};let N={};function ge(n){N[n]!==void 0&&(cancelAnimationFrame(N[n]),delete N[n])}function We(n){Object.keys(N).forEach(e=>(!n||e.startsWith(n))&&ge(e))}let O={};R.prototype.draw=function(n,e){if(typeof window>"u")return this;let{id:t=1,lookbehind:o=0,lookahead:i=0}=e,r=Math.max(ce(),0);ge(t),o=Math.abs(o),O[t]=(O[t]||[]).filter(m=>!m.isInFuture(r));let s=this.queryArc(r,r+i).filter(m=>m.hasOnset());O[t]=O[t].concat(s);let l;const a=()=>{const m=ce(),h=m+i;O[t]=O[t].filter(f=>f.isInNearPast(o,m));let u=Math.max(l||h,h-1/10);const g=this.queryArc(u,h).filter(f=>f.hasOnset());O[t]=O[t].concat(g),l=h,n(O[t],m,h,this),N[t]=requestAnimationFrame(a)};return N[t]=requestAnimationFrame(a),this};const Ge=(n=!0,e)=>{const t=x();n&&t.clearRect(0,0,t.canvas.width,t.canvas.height),We(e)};R.prototype.onPaint=function(n){return this.withState(e=>{e.controls.painters||(e.controls.painters=[]),e.controls.painters.push(n)})};R.prototype.getPainters=function(){let n=[];return this.queryArc(0,0,{painters:n}),n};class $e{constructor(e,t){this.onFrame=e,this.onError=t}start(){const e=this;let t=requestAnimationFrame(function o(i){try{e.onFrame(i)}catch(r){e.onError(r)}t=requestAnimationFrame(o)});e.cancel=()=>{cancelAnimationFrame(t)}}stop(){this.cancel&&this.cancel()}}class Je{constructor(e,t){this.visibleHaps=[],this.lastFrame=null,this.drawTime=t,this.painters=[],this.framer=new $e(()=>{if(!this.scheduler){console.warn("Drawer: no scheduler");return}const o=Math.abs(this.drawTime[0]),i=this.drawTime[1],r=this.scheduler.now()+i;if(this.lastFrame===null){this.lastFrame=r;return}const s=this.scheduler.pattern.queryArc(Math.max(this.lastFrame,r-1/10),r);this.lastFrame=r,this.visibleHaps=(this.visibleHaps||[]).filter(a=>a.endClipped>=r-o-i).concat(s.filter(a=>a.hasOnset()));const l=r-i;e(this.visibleHaps,l,this,this.painters)},o=>{console.warn("draw error",o)})}setDrawTime(e){this.drawTime=e}invalidate(e=this.scheduler,t){if(!e)return;t=t??e.now(),this.scheduler=e;let[o,i]=this.drawTime;const[r,s]=[Math.max(t,0),t+i+.1];this.visibleHaps=this.visibleHaps.filter(a=>a.whole.begin<t),this.painters=[];const l=e.pattern.queryArc(r,s,{painters:this.painters});this.visibleHaps=this.visibleHaps.concat(l)}start(e){this.scheduler=e,this.invalidate(),this.framer.start()}stop(){this.framer&&this.framer.stop()}}function Ue(n){return typeof window>"u"?"#fff":getComputedStyle(document.documentElement).getPropertyValue(n)}let ye={background:"#222",foreground:"#75baff",caret:"#ffcc00",selection:"rgba(128, 203, 196, 0.5)",selectionMatch:"#036dd626",lineHighlight:"#00000050",gutterBackground:"transparent",gutterForeground:"#8a919966"};function $(){return ye}function Ve(n){ye=n}let he="#22222210";R.prototype.animate=function({callback:n,sync:e=!1,smear:t=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const o=x();let{clientWidth:i,clientHeight:r}=o.canvas;i*=window.devicePixelRatio,r*=window.devicePixelRatio;let s=t===0?"99":Number((1-t)*100).toFixed(0);s=s.length===1?`0${s}`:s,he=`#200010${s}`;const l=a=>{let m;a=Math.round(a),m=this.slow(1e3).queryArc(a,a),o.fillStyle=he,o.fillRect(0,0,i,r),m.forEach(h=>{let{x:u,y:g,w:f,h:b,s:y,r:P,angle:d=0,fill:_="darkseagreen"}=h.value;if(f*=i,b*=r,P!==void 0&&d!==void 0){const v=d*2*Math.PI,[w,T]=[(i-f)/2,(r-b)/2];u=w+Math.cos(v)*P*w,g=T+Math.sin(v)*P*T}else u*=i-f,g*=r-b;const F={...h.value,x:u,y:g,w:f,h:b};o.fillStyle=_,y==="rect"?o.fillRect(u,g,f,b):y==="ellipse"&&(o.beginPath(),o.ellipse(u+f/2,g+b/2,f/2,b/2,0,0,2*Math.PI),o.fill()),n&&n(o,F,h)}),window.frame=requestAnimationFrame(l)};return window.frame=requestAnimationFrame(l),He};const{x:we,y:Ze,w:xe,h:et,angle:tt,r:nt,fill:ot,smear:it}=Ee("x","y","w","h","angle","r","fill","smear"),rt=ee("rescale",function(n,e){return e.mul(we(n).w(n).y(n).h(n))}),st=ee("moveXY",function(n,e,t){return t.add(we(n).y(e))}),at=ee("zoomIn",function(n,e){const t=Ie(1).sub(n).div(2);return e.rescale(n).move(t,t)}),G=(n,e,t)=>n*(t-e)+e,ue=n=>{let{value:e}=n;typeof n.value!="object"&&(e={value:e});let{note:t,n:o,freq:i,s:r}=e;if(i)return Oe(i);if(t=t??o,typeof t=="string")try{return Re(t)}catch{return 0}return typeof t=="number"?t:r?"_"+r:e};R.prototype.pianoroll=function(n={}){let{cycles:e=4,playhead:t=.5,overscan:o=0,hideNegative:i=!1,ctx:r=x(),id:s=1}=n,l=-e*t,a=e*(1-t);const m=(h,u)=>(!i||h.whole.begin>=0)&&h.isWithinTime(u+l,u+a);return this.draw((h,u)=>{globalThis.haps_from_outputs||(globalThis.haps_from_outputs=[]),globalThis.haps_from_outputs.length>0&&(h.push(...globalThis.haps_from_outputs),h=globalThis.haps_from_outputs.filter(m),globalThis.haps_from_outputs=h),te({...n,time:u,ctx:r,haps:h.filter(g=>m(g,u))})},{lookbehind:l-o,lookahead:a+o,id:s}),this};function te({time:n,haps:e,cycles:t=4,playhead:o=.5,flipTime:i=0,flipValues:r=0,hideNegative:s=!1,inactive:l=$().foreground,active:a=$().foreground,background:m="transparent",smear:h=0,playheadColor:u=$().foreground,minMidi:g=10,maxMidi:f=90,autorange:b=0,timeframe:y,fold:P=1,vertical:d=0,labels:_=!1,fill:F=1,fillActive:v=!1,strokeActive:w=!0,stroke:T,hideInactive:H=0,colorizeInactive:M=1,fontFamily:C,ctx:c,id:z}={}){const A=c.canvas.width,E=c.canvas.height;let L=-t*o,X=t*(1-o);z&&(e=e.filter(p=>p.hasTag(z))),y&&(console.warn("timeframe is deprecated! use from/to instead"),L=0,X=y);const D=d?E:A,I=d?A:E;let W=d?[D,0]:[0,D];const J=X-L,ne=d?[0,I]:[I,0];let U=f-g+1,j=I/U,V=[];i&&W.reverse(),r&&ne.reverse();const{min:ve,max:Pe,values:Te}=e.reduce(({min:p,max:S,values:Y},B)=>{const q=ue(B);return{min:q<p?q:p,max:q>S?q:S,values:Y.includes(q)?Y:[...Y,q]}},{min:1/0,max:-1/0,values:[]});b&&(g=ve,f=Pe,U=f-g+1),V=Te.sort((p,S)=>typeof p=="number"&&typeof S=="number"?p-S:typeof p=="number"?1:String(p).localeCompare(String(S))),j=P?I/V.length:I/U,c.fillStyle=m,c.globalAlpha=1,h||(c.clearRect(0,0,A,E),c.fillRect(0,0,A,E)),e.forEach(p=>{const S=p.whole.begin<=n&&p.endClipped>n;let Y=T??(w&&S),B=!S&&F||S&&v;if(H&&!S)return;let q=p.value?.color;a=q||a,l=M&&q||l,q=S?a:l,c.fillStyle=B?q:"transparent",c.strokeStyle=q;const{velocity:Ae=1,gain:ke=1}=p.value||{};c.globalAlpha=Ae*ke;const Fe=(p.whole.begin-(i?X:L))/J,oe=G(Fe,...W);let Q=G(p.duration/J,0,D);const ie=ue(p),Me=P?V.indexOf(ie)/V.length:(Number(ie)-g)/U,re=G(Me,...ne);let se=0;const ae=G(n/J,...W);let K;if(d?K=[re+1-(r?j:0),D-ae+oe+se+1-(i?0:Q),j-2,Q-2]:K=[oe-ae+se+1-(i?Q:0),re+1-(r?0:j),Q-2,j-2],Y&&c.strokeRect(...K),B&&c.fillRect(...K),_){const Se=p.value.note??p.value.s+(p.value.n?`:${p.value.n}`:""),{label:le,activeLabel:qe}=p.value,_e=(S&&qe||le)??Se;let Ce=d?Q:j*.75;c.font=`${Ce}px ${C||"monospace"}`,c.fillStyle=B?"black":q,c.textBaseline="top",c.fillText(_e,...K)}}),c.globalAlpha=1;const Z=G(-L/J,...W);return c.strokeStyle=u,c.beginPath(),d?(c.moveTo(0,Z),c.lineTo(I,Z)):(c.moveTo(Z,0),c.lineTo(Z,I)),c.stroke(),this}function be(n,e={}){let[t,o]=n;t=Math.abs(t);const i=o+t,r=i!==0?t/i:0;return{fold:1,...e,cycles:i,playhead:r}}const De=(n={})=>(e,t,o,i)=>te({ctx:e,time:t,haps:o,...be(i,n)});R.prototype.punchcard=function(n){return this.onPaint(De(n))};R.prototype.wordfall=function(n){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...n})};function lt(n){const{drawTime:e,...t}=n;te({...be(e),...t})}function je(n,e,t,o){const i=(n-90)*Math.PI/180;return[t+Math.cos(i)*e,o+Math.sin(i)*e]}const fe=(n,e,t,o,i=0)=>je((n+i)*360,e*n,t,o);function de(n){let{ctx:e,from:t=0,to:o=3,margin:i=50,cx:r=100,cy:s=100,rotate:l=0,thickness:a=i/2,color:m=$().foreground,cap:h="round",stretch:u=1,fromOpacity:g=1,toOpacity:f=1}=n;t*=u,o*=u,l*=u,e.lineWidth=a,e.lineCap=h,e.strokeStyle=m,e.globalAlpha=g,e.beginPath();let[b,y]=fe(t,i,r,s,l);e.moveTo(b,y);const P=1/60;let d=t;for(;d<=o;){const[_,F]=fe(d,i,r,s,l);e.globalAlpha=(d-t)/(o-t)*f,e.lineTo(_,F),d+=P}e.stroke()}function Ne(n){let{stretch:e=1,size:t=80,thickness:o=t/2,cap:i="butt",inset:r=3,playheadColor:s="#ffffff",playheadLength:l=.02,playheadThickness:a=o,padding:m=0,steady:h=1,activeColor:u=$().foreground,inactiveColor:g=$().gutterForeground,colorizeInactive:f=0,fade:b=!0,ctx:y,time:P,haps:d,drawTime:_,id:F}=n;F&&(d=d.filter(A=>A.hasTag(F)));const[v,w]=[y.canvas.width,y.canvas.height];y.clearRect(0,0,v*2,w*2);const[T,H]=[v/2,w/2],M={margin:t/e,cx:T,cy:H,stretch:e,cap:i,thickness:o},C={...M,thickness:a,from:r-l,to:r,color:s},[c]=_,z=h*P;d.forEach(A=>{const E=A.whole.begin<=P&&A.endClipped>P,L=A.whole.begin-P+r,X=A.endClipped-P+r-m,D=A.value?.color||u,I=f||E?D:g,W=b?1-Math.abs((A.whole.begin-P)/c):1;de({ctx:y,...M,from:L,to:X,rotate:z,color:I,fromOpacity:W,toOpacity:W})}),de({ctx:y,...C,rotate:z})}R.prototype.spiral=function(n={}){return this.onPaint((e,t,o,i)=>Ne({ctx:e,time:t,haps:o,drawTime:i,...n}))};const Xe=Le(36),me=(n,e,t,o)=>{o=o*Math.PI*2;const i=Math.sin(o)*t+n,r=Math.cos(o)*t+e;return[i,r]},pe=(n,e)=>.5-Math.log2(n/e)%1;function Ye({haps:n,ctx:e,id:t,hapcircles:o=1,circle:i=0,edo:r=12,root:s=Xe,thickness:l=3,hapRadius:a=6,mode:m="flake",margin:h=10}={}){const u=m==="polygon",g=m==="flake",f=e.canvas.width,b=e.canvas.height;e.clearRect(0,0,f,b);const y=$().foreground,d=Math.min(f,b)/2-l/2-a-h,_=f/2,F=b/2;t&&(n=n.filter(w=>w.hasTag(t))),e.strokeStyle=y,e.fillStyle=y,e.globalAlpha=1,e.lineWidth=l,i&&(e.beginPath(),e.arc(_,F,d,0,2*Math.PI),e.stroke()),r&&(Array.from({length:r},(w,T)=>{const H=pe(s*Math.pow(2,T/r),s),[M,C]=me(_,F,d,H);e.beginPath(),e.arc(M,C,a,0,2*Math.PI),e.fill()}),e.stroke());let v=[];e.lineWidth=a,n.forEach(w=>{let T;try{T=ze(w)}catch{return}const H=pe(T,s),[M,C]=me(_,F,d,H),c=w.value.color||y;e.strokeStyle=c,e.fillStyle=c;const{velocity:z=1,gain:A=1}=w.value||{},E=z*A;e.globalAlpha=E,v.push([M,C,H,c,E]),e.beginPath(),o&&(e.moveTo(M+a,C),e.arc(M,C,a,0,2*Math.PI),e.fill()),g&&(e.moveTo(_,F),e.lineTo(M,C)),e.stroke()}),e.strokeStyle=y,e.globalAlpha=1,u&&v.length&&(v=v.sort((w,T)=>w[2]-T[2]),e.beginPath(),e.moveTo(v[0][0],v[0][1]),v.forEach(([w,T,H,M,C])=>{e.strokeStyle=M,e.globalAlpha=C,e.lineTo(w,T)}),e.lineTo(v[0][0],v[0][1]),e.stroke())}R.prototype.pitchwheel=function(n={}){let{ctx:e=x(),id:t=1}=n;return this.tag(t).onPaint((o,i,r)=>Ye({...n,time:i,ctx:e,haps:r.filter(s=>s.isActive(i)),id:t}))};let k=[],Be=(n,e)=>{let t=[],o={get(){return o.lc||o.listen(()=>{})(),o.value},l:e||0,lc:0,listen(i,r){return o.lc=t.push(i,r||o.l)/2,()=>{let s=t.indexOf(i);~s&&(t.splice(s,2),--o.lc||o.off())}},notify(i){let r=!k.length;for(let s=0;s<t.length;s+=2)k.push(t[s],t[s+1],o.value,i);if(r){for(let s=0;s<k.length;s+=4){let l;for(let a=s+1;!l&&(a+=4)<k.length;)k[a]<k[s+1]&&(l=k.push(k[s],k[s+1],k[s+2],k[s+3]));l||k[s](k[s+2],k[s+3])}k.length=0}},off(){},set(i){o.value!==i&&(o.value=i,o.notify())},subscribe(i,r){let s=o.listen(i,r);return i(o.value),s},value:n};return o},ct=(n={})=>{let e=Be(n);return e.setKey=function(t,o){typeof o>"u"?t in e.value&&(e.value={...e.value},delete e.value[t],e.notify(t)):e.value[t]!==o&&(e.value={...e.value,[t]:o},e.notify(t))},e};export{Je as D,$e as F,tt as a,rt as b,Ge as c,Ue as d,$ as e,ot as f,x as g,et as h,Ve as i,be as j,De as k,lt as l,st as m,Ye as n,ct as o,te as p,Be as q,nt as r,it as s,xe as w,we as x,Ze as y,at as z};
//# sourceMappingURL=index.D_JsPLR7.js.map
